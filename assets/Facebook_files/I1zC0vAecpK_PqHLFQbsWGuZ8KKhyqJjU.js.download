;/*FB_PKG_DELIM*/

__d("BlobStorageTypes",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}f.toBlobFileName=a}),66);
__d("EBAPI",["MAWEBCombinedSwitch","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=(a=c("requireDeferred"))("EBAPIMinosVerifySingleEpoch").__setRef("EBAPI"),i=a("EBAPIWriteMinosPublicKeysForRecipient").__setRef("EBAPI"),j=a("EBGetContactEpochHead").__setRef("EBAPI"),k=a("EBGetMessageKeys").__setRef("EBAPI"),l=a("EBIsEbEnabled").__setRef("EBAPI"),m=a("EBMessageBulkPointQuery").__setRef("EBAPI"),n=a("EBMessageRangeQueryForIndexing").__setRef("EBAPI"),o=a("EBMinosWriteKeyChangeAdminMessage").__setRef("EBAPI"),p=a("EBMinosWriteSecureStorageAlert").__setRef("EBAPI"),q=a("EBUploadDeletedMessage").__setRef("EBAPI"),r=a("EBUploadReceivedMessages").__setRef("EBAPI"),s=a("EBUploadReceivedMessagesProtobufOnly").__setRef("EBAPI"),t=a("EBUploadSentMessage").__setRef("EBAPI");b={getContactEpochHead:function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return j.load().then(function(a){return a.getContactEpochHead.apply(a,b)})},getMessageKeys:function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return k.load().then(function(a){return a.getMessageKeys.apply(a,b)})},isEBEnabled:function(){return d("MAWEBCombinedSwitch").MAWEBCombinedSwitch.isEnabled()},isEbEnabledEbSwitch:function(){return l.load().then(function(a){return a.isEbEnabledEbSwitch()})},messageBulkPointQuery:function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return m.load().then(function(a){return a.messageBulkPointQuery.apply(a,b)})},messageRangeQueryForIndexing:function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return n.load().then(function(a){return a.messageRangeQueryForIndexing.apply(a,b)})},minosVerifySingleEpoch:function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return h.load().then(function(a){return a.minosVerifySingleEpoch.apply(a,b)})},uploadDeletedMessage:function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return q.load().then(function(a){return a.uploadDeletedMessage.apply(a,b)})},uploadReceivedMessages:function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return r.load().then(function(a){return a.uploadReceivedMessages.apply(a,b)})},uploadReceivedMessagesProtobufOnly:function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return s.load().then(function(a){return a.uploadReceivedMessagesProtobufOnly.apply(a,b)})},uploadSentMessage:function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return t.load().then(function(a){return a.uploadSentMessage.apply(a,b)})},writeMinosKeyChangeAdminMessage:function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return o.load().then(function(a){return a.writeMinosKeyChangeAdminMessage.apply(a,b)})},writeMinosMailboxKeysForRecipientAPI:function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return i.load().then(function(a){return a.writeMinosMailboxKeysForRecipientAPI.apply(a,b)})},writeMinosSecureStorageAlert:function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return p.load().then(function(a){return a.writeMinosSecureStorageAlert.apply(a,b)})}};e=b;g["default"]=e}),98);
__d("MEBEncryptionVersion",[],(function(a,b,c,d,e,f){a=Object.freeze({UNKNOWN:0,ENCRYPTION_KDF_WITH_VERSION:2,ENCRYPTION_KDF_WITH_NULL_SALT:3,ENCRYPTION_KDF_WITH_NULL_SALT_DF_CANARY:4,TEST_VERSION:99});f["default"]=a}),66);
__d("EBCryptoUtils",["Base64Utils","EncryptedBackupsSymmetricEncryptionUtils","HChaCha20","MEBEncryptionVersion","SymmetricEncryptionCreateEncryptedData","SymmetricEncryptionPaddingUtils","XPlatReactCrypto","err"],(function(a,b,c,d,e,f,g){"use strict";var h=32,i=2147483647,j="message_key_in_epoch",k="_",l="cipher_version",m="thread",n="message_thread";f="supplemental_enc_aad";var o="kdf_info:mailbox_root_key_v2>supplemental_enc_key";function a(a,b,d,e){var f=d>=c("MEBEncryptionVersion").ENCRYPTION_KDF_WITH_NULL_SALT?null:p(e);a=q(a,d,e);if(a==null)throw c("err")("Error in derive message symmetric key. info is null");return s(a,f,b,[h])}function p(a){try{return new TextEncoder().encode(a).buffer}catch(a){throw c("err")("Error in get blob from string with exception: ",a)}}function q(a,b,c){a=r(a,b,c);return p(a)}function r(a,b,d){if(b>=c("MEBEncryptionVersion").ENCRYPTION_KDF_WITH_NULL_SALT_DF_CANARY||b>=c("MEBEncryptionVersion").ENCRYPTION_KDF_WITH_NULL_SALT)return[j,new TextDecoder().decode(a),l,b,m,d!=null?d:""].join(k);else if(b>=c("MEBEncryptionVersion").ENCRYPTION_KDF_WITH_VERSION)return[j,new TextDecoder().decode(a),l,b].join(k);else return[j,new TextDecoder().decode(a)].join(k)}function s(a,b,e,f){if(f.length<1||f.some(function(a){return a>i}))throw c("err")("Invalid key lengths for derive keys");var g=f.reduce(function(a,b){return a+b},0)*8;return d("XPlatReactCrypto").subtleImportKey("raw",e,"HKDF",!1,["deriveBits"]).then(function(c){return d("XPlatReactCrypto").subtleDeriveBits({hash:"SHA-256",info:a,name:"HKDF",salt:b!=null?b:new Uint8Array(10).buffer},c,g)}).then(function(a){a=new Uint8Array(a);var b=[],c=0;for(var d=0,e=f.length;d<e;++d){var g=c+f[d];b.push(a.slice(c,g).buffer);c=g}return b}).catch(function(a){throw c("err")("Exception in create derived keys",a)})}function b(a,b,e){e=d("Base64Utils").toArrayBuffer(e);return t(a,b,e).then(function(a){if(a==null)throw c("err")("symmetric string decryption with null result");return a}).catch(function(a){throw c("err")("symmetric string decryption failed with error",a)})}function t(a,b,e){if(e.byteLength<d("EncryptedBackupsSymmetricEncryptionUtils").hChaCha20SubKeyNonceLengthInBytes+d("EncryptedBackupsSymmetricEncryptionUtils").aesGcmTagLengthInBytes)throw c("err")("cipher text is invalid");e=new Uint8Array(e);var f=e.slice(0,d("EncryptedBackupsSymmetricEncryptionUtils").totalNonceLengthInBytes),g=new(d("HChaCha20").HChaCha20)(),h=e.slice(d("EncryptedBackupsSymmetricEncryptionUtils").totalNonceLengthInBytes).buffer;e=g.hChaCha20Bytes(f.slice(0,d("EncryptedBackupsSymmetricEncryptionUtils").hChaCha20SubKeyNonceLengthInBytes).buffer,a);return d("XPlatReactCrypto").subtleImportKey("raw",e,"AES-GCM",!1,["decrypt"]).then(function(a){return d("XPlatReactCrypto").subtleDecrypt({additionalData:b,iv:new Uint8Array(f.slice(d("EncryptedBackupsSymmetricEncryptionUtils").hChaCha20SubKeyNonceLengthInBytes).buffer),name:"AES-GCM",tagLength:d("EncryptedBackupsSymmetricEncryptionUtils").aesGcmTagLength},a,h)}).then(function(a){a=d("SymmetricEncryptionPaddingUtils").stripPadding(a);if(a==null)throw c("err")("Failed to strip padding for symmetric decryption");return a}).catch(function(a){throw c("err")("symmetric data decryption failed with error",a)})}async function e(a,b,e){b=await c("SymmetricEncryptionCreateEncryptedData")(b,new TextEncoder().encode([n,e].join(k)).buffer,a);e=b[0];return e!=null?d("Base64Utils").fromArrayBuffer(e):null}g.KEY_LEN=h;g.MAX_INT_32=i;g.STRING_JOIN_SEPARATOR=k;g.MESSAGE_ENCYPTION_AAD=n;g.SUPPLEMENTAL_ENC_AAD=f;g.SUPPLEMENTAL_ENC_KEY_INFO=o;g.deriveMessageSymmetricKey=a;g.getBlobFromString=p;g.createDerivedKeys=s;g.symmetricEncryptionCreateDecryptedString=b;g.encryptThenBase64EncodeBlob=e}),98);
__d("EBEchoMessageDecryptor",["EBCryptoUtils","I64","LSAuthorityLevel","LSIntEnum","MEBEncryptionVersion","ReQL","WACryptoUtils","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n;async function o(a,b,e){if(b==null){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] No backup id provided"])));return[]}a=await d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.tables.secure_encrypted_backups_epochs));if(a.length===0){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] SecureEncryptedBackupsEpoch table is empty"])));return[]}return a.filter(function(a){return(m||(m=d("I64"))).equal(a.authorityLevel,(n||(n=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE))&&(m||(m=d("I64"))).equal(a.backupId,(m||(m=d("I64"))).of_string(b))&&e.equals(a[e.key])})}function p(a,b){var c=b.epoch_id;return c!=null?o(a,b.backup_id,{equals:function(a){return a instanceof ArrayBuffer?!1:(m||(m=d("I64"))).equal(c,a)},key:"epochId",value:c}):o(a,b.backup_id,{equals:function(a){return a instanceof ArrayBuffer?d("WACryptoUtils").arrayBuffersEqual(b.epoch_anon_id,a):!1},key:"epochAnonIdBlob",value:b.epoch_anon_id})}a=function(){function a(){}var b=a.prototype;b.decrypt=function(a,b,e){e=e.map(async function(e){if(e.value==null){d("WALogger").ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Empty echo message string - cannot decrypt"])));return{otid:e.otid,value:void 0}}var f=e.value,g=await p(a,e);if(g.length===0){d("WALogger").ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] No epoch keys found for message"])));return{otid:e.otid,value:void 0}}g=await d("EBCryptoUtils").deriveMessageSymmetricKey(g[0].epochAnonIdBlob,g[0].epochRootKeyBlob,(g=e.encryption_version)!=null?g:c("MEBEncryptionVersion").UNKNOWN,b);if(g==null||g.length===0){d("WALogger").ERROR(l||(l=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to derive symmetric key for message"])));return{otid:e.otid,value:void 0}}g=await d("EBCryptoUtils").symmetricEncryptionCreateDecryptedString(g[0],new TextEncoder().encode([d("EBCryptoUtils").MESSAGE_ENCYPTION_AAD,b].join(d("EBCryptoUtils").STRING_JOIN_SEPARATOR)).buffer,f);return{otid:e.otid,value:g!=null?new TextDecoder().decode(g):void 0}});return Promise.all(e)};return a}();g.getEpochKeysByID=p;g.EchoMessageDecryptor=a}),98);
__d("EBProtobufMessageDecryptor",["Base64Utils","EBCryptoUtils","EBEchoMessageDecryptor","MEBEncryptionVersion","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p;a=function(){function a(){}var b=a.prototype;b.$1=async function(a,b,e){var f;a=await d("EBEchoMessageDecryptor").getEpochKeysByID(a,e);if(a.length===0){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] No epoch keys found for message"])));return}a=a[0];f=await d("EBCryptoUtils").deriveMessageSymmetricKey(a.epochAnonIdBlob,a.epochRootKeyBlob,(f=e.encryption_version)!=null?f:c("MEBEncryptionVersion").UNKNOWN,b);if(f==null||f.length===0){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to derive symmetric key for message"])));return}if(e.encryptedProtobufContent==null){d("WALogger").ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] encrypted protobuf content is null"])));return}var g=e.encryptedProtobufContent;f=await d("EBCryptoUtils").symmetricEncryptionCreateDecryptedString(f[0],new TextEncoder().encode([d("EBCryptoUtils").MESSAGE_ENCYPTION_AAD,b].join(d("EBCryptoUtils").STRING_JOIN_SEPARATOR)).buffer,g);var m;if(e.skCipherText!=null){b=e.skCipherText;a=await (g=d("EBCryptoUtils")).createDerivedKeys(new TextEncoder().encode(g.SUPPLEMENTAL_ENC_KEY_INFO).buffer,void 0,a.epochRootKeyBlob,[g.KEY_LEN]);m=await g.symmetricEncryptionCreateDecryptedString(a[0],new TextEncoder().encode(g.SUPPLEMENTAL_ENC_AAD).buffer,b)}if(f==null){d("WALogger").ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to decrypt protobuf"])));return}a=d("Base64Utils").fromArrayBuffer(f);if(e.protobufTimestampMs==null){d("WALogger").ERROR(l||(l=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] protobuf timestamp is null"])));return}g=e.protobufTimestampMs;return{decryptedProtobuf:a,decryptedSupplementalKey:m!=null?new TextDecoder().decode(m):void 0,protobufTimestampMs:g}};b.$2=async function(a,b,c){var e=this,f=c.topLevelProtobuf,g=c.supplementalProtobufs;f=await this.$1(a,b,f);if(f==null){d("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to decrypt top level protobuf"])));return}var h=new Map();await Promise.all(g.map(async function(c){c=await e.$1(a,b,c);if(c==null){d("WALogger").ERROR(n||(n=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to decrypt supplemental protobuf"])));return}var f=c.decryptedSupplementalKey;if(f==null){d("WALogger").ERROR(o||(o=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] decrypted supplemental key is null"])));return}h.set(f,c)}));return{messageTags:c.messageTags,otid:c.topLevelProtobuf.otid,supplementalProtobufs:h,topLevelProtobuf:f}};b.decrypt=async function(a,b,c){var e=this,f=[];await Promise.all(c.map(async function(c){var g=await e.$2(a,b,c);if(g==null){d("WALogger").ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to decrypt protobuf message for message with otid ",""])),c.topLevelProtobuf.otid);return}f.push(g)}));return f};return a}();g.ProtobufMessageDecryptor=a}),98);
__d("LSDecryptAndValidateMinosMessageProtobuf",["LSQplAnnotateString.nop","LSQplMarkEnd.nop","LSQplMarkPoint.nop","LSQplStartTrace.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(a){return d[0]=c.i64.random(),d[1]=c.i64.to_string(d[0]),d[1]!==void 0?c.nativeOperation(b("LSQplStartTrace.nop"),c.i64.cast([0,679675062]),d[1],!0,void 0):c.resolve()},function(e){return d[1]!==void 0?a[2]!==void 0?c.nativeOperation(b("LSQplAnnotateString.nop"),c.i64.cast([0,679675062]),d[1],"act_thread_id",a[2]):c.resolve():c.resolve()},function(e){return d[2]=a[0].get("otid"),d[1]!==void 0?d[2]!==void 0?c.nativeOperation(b("LSQplAnnotateString.nop"),c.i64.cast([0,679675062]),d[1],"otid",d[2]):c.resolve():c.resolve()},function(a){return d[1]!==void 0?c.nativeOperation(b("LSQplMarkPoint.nop"),c.i64.cast([0,679675062]),d[1],"decrypt_native_op_is_not_supported"):c.resolve()},function(a){return d[1]!==void 0?c.nativeOperation(b("LSQplMarkEnd.nop"),c.i64.cast([0,679675062]),d[1],!1):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsDecryptAndValidateMinosMessageProtobufStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSDecryptProtobuf",["LSArrayGetObjectAt","LSBase64Decode.nop","LSCreateDerivedKeys.nop","LSGetBlobFromString.nop","LSLogMebClientEvent.nop","LSSymmetricEncryptionCreateDecryptedData.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][decryptProtobuf] Beginning execution."),d[1]=c.i64.of_float(Date.now()),d[8]=a[1]==null?c.i64.cast([0,0]):a[1],d[2]=c.i64.of_int32(a[3].length),c.i64.eq(d[2],c.i64.cast([0,1]))?c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[3],c.i64.cast([0,0])).then(function(a){return a=a,d[12]=a[0],d[13]=a[1],a})},function(e){return d[14]=d[12].get("epoch_anon_id"),d[15]=d[12].get("epoch_root_key"),d[16]=c.createArray(),d[26]=(d[16].push(c.i64.cast([0,32])),d[16]),c.i64.ge(d[8],c.i64.cast([0,3]))?c.resolve(d[17]=void 0):c.sequence([function(e){return c.nativeOperation(b("LSGetBlobFromString.nop"),a[2]).then(function(a){return a=a,d[26]=a[0],a})},function(a){return d[17]=d[26]}])},function(e){return c.i64.ge(d[8],c.i64.cast([0,4]))?(d[26]="_",d[18]=["message_key_in_epoch",d[26],c.blobs.to_string(d[14]),d[26],"cipher_version",d[26],c.i64.to_string(d[8]),d[26],"thread",d[26],a[2]==null?"":a[2]].join("")):(c.i64.ge(d[8],c.i64.cast([0,3]))?(d[27]="_",d[26]=["message_key_in_epoch",d[27],c.blobs.to_string(d[14]),d[27],"cipher_version",d[27],c.i64.to_string(d[8]),d[27],"thread",d[27],a[2]==null?"":a[2]].join("")):(c.i64.ge(d[8],c.i64.cast([0,2]))?(d[28]="_",d[27]=["message_key_in_epoch",d[28],c.blobs.to_string(d[14]),d[28],"cipher_version",d[28],c.i64.to_string(d[8])].join("")):d[27]=["message_key_in_epoch","_",c.blobs.to_string(d[14])].join(""),d[26]=d[27]),d[18]=d[26]),c.nativeOperation(b("LSGetBlobFromString.nop"),d[18]).then(function(a){return a=a,d[19]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[19],d[17],d[15],d[16]).then(function(a){return a=a,d[20]=a[0],a})},function(a){return d[20]?d[21]=!1:d[21]=!0,d[21]?c.resolve(d[22]=void 0):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[20],c.i64.cast([0,0])).then(function(a){return a=a,d[26]=a[0],d[27]=a[1],a})},function(a){return d[22]=d[26]}])},function(e){return c.blobs.neq(d[22],void 0)?c.sequence([function(e){return c.nativeOperation(b("LSBase64Decode.nop"),a[0]).then(function(a){return a=a,d[26]=a[0],a})},function(e){return c.blobs.neq(d[26],void 0)?c.sequence([function(e){return c.nativeOperation(b("LSSymmetricEncryptionCreateDecryptedData.nop"),d[22],c.blobs.of_string(["message_thread","_",a[2]].join("")),d[26]).then(function(a){return a=a,d[29]=a[0],a})},function(a){return d[27]=d[29]}]):c.resolve(d[27]=void 0)},function(a){return c.blobs.neq(d[27],void 0)?c.resolve(d[28]=d[27]):c.sequence([function(a){return d[29]=["Failed to decrypt message. Epoch Anon ID: ",c.blobs.to_string(d[14]),", Encryption Version: ",c.i64.to_string(d[8])].join(""),function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsDecryptProtobufStoredProcedure] ","",d[29]].join("")),d[30]=c.createArray(),void 0!==void 0?d[31]=(d[30].push(void 0),d[30]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDecryptProtobufStoredProcedure",[d[29]].join(""),d[30],c.i64.cast([0,3]))},function(a){return d[28]=void 0}])},function(a){return d[23]=d[28]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsDecryptProtobufStoredProcedure] Decryption message key is null"),d[26]=c.createArray(),void 0!==void 0?d[27]=(d[26].push(void 0),d[26]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDecryptProtobufStoredProcedure","Decryption message key is null",d[26],c.i64.cast([0,3]))},function(a){return d[23]=void 0}])},function(a){return c.blobs.neq(d[23],void 0)?(a=[d[23],void 0],d[24]=a[0],d[25]=a[1],a):(d[26]=new c.Map(),d[26].set("error_code",c.i64.cast([0,101])),d[26].set("stored_procedure","LSEncryptedBackupsDecryptProtobufStoredProcedure"),d[26].set("error_message",""),a=[void 0,d[26]],d[24]=a[0],d[25]=a[1]),a=[d[24],d[25]],d[3]=a[0],d[4]=a[1]}]):c.resolve((d[12]=c.i64.of_int32(a[3].length),c.i64.eq(d[12],c.i64.cast([0,0]))?(d[15]=new c.Map(),d[15].set("error_code",c.i64.cast([0,102])),d[15].set("stored_procedure","LSEncryptedBackupsDecryptProtobufStoredProcedure"),d[15].set("error_message",""),e=[void 0,d[15]],d[13]=e[0],d[14]=e[1]):(d[15]=new c.Map(),d[15].set("error_code",c.i64.cast([0,103])),d[15].set("stored_procedure","LSEncryptedBackupsDecryptProtobufStoredProcedure"),d[15].set("error_message",""),e=[void 0,d[15]],d[13]=e[0],d[14]=e[1]),e=[d[13],d[14]],d[3]=e[0],d[4]=e[1]))},function(a){return d[5]=c.i64.of_float(Date.now()),d[6]=c.i64.random(),d[9]="Finishing execution. Execution time: ",d[10]=c.i64.to_string(c.i64.sub(d[5],d[0])),d[11]=" ms",d[7]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][decryptProtobuf] ",d[7],d[9],d[7],d[10],d[7],d[11]].join("")),c.i64.eq(c.i64.mod_(d[6],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[12]=",",d[13]=c.createArray(),void 0!==void 0?d[14]=(d[13].push(void 0),d[13]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"decryptProtobuf",[d[9],d[12],d[10],d[12],d[11]].join(""),d[13],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[3],d[4]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsDecryptProtobufStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSDecryptSupplementalKey",["LSArrayGetObjectAt","LSBase64Decode.nop","LSCreateDerivedKeys.nop","LSLogMebClientEvent.nop","LSSymmetricEncryptionCreateDecryptedData.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][decryptSupplementalKey] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.nativeOperation(b("LSBase64Decode.nop"),a[0]).then(function(a){return a=a,d[2]=a[0],a})},function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[1],c.i64.cast([0,0])).then(function(a){return a=a,d[3]=a[0],d[4]=a[1],a})},function(a){return c.blobs.neq(d[2],void 0)?c.sequence([function(a){return d[13]=d[3].get("epoch_root_key"),d[14]=c.createArray(),d[21]=(d[14].push(c.i64.cast([0,32])),d[14]),c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blob("a2RmX2luZm86bWFpbGJveF9yb290X2tleV92Mj5zdXBwbGVtZW50YWxfZW5jX2tleQ=="),void 0,d[13],d[14]).then(function(a){return a=a,d[15]=a[0],a})},function(a){return d[15]!==void 0?c.sequence([function(a){return d[21]=c.i64.of_int32(d[15].length),c.i64.ge(d[21],c.i64.cast([0,1]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[15],c.i64.cast([0,0])).then(function(a){return a=a,d[23]=a[0],d[24]=a[1],a})},function(a){return d[22]=d[23]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[24]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoUtils] ","",d[24]].join("")),d[23]=c.createArray(),void 0!==void 0?d[25]=(d[23].push(void 0),d[23]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils",d[24],d[23],c.i64.cast([0,3]))},function(a){return d[22]=void 0}])},function(a){return d[16]=d[22]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[22]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoUtils] ","",d[22]].join("")),d[21]=c.createArray(),void 0!==void 0?d[23]=(d[21].push(void 0),d[21]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils",d[22],d[21],c.i64.cast([0,3]))},function(a){return d[16]=void 0}])},function(a){return c.blobs.neq(d[16],void 0)?d[17]=!0:d[17]=!1,d[17]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),c.nativeOperation(b("LSSymmetricEncryptionCreateDecryptedData.nop"),d[16],c.blob("c3VwcGxlbWVudGFsX2VuY19hYWQ="),d[2]).then(function(a){return a=a,d[18]=a[0],a})},function(a){return c.blobs.neq(d[18],void 0)?(a=[c.blobs.to_string(d[18]),void 0],d[19]=a[0],d[20]=a[1],a):(d[21]=new c.Map(),d[21].set("error_code",c.i64.cast([0,109])),d[21].set("stored_procedure","LSEncryptedBackupsDecryptSupplementalKeyStoredProcedure"),d[21].set("error_message",""),a=[void 0,d[21]],d[19]=a[0],d[20]=a[1]),a=[d[19],d[20]],d[5]=a[0],d[6]=a[1]}]):c.resolve((d[13]=new c.Map(),d[13].set("error_code",c.i64.cast([0,109])),d[13].set("stored_procedure","LSEncryptedBackupsDecryptSupplementalKeyStoredProcedure"),d[13].set("error_message",""),a=[void 0,d[13]],d[5]=a[0],d[6]=a[1]))},function(a){return d[7]=c.i64.of_float(Date.now()),d[8]=c.i64.random(),d[10]="Finishing execution. Execution time: ",d[11]=c.i64.to_string(c.i64.sub(d[7],d[0])),d[12]=" ms",d[9]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][decryptSupplementalKey] ",d[9],d[10],d[9],d[11],d[9],d[12]].join("")),c.i64.eq(c.i64.mod_(d[8],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[13]=",",d[14]=c.createArray(),void 0!==void 0?d[15]=(d[14].push(void 0),d[14]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"decryptSupplementalKey",[d[10],d[13],d[11],d[13],d[12]].join(""),d[14],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[5],d[6]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsDecryptSupplementalKeyStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSDecryptMessageProtobufs",["LSArrayGetObjectAt","LSDecryptAndValidateMinosMessageProtobuf","LSDecryptProtobuf","LSDecryptSupplementalKey","LSIsEncryptionVersionSecure","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][decryptMessageProtobufs] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[15]=new c.Map(),d[15].set("error_msg","Expected a nonempty query result"),d[15].set("code",c.i64.cast([0,3])),d[15].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[16]=c.createArray(),d[17]=(d[16].push(d[15]),d[16]),e=[void 0,d[16]],d[2]=e[0],d[3]=e[1]):(b=a.item,d[15]=new c.Map(),d[15].set("backup_id",b.backupId),d[15].set("device_public_key_blob",b.devicePublicKeyBlob),d[15].set("device_private_key_blob",b.devicePrivateKeyBlob),d[15].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[15].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[15].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[15].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[15].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[15].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[15].set("orf_client_state_v2_blob",void 0),d[15].set("orf_v2_authority_level",void 0),d[15].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[15].set("device_id",b.deviceId),d[15].set("backup_tenancy",b.backupTenancy),d[15].set("encryption_version",b.encryptionVersion),d[15].set("revision_version",b.revisionVersion),d[15].set("initialize_restore_result",void 0),d[15].set("device_creation_timestamp_sec",void 0),d[15].set("authority_level",b.authorityLevel),e=[d[15],void 0],d[2]=e[0],d[3]=e[1])})},function(e){return d[5]=new c.Map(),d[5].set("value",d[2]),d[5].set("errors",d[3]),d[6]=d[5].get("value"),d[6]!==void 0?c.sequence([function(e){return d[15]=d[6].get("backup_id"),d[16]=d[6].get("device_public_key_blob"),d[17]=d[6].get("device_private_key_blob"),d[18]=d[6].get("epoch_storage_public_key_blob"),d[19]=d[6].get("epoch_storage_private_key_blob"),d[20]=d[6].get("epoch_auth_public_key_blob"),d[21]=d[6].get("epoch_auth_private_key_blob"),d[22]=d[6].get("mailbox_root_key_blob"),d[23]=d[6].get("ocmf_client_state_blob"),d[24]=d[6].get("orf_client_state_v2_blob"),d[25]=d[6].get("orf_v2_authority_level"),d[26]=d[6].get("oblivious_validation_token_blob"),d[27]=d[6].get("device_id"),d[28]=d[6].get("backup_tenancy"),d[29]=d[6].get("encryption_version"),d[30]=d[6].get("revision_version"),d[31]=d[6].get("initialize_restore_result"),d[32]=d[6].get("device_creation_timestamp_sec"),d[33]=d[6].get("authority_level"),c.i64.neq(d[27],void 0)?c.sequence([function(a){return d[36]=void 0,c.i64.neq(d[36],void 0)?c.resolve(d[37]=d[36]):c.sequence([function(a){return d[47]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[48]=a[0],a})},function(a){return d[48]?d[57]=(d[47].push(c.i64.cast([0,0])),d[47]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[49]=a[0],a})},function(a){return d[49]?d[57]=(d[47].push(c.i64.cast([0,2])),d[47]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[50]=a[0],a})},function(a){return d[50]?d[57]=(d[47].push(c.i64.cast([0,3])),d[47]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[51]=a[0],a})},function(a){return d[51]?d[57]=(d[47].push(c.i64.cast([0,4])),d[47]):0,d[52]=c.createArray(),d[53]=c.i64.of_int32(d[47].length),c.i64.gt(d[53],c.i64.cast([0,0]))?c.loopAsync(d[53],function(a){return d[57]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[47],d[57]).then(function(a){return a=a,d[58]=a[0],d[59]=a[1],a})},function(a){return d[60]=(d[52].push(d[58]),d[52])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[57]=c.createArray(),d[58]=c.i64.of_int32(d[52].length),c.i64.gt(d[58],c.i64.cast([0,0]))?c.loopAsync(d[58],function(a){return d[60]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[52],d[60]).then(function(a){return a=a,d[61]=a[0],d[62]=a[1],a})},function(a){return d[63]=(d[57].push(c.i64.to_string(d[61])),d[57])}])}):c.resolve()},function(a){return d[59]=d[57].join(","),d[54]=d[59]}])},function(a){return d[52].some(function(a){return c.i64.eq(d[29],a)})?d[55]=d[29]:d[55]=void 0,c.i64.neq(d[55],void 0)?d[56]=d[55]:d[56]=void 0,d[37]=d[56]}])},function(e){return c.i64.neq(d[37],void 0)?d[38]=d[37]:d[38]=c.i64.cast([0,0]),c.i64.neq(d[28],void 0)?d[39]=d[28]:d[39]=c.i64.cast([0,1]),d[40]=c.createArray(),d[41]=c.createArray(),d[42]=new c.Map(),d[43]=c.i64.of_int32(a[0].length),c.i64.gt(d[43],c.i64.cast([0,0]))?c.loopAsync(d[43],function(e){return d[47]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[0],d[47]).then(function(a){return a=a,d[48]=a[0],d[49]=a[1],a})},function(a){return d[50]=d[48].get("encrypted_protobufs"),d[51]=d[50].get("toplevel_protobuf"),d[52]=d[51].get("epoch_id"),d[53]=d[51].get("epoch_anon_id"),d[54]=d[42].get(c.blobs.to_string(d[53])),d[54]!==void 0?c.resolve(d[55]=d[54]):c.sequence([function(a){return c.i64.neq(d[52],void 0)?c.sequence([function(a){return d[62]=c.createArray(),c.count(c.db.table(169).fetch([[[d[52]]]])).then(function(a){return d[63]=a})},function(a){return c.i64.le(d[63],c.i64.cast([0,1]))?c.sequence([function(a){return c.db.table(169).fetch([[[d[52]]]]).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[73]=new c.Map(),d[73].set("error_msg","Expected a nonempty query result"),d[73].set("code",c.i64.cast([0,3])),d[73].set("src_line","MEBEpochClientUtils.php:313 MEBEpochClientUtils::requireEpochReturnShapeFromPersistentEpochsTableDirectly()"),d[74]=c.createArray(),d[75]=(d[74].push(d[73]),d[74]),e=[void 0,d[74]],d[69]=e[0],d[70]=e[1]):(b=a.item,d[73]=new c.Map(),d[73].set("epoch_id",b.epochId),d[73].set("backup_id",b.backupId),d[73].set("epoch_anon_id_blob",b.epochAnonIdBlob),d[73].set("epoch_root_key_blob",b.epochRootKeyBlob),d[73].set("epoch_status",b.epochStatus),d[73].set("epoch_head",b.epochHead),d[73].set("authority_level",b.authorityLevel),e=[d[73],void 0],d[69]=e[0],d[70]=e[1])})},function(a){return d[72]=new c.Map(),d[72].set("value",d[69]),d[72].set("errors",d[70]),d[64]=d[72]}]):c.resolve((d[69]=new c.Map(),d[69].set("error_msg","Expected at most one result"),d[69].set("code",c.i64.cast([0,4])),d[69].set("src_line","MEBEpochClientUtils.php:313 MEBEpochClientUtils::requireEpochReturnShapeFromPersistentEpochsTableDirectly()"),d[70]=c.createArray(),d[72]=(d[70].push(d[69]),d[70]),d[71]=new c.Map(),d[71].set("value",void 0),d[71].set("errors",d[70]),d[64]=d[71]))},function(a){return d[65]=d[64].get("value"),d[65]!==void 0?(d[69]=d[65].get("epoch_id"),d[70]=d[65].get("backup_id"),d[71]=d[65].get("epoch_anon_id_blob"),d[72]=d[65].get("epoch_root_key_blob"),d[73]=d[65].get("epoch_status"),d[74]=d[65].get("epoch_head"),d[75]=d[65].get("authority_level"),c.i64.eq(d[75],c.i64.cast([0,80]))?d[76]=d[64]:(d[77]=new c.Map(),d[77].set("error_msg","NONE"),d[77].set("code",c.i64.cast([0,0])),d[77].set("src_line","MEBEpochClientUtils.php:315 Closure$MEBEpochClientUtils::requireEpochReturnShapeFromPersistentEpochsTableDirectly#2()"),d[78]=c.createArray(),d[80]=(d[78].push(d[77]),d[78]),d[79]=new c.Map(),d[79].set("value",void 0),d[79].set("errors",d[78]),d[76]=d[79]),d[66]=d[76]):(d[69]=d[64].get("errors"),d[70]=d[64].get("errors"),d[71]=new c.Map(),d[71].set("value",void 0),d[71].set("errors",d[69]),d[66]=d[71]),d[67]=d[66].get("value"),d[67]!==void 0?(d[69]=d[67].get("epoch_id"),d[70]=d[67].get("backup_id"),d[71]=d[67].get("epoch_anon_id_blob"),d[72]=d[67].get("epoch_root_key_blob"),d[73]=d[67].get("epoch_status"),d[74]=d[67].get("epoch_head"),d[75]=d[67].get("authority_level"),c.i64.eq(d[70],d[15])&&c.i64.eq(d[75],c.i64.cast([0,80]))?(d[76]=new c.Map(),d[76].set("epoch_root_key",d[72]),d[76].set("epoch_anon_id",d[71]),d[77]=(d[62].push(d[76]),d[62])):0,d[68]=!0):(d[69]=d[66].get("errors"),d[70]=d[66].get("errors"),d[68]=!1),d[61]=d[62]}]):c.sequence([function(a){return d[62]=c.createArray(),c.filter(c.db.table(169).fetch(),function(a){return c.blobs.eq(a.epochAnonIdBlob,d[53])}).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[69]=new c.Map(),d[69].set("error_msg","Expected a nonempty query result"),d[69].set("code",c.i64.cast([0,3])),d[69].set("src_line","MEBEpochClientUtils.php:556 MEBEpochClientUtils::maybeEpochWithAnonIDFromPersistentEpochsTableDirectly()"),d[70]=c.createArray(),d[71]=(d[70].push(d[69]),d[70]),e=[void 0,d[70]],d[63]=e[0],d[64]=e[1]):(b=a.item,d[69]=new c.Map(),d[69].set("epoch_id",b.epochId),d[69].set("backup_id",b.backupId),d[69].set("epoch_anon_id_blob",b.epochAnonIdBlob),d[69].set("epoch_root_key_blob",b.epochRootKeyBlob),d[69].set("epoch_status",b.epochStatus),d[69].set("epoch_head",b.epochHead),d[69].set("authority_level",b.authorityLevel),e=[d[69],void 0],d[63]=e[0],d[64]=e[1])})},function(a){return d[66]=new c.Map(),d[66].set("value",d[63]),d[66].set("errors",d[64]),d[67]=d[66].get("value"),d[67]!==void 0?(d[69]=d[67].get("epoch_id"),d[70]=d[67].get("backup_id"),d[71]=d[67].get("epoch_anon_id_blob"),d[72]=d[67].get("epoch_root_key_blob"),d[73]=d[67].get("epoch_status"),d[74]=d[67].get("epoch_head"),d[75]=d[67].get("authority_level"),c.i64.eq(d[70],d[15])&&c.i64.eq(d[75],c.i64.cast([0,80]))?(d[76]=new c.Map(),d[76].set("epoch_root_key",d[72]),d[76].set("epoch_anon_id",d[71]),d[77]=(d[62].push(d[76]),d[62])):0,d[68]=!0):(d[69]=d[66].get("errors"),d[70]=d[66].get("errors"),d[68]=!1),d[61]=d[62]}])},function(a){return d[55]=d[61]}])},function(e){return d[56]=d[51].get("epoch_anon_id"),d[42].set(c.blobs.to_string(d[56]),d[55]),d[57]=d[51].get("encrypted_protobuf"),d[58]=d[51].get("encryption_version"),c.storedProcedure(b("LSDecryptProtobuf"),d[57],d[58],a[1],d[55]).then(function(a){return a=a,d[59]=a[0],d[60]=a[1],a})},function(e){return c.blobs.neq(d[59],void 0)?c.sequence([function(e){return d[61]=d[48].get("encrypted_protobufs"),d[62]=d[61].get("supplemental_protobufs"),d[63]=new c.Map(),d[64]=d[62].keys(),d[65]=c.i64.of_int32(d[64].length),c.i64.gt(d[65],c.i64.cast([0,0]))?c.loopAsync(d[65],function(e){return d[73]=e,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[64],d[73]).then(function(a){return a=a,d[74]=a[0],d[75]=a[1],a})},function(e){return d[76]=d[62].get(d[74]),d[76]!==void 0?c.sequence([function(a){return d[77]=d[76].get("epoch_id"),d[78]=d[76].get("epoch_anon_id"),d[79]=d[42].get(c.blobs.to_string(d[78])),d[79]!==void 0?c.resolve(d[80]=d[79]):c.sequence([function(a){return c.i64.neq(d[77],void 0)?c.sequence([function(a){return d[86]=c.createArray(),c.count(c.db.table(169).fetch([[[d[77]]]])).then(function(a){return d[87]=a})},function(a){return c.i64.le(d[87],c.i64.cast([0,1]))?c.sequence([function(a){return c.db.table(169).fetch([[[d[77]]]]).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[97]=new c.Map(),d[97].set("error_msg","Expected a nonempty query result"),d[97].set("code",c.i64.cast([0,3])),d[97].set("src_line","MEBEpochClientUtils.php:313 MEBEpochClientUtils::requireEpochReturnShapeFromPersistentEpochsTableDirectly()"),d[98]=c.createArray(),d[99]=(d[98].push(d[97]),d[98]),e=[void 0,d[98]],d[93]=e[0],d[94]=e[1]):(b=a.item,d[97]=new c.Map(),d[97].set("epoch_id",b.epochId),d[97].set("backup_id",b.backupId),d[97].set("epoch_anon_id_blob",b.epochAnonIdBlob),d[97].set("epoch_root_key_blob",b.epochRootKeyBlob),d[97].set("epoch_status",b.epochStatus),d[97].set("epoch_head",b.epochHead),d[97].set("authority_level",b.authorityLevel),e=[d[97],void 0],d[93]=e[0],d[94]=e[1])})},function(a){return d[96]=new c.Map(),d[96].set("value",d[93]),d[96].set("errors",d[94]),d[88]=d[96]}]):c.resolve((d[93]=new c.Map(),d[93].set("error_msg","Expected at most one result"),d[93].set("code",c.i64.cast([0,4])),d[93].set("src_line","MEBEpochClientUtils.php:313 MEBEpochClientUtils::requireEpochReturnShapeFromPersistentEpochsTableDirectly()"),d[94]=c.createArray(),d[96]=(d[94].push(d[93]),d[94]),d[95]=new c.Map(),d[95].set("value",void 0),d[95].set("errors",d[94]),d[88]=d[95]))},function(a){return d[89]=d[88].get("value"),d[89]!==void 0?(d[93]=d[89].get("epoch_id"),d[94]=d[89].get("backup_id"),d[95]=d[89].get("epoch_anon_id_blob"),d[96]=d[89].get("epoch_root_key_blob"),d[97]=d[89].get("epoch_status"),d[98]=d[89].get("epoch_head"),d[99]=d[89].get("authority_level"),c.i64.eq(d[99],c.i64.cast([0,80]))?d[100]=d[88]:(d[101]=new c.Map(),d[101].set("error_msg","NONE"),d[101].set("code",c.i64.cast([0,0])),d[101].set("src_line","MEBEpochClientUtils.php:315 Closure$MEBEpochClientUtils::requireEpochReturnShapeFromPersistentEpochsTableDirectly#2()"),d[102]=c.createArray(),d[104]=(d[102].push(d[101]),d[102]),d[103]=new c.Map(),d[103].set("value",void 0),d[103].set("errors",d[102]),d[100]=d[103]),d[90]=d[100]):(d[93]=d[88].get("errors"),d[94]=d[88].get("errors"),d[95]=new c.Map(),d[95].set("value",void 0),d[95].set("errors",d[93]),d[90]=d[95]),d[91]=d[90].get("value"),d[91]!==void 0?(d[93]=d[91].get("epoch_id"),d[94]=d[91].get("backup_id"),d[95]=d[91].get("epoch_anon_id_blob"),d[96]=d[91].get("epoch_root_key_blob"),d[97]=d[91].get("epoch_status"),d[98]=d[91].get("epoch_head"),d[99]=d[91].get("authority_level"),c.i64.eq(d[94],d[15])&&c.i64.eq(d[99],c.i64.cast([0,80]))?(d[100]=new c.Map(),d[100].set("epoch_root_key",d[96]),d[100].set("epoch_anon_id",d[95]),d[101]=(d[86].push(d[100]),d[86])):0,d[92]=!0):(d[93]=d[90].get("errors"),d[94]=d[90].get("errors"),d[92]=!1),d[85]=d[86]}]):c.sequence([function(a){return d[86]=c.createArray(),c.filter(c.db.table(169).fetch(),function(a){return c.blobs.eq(a.epochAnonIdBlob,d[78])}).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[93]=new c.Map(),d[93].set("error_msg","Expected a nonempty query result"),d[93].set("code",c.i64.cast([0,3])),d[93].set("src_line","MEBEpochClientUtils.php:556 MEBEpochClientUtils::maybeEpochWithAnonIDFromPersistentEpochsTableDirectly()"),d[94]=c.createArray(),d[95]=(d[94].push(d[93]),d[94]),e=[void 0,d[94]],d[87]=e[0],d[88]=e[1]):(b=a.item,d[93]=new c.Map(),d[93].set("epoch_id",b.epochId),d[93].set("backup_id",b.backupId),d[93].set("epoch_anon_id_blob",b.epochAnonIdBlob),d[93].set("epoch_root_key_blob",b.epochRootKeyBlob),d[93].set("epoch_status",b.epochStatus),d[93].set("epoch_head",b.epochHead),d[93].set("authority_level",b.authorityLevel),e=[d[93],void 0],d[87]=e[0],d[88]=e[1])})},function(a){return d[90]=new c.Map(),d[90].set("value",d[87]),d[90].set("errors",d[88]),d[91]=d[90].get("value"),d[91]!==void 0?(d[93]=d[91].get("epoch_id"),d[94]=d[91].get("backup_id"),d[95]=d[91].get("epoch_anon_id_blob"),d[96]=d[91].get("epoch_root_key_blob"),d[97]=d[91].get("epoch_status"),d[98]=d[91].get("epoch_head"),d[99]=d[91].get("authority_level"),c.i64.eq(d[94],d[15])&&c.i64.eq(d[99],c.i64.cast([0,80]))?(d[100]=new c.Map(),d[100].set("epoch_root_key",d[96]),d[100].set("epoch_anon_id",d[95]),d[101]=(d[86].push(d[100]),d[86])):0,d[92]=!0):(d[93]=d[90].get("errors"),d[94]=d[90].get("errors"),d[92]=!1),d[85]=d[86]}])},function(a){return d[80]=d[85]}])},function(a){return d[81]=d[76].get("epoch_anon_id"),d[42].set(c.blobs.to_string(d[81]),d[80]),d[82]=d[76].get("sk_ciphertext"),c.storedProcedure(b("LSDecryptSupplementalKey"),d[82]==null?"":d[82],d[80]).then(function(a){return a=a,d[83]=a[0],d[84]=a[1],a})},function(e){return d[83]!==void 0?c.sequence([function(e){return d[85]=d[76].get("encrypted_protobuf"),d[86]=d[76].get("encryption_version"),c.storedProcedure(b("LSDecryptProtobuf"),d[85],d[86],a[1],d[80]).then(function(a){return a=a,d[87]=a[0],d[88]=a[1],a})},function(a){return c.blobs.neq(d[87],void 0)?(d[89]=d[76].get("protobuf_timestamp_ms"),d[90]=new c.Map(),d[90].set("decrypted_protobuf",d[87]),d[90].set("protobuf_timestamp_ms",d[89]),d[63].set(d[83],d[90])):d[89]=(d[41].push(d[88]),d[41])}]):c.resolve((d[85]=new c.Map(),d[85].set("error_code",c.i64.cast([0,109])),d[85].set("stored_procedure","LSEncryptedBackupsDecryptMessageProtobufsStoredProcedure"),d[85].set("error_message",""),d[86]=(d[41].push(d[85]),d[41])))}]):(d[77]=d[48].get("otid"),d[78]=["Supplemental key is null for supplemental protobuf with otid: ",d[77]," act_thread_id: ",a[1]].join(""),function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][decryptMessageProtobufs] ","",d[78]].join("")),d[79]=c.createArray(),void 0!==void 0?d[80]=(d[79].push(void 0),d[79]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"decryptMessageProtobufs",[d[78]].join(""),d[79],c.i64.cast([0,3])))}])}):c.resolve()},function(a){return d[66]=d[48].get("otid"),d[67]=d[51].get("protobuf_timestamp_ms"),d[68]=new c.Map(),d[68].set("decrypted_protobuf",d[59]),d[68].set("protobuf_timestamp_ms",d[67]),d[69]=d[48].get("message_tags"),d[70]=d[48].get("attachment_data"),d[70]!==void 0?c.sequence([function(a){return d[73]=c.createArray(),d[74]=c.i64.of_int32(d[70].length),c.i64.gt(d[74],c.i64.cast([0,0]))?c.loopAsync(d[74],function(a){return d[81]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[70],d[81]).then(function(a){return a=a,d[82]=a[0],d[83]=a[1],a})},function(a){return d[84]=(d[73].push(d[82]),d[73])}])}):c.resolve()},function(a){return d[75]=new c.Map(),d[75].set("attachment_data",d[73]),d[76]=new c.Map(),d[80]="attachment_data",d[77]=d[75].get(d[80]),d[77]?d[78]=!1:d[78]=!0,d[78]?c.resolve():c.sequence([function(a){return d[77]?d[81]=!1:d[81]=!0,d[81]?c.resolve(d[82]=void 0):c.sequence([function(a){return d[84]=c.createArray(),d[85]=c.i64.of_int32(d[77].length),c.i64.gt(d[85],c.i64.cast([0,0]))?c.loopAsync(d[85],function(a){return d[86]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[77],d[86]).then(function(a){return a=a,d[87]=a[0],d[88]=a[1],a})},function(a){return d[89]=new c.Map(),d[92]="attachment_object_id",d[90]=d[87].get(d[92]),d[90]!==void 0?d[89].set(d[92],d[90]):0,d[93]="attachment_cdn_url",d[91]=d[87].get(d[93]),d[91]!==void 0?d[89].set(d[93],d[91]):0,d[94]=(d[84].push(d[89]),d[84])}])}):c.resolve()},function(a){return d[82]=d[84]}])},function(a){return d[83]=c.i64.of_int32(d[82].length),c.i64.neq(d[83],c.i64.cast([0,0]))?d[76].set(d[80],d[82]):0}])},function(a){return d[79]=c.toJSON(d[76]),d[71]=d[79]}]):c.resolve(d[71]=void 0)},function(a){return d[72]=new c.Map(),d[72].set("otid",d[66]),d[72].set("toplevel_protobuf",d[68]),d[72].set("supplemental_protobufs",d[63]),d[72].set("message_tags",d[69]),d[72].set("restore_message_data",d[71]),d[73]=(d[40].push(d[72]),d[40]),c.resolve()}]):c.resolve(d[61]=(d[41].push(d[60]),d[41]))}])}):c.resolve()},function(a){return d[44]=c.i64.of_int32(d[41].length),c.i64.gt(d[44],c.i64.cast([0,0]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[41],c.i64.cast([0,0])).then(function(a){return a=a,d[47]=a[0],d[48]=a[1],a})},function(a){return a=[void 0,d[47]],d[45]=a[0],d[46]=a[1],a}]):c.resolve((a=[d[40],void 0],d[45]=a[0],d[46]=a[1],a))},function(a){return a=[d[45],d[46]],d[34]=a[0],d[35]=a[1],a}]):c.resolve((d[36]=new c.Map(),d[36].set("error_code",c.i64.cast([0,24])),d[36].set("stored_procedure","LSEncryptedBackupsDecryptMessageProtobufsStoredProcedure"),d[36].set("error_message",""),e=[void 0,d[36]],d[34]=e[0],d[35]=e[1]))},function(a){return a=[d[34],d[35]],d[7]=a[0],d[8]=a[1],a}]):c.resolve((d[15]=d[5].get("errors"),d[16]=d[5].get("errors"),d[17]=new c.Map(),d[17].set("error_code",c.i64.cast([0,1])),d[17].set("stored_procedure","LSEncryptedBackupsDecryptMessageProtobufsStoredProcedure"),d[17].set("error_message",""),e=[void 0,d[17]],d[7]=e[0],d[8]=e[1]))},function(a){return d[9]=c.i64.of_float(Date.now()),d[10]=c.i64.random(),d[12]="Finishing execution. Execution time: ",d[13]=c.i64.to_string(c.i64.sub(d[9],d[0])),d[14]=" ms",d[11]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][decryptMessageProtobufs] ",d[11],d[12],d[11],d[13],d[11],d[14]].join("")),c.i64.eq(c.i64.mod_(d[10],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[15]=",",d[16]=c.createArray(),void 0!==void 0?d[17]=(d[16].push(void 0),d[16]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"decryptMessageProtobufs",[d[12],d[15],d[13],d[15],d[14]].join(""),d[16],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[7],d[8]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsDecryptMessageProtobufsStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state","secure_encrypted_backups_epochs"];e.exports=a}),null);
__d("LSDecryptMessageProtobufsStoredProcedure",["LSDecryptMessageProtobufs","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSDecryptMessageProtobufs"),e.encryptedMessagesWithProtobufs,e.actThreadId);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSDecryptMessagesStoredProcedure",["LSDecryptMessages","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSDecryptMessages"),e.encryptedMessages,e.actThreadId);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("EBAPIDecryptionModule",["Base64Utils","EBEchoMessageDecryptor","EBProtobufMessageDecryptor","I64","LSDecryptMessageProtobufsStoredProcedure","LSDecryptMessagesStoredProcedure","LSDict","LSFactory","LSShape","LSVec","WALogger","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;async function a(a,b,c,e){d("WALogger").DEV(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Running native decryption"])));var f=new(d("EBEchoMessageDecryptor").EchoMessageDecryptor)(),g=new(d("EBProtobufMessageDecryptor").ProtobufMessageDecryptor)();try{f=e.length>0?await f.decrypt(a,b,e):[];e=c.length>0?await g.decrypt(a,b,c):[];return d("WAResultOrError").makeResult({decryptedEchoMessages:f,decryptedProtobufs:e})}catch(a){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Error thrown when running native decryption: ",""])),a);return d("WAResultOrError").makeError("runtime-error-during-native-decryption")}}async function b(a,b,e,g){try{a=await a.runInTransaction(async function(a){var f=[],h=null;if(g.length>0){var i=await c("LSDecryptMessagesStoredProcedure")(c("LSFactory")(a),{actThreadId:b,encryptedMessages:c("LSVec").ofArray(g)}),j=i[0];i[1];j!=null&&(f=c("LSVec").toArray(j).map(function(a){return d("LSShape").toRecord(a).value}))}if(e.length>0){i=await c("LSDecryptMessageProtobufsStoredProcedure")(c("LSFactory")(a),{actThreadId:b,encryptedMessagesWithProtobufs:c("LSVec").ofArray(e)});j=i[0];i[1];j!=null&&(h=j)}return{echo:c("LSVec").ofArray(f),protobuf:h!=null?h:c("LSVec").ofArray([])}},"readwrite",void 0,void 0,f.id+":113");return d("WAResultOrError").makeResult(a)}catch(a){return d("WAResultOrError").makeError("decryption-error")}}function k(a){return{decrypted_protobuf:d("Base64Utils").toArrayBuffer(a.decryptedProtobuf),protobuf_timestamp_ms:(j||(j=d("I64"))).of_string(a.protobufTimestampMs)}}function e(a,b){a=c("LSVec").ofArray(a.map(function(a){return a.value}).filter(Boolean));b=c("LSVec").ofArray(b.map(function(a){var b=a.topLevelProtobuf,e=a.supplementalProtobufs;a=a.otid;if(a==null)return;var f=new Map();e.forEach(function(a,b){a=d("LSShape").ofRecord(k(a));f.set(b,a)});e={otid:a,supplemental_protobufs:new(c("LSDict"))(f),toplevel_protobuf:d("LSShape").ofRecord(k(b))};return d("LSShape").ofRecord(e)}).filter(Boolean));return{echo:a,protobuf:b}}g.decryptUsingNativeJS=a;g.decryptUsingLS=b;g.convertNativeDecryptionResponseToDecryptedMessageType=e}),98);
__d("EBAPIMessagePointQueryWithPersistence",["EBMessagePointQueryWithPersistence"],(function(a,b,c,d,e,f,g){"use strict";g["default"]=d("EBMessagePointQueryWithPersistence").messagePointQueryWithPersistence}),98);
__d("LSDeriveAndStoreEpochsStoredProcedure",["LSDeriveAndStoreEpochs","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSDeriveAndStoreEpochs"),e.epochEdges,e.targetDeviceId,e.epochSyncReason,e.traceId);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("MEBEpochSyncReason",[],(function(a,b,c,d,e,f){a=Object.freeze({EMPTY_RESTORE_PAYLOAD:-3,NONE_PROVIDED_BY_CLIENT:-2,NONE_PROVIDED_BY_SERVER:-1,SNAPSHOT_RESTORE:0,POINT_QUERY_RESTORE:1,RANGE_QUERY_RESTORE:2,MESSAGE_QUERY_RESTORE:3,SURROUNDING_RESTORE:4,DOWNLOAD_EPOCHS_V2:5,PREPARE_OPEN_EPOCH:6,HANDLE_OPEN_EPOCH_SUCCESS:7,HANDLE_INIT_GET_SECRETS:8,DERIVE_ONBOARDING_MATERIAL:9,DECRYPT_AND_WRITE_MESSAGES:10,RESTORE_WITH_SERIALIZER:11,FINISH_ADD_PEER_DEVICE:12,SYNC_DELTAS:13,THREAD_POINT_QUERY_RESTORE:14});f["default"]=a}),66);
__d("handleRestoreMessagesGraphQLResponse_XFBEncryptedBackupMessages.graphql",[],(function(a,b,c,d,e,f){"use strict";a=function(){var a={alias:null,args:null,kind:"ScalarField",name:"encryption_version",storageKey:null},b={alias:null,args:null,kind:"ScalarField",name:"epoch_anon_id",storageKey:null},c={alias:null,args:null,kind:"ScalarField",name:"epoch_id",storageKey:null},d={alias:null,args:null,kind:"ScalarField",name:"encrypted_protobuf_stanza",storageKey:null},e={alias:null,args:null,kind:"ScalarField",name:"protobuf_timestamp_ms",storageKey:null},f={alias:null,args:null,kind:"ScalarField",name:"sk_ciphertext",storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"supplemental_key",storageKey:null},h={alias:null,args:null,kind:"ScalarField",name:"actor_token",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"encrypted_protobuf",storageKey:null},j={alias:null,args:null,kind:"ScalarField",name:"mek_fbid",storageKey:null},k={alias:null,args:null,kind:"ScalarField",name:"mek_id",storageKey:null},l={alias:null,args:null,kind:"ScalarField",name:"protobuf_timestamp",storageKey:null},m={alias:null,args:null,kind:"ScalarField",name:"transport_sender_signing_pk",storageKey:null},n={alias:null,args:null,kind:"ScalarField",name:"transport_sender_message_signature",storageKey:null},o=[b,c];return{argumentDefinitions:[{defaultValue:!1,kind:"LocalArgument",name:"minos_gk_enabled"}],kind:"Fragment",metadata:null,name:"handleRestoreMessagesGraphQLResponse_XFBEncryptedBackupMessages",selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupMessage",kind:"LinkedField",name:"encrypted_messages",plural:!0,selections:[{alias:null,args:null,concreteType:"XFBEchoDocument",kind:"LinkedField",name:"echo_document",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"echo_document_string",storageKey:null},a,b,c,{alias:null,args:null,kind:"ScalarField",name:"epoch_fingerprint",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"otid",storageKey:null},{alias:null,args:null,concreteType:"XFBProtobufStanzas",kind:"LinkedField",name:"protobuf_stanzas",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"message_tags",storageKey:null},{alias:null,args:null,concreteType:"XFBProtobufStanza",kind:"LinkedField",name:"top_level_protobuf",plural:!1,selections:[d,a,b,c,e,f],storageKey:null},{alias:null,args:null,concreteType:"XFBProtobufStanza",kind:"LinkedField",name:"supplemental_protobufs",plural:!0,selections:[d,a,b,c,e,f,g],storageKey:null},{condition:"minos_gk_enabled",kind:"Condition",passingValue:!0,selections:[{alias:null,args:null,concreteType:"XFBMinosProtobufStanza",kind:"LinkedField",name:"top_level_protobuf_v2",plural:!1,selections:[h,i,j,k,l,m,n],storageKey:null},{alias:null,args:null,concreteType:"XFBMinosProtobufStanza",kind:"LinkedField",name:"supplemental_protobufs_v2",plural:!0,selections:[h,i,l,j,k,g,{alias:null,args:null,kind:"ScalarField",name:"supplemental_otid",storageKey:null},m,n],storageKey:null}]}],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"backup_id",storageKey:null},{alias:null,args:null,concreteType:"XFBMessageRangeInfo",kind:"LinkedField",name:"message_range_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"has_more_before",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"has_more_after",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"next_message_timestamp_ms_before",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"next_message_timestamp_ms_after",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"should_delete_mailbox",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"exception_string",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"thread_not_found",storageKey:null},{alias:null,args:null,concreteType:"XFBEpochDerivationSet",kind:"LinkedField",name:"epoch_derivation_set",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupsEpochEdge",kind:"LinkedField",name:"epoch_edges",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"backward_edge",storageKey:null},{alias:null,args:null,concreteType:"XFBEpochForwardEdge",kind:"LinkedField",name:"forward_edge",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"auth_public_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"encrypted_entropy",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"entropy_fingerprint",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"epoch_storage_public_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"psk_fingerprint",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBEpochIds",kind:"LinkedField",name:"from_epoch",plural:!1,selections:o,storageKey:null},{alias:null,args:null,concreteType:"XFBEpochIds",kind:"LinkedField",name:"to_epoch",plural:!1,selections:o,storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"from_epoch_fingerprint",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"to_epoch_fingerprint",storageKey:null}],storageKey:null}],storageKey:null},{condition:"minos_gk_enabled",kind:"Condition",passingValue:!0,selections:[{alias:null,args:null,concreteType:"XFBMinosDecryptionKeyMap",kind:"LinkedField",name:"minos_decryption_keys",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,concreteType:"XFBMinosDecryptionKeys",kind:"LinkedField",name:"keys",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBMinosMekInfo",kind:"LinkedField",name:"mek_info",plural:!1,selections:[k,{alias:null,args:null,kind:"ScalarField",name:"roster_hash",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"encrypted_mek",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBMinosRecipientInfo",kind:"LinkedField",name:"recipient_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"epoch_fbid",storageKey:null},b],storageKey:null},{alias:null,args:null,concreteType:"XFBMekCreatorInfo",kind:"LinkedField",name:"mek_creator_info",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBMinosEncryptionKeys",kind:"LinkedField",name:"minos_keys",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"sender_auth_pk",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"sender_epoch_head",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBMinosTransportKeys",kind:"LinkedField",name:"transport_keys",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"ephm_hpke_pk",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"ephm_signature",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"mek_creator_transport_signing_pk",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}]}],type:"XFBEncryptedBackupMessages",abstractKey:null}}();e.exports=a}),null);
__d("handleRestoreMessagesGraphQLResponse",["EBAPIQPLPoints","I64","LSAuthorityLevel","LSBase64Decode","LSDecryptMessageProtobufsStoredProcedure","LSDecryptMessagesStoredProcedure","LSDeriveAndStoreEpochsStoredProcedure","LSDict","LSFactory","LSIntEnum","LSShape","LSVec","MAWEBRestoreTrackingUtils","MAWEncryptedBackupUtils","MAWJobDefinitions","MEBEncryptionVersion","MEBEpochSyncReason","QPLUserFlow","ReQL","WAHashStringToNumber","WALogger","handleRestoreMessagesGraphQLResponse_XFBEncryptedBackupMessages.graphql"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p;function q(a){if(a==null)return c("MEBEncryptionVersion").UNKNOWN;switch(a){case"ENCRYPTION_KDF_WITH_NULL_SALT":return c("MEBEncryptionVersion").ENCRYPTION_KDF_WITH_NULL_SALT;case"ENCRYPTION_KDF_WITH_VERSION":return c("MEBEncryptionVersion").ENCRYPTION_KDF_WITH_VERSION;case"ENCRYPTION_KDF_WITH_NULL_SALT_DF_CANARY":return c("MEBEncryptionVersion").ENCRYPTION_KDF_WITH_NULL_SALT_DF_CANARY;case"TEST_VERSION":return c("MEBEncryptionVersion").TEST_VERSION;default:return c("MEBEncryptionVersion").UNKNOWN}}function r(a,b,e,f){var g=[],h=[],k=[];a=(a=a==null?void 0:a.map(function(a){var e,f,l,m,n,r,s,u;if(a==null){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] message is null in the GraphQL range restore response"])));return}var v=a.otid;if(v==null){d("WALogger").ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] otid is null for a message in the GraphQL range restore response"])));return}e=(e=a.echo_document)==null?void 0:e.echo_document_string;f=(f=a.echo_document)==null?void 0:f.epoch_anon_id;l=(l=a.echo_document)==null?void 0:l.epoch_fingerprint;var w=a.protobuf_stanzas,x=w==null||(m=w.top_level_protobuf)==null?void 0:m.encrypted_protobuf_stanza,y=w==null||(n=w.top_level_protobuf)==null?void 0:n.epoch_anon_id,z=w==null||(r=w.top_level_protobuf)==null?void 0:r.epoch_id,A=w==null||(s=w.top_level_protobuf)==null?void 0:s.protobuf_timestamp_ms,B=w==null?void 0:w.supplemental_protobufs,C=w==null?void 0:w.message_tags;u=(u=a.protobuf_stanzas)==null?void 0:u.top_level_protobuf_v2;if(x==null||y==null||z==null||A==null){var D;if(e==null||f==null||e.length===0){if(u==null){t(x,y,z,A);return}return}u=q((u=a.echo_document)==null?void 0:u.encryption_version);g.push(d("LSShape").ofRecord({backup_id:b,encryption_version:(o||(o=d("LSIntEnum"))).ofNumber(u),epoch_anon_id:new TextEncoder().encode(f).buffer,epoch_fingerprint:l!=null?new TextEncoder().encode(l).buffer:void 0,epoch_id:((D=a.echo_document)==null?void 0:D.epoch_id)!=null?(p||(p=d("I64"))).of_string(a.echo_document.epoch_id):void 0,otid:v,value:e}));h.push({backup_id:b,encryption_version:u,epoch_anon_id:new TextEncoder().encode(f).buffer,epoch_fingerprint:l!=null?new TextEncoder().encode(l).buffer:void 0,epoch_id:((D=a.echo_document)==null?void 0:D.epoch_id)!=null?(p||(p=d("I64"))).of_string(a.echo_document.epoch_id):void 0,otid:v,value:e});return}if(w!=null){var E;u=q(w==null||(E=w.top_level_protobuf)==null?void 0:E.encryption_version);f=d("LSShape").ofRecord({encrypted_protobuf:x,encryption_version:(o||(o=d("LSIntEnum"))).ofNumber(u),epoch_anon_id:new TextEncoder().encode(y).buffer,epoch_id:(p||(p=d("I64"))).of_string(z),protobuf_timestamp_ms:p.of_string(A)});var F={messageTags:C==null?void 0:C.map(function(a){return a}),otid:v,supplementalProtobufs:[],topLevelProtobuf:{backup_id:b,encryptedProtobufContent:x,encryption_version:u,epoch_anon_id:new TextEncoder().encode(y).buffer,epoch_id:p.of_string(z),otid:v,protobufTimestampMs:A,value:void 0}},G=new(c("LSDict"))();B==null||B.forEach(function(a){var c=a==null?void 0:a.supplemental_key,e=a==null?void 0:a.encrypted_protobuf_stanza,f=a.epoch_anon_id,g=a==null?void 0:a.epoch_id,h=a==null?void 0:a.protobuf_timestamp_ms;if(e==null||f==null||g==null||h==null||c==null)return;var i=q(a==null?void 0:a.encryption_version);G.set(c,d("LSShape").ofRecord({encrypted_protobuf:e,encryption_version:(o||(o=d("LSIntEnum"))).ofNumber(i),epoch_anon_id:new TextEncoder().encode(f).buffer,epoch_id:(p||(p=d("I64"))).of_string(g),protobuf_timestamp_ms:p.of_string(h),sk_ciphertext:a==null?void 0:a.sk_ciphertext}));F.supplementalProtobufs.push({backup_id:b,encryptedProtobufContent:e,encryption_version:i,epoch_anon_id:new TextEncoder().encode(f).buffer,epoch_id:p.of_string(g),protobufTimestampMs:h,skCipherText:a==null?void 0:a.sk_ciphertext,supplementalKey:c,value:void 0})});k.push(F);return d("LSShape").ofRecord({encrypted_protobufs:d("LSShape").ofRecord({supplemental_protobufs:G,toplevel_protobuf:f}),otid:v})}}).filter(Boolean))!=null?a:[];f!=null&&e!=null&&c("QPLUserFlow").addPoint(e,"processing_encrypted_messages_complete",{instanceKey:f});s(g,a,e,f);return{encryptedLSEchoMessages:g,encryptedMessagesWithProtobufs:a,encryptedNonLSEchoMessages:h,encryptedNonLSProtobufs:k}}function s(a,b,e,f){if(e!=null){if(a.length>0){var g=d("LSShape").toRecord(a[0]);a=d("LSShape").toRecord(a[a.length-1]);c("QPLUserFlow").addAnnotations(e,{string:{first_echo_otid:g.otid,last_echo_otid:a.otid}},{instanceKey:f})}if(b.length>0){a=(g=d("LSShape")).toRecord(b[0]);var h=g.toRecord(a.encrypted_protobufs);b=g.toRecord(b[b.length-1]);g=g.toRecord(b.encrypted_protobufs);c("QPLUserFlow").addAnnotations(e,{string:{first_protobuf_otid:a.otid,first_protobuf_ts:(p||(p=d("I64"))).to_string(d("LSShape").toRecord(h.toplevel_protobuf).protobuf_timestamp_ms),last_protobuf_otid:b.otid,last_protobuf_ts:p.to_string(d("LSShape").toRecord(g.toplevel_protobuf).protobuf_timestamp_ms)}},{instanceKey:f})}}}function t(a,b,c,e){d("WALogger").ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] message with no echo document and no protobuf data, more details: encrypted_protobuf_content: ",", protobuf_epoch_anon_id: ",", protobuf_epoch_id: ",", protobuf_timestamp_ms: ",""])),a==null?"null/empty":"not empty",b==null?"null/empty":"not empty",c==null?"null/empty":"not empty",e==null?"null/empty":"not empty")}async function a(a,b){var e=b!=null?await d("ReQL").firstAsync(d("ReQL").fromTableAscending(b.secure_encrypted_backups_client_state)):await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.secure_encrypted_backups_client_state));b=b!=null?await d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(b.secure_encrypted_backups_epochs)):await d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.tables.secure_encrypted_backups_epochs));a=b.filter(function(a){return(p||(p=d("I64"))).equal(a.authorityLevel,(o||(o=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE))}).map(function(a){return(p||(p=d("I64"))).to_string(a.epochId)});if(e==null){d("WALogger").ERROR(l||(l=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth][web Client state is null - unable to proceed with GQL restore"])));return}b=e.deviceId;var f=e.mailboxRootKeyBlob,g=e.ocmfClientStateBlob;e=e.backupId;return{backupId:e,device_id:b,locally_available_epochs:a,mailboxRootKey:f,ocmfClientStateBlob:g}}async function e(a,b,e,g,h,i){i===void 0&&(i=!1);g!=null&&i===!1&&(h!=null&&h?d("MAWEBRestoreTrackingUtils").addQPLRestorePointWithAnnotationsWorker({annotations:{bool:{has_epochs:a!=null&&a.epoch_edges.length>0}},pointName:"derive_and_store_epochs_worker",traceId:g}):d("MAWEBRestoreTrackingUtils").addQPLRestorePointWithAnnotations({annotations:{bool:{has_epochs:a!=null&&a.epoch_edges.length>0}},pointName:"derive_and_store_epochs",traceId:g}));try{if(a!=null){var j=a.epoch_edges,k=[],l=new TextEncoder();j!=null&&(j.forEach(function(a){var b=a.from_epoch,c=a.to_epoch,e=a.forward_edge,f=a.backward_edge!=null?d("LSBase64Decode").decode(a.backward_edge):void 0,g=(e==null?void 0:e.auth_public_key)!=null?d("LSBase64Decode").decode(e.auth_public_key):void 0,h=(e==null?void 0:e.encrypted_entropy)!=null?d("LSBase64Decode").decode(e==null?void 0:e.encrypted_entropy):void 0,i=(e==null?void 0:e.entropy_fingerprint)!=null?d("LSBase64Decode").decode(e==null?void 0:e.entropy_fingerprint):void 0,j=(e==null?void 0:e.epoch_storage_public_key)!=null?d("LSBase64Decode").decode(e==null?void 0:e.epoch_storage_public_key):void 0;e=(e==null?void 0:e.psk_fingerprint)!=null?d("LSBase64Decode").decode(e==null?void 0:e.psk_fingerprint):void 0;var m;g!=null&&h!=null&&(m=d("LSShape").ofRecord({auth_public_key:g,encrypted_entropy:h,entropy_fingerprint:i,epoch_storage_public_key:j,psk_fingerprint:e}));g=b==null?void 0:b.epoch_anon_id;h=b==null?void 0:b.epoch_id;i=c==null?void 0:c.epoch_anon_id;j=c==null?void 0:c.epoch_id;g!=null&&h!=null&&i!=null&&j!=null&&k.push(d("LSShape").ofRecord({backward_edge:f,forward_edge:m,from_epoch:d("LSShape").ofRecord({epoch_anon_id:l.encode(g).buffer,epoch_id:(p||(p=d("I64"))).of_string(h)}),from_epoch_fingerprint:a.from_epoch_fingerprint!=null?d("LSBase64Decode").decode(a.from_epoch_fingerprint):void 0,to_epoch:d("LSShape").ofRecord({epoch_anon_id:l.encode(i).buffer,epoch_id:p.of_string(j)}),to_epoch_fingerprint:a.to_epoch_fingerprint!=null?d("LSBase64Decode").decode(a.to_epoch_fingerprint):void 0}))}),await b.runInTransaction(function(a){return c("LSDeriveAndStoreEpochsStoredProcedure")(c("LSFactory")(a),{epochEdges:c("LSVec").ofArray(k),epochSyncReason:(o||(o=d("LSIntEnum"))).ofNumber(c("MEBEpochSyncReason").DECRYPT_AND_WRITE_MESSAGES),targetDeviceId:e,traceId:g})},"readwrite",void 0,void 0,f.id+":579"))}}catch(b){g!=null&&i===!1&&(h!=null&&h?d("MAWEBRestoreTrackingUtils").addQPLRestorePointWithAnnotationsWorker({annotations:{bool:{has_epochs:a!=null&&a.epoch_edges.length>0},string:{exception:b.message}},pointName:"derive_and_store_epochs_worker_exception",traceId:g}):d("MAWEBRestoreTrackingUtils").addQPLRestorePointWithAnnotations({annotations:{bool:{has_epochs:a!=null&&a.epoch_edges.length>0},string:{exception:b.message}},pointName:"derive_and_store_epochs_exception",traceId:g}))}}h!==void 0?h:h=b("handleRestoreMessagesGraphQLResponse_XFBEncryptedBackupMessages.graphql");async function u(a){var b=a.backupId,e=a.encryptedMessages,g=a.messageRangeInfo,h=a.qplEvent,i=a.runningInWorker,j=a.sortOrderMs,k=a.source,l=a.storage,o=a.threadId;a=a.traceId;var q=a!=null?d("WAHashStringToNumber").hashStringToNumber(a):void 0;e=r(e,b);var s=e.encryptedLSEchoMessages,t=e.encryptedMessagesWithProtobufs;b=g!=null?g:{};e=b.has_more_after;g=b.has_more_before;var u=b.next_message_timestamp_ms_after;b=b.next_message_timestamp_ms_before;if(g==null||e==null||u==null||b==null)return;if(t.length===0){var v;(v=d("EBAPIQPLPoints")).ebAPIAddQPLPoint(i,h,v.EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_ECHO_START,void 0,q);var w=await l.runInTransaction(function(a){return c("LSDecryptMessagesStoredProcedure")(c("LSFactory")(a),{actThreadId:o,encryptedMessages:c("LSVec").ofArray(s)})},"readwrite",void 0,void 0,f.id+":802");v.ebAPIAddQPLPoint(i,h,v.EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_ECHO_END,void 0,q);v=w[0];if(v!=null){d("EBAPIQPLPoints").ebAPIAddQPLPoint(i,h,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.ECHO_DECODE_START,void 0,q);w=c("LSVec").toArray(v).map(function(a){return d("LSShape").toRecord(a).value}).map(function(a){return d("MAWJobDefinitions").toEncodedEchoMessage(a)});v={echoMessages:w,hasMoreAfter:e,hasMoreBefore:g,isPointQuery:!1,mpsMessageQuery:void 0,nextMessageTimestampMsAfter:(p||(p=d("I64"))).of_string(u),nextMessageTimestampMsBefore:p.of_string(b),referenceTimestamp:j!=null?j:void 0,requestId:a,taskSource:k!=null?k:void 0};return v}}else{d("EBAPIQPLPoints").ebAPIAddQPLPoint(i,h,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_PROTOBUF_START,void 0,q);w=await l.runInTransaction(function(a){return c("LSDecryptMessageProtobufsStoredProcedure")(c("LSFactory")(a),{actThreadId:o,encryptedMessagesWithProtobufs:c("LSVec").ofArray(t)})},"readwrite",void 0,void 0,f.id+":865");v=w[0];l=w[1];if(l!=null){w=d("LSShape").toRecord(l);d("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][processEncryptedMessagesWithoutPersisting] decryptMessageProtobufs failed with error: ",""])),w.error_message)}d("EBAPIQPLPoints").ebAPIAddQPLPoint(i,h,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_PROTOBUF_END,void 0,q);if(v==null){d("WALogger").ERROR(n||(n=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Protobuf decryption failed in search range restore response"])));d("EBAPIQPLPoints").ebAPIAddQPLPoint(i,h,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.PROTOBUF_DECRYPTION_FAILURE,void 0,q);return}l=d("MAWEncryptedBackupUtils").convertLSTypesToJSTypesForRestoreJob(v);w={hasMoreAfter:e,hasMoreBefore:g,isPointQuery:!1,mpsMessageQuery:void 0,nextMessageTimestampMsAfter:(p||(p=d("I64"))).of_string(u),nextMessageTimestampMsBefore:p.of_string(b),protobufMessages:l,referenceTimestamp:j!=null?j:void 0,requestId:a,taskSource:k!=null?k:void 0};return w}}g.processMessageArray=r;g.getClientState=a;g.deriveAndStoreEpochs=e;g.processEncryptedMessagesWithoutPersisting=u}),98);
__d("EBAPISharedUtils",["EBAPIQPLPoints","I64","LSAuthorityLevel","LSIntEnum","MAWBridgeSafeActionsWorkerAndUI","MAWRotateDTSG","MWEBODSEntityName.enum","ODS","WALogger","handleRestoreMessagesGraphQLResponse"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p;function a(a,b){if(a!=null){b=b.filter(function(a){return(n||(n=d("I64"))).equal(a.authorityLevel,(o||(o=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE))}).map(function(a){return(n||(n=d("I64"))).to_string(a.epochId)});return{backupId:a.backupId,device_id:a.deviceId,locally_available_epochs:b,mailboxRootKey:a.mailboxRootKeyBlob,ocmfClientStateBlob:a.ocmfClientStateBlob}}}function b(a){var b=a==null?void 0:a.backupTenancy;a=a==null?void 0:a.authorityLevel;return b==null||a==null?!1:(n||(n=d("I64"))).equal((o||(o=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE),a)}function q(a){var b=a.backupId,c=a.devicePrivateKeyBlob,d=a.devicePublicKeyBlob,e=a.epochAuthPrivateKeyBlob,f=a.epochAuthPublicKeyBlob,g=a.epochStoragePrivateKeyBlob,h=a.epochStoragePublicKeyBlob,i=a.mailboxRootKeyBlob,j=a.obliviousValidationTokenBlob,k=a.ocmfClientStateBlob;if(b!=null&&c!=null&&d!=null&&e!=null&&f!=null&&g!=null&&h!=null&&i!=null&&j!=null&&k!=null)return{authorityLevel:a.authorityLevel,backupId:b,backupTenancy:a.backupTenancy,deviceId:a.deviceId,devicePrivateKeyBlob:c,devicePublicKeyBlob:d,encryptionVersion:a.encryptionVersion,epochAuthPrivateKeyBlob:e,epochAuthPublicKeyBlob:f,epochStoragePrivateKeyBlob:g,epochStoragePublicKeyBlob:h,mailboxRootKeyBlob:i,obliviousValidationTokenBlob:j,ocmfClientStateBlob:k,revisionVersion:a.revisionVersion}}function r(a){var b=a.authorityLevel,c=a.backupId,d=a.epochAnonIdBlob,e=a.epochId,f=a.epochRootKeyBlob;a=a.epochStatus;if(b!=null&&c!=null&&d!=null&&e!=null&&f!=null&&a!=null)return{authorityLevel:b,backupId:c,epochAnonIdBlob:d,epochId:e,epochRootKeyBlob:f,epochStatus:a}}function e(a){var b=[],c=new Set(["epochId","authorityLevel","backupId","epochAnonIdBlob","epochRootKeyBlob","epochStatus"]);a=a.get("secure_encrypted_backups_epochs");if(a==null||(a==null?void 0:a.size)===0)return b;if(a!=null){a=a.entries();for(a of a){var d=a[0];a[1];d=d;if(d instanceof Object){d=Object.values(d);d=d[1];if(d instanceof Object){var e={};for(d of Object.entries(d)){var f=d[0],g=d[1];c.has(f)&&(e[f]=g)}f=r(e);f!=null&&b.push(f)}}}}return b}function f(a){a=a.get("secure_encrypted_backups_client_state");var b={};if(a==null||(a==null?void 0:a.size)===0)return;if(a!=null){a=a.entries();for(a of a){var c=a[0];a[1];c=c;if(c instanceof Object){c=Object.values(c);c=c[1];if(c instanceof Object)for(c of Object.entries(c)){var d=c[0],e=c[1];b[d]=e}}break}}d=q(b);return d}function s(a){(p||(p=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,a)}async function t(a,b,c,e,f,g,o,p,q,r,s,t){var u,v,w,x;d("EBAPIQPLPoints").ebAPIAddQPLPoint(b,c,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.GRAPHQL_QUERY_END,void 0,f);if(a==null||(a==null||(u=a.viewer)==null||(u=u.encrypted_backup)==null?void 0:u.mailbox)==null){d("EBAPIQPLPoints").ebAPIEndFailure(b,c,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE,f);return{response:"invalid-graphql-response",success:!1}}v=(v=a==null||(w=a.viewer)==null||(w=w.encrypted_backup)==null||(w=w.mailbox)==null?void 0:w.messages)!=null?v:a==null||(x=a.viewer)==null||(x=x.encrypted_backup)==null||(x=x.mailbox)==null?void 0:x.messages_point_restore;if(v==null){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] GQL worker range restore query returned null for message response"])));d("EBAPIQPLPoints").ebAPIEndFailure(b,c,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE,f);return{response:"invalid-graphql-response",success:!1}}a=v;if((a==null?void 0:a.encrypted_messages)==null){d("EBAPIQPLPoints").ebAPIEndFailure(b,c,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NULL_MESSAGES,f);return{response:"invalid-graphql-response",success:!1}}v=a.backup_id;var y=a.encrypted_messages,z=a.epoch_derivation_set,A=a.exception_string,B=a.message_range_info;a=a.should_delete_mailbox;if(A!=null){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] server side exception during graphql restore - ",""])),A);a===!0&&d("EBAPIQPLPoints").ebAPIAddQPLPoint(b,c,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DELETE_MAILBOX,void 0,f);d("EBAPIQPLPoints").ebAPIEndFailure(b,c,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.SERVER_SIDE_EXCEPTION,f,{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.SERVER_SIDE_EXCEPTION,exception:A}});return{response:"server-side-exception",success:!1}}d("EBAPIQPLPoints").ebAPIAddQPLPoint(b,c,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DERIVE_AND_STORE_EPOCHS_START,void 0,f);await d("handleRestoreMessagesGraphQLResponse").deriveAndStoreEpochs(z,e,g,r,b);d("EBAPIQPLPoints").ebAPIAddQPLPoint(b,c,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DERIVE_AND_STORE_EPOCHS_END,void 0,f);if(B==null){d("WALogger").ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] message range info is null - cannot proceed with graphQL restore"])));d("EBAPIQPLPoints").ebAPIEndFailure(b,c,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.MISSING_RANGE_INFO,f);return{response:"missing-message-range-info",success:!1}}if(B!=null){a=B.has_more_after;A=B.has_more_before;z=B.next_message_timestamp_ms_after;g=B.next_message_timestamp_ms_before;if(A==null||a==null||z==null||g==null){d("WALogger").ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] message range info is not complete - cannot proceed with graphQL restore"])));d("EBAPIQPLPoints").ebAPIEndFailure(b,c,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.MISSING_RANGE_INFO,f);return{response:"missing-message-range-info",success:!1}}}v==null&&(d("WALogger").WARN(l||(l=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] backup_id is null during graphQL restore"]))),d("EBAPIQPLPoints").ebAPIAddQPLPoint(b,c,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.BACKUP_ID_NULL,void 0,f));d("EBAPIQPLPoints").ebAPIAddQPLPoint(b,c,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.PROCESS_AND_DECRYPT_MESSAGES_START,void 0,f);A=await d("handleRestoreMessagesGraphQLResponse").processEncryptedMessagesWithoutPersisting({backupId:v!=null?v:(n||(n=d("I64"))).to_string(t),encryptedMessages:y,messageRangeInfo:B,qplEvent:c,runningInWorker:b,sortOrderMs:s,source:q,storage:e,threadId:o,traceId:r});d("EBAPIQPLPoints").ebAPIAddQPLPoint(b,c,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.PROCESS_AND_DECRYPT_MESSAGES_END,void 0,f);if(A==null){d("EBAPIQPLPoints").ebAPIEndFailure(b,c,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.EMPTY_DECRYPTION_RESPONSE,f);return{response:"empty-decryption-response",success:!1}}if(A.echoMessages!=null){a=A;z=a.echoMessages;d("EBAPIQPLPoints").ebAPIAddQPLPoint(b,c,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.ECHO_TO_PROTOBUF_CONVERSION_START,void 0,f);try{g=await d("MAWBridgeSafeActionsWorkerAndUI").sendAndReceiveBackendWorkerAndUIShared("convertEchoMessagesToEBProtobufs",{chatJid:p,encodedEchoMessages:z});d("EBAPIQPLPoints").ebAPIAddQPLPoint(b,c,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.ECHO_TO_PROTOBUF_CONVERSION_END,void 0,f);A=babelHelpers.extends({},A,{echoMessages:void 0,protobufMessages:(A.protobufMessages||[]).concat(g)})}catch(a){d("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Echo to protobuf conversion failed in search range restore response: ",""])),a.message);d("EBAPIQPLPoints").ebAPIEndFailure(b,c,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.ECHO_TO_PROTOBUF_CONVERSION_FAILURE,f);return{response:"echo-to-protobuf-conversion-error",success:!1}}}d("EBAPIQPLPoints").ebAPIEndSuccess(b,c,f,{bool:{isEcho:(v=A)!=null&&v.echoMessages?((t=A)==null?void 0:t.echoMessages.length)>0:!1,isProtobuf:(y=A)!=null&&y.protobufMessages?((B=A)==null?void 0:B.protobufMessages.length)>0:!1}});return{response:A,success:!0}}function u(a){return a!=null&&a.message.indexOf("1357004")!==-1?d("MAWRotateDTSG").tryRotateDTSG().then(function(a){if(a)return"token-rotation-successful";else return"token-rotation-failed"}):Promise.resolve("token-rotation-not-required")}g.getDeviceAndKeyMetadata=a;g.isBackupTenancyAuthoritative=b;g.getAvailableEpochsFromPersistedEBSM=e;g.getClientStateFromPersistedEBSM=f;g.bumpOdsRestoreKey=s;g.constructEBRestoreResponse=t;g.handleDTSGTokenRotation=u}),98);
__d("EBBase64Decode",["Base64Utils"],(function(a,b,c,d,e,f,g){"use strict";function h(a){a=a.replace(/-/g,"+").replace(/_/g,"/").replace(/\./g,"=").replace("/,/","=");var b=4-a.length%4;if(b<4)for(var c=0;c<b;c++)a+="=";return a}function a(a){return d("Base64Utils").toArrayBuffer(h(a))}g["default"]=a}),98);
__d("EBEpochUtils",["Base64Utils","EBBase64Decode","EBCryptoUtils","FBLogger","I64","PublicEncryptionCreateDecryptedData","PublicEncryptionCreateEncryptedData"],(function(a,b,c,d,e,f,g){"use strict";var h,i="epoch_chaining",j="epoch_root_key",k="epoch_data_storage",l="epoch_data_metadata",m=18;function a(a){var b=new TextEncoder().encode("0").buffer;if(a==null)return b;if(a.byteLength===0)return b;b=new TextDecoder();b=b.decode(a);a=Number.parseInt(b,10);if(Number.isNaN(a))throw c("FBLogger")("messenger_web").mustfixThrow("currentEpochInt is NaN");b=a+1;return new TextEncoder().encode(b.toString()).buffer}async function b(a,b,e){var f,g=[(f=d("EBCryptoUtils")).KEY_LEN,f.KEY_LEN];f=f.getBlobFromString([i,a,(h||(h=d("I64"))).to_string(b)].join(d("EBCryptoUtils").STRING_JOIN_SEPARATOR));if(f==null)throw c("FBLogger")("messenger_web").mustfixThrow("infoForEpochChaining is empty");a=await d("EBCryptoUtils").createDerivedKeys(f,null,e,g);return{epoch_chaining_key:a[0],epoch_distribution_pre_shared_key:a[1]}}async function e(a,b,d,e,f,g){a=await c("PublicEncryptionCreateDecryptedData")(a,b,d,e,n(f),g);return a[0]}async function f(a,b,d,e,f,g){a=await c("PublicEncryptionCreateEncryptedData")(a,b,d,e,n(f),g);return a[0]}function n(a){return new TextEncoder().encode(["epoch_",a].join(d("EBCryptoUtils").STRING_JOIN_SEPARATOR)).buffer}async function o(a,b,c,e){a=await d("EBCryptoUtils").createDerivedKeys(a,b,c,e);return a[0]}function p(a,b){var e=d("EBCryptoUtils").getBlobFromString(j);if(e==null)throw c("FBLogger")("messenger_web").mustfixThrow("epochRootKey is empty");return o(e,a,b,[d("EBCryptoUtils").KEY_LEN])}function q(a,b){b=new TextEncoder().encode("meb/debug/fingerprint/"+b).buffer;if(b==null)throw c("FBLogger")("messenger_web").mustfixThrow("blob type for which fingerprints are supported is empty");return o(b,null,a,[m])}async function r(a,b,c){var e=[d("EBCryptoUtils").KEY_LEN];b=d("Base64Utils").fromArrayBuffer(b);a=[a,b].join(d("EBCryptoUtils").STRING_JOIN_SEPARATOR);b=await d("EBCryptoUtils").createDerivedKeys(new TextEncoder().encode(a).buffer,null,c,e);return b.length===0?Promise.resolve():b[0]}function s(a){return r(k,a.epochAnonIdBlob,a.epochRootKeyBlob)}async function t(a,b){b=d("Base64Utils").fromArrayBuffer(b);b=await u(b,a,l);if(b==null)throw c("FBLogger")("messenger_web").mustfixThrow("symmetricDecryptAndBase64Decode output is empty while decrypting backward edge");return b}async function u(a,b,e){e=c("EBBase64Decode")(e);if(e==null)throw c("FBLogger")("messenger_web").mustfixThrow("aadBuffer is empty");b=await d("EBCryptoUtils").symmetricEncryptionCreateDecryptedString(b,e,a);if(b==null)throw c("FBLogger")("messenger_web").mustfixThrow("decrypted_arraybuffer is empty");return b}g.getNextEpochId=a;g.generateEpochChainingAndDistributionPreSharedKey=b;g.decryptEpochKey=e;g.generateEncryptedEpochKey=f;g.deriveKey=o;g.generateEpochRootKey=p;g.getFingerPrint=q;g.createDerivedKeysForEpoch=r;g.deriveBackwardEdgeKey=s;g.decryptBackwardEdge=t}),98);
__d("LSEpochStatus",[],(function(a,b,c,d,e,f){a=Object.freeze({ES_OPEN:1,ES_CLOSE:2});f["default"]=a}),66);
__d("MEBEpochDerivationResult",[],(function(a,b,c,d,e,f){a=Object.freeze({SUCCESS:0,UNKNOWN_ERROR:1,EDGE_NEITHER_FORWARD_NOR_BACKWARD:2,FORWARD_DECRYPTION_FAILED:3,FORWARD_SOURCE_EPOCH_NOT_FOUND_DEPRECATED:4,BACKWARD_SOURCE_EPOCH_NOT_FOUND_DEPRECATED:5,BACKWARD_DECRYPTION_FAILED:6,MISSING_CLIENT_STATE:7,DEVICE_ID_MISMATCH:8,SOURCE_FINGERPRINT_MISMATCH:9,DEST_FINGERPRINT_MISMATCH:10,STORAGE_KEY_MISMATH:11,PSK_FINGERPRINT_MISMATCH:12,SOURCE_EPOCH_NOT_FOUND:13,FORWARD_EDGE_NOT_CONSECUTIVE:14,BACKWARD_EDGE_NOT_CONSECUTIVE:15,DERIVATION_DEST_EXISTS:16,DERIVATION_DEST_ANON_ID_EXISTS:17});f["default"]=a}),66);
__d("EBDeriveAndStoreEpochs",["Base64Utils","EBBase64Decode","EBEpochUtils","I64","LSAuthorityLevel","LSEpochStatus","MEBEpochDerivationResult","ReQL","WACryptoUtils","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";var h;async function i(a,b,e,f){var g,i,j,k,l=await d("EBEpochUtils").getNextEpochId(f.epochAnonIdBlob);if(new TextDecoder().decode(l)!==(e==null||(g=e.to_epoch)==null?void 0:g.epoch_anon_id))return d("WAResultOrError").makeError({errorMessage:"epoch forward edge not consecutive",resultCode:c("MEBEpochDerivationResult").FORWARD_EDGE_NOT_CONSECUTIVE});l=e==null||(i=e.from_epoch)==null?void 0:i.epoch_id;var m=e==null||(j=e.from_epoch)==null?void 0:j.epoch_anon_id;if(l==null||m==null)return d("WAResultOrError").makeError({errorMessage:"fromEpochId or fromEpochAnonId is null",resultCode:c("MEBEpochDerivationResult").SOURCE_EPOCH_NOT_FOUND});m=await d("EBEpochUtils").generateEpochChainingAndDistributionPreSharedKey(m,(h||(h=d("I64"))).of_string(l),f.epochRootKeyBlob);l=m.epoch_distribution_pre_shared_key;f=await d("EBEpochUtils").getFingerPrint(l,"MEBCryptoPreSharedKey");if((b==null?void 0:b.psk_fingerprint)!==d("Base64Utils").fromArrayBuffer(f))return d("WAResultOrError").makeError({errorMessage:"epoch forward edge psk fingerprint mismatch",resultCode:c("MEBEpochDerivationResult").PSK_FINGERPRINT_MISMATCH});f=b==null?void 0:b.epoch_storage_public_key;if(d("Base64Utils").fromArrayBuffer(a.epochStoragePublicKeyBlob)!==f)return d("WAResultOrError").makeError({errorMessage:"epoch forward edge storage key mismatch",resultCode:c("MEBEpochDerivationResult").STORAGE_KEY_MISMATH});f=b==null?void 0:b.auth_public_key;if(f==null)return d("WAResultOrError").makeError({errorMessage:"epoch forward edge auth public key is null",resultCode:c("MEBEpochDerivationResult").FORWARD_SOURCE_EPOCH_NOT_FOUND_DEPRECATED});e=e==null||(k=e.to_epoch)==null?void 0:k.epoch_anon_id;if(e==null)return d("WAResultOrError").makeError({errorMessage:"epoch forward edge target epoch anon id is null",resultCode:c("MEBEpochDerivationResult").FORWARD_SOURCE_EPOCH_NOT_FOUND_DEPRECATED});b=b==null?void 0:b.encrypted_entropy;if(b==null)return d("WAResultOrError").makeError({errorMessage:"epoch forward edge encrypted entropy is null",resultCode:c("MEBEpochDerivationResult").FORWARD_SOURCE_EPOCH_NOT_FOUND_DEPRECATED});f=c("EBBase64Decode")(f);if(f==null)return d("WAResultOrError").makeError({errorMessage:"epoch forward edge auth public key is null",resultCode:c("MEBEpochDerivationResult").FORWARD_SOURCE_EPOCH_NOT_FOUND_DEPRECATED});b=c("EBBase64Decode")(b);if(b==null)return d("WAResultOrError").makeError({errorMessage:"epoch forward edge encrypted entropy is null",resultCode:c("MEBEpochDerivationResult").FORWARD_SOURCE_EPOCH_NOT_FOUND_DEPRECATED});a=await d("EBEpochUtils").decryptEpochKey(a.epochStoragePublicKeyBlob,a.epochStoragePrivateKeyBlob,f,l,e,b);return a==null?d("WAResultOrError").makeError({errorMessage:"epoch forward edge entropy is null",resultCode:c("MEBEpochDerivationResult").FORWARD_DECRYPTION_FAILED}):d("WAResultOrError").makeResult(await d("EBEpochUtils").generateEpochRootKey(m.epoch_chaining_key,a))}async function j(a,b,e){var f;b=b==null||(f=b.to_epoch)==null?void 0:f.epoch_anon_id;if(b==null)return d("WAResultOrError").makeError({errorMessage:"toEpochId is null",resultCode:c("MEBEpochDerivationResult").BACKWARD_SOURCE_EPOCH_NOT_FOUND_DEPRECATED});b=d("EBEpochUtils").getNextEpochId(c("EBBase64Decode")(b));if(d("WACryptoUtils").arrayBuffersEqual(b,a.epochAnonIdBlob))return d("WAResultOrError").makeError({errorMessage:"epoch backward edge not consecutive",resultCode:c("MEBEpochDerivationResult").BACKWARD_EDGE_NOT_CONSECUTIVE});b=await d("EBEpochUtils").deriveBackwardEdgeKey(a);return b==null?d("WAResultOrError").makeError({errorMessage:"epoch backward edge storage key is null",resultCode:c("MEBEpochDerivationResult").STORAGE_KEY_MISMATH}):d("WAResultOrError").makeResult(await d("EBEpochUtils").decryptBackwardEdge(b,e))}async function k(a,b){var e,g,k,l,m=await a.runInTransaction(function(a){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.secure_encrypted_backups_client_state))},"readwrite",void 0,void 0,f.id+":203");if(m==null)return d("WAResultOrError").makeError({errorMessage:"client state is missing",resultCode:c("MEBEpochDerivationResult").MISSING_CLIENT_STATE});var n=b==null||(e=b.from_epoch)==null?void 0:e.epoch_id;if(n==null)return d("WAResultOrError").makeError({errorMessage:"fromEpochId is null",resultCode:c("MEBEpochDerivationResult").SOURCE_EPOCH_NOT_FOUND});var o=await a.runInTransaction(function(a){return a.secure_encrypted_backups_epochs.get((h||(h=d("I64"))).of_string(n))},"readwrite",void 0,void 0,f.id+":221");if(o==null)return d("WAResultOrError").makeError({errorMessage:"source epoch is missing",resultCode:c("MEBEpochDerivationResult").SOURCE_EPOCH_NOT_FOUND});var p=b==null||(g=b.from_epoch)==null?void 0:g.epoch_anon_id;if(new TextDecoder().decode(o.epochAnonIdBlob)!==p)return d("WAResultOrError").makeError({errorMessage:"epoch derivation source epoch anon id mismatch",resultCode:c("MEBEpochDerivationResult").SOURCE_FINGERPRINT_MISMATCH});p=b==null?void 0:b.from_epoch_fingerprint;var q=await d("EBEpochUtils").getFingerPrint(o.epochRootKeyBlob,"MEBEpochRootKey");if(d("Base64Utils").fromArrayBuffer(q)!==p)return d("WAResultOrError").makeError({errorMessage:"epoch derivation source epoch fingerprint mismatch",resultCode:c("MEBEpochDerivationResult").SOURCE_FINGERPRINT_MISMATCH});q=b==null?void 0:b.forward_edge;if(q!=null)p=await i(m,q,b,o);else{q=b==null?void 0:b.backward_edge;if(q==null)return d("WAResultOrError").makeError({errorMessage:"backward edge is null",resultCode:c("MEBEpochDerivationResult").BACKWARD_SOURCE_EPOCH_NOT_FOUND_DEPRECATED});p=await j(o,b,new TextEncoder().encode(q).buffer)}o=b==null?void 0:b.to_epoch_fingerprint;var r=p.value,s=b==null||(k=b.to_epoch)==null?void 0:k.epoch_id,t=b==null||(l=b.to_epoch)==null?void 0:l.epoch_anon_id;if(s==null||t==null)return d("WAResultOrError").makeError({errorMessage:"target epoch id or anon id is null",resultCode:c("MEBEpochDerivationResult").FORWARD_SOURCE_EPOCH_NOT_FOUND_DEPRECATED});if(r==null)return p;q=await d("EBEpochUtils").getFingerPrint(r,"MEBEpochRootKey");if(o!==d("Base64Utils").fromArrayBuffer(q))return d("WAResultOrError").makeError({errorMessage:"epoch derivation target epoch fingerprint mismatch",resultCode:c("MEBEpochDerivationResult").DEST_FINGERPRINT_MISMATCH});await a.runInTransaction(function(a){return a.secure_encrypted_backups_epochs.put({authorityLevel:(h||(h=d("I64"))).of_float(c("LSAuthorityLevel").AUTHORITATIVE),backupId:m.backupId,epochAnonIdBlob:new TextEncoder().encode(t).buffer,epochId:h.of_string(s),epochRootKeyBlob:r,epochStatus:h.of_float(c("LSEpochStatus").ES_CLOSE)})},"readwrite",void 0,void 0,f.id+":301");return d("WAResultOrError").makeResult(r)}async function a(a,b){if((b==null?void 0:b.epoch_edges)==null)return[];var d=[];for(b of b.epoch_edges){var e,f,g,h,i=await k(a,b);e={resultForEpochSync:{error_message:(e=i.error)==null?void 0:e.errorMessage,from:{epoch_anon_id:(e=b.from_epoch)==null?void 0:e.epoch_anon_id,epoch_id:b==null||(f=b.from_epoch)==null?void 0:f.epoch_id},has_backward_edge:(b==null?void 0:b.backward_edge)!=null,has_forward_edge:(b==null?void 0:b.forward_edge)!=null,result_code:i.success?c("MEBEpochDerivationResult").SUCCESS:i.error.resultCode,to:{epoch_anon_id:b==null||(g=b.to_epoch)==null?void 0:g.epoch_anon_id,epoch_id:b==null||(h=b.to_epoch)==null?void 0:h.epoch_id}}};d.push(e)}return d}g.deriveAndStoreEpochsNonLS=a}),98);
__d("EBMessagePointQueryWithPersistenceQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="10035011859900671"}),null);
__d("EBMessagePointQueryWithPersistenceQuery.graphql",["EBMessagePointQueryWithPersistenceQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a={defaultValue:null,kind:"LocalArgument",name:"app_id"},c={defaultValue:null,kind:"LocalArgument",name:"restore_payload_string"},d={defaultValue:null,kind:"LocalArgument",name:"restore_type"},e=[{kind:"Variable",name:"app_id",variableName:"app_id"},{kind:"Variable",name:"restore_payload_string",variableName:"restore_payload_string"},{kind:"Variable",name:"restore_type",variableName:"restore_type"}],f={alias:null,args:null,kind:"ScalarField",name:"encryption_version",storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"epoch_anon_id",storageKey:null},h={alias:null,args:null,kind:"ScalarField",name:"epoch_id",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"encrypted_protobuf_stanza",storageKey:null},j={alias:null,args:null,kind:"ScalarField",name:"protobuf_timestamp_ms",storageKey:null},k={alias:null,args:null,kind:"ScalarField",name:"sk_ciphertext",storageKey:null},l=[g,h];return{fragment:{argumentDefinitions:[a,c,d],kind:"Fragment",metadata:null,name:"EBMessagePointQueryWithPersistenceQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"encrypted_backup",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupMailbox",kind:"LinkedField",name:"mailbox",plural:!1,selections:[{alias:null,args:e,concreteType:"XFBEncryptedBackupMessages",kind:"LinkedField",name:"messages_point_restore",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"handleRestoreMessagesGraphQLResponse_XFBEncryptedBackupMessages"}],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[c,d,a],kind:"Operation",name:"EBMessagePointQueryWithPersistenceQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"encrypted_backup",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupMailbox",kind:"LinkedField",name:"mailbox",plural:!1,selections:[{alias:null,args:e,concreteType:"XFBEncryptedBackupMessages",kind:"LinkedField",name:"messages_point_restore",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupMessage",kind:"LinkedField",name:"encrypted_messages",plural:!0,selections:[{alias:null,args:null,concreteType:"XFBEchoDocument",kind:"LinkedField",name:"echo_document",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"echo_document_string",storageKey:null},f,g,h,{alias:null,args:null,kind:"ScalarField",name:"epoch_fingerprint",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"otid",storageKey:null},{alias:null,args:null,concreteType:"XFBProtobufStanzas",kind:"LinkedField",name:"protobuf_stanzas",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"message_tags",storageKey:null},{alias:null,args:null,concreteType:"XFBProtobufStanza",kind:"LinkedField",name:"top_level_protobuf",plural:!1,selections:[i,f,g,h,j,k],storageKey:null},{alias:null,args:null,concreteType:"XFBProtobufStanza",kind:"LinkedField",name:"supplemental_protobufs",plural:!0,selections:[i,f,g,h,j,k,{alias:null,args:null,kind:"ScalarField",name:"supplemental_key",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"backup_id",storageKey:null},{alias:null,args:null,concreteType:"XFBMessageRangeInfo",kind:"LinkedField",name:"message_range_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"has_more_before",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"has_more_after",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"next_message_timestamp_ms_before",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"next_message_timestamp_ms_after",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"should_delete_mailbox",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"exception_string",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"thread_not_found",storageKey:null},{alias:null,args:null,concreteType:"XFBEpochDerivationSet",kind:"LinkedField",name:"epoch_derivation_set",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupsEpochEdge",kind:"LinkedField",name:"epoch_edges",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"backward_edge",storageKey:null},{alias:null,args:null,concreteType:"XFBEpochForwardEdge",kind:"LinkedField",name:"forward_edge",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"auth_public_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"encrypted_entropy",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"entropy_fingerprint",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"epoch_storage_public_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"psk_fingerprint",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBEpochIds",kind:"LinkedField",name:"from_epoch",plural:!1,selections:l,storageKey:null},{alias:null,args:null,concreteType:"XFBEpochIds",kind:"LinkedField",name:"to_epoch",plural:!1,selections:l,storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"from_epoch_fingerprint",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"to_epoch_fingerprint",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}],storageKey:null}]},params:{id:b("EBMessagePointQueryWithPersistenceQuery_facebookRelayOperation"),metadata:{},name:"EBMessagePointQueryWithPersistenceQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("XFBLSRestoreOperationType.facebook",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum").Mirrored(["DELTA_GENERIC_MESSAGE_SYNC","INITIAL_RESTORE","MESSAGE_QUERY_RESTORE","POINT_QUERY_RESTORE","RANGE_QUERY_RESTORE","SNAPSHOT_RESTORE","SURROUNDING_RESTORE","THREAD_POINT_QUERY_RESTORE","UNKNOWN"]);c=a;f["default"]=c}),66);
__d("EBMessagePointQueryWithPersistence",["Base64Utils","EBAPIDecryptionModule","EBAPIQPLPoints","EBAPISharedUtils","EBAPIWorkerCheck","EBDeriveAndStoreEpochs","EBIsEbEnabled","EBMessagePointQueryWithPersistenceQuery.graphql","I64","LSDecryptMessageProtobufsStoredProcedure","LSDecryptMessagesStoredProcedure","LSEncryptedBackupsBackupTenancy","LSFactory","LSIntEnum","LSMEBTaskCreationSource","LSShape","LSVec","MAWBridge","MAWConvertEchoMessagesToEBProtobufs","MAWCurrentUser","MAWEBRestoreTrackingUtils","MAWEncryptedBackupUtils","MAWJobDefinitions","MAWMainTraceUtils","QPLUserFlow","WAHashStringToNumber","WALogger","WAResultOrError","WorkerRelay","WorkerRelayNetwork","cr:14165","gkx","handleRestoreMessagesGraphQLResponse","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x=h!==void 0?h:h=b("EBMessagePointQueryWithPersistenceQuery.graphql");async function a(a){var e=a.jid,g=a.messageId,h=a.sortOrderMs,y=a.source,z=a.threadId;a=a.traceId;if(!d("EBAPIWorkerCheck").runningInWorker())return d("WAResultOrError").makeError("unsupported-context");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql");var A=a!=null?a:d("MAWMainTraceUtils").createTraceId(),B=d("WAHashStringToNumber").hashStringToNumber(A),C=c("qpl")._(521474469,"2612");c("QPLUserFlow").start(C,{annotations:{bool:{mainThreadRestore:!1,workerThreadRestore:!0},int:{source:y!=null?y:c("LSMEBTaskCreationSource").UNKNOWN}},instanceKey:B});d("MAWEBRestoreTrackingUtils").markEBRestorePoint(y,A,"GQL_WORKER",!0);try{var D,E,F;if(b("cr:14165")==null){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Calling EBLS without EBLS being available for message point query"])));c("QPLUserFlow").endFailure(C,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.EBLS_NOT_INITIALIZED,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.EBLS_NOT_INITIALIZED}},instanceKey:B});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(A,!0,"ebls_not_initialized");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.error");return d("WAResultOrError").makeError("ebls-not-initialized")}c("QPLUserFlow").addPoint(C,"before_ebls_initialization",{instanceKey:B});await b("cr:14165").genLSClient();c("QPLUserFlow").addPoint(C,"after_ebls_initialization",{instanceKey:B});var G=await b("cr:14165").getLSStorage(),H=await d("EBIsEbEnabled").isEbEnabledLS(G.tables),I=await d("MAWEncryptedBackupUtils").getBackupTenancy(G.tables);H=H!=null?H:I!=null&&(v||(v=d("I64"))).equal(I,(w||(w=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsBackupTenancy").PRODUCTION));if(!H){c("QPLUserFlow").addPoint(C,"eb_not_enabled",{instanceKey:B});c("QPLUserFlow").endSuccess(C,{instanceKey:B});d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"eb_not_enabled",traceId:A});d("MAWEBRestoreTrackingUtils").markEBRestoreSuccess(A,!0);d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.success");return d("WAResultOrError").makeResult()}d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"lsdb_singleton_retrieved",traceId:A});c("QPLUserFlow").addPoint(C,"lsdb_singleton_retrieved",{instanceKey:B});I=await d("handleRestoreMessagesGraphQLResponse").getClientState(G);if(I==null){d("WALogger").ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] No client state found - unable to restore"])));c("QPLUserFlow").endFailure(C,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NO_CLIENT_STATE,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NO_CLIENT_STATE}},instanceKey:B});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(A,!0,"no_client_state");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.error");return d("WAResultOrError").makeError("no-client-state")}H=I.backupId;var J=I.device_id,K=I.locally_available_epochs,L=I.mailboxRootKey,M=I.ocmfClientStateBlob;if(H==null||J==null||L==null||M==null){d("WALogger").ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] mandatory params of client state are null"])));c("QPLUserFlow").endFailure(C,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_CLIENT_STATE,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_CLIENT_STATE}},instanceKey:B});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(A,!0,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_CLIENT_STATE);d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.error");return d("WAResultOrError").makeError("invalid-client-state")}d("MAWEBRestoreTrackingUtils").addQPLRestorePointWithAnnotationsWorker({annotations:{string:{device_id:(v||(v=d("I64"))).to_string((D=I==null?void 0:I.device_id)!=null?D:(v||(v=d("I64"))).zero)}},pointName:"client_state_retrieved",traceId:A});c("QPLUserFlow").addPoint(C,"client_state_retrieved",{data:{string:{device_id:v.to_string((D=I==null?void 0:I.device_id)!=null?D:(v||(v=d("I64"))).zero)}},instanceKey:B});I=d("MAWCurrentUser").getAppID();d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"app_id_retrieved",traceId:A});c("QPLUserFlow").addPoint(C,"app_id_retrieved",{instanceKey:B});D={restore_context:{act_thread_id:d("MAWJobDefinitions").toThreadJidPrimaryId(z),site:"www",tam_thread_subtype:0},success:babelHelpers.extends({device_context:{device_id:v.to_string(J),locally_available_epochs:K,raw_tokens:{mailbox_root_key:d("Base64Utils").fromArrayBuffer(L),ocmf_client_state_blob:d("Base64Utils").fromArrayBuffer(M)}},message_id:g},h!=null?{reference_timestamp:h}:{})};d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"graphql_query_start",traceId:A});c("QPLUserFlow").addPoint(C,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.GRAPHQL_QUERY_START,{instanceKey:B});await d("WorkerRelayNetwork").createWorkerNetworkExecute();K=await d("WorkerRelay").createWorkerQuery(x,{app_id:String(I!=null?I:"0"),restore_payload_string:JSON.stringify(D),restore_type:"POINT_QUERY_RESTORE"});d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"graphql_query_end",traceId:A});c("QPLUserFlow").addPoint(C,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.GRAPHQL_QUERY_END,{instanceKey:B});if(K==null||(K==null||(E=K.viewer)==null||(E=E.encrypted_backup)==null?void 0:E.mailbox)==null){c("QPLUserFlow").endFailure(C,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE}},instanceKey:B});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(A,!0,"gql_point_restore_exception");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.error");return d("WAResultOrError").makeError("invalid-graphql-response")}L=K==null||(F=K.viewer)==null||(F=F.encrypted_backup)==null||(F=F.mailbox)==null?void 0:F.messages_point_restore;if(L==null){d("WALogger").ERROR(l||(l=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] GQL worker point restore query returned null for message response"])));c("QPLUserFlow").endFailure(C,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE}},instanceKey:B});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(A,!0,"gql_point_restore_exception");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.error");return d("WAResultOrError").makeError("invalid-graphql-response")}M=L;if((M==null?void 0:M.encrypted_messages)==null){c("QPLUserFlow").endFailure(C,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NULL_MESSAGES,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NULL_MESSAGES}},instanceKey:B});d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"null_messages",traceId:A});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(A,!0,"null_messages");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.error");return d("WAResultOrError").makeError("invalid-graphql-response")}g=M.backup_id;I=M.encrypted_messages;D=M.epoch_derivation_set;K=M.exception_string;L=M.message_range_info;M=M.should_delete_mailbox;if(K!=null){d("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] server side exception during graphql restore - ",""])),K);M===!0&&(c("QPLUserFlow").addPoint(C,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DELETE_MAILBOX,{instanceKey:B}),d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"delete_mailbox",traceId:A}));c("QPLUserFlow").endFailure(C,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.SERVER_SIDE_EXCEPTION,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.SERVER_SIDE_EXCEPTION,exception:K}},instanceKey:B});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(A,!0,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.SERVER_SIDE_EXCEPTION,{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.SERVER_SIDE_EXCEPTION,exception:K}});d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.error");return d("WAResultOrError").makeError("server-side-exception")}d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"derive_and_store_epochs_start",traceId:A});c("QPLUserFlow").addPoint(C,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DERIVE_AND_STORE_EPOCHS_START,{instanceKey:B});c("QPLUserFlow").addAnnotations(C,{bool:{hasEpochs:D!=null&&D.epoch_edges.length>0,nonLS:c("gkx")("7473")}},{instanceKey:B});c("gkx")("7473")?await d("EBDeriveAndStoreEpochs").deriveAndStoreEpochsNonLS(G,D):await d("handleRestoreMessagesGraphQLResponse").deriveAndStoreEpochs(D,G,J,A,!0);d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"derive_and_store_epochs_end",traceId:A});c("QPLUserFlow").addPoint(C,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DERIVE_AND_STORE_EPOCHS_END,{instanceKey:B});I.length===0&&(c("QPLUserFlow").addPoint(C,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NO_MESSAGES_TO_RESTORE,{instanceKey:B}),d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"no_messages",traceId:A}));if(L==null){d("WALogger").ERROR(n||(n=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] message range info is null - cannot proceed with graphQL restore"])));c("QPLUserFlow").endFailure(C,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.MISSING_RANGE_INFO,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.MISSING_RANGE_INFO}},instanceKey:B});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(A,!0,"missing_message_range_info");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.error");return d("WAResultOrError").makeError("missing-message-range-info")}g==null&&(d("WALogger").WARN(o||(o=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] backup_id is null during graphQL restore"]))),c("QPLUserFlow").addPoint(C,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.BACKUP_ID_NULL,{instanceKey:B}),d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"backup_id_null",traceId:A}));M=L.has_more_after;K=L.has_more_before;D=L.next_message_timestamp_ms_after;J=L.next_message_timestamp_ms_before;if(K==null||M==null||D==null||J==null){d("WALogger").ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] message range info is not complete - cannot proceed with graphQL restore"])));c("QPLUserFlow").endFailure(C,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.MISSING_RANGE_INFO,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.MISSING_RANGE_INFO}},instanceKey:B});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(A,!0,"message_range_info_null");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.error");return d("WAResultOrError").makeError("missing-message-range-info")}L=d("handleRestoreMessagesGraphQLResponse").processMessageArray(I,g!=null?g:(v||(v=d("I64"))).to_string(H),C,B);var N=L.encryptedLSEchoMessages,O=L.encryptedMessagesWithProtobufs;I=L.encryptedNonLSEchoMessages;g=L.encryptedNonLSProtobufs;if(c("gkx")("7473")){c("QPLUserFlow").addPoint(C,"native_decryption_start",{instanceKey:B});d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"native_decryption_start",traceId:A});H=await d("EBAPIDecryptionModule").decryptUsingNativeJS(G,z,g,I);if(!H.success){c("QPLUserFlow").endFailure(C,"native_decryption_error",{instanceKey:B});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(A,!0,"native_decryption_error");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.error");return d("WAResultOrError").makeError("native-decryption-error")}c("QPLUserFlow").addPoint(C,"native_decryption_success",{instanceKey:B});d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"native_decryption_success",traceId:A});L=H.value.decryptedEchoMessages;g=H.value.decryptedProtobufs;I=d("EBAPIDecryptionModule").convertNativeDecryptionResponseToDecryptedMessageType(L,g);H=[];if(g.length>0)H=d("MAWEncryptedBackupUtils").convertLSTypesToJSTypesForRestoreJob(I.protobuf);else{I=c("LSVec").toArray(I.echo).map(function(a){return d("MAWJobDefinitions").toEncodedEchoMessage(a)});H=d("MAWConvertEchoMessagesToEBProtobufs").convertEchoMessagesToEBProtobufs(I,e)}c("promiseDone")(d("MAWBridge").getBridge().sendAndReceive("event","uiUpdate",{events:[{tag:"RestoreNativeOp",value:{chatJid:e,decryptedMessagesProtobufs:H,hasMoreAfter:M,hasMoreBefore:K,isPointQuery:!0,nextMessageTimestampMsAfter:(v||(v=d("I64"))).of_string(D),nextMessageTimestampMsBefore:v.of_string(J),referenceTimestamp:h!=null?(v||(v=d("I64"))).to_string(h):void 0,requestId:A,taskSource:(w||(w=d("LSIntEnum"))).ofNumber(y!=null?y:c("LSMEBTaskCreationSource").UNKNOWN),threadId:z}}]}));c("QPLUserFlow").endSuccess(C,{annotations:{bool:{isEcho:L.length>0,isProtobuf:g.length>0}},instanceKey:B});d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.success");return d("WAResultOrError").makeResult()}if(O.length===0){d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"decrypt_messages_echo_start",traceId:A});c("QPLUserFlow").addPoint(C,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_ECHO_START,{instanceKey:B});I=await G.runInTransaction(function(a){return c("LSDecryptMessagesStoredProcedure")(c("LSFactory")(a),{actThreadId:z,encryptedMessages:c("LSVec").ofArray(N)})},"readwrite",void 0,void 0,f.id+":805");H=I[0];L=I[1];if(L!=null){g=d("LSShape").toRecord(L);d("WALogger").ERROR(q||(q=babelHelpers.taggedTemplateLiteralLoose(["[echo-only][echo] decryptMessageEcho failed with an error."])));d("WALogger").WARN(r||(r=babelHelpers.taggedTemplateLiteralLoose(["[echo-only][echo] decryptMessageEcho failed with error: ",""])),g.error_message);c("QPLUserFlow").endFailure(C,"ECHO_DECRYPTION_FAILURE",{annotations:{string:{error_description:g.error_message}},instanceKey:B});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(a,!1,"ECHO_DECRYPTION_FAILURE",{string:{error_description:g.error_message}});d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.error");return d("WAResultOrError").makeError("echo-decryption-failure")}d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"decrypt_messages_echo_end",traceId:A});c("QPLUserFlow").addPoint(C,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_ECHO_END,{instanceKey:B});I=H;if(I!=null){L=c("LSVec").toArray(I).map(function(a){return d("LSShape").toRecord(a).value});c("promiseDone")(d("MAWBridge").getBridge().sendAndReceive("event","uiUpdate",{events:[{tag:"RestoreNativeOp",value:{chatJid:e,echoMessages:c("LSVec").ofArray(L),hasMoreAfter:M,hasMoreBefore:K,isPointQuery:!0,nextMessageTimestampMsAfter:(v||(v=d("I64"))).of_string(D),nextMessageTimestampMsBefore:v.of_string(J),referenceTimestamp:h!=null?(v||(v=d("I64"))).to_string(h):void 0,requestId:A,taskSource:(w||(w=d("LSIntEnum"))).ofNumber(y!=null?y:c("LSMEBTaskCreationSource").UNKNOWN),threadId:z}}]}))}}else{d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"decrypt_messages_protobuf_start",traceId:A});c("QPLUserFlow").addPoint(C,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_PROTOBUF_START,{instanceKey:B});g=await G.runInTransaction(function(a){return c("LSDecryptMessageProtobufsStoredProcedure")(c("LSFactory")(a),{actThreadId:z,encryptedMessagesWithProtobufs:c("LSVec").ofArray(O)})},"readwrite",void 0,void 0,f.id+":909");H=g[0];I=g[1];if(I!=null){L=d("LSShape").toRecord(I);d("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[protobuf-only] decryptMessageProtobufs failed with an error"])));d("WALogger").WARN(t||(t=babelHelpers.taggedTemplateLiteralLoose(["[protobuf-only] decryptMessageProtobufs failed with error: ",""])),L.error_message);c("QPLUserFlow").endFailure(C,"PROTOBUF_DECRYPTION_FAILURE",{annotations:{string:{error_description:L.error_message}},instanceKey:B});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(a,!1,"PROTOBUF_DECRYPTION_FAILURE",{string:{error_description:L.error_message}});d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.error");return d("WAResultOrError").makeError("protobuf-decryption-failure")}d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"decrypt_messages_protobuf_end",traceId:A});c("QPLUserFlow").addPoint(C,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_PROTOBUF_END,{instanceKey:B});if(H!=null){G=d("MAWEncryptedBackupUtils").convertLSTypesToJSTypesForRestoreJob(H);c("promiseDone")(d("MAWBridge").getBridge().sendAndReceive("event","uiUpdate",{events:[{tag:"RestoreNativeOp",value:{chatJid:e,decryptedMessagesProtobufs:G,hasMoreAfter:M,hasMoreBefore:K,isPointQuery:!0,nextMessageTimestampMsAfter:(v||(v=d("I64"))).of_string(D),nextMessageTimestampMsBefore:v.of_string(J),referenceTimestamp:h!=null?(v||(v=d("I64"))).to_string(h):void 0,requestId:A,taskSource:(w||(w=d("LSIntEnum"))).ofNumber(y!=null?y:c("LSMEBTaskCreationSource").UNKNOWN),threadId:z}}]}))}else{c("QPLUserFlow").endFailure(C,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPTED_PROTOBUFS_NULL,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPTED_PROTOBUFS_NULL}},instanceKey:B});d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"decrypted_protobufs_null",traceId:A});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(A,!0,"decrypted_protobufs_null");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.error");return d("WAResultOrError").makeError("invalid-graphql-response")}}c("QPLUserFlow").endSuccess(C,{annotations:{bool:{isEcho:O.length===0,isProtobuf:O.length>0}},instanceKey:B});d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.success");return d("WAResultOrError").makeResult()}catch(a){d("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] graphQL point restore error ",""])),a);c("QPLUserFlow").endFailure(C,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.RUNTIME_ERROR,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.RUNTIME_ERROR,errorStackTrace:(g=a.stack)!=null?g:""}},error:a,instanceKey:B});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(A,!0,"gql_point_restore_exception");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.error");return d("WAResultOrError").DEPRECATED_makeError("runtime-error",a)}}g.pointRestoreQuery=x;g.messagePointQueryWithPersistence=a}),98);
__d("MAWQuotedMsgUtils",["WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return a.content.type==="NoteReply"?a.content.msgContent==null?a:babelHelpers["extends"]({},a,{content:babelHelpers["extends"]({},a.content,{msgContent:void 0})}):a}function a(a){return a.content.expirationTs==null||a.content.expirationTs>d("WATimeUtils").unixTime()?a:h(a)}g.dbQuotedMsgWithoutExpirableContent=h;g.dbQuotedMsgWithoutExpiredContent=a}),98);
__d("MAWGetMsgQuoteTxn",["LSMEBTaskCreationSource","MAWBridgeEventTransmitter","MAWDbMsgTxns","MAWDexieTable","MAWIndexedDb","MAWMsgType","MAWQuotedMsgUtils","MAWTransactionMode","WAJids","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h=function(a){return a==null||a===d("WAJids").AUTHOR_SYSTEM?null:d("WAJids").authorAsUserJid(a)};function i(a,b,e,f){var g=b.quote;b=(g==null?void 0:g.content)||{};var i=b.author;b=b.externalId;if(i==null)return d("MAWDexieTable").dexieResolve(null);i=d("WAJids").isAuthorMe(i)?d("WAJids").AUTHOR_ME:h(i);if(g==null||i==null||b==null)return d("MAWDexieTable").dexieResolve(null);var j={author:i,chat:e,externalId:b};if(g.content.type==="NoteReply")return d("MAWDexieTable").dexieResolve({quote:d("MAWQuotedMsgUtils").dbQuotedMsgWithoutExpiredContent(g),quoteExternalId:g.content.externalId});var k=f!=null&&f==="ebrestore"?c("LSMEBTaskCreationSource").EB_POINT_QUERY_RESTORE_PROTOBUF:c("LSMEBTaskCreationSource").EB_POINT_QUERY_IN_ACT;return d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,j).then(function(b){d("MAWBridgeEventTransmitter").issuePointQueryOutsideTxn(j.externalId,d("WAJids").threadIdForChatJid(j.chat),void 0,k,j.chat);if(b==null||!d("MAWMsgType").isQuotedMsgType(b.type))return{quote:g,quoteExternalId:g.content.externalId};var a=b.author,c=b.externalId,e=b.mediaId,f=b.msgContent,h=b.msgId,i=b.plaintextHash,l=b.specialTextSize,m=b.ts,n=b.type,o=b.xmaMessageType;a={author:a,externalId:c,mediaId:e,msgContent:f,msgId:h,plaintextHash:i,specialTextSize:l,ts:m,type:n,xmaMessageType:o};b.messageExpirationTs!=null&&b.messageExpirationTs<d("WATimeUtils").unixTime()&&(a=babelHelpers["extends"]({},a,{mediaId:void 0,msgContent:void 0,type:d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL}));return{quote:babelHelpers["extends"]({},g,{content:a}),quoteExternalId:b.externalId}})}function a(a,b,c){return i(a,b,c).then(function(a){return babelHelpers["extends"]({},b,{quote:a==null?void 0:a.quote,quoteExpirationTs:a==null?void 0:a.quote.content.expirationTs,quoteExternalId:a==null?void 0:a.quoteExternalId})})}function j(a,b){return a.messages.where("quoteExternalId").anyOf(b).toArray()}b=d("MAWIndexedDb").makeMsgrTransactor({messages:d("MAWTransactionMode").READONLY},"maybeBatchGetMsgsByQuoteExternalId",function(a){return function(){for(var b=arguments.length,c=new Array(b),d=0;d<b;d++)c[d]=arguments[d];return j.apply(void 0,[a].concat(c))}});g.getMsgQuoteInfo=i;g.enhanceMsgWithQuoteInfo=a;g.maybeBatchGetMsgsByQuoteExternalId=j;g.maybeBatchGetMsgsByQuoteExternalIdWithTransaction=b}),98);
__d("MAWBulkPutReactionsWithThreadUpdateTxn",["FBLogger","MAWDbReaction","MAWDbReactionsTxns","MAWDexieTable","MAWJidUtils","MAWThreadSnippetBuildTxns","WAArrayGroupBy","WAJids","WAMsgMap","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return a.reduce(function(a,b){var c=d("MAWJidUtils").maybeToProtocolMsgId(b.author,b.threadJid,b.reactToExternalId);if(c==null)return a;a.set(c,d("MAWDbReactionsTxns").coerceToReaction(b));return a},new(d("WAMsgMap").MsgMap)()).values()}function a(a,b,e){if(b.length===0)return d("MAWDexieTable").dexieResolve();b=h(b);var f=b.map(function(a){var b=e.get(a.threadJid);if(b==null)throw c("FBLogger")("messenger_web").mustfixThrow("Should not have got here - expect thread to exist for flow");return a});b=d("WAArrayGroupBy").groupBy(f,function(a){a=a.threadJid;return a});b=b.map(function(b){var c=b[0];b=b[1];c=e.get(c);if(c==null||b.length===0)return null;var f=null;for(var g=b.length-1;g>=0;g--){f=d("MAWDbReaction").maybeCastToIncomingDbReaction(b[g]);if(f!=null)break}g=b.filter(function(a){return a.reaction==null});b=d("WAJids").interpretAsGroupJid(c.jid)!=null;return d("MAWThreadSnippetBuildTxns").getThreadChangesetForReactionChanges(a,c,{newestReaction:f,reactionsToClear:g},b)}).filter(Boolean);return d("MAWDexieTable").dexieAll(b).then(function(b){return d("MAWDexieTable").dexieAll([a.threads.bulkPut(b.map(function(a){a=a.thread;return a})),a.reactions.bulkPut(f)]).then(c("emptyFunction"))})}g.bulkPutReactionsWithThreadUpdates=a}),98);
__d("MAWDeletedReactionsCache",["WAMsgMap"],(function(a,b,c,d,e,f,g){"use strict";a=new(d("WAMsgMap").MsgMap)();g.DeletedReactionsCache=a}),98);
__d("MAWUseProtocolMsgIdForMsgId",[],(function(a,b,c,d,e,f){"use strict";function a(){return!0}f.shouldUseProtocolMsgIdForMsgId=a}),66);
__d("MAWBulkWriteReactionsTxns",["FBLogger","LSMEBTaskCreationSource","MAWAuthor","MAWBridgeEventTransmitter","MAWBulkPutReactionsWithThreadUpdateTxn","MAWDbMsg","MAWDbReaction","MAWDbReactionsTxns","MAWDeletedReactionsCache","MAWDexieTable","MAWJidUtils","MAWODSProxy","MAWUseProtocolMsgIdForMsgId","WAArrayGroupBy","WAJids","WAOdsEnums","gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var e=[],f=[];b.forEach(function(a){var b=a.chatJid;a=a.unstoredReaction;a=a.reactToExternalId;e.push(b);f.push(a)});return d("MAWDexieTable").dexieAll([a.threads.where("jid").anyOf(e).toArray(),a.messages.where("externalId").anyOf(f).toArray(),a.reactions.where("reactToExternalId").anyOf(f).toArray()]).then(function(e){var f=e[0],g=e[1];e=e[2];var i=new Map(f.map(function(a){return[a.jid,a]})),j=new Map(d("WAArrayGroupBy").groupBy(g,function(a){return a.externalId})),k=new Map(d("WAArrayGroupBy").groupBy(e,function(a){return a.reactToExternalId})),l=[],m=d("MAWUseProtocolMsgIdForMsgId").shouldUseProtocolMsgIdForMsgId();g=function(a){b.forEach(function(b){var e=b.chatJid;b=b.unstoredReaction;var f=b.author,g=b.externalId,n=b.groupingKey,o=b.reaction,p=b.reactToAuthor,q=b.reactToExternalId,r=b.senderTimestampMs,s=b.ts;e=i.get(e);if(e==null)return"missing_thread";var t=null;if(!m&&a!=null){var u=new Map(a),v=u.get(e.jid);if(v==null)throw c("FBLogger")("messenger_web").mustfixThrow("nextInChatReactionId should not be null");u.set(e.jid,v+1);t=d("MAWDbMsg").craftReactionId(e.chatId,v)}else t=d("MAWJidUtils").formatProtocolMsgIdFromExternalId(e.jid,g);u=k.get(b.reactToExternalId)||[];v=d("MAWDbReaction").findMatchingReaction(u,e.jid,f);if(v!=null&&d("MAWDbReaction").getReactionTimeMs(v)>d("MAWDbReaction").getReactionTimeMs(b))return"newer_reaction_exists";if(v!=null&&b.reaction==null){u={author:b.author,chat:b.threadJid,externalId:b.externalId};d("MAWDeletedReactionsCache").DeletedReactionsCache.set(u,v)}u=d("MAWAuthor").getAuthorUserJid(p);var w=j.get(b.reactToExternalId);if(w==null){var x=d("WAJids").threadIdForChatJid(e.jid);b.reactToExternalId===b.externalId?c("FBLogger")("messenger_web").warn("reactToExternalId is same as externalId"):c("gkx")("16596")||d("MAWBridgeEventTransmitter").issuePointQueryOutsideTxn(b.reactToExternalId,x,void 0,c("LSMEBTaskCreationSource").EB_POINT_QUERY_IN_ACT_REACTIONS,e.jid)}b=h(e,u,w);x=d("MAWDbReaction").formatReactionForDb(e.jid,g,t,q,o,n,p,b==null&&m?d("MAWJidUtils").formatProtocolMsgIdFromExternalId(e.jid,q):b==null?void 0:b.msgId,s,f!=null?f:d("WAJids").AUTHOR_ME,v==null?void 0:v.rowId,void 0,r);l.push(x)});return{chatJidToDbThread:i,unstoredDbReactionsForInsertion:l}};if(!m){e=f.map(function(b){return d("MAWDbReactionsTxns").getNextReactionIdNumberForThread(a,b).then(function(a){return[b.jid,a]})});return d("MAWDexieTable").dexieAll(e).then(g)}return g(null)})}function h(a,b,e){e=(e=e==null?void 0:e.filter(function(c){return c.threadJid===a.jid&&b===d("MAWAuthor").getAuthorUserJid(c.author)}))!=null?e:[];e.length>1&&(c("FBLogger")("maw_mutation_validator").warn("%s matching duplicate messages found for a reaction",e.length),d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_MUTATION_VALIDATOR,key:"match_reaction_to_message.invalid"}));return e[0]}function b(a,b){var c=b.chatJidToDbThread;b=b.unstoredDbReactionsForInsertion;return d("MAWBulkPutReactionsWithThreadUpdateTxn").bulkPutReactionsWithThreadUpdates(a,b,c)}g.prepareReactionsData=a;g.bulkWriteReactions=b}),98);
__d("MAWBridgeThread",["FBLogger","MAWTimeUtils","WAJids","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e,f,g,i){var j=d("WAJids").switchOnMsgrChatJidType(a.jid,{group:function(a){return!0},user:function(a){return!1}}),k=h(a.snippetMsgTs,g);k===d("WATimeUtils").castToMillisTime(0)&&c("FBLogger")("messenger_web").info("[VerifyThreadExists] Passing zero lastActivityTs. clientThreadkey: %s, authoritativeThreadKey: %s, snippetMsgTs: %s, newestMsgTs: %s",b,e,a.snippetMsgTs==null?"null":d("WATimeUtils").fromMillisTime(a.snippetMsgTs),g);return{authoritativeThreadKey:e,cannotReplyReason:a.cannotReplyReason,clientThreadKey:b,description:f,folder:a.folder,instanceKey:i,isGroup:j,jid:a.jid,lastActivityTs:k,lastReadTs:d("MAWTimeUtils").ensureValidMillisTime(a.lastReadMsgTs)||d("WATimeUtils").castToMillisTime(0)}}function h(a,b){return d("MAWTimeUtils").ensureValidMillisTime(a!=null&&d("WATimeUtils").fromMillisTime(a)!==0?a:b)||d("WATimeUtils").castToMillisTime(0)}g.createBridgeThread=a;g.getLastActivityTs=h}),98);
__d("MAWGetOrCreateThreadTxns",["MAWAdminMsgTxns","MAWBridgeThread","MAWBridgeTypesCreators","MAWDbMsgTxns","MAWDbThread","MAWDexieTable","MAWFolderTypes","MAWIndexedDb","MAWQplProxy","MAWThreadMappingQPL","MAWWriteBulkWriteIncomingAdminMsgTxns","WATimeUtils","getErrorSafe","gkx","qpl"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){if(a!=null&&b!=null){var c=d("WATimeUtils").fromMillisTime(a),e=d("WATimeUtils").fromMillisTime(b);return d("WATimeUtils").castToMillisTime(Math.max(c,e))}return a!=null?a:b}function i(a,b){return a.threads.get({jid:b})}function j(a,b){return(c("gkx")("10029")?d("MAWDexieTable").dexieAll(b.map(function(b){return a.threads.get({jid:b})})).then(function(a){return a.filter(Boolean)}):a.threads.where("jid").anyOf(b).toArray()).then(function(a){var c=new Map();for(a of a)c.set(a.jid,a);return b.map(function(a){return c.get(a)})})}function a(a,b,e){var f=b.instanceKey,g=b.jid;d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(1056836502,"2778"),"get_or_create_thread_start",{instanceKey:f});e!=null&&d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25313175,"1551"),"thread_mapping_get_or_create_thread_start",{instanceKey:e});return i(a,g).then(function(f){if(f==null){e!=null&&d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25313175,"1551"),"create-1-1-thread-start",{instanceKey:e});return l(a,b,e).then(function(a){return{created:!0,thread:a}})}else return o(a,b,f).then(function(a){return{created:!1,thread:a}})}).then(function(a){d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(1056836502,"2778"),"get_or_create_thread_end",{instanceKey:f});e!=null&&d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25313175,"1551"),"thread_mapping_get_or_create_thread_end",{instanceKey:e});return a})}function b(a,b,c){c=c===void 0?{}:c;var e=c.logState;return j(a,b.map(function(a){a=a.jid;return a})).then(function(c){e==null||e("threadMapping2FetchedThreads");var f={},g=[],h=[];for(c of c.entries()){var i=c[0],j=c[1];j==null?g.push(b[i]):h.push({params:b[i],thread:j})}return d("MAWDexieTable").dexieAll([g.length?m(a,g):d("MAWDexieTable").dexieResolve([]),h.length?p(a,h):d("MAWDexieTable").dexieResolve([])]).then(function(a){var c=a[0];a=a[1];e==null||e("threadMapping3ThreadsUpdated");for(c of c){var d=c.adminMsgParams,g=c.thread;f[g.jid]={adminMsgParams:d,created:!0,thread:g}}for(d of a)f[d.jid]={adminMsgParams:null,created:!1,thread:d};return b.map(function(a){a=a.jid;return f[a]})})})}function k(a){var b=a.authoritativeThreadKey,c=a.clientThreadKey,e=a.createTs,f=a.deduplicationKey,g=a.folder,h=a.jid;a=a.lastActivityTimestamp;var i=d("WATimeUtils").millisTime();e=(a=a!=null?a:e)!=null?a:i;a={authoritativeThreadKey:b!=null?b:void 0,deduplicationKey:f,folder:g!=null?g:d("MAWFolderTypes").FOLDER_ID.INBOX,jid:h,lastReadMsg:null,lastReadMsgReceiptSent:null,newestMsgTs:e,oldestMsg:null,optimisticThreadKey:c!=null?c:void 0,threadOrder:d("MAWDbThread").craftThreadOrder(e,h)};return a}function l(a,b,e){var f=b.authoritativeThreadKey,g=b.description,h=b.instanceKey,i=b.skipVerifyThread,j=k(b);return a.threads.add(j).then(function(b){b=babelHelpers["extends"]({},j,{chatId:b});i!==!0&&d("MAWIndexedDb").afterTransaction({tag:"VerifyThreadExists",value:d("MAWBridgeThread").createBridgeThread(b,b.optimisticThreadKey,f,g,j.newestMsgTs,h)});e!=null&&d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25313175,"1551"),"write-e2ee-admin-msg-in-new-thread",{instanceKey:e});return d("MAWAdminMsgTxns").writeE2EEThreadDescriptionMsg(a,b,e)})["catch"](function(a){a=c("getErrorSafe")(a);h!=null&&d("MAWThreadMappingQPL").endFailureInWorker("create_thread_failed",h,{string:{createThreadFailureReason:a.message}});a.message="Error creating thread: "+a.message;throw a})}function m(a,b){var e=b.map(k);return a.threads.bulkAdd(e,{allKeys:!0}).then(function(c){c=c.map(function(a,c){return{data:babelHelpers["extends"]({},e[c],{chatId:a}),params:b[c]}});for(var f of c)f.params.skipVerifyThread!==!0&&d("MAWIndexedDb").afterTransaction({tag:"VerifyThreadExists",value:d("MAWBridgeThread").createBridgeThread(f.data,f.data.optimisticThreadKey,f.params.authoritativeThreadKey,f.params.description,null,f.params.instanceKey)});return d("MAWWriteBulkWriteIncomingAdminMsgTxns").writeE2EEAdminMsgsForIncomingCreatedThreadsWithoutAfterTxns(a,c.map(function(a){return a.data}))})["catch"](function(a){a=c("getErrorSafe")(a);a.message="Error bulk creating threads: "+a.message;throw a})}function n(a,b,c){var d=b.authoritativeThreadKey,e=b.clientThreadKey,f=b.deduplicationKey,g=b.folder;b=b.lastActivityTimestamp;d={authoritativeThreadKey:d!=null?d:a.authoritativeThreadKey,cannotReplyReason:g!=null||e!=null?null:a.cannotReplyReason,deduplicationKey:g!=null||e!=null?f:a.deduplicationKey,folder:g!=null?g:a.folder,newestMsgTs:h(c,b),optimisticThreadKey:e!=null?e:a.optimisticThreadKey};return babelHelpers["extends"]({},a,d)}function o(a,b,e){var f=b.authoritativeThreadKey,g=b.description,h=b.instanceKey,i=b.skipVerifyThread;return d("MAWDbMsgTxns").getThreadNewestMessageMs(a,e.jid).then(function(j){var k=n(e,b,j);return a.threads.update(e.chatId,k).then(function(){var a;i!==!0&&d("MAWIndexedDb").afterTransaction({tag:"VerifyThreadExists",value:d("MAWBridgeThread").createBridgeThread(k,k.optimisticThreadKey,f,g,j,h)});d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({folder:(a=k==null?void 0:k.folder)!=null?a:d("MAWFolderTypes").FOLDER_ID.INBOX,threadJid:k.jid})});return k})["catch"](function(a){a=c("getErrorSafe")(a);a.message="Error updating thread: "+a.message;throw a})})}function p(a,b){return d("MAWDexieTable").dexieAll(b.map(function(b){var c=b.params,e=b.thread;return d("MAWDbMsgTxns").getThreadNewestMessageMs(a,e.jid).then(function(a){a=n(e,c,a);return{params:c,thread:a}})})).then(function(b){return a.threads.bulkUpdate(b.map(function(a){a=a.thread;return{changes:a,key:a.chatId}})).then(function(){for(var a of b){var c=a.params,e=c.authoritativeThreadKey,f=c.description,g=c.instanceKey;c=c.skipVerifyThread;var h=a.thread;c!==!0&&d("MAWIndexedDb").afterTransaction({tag:"VerifyThreadExists",value:d("MAWBridgeThread").createBridgeThread(h,h.optimisticThreadKey,e,f,null,g)})}return b.map(function(a){a=a.thread;return a})})})["catch"](function(a){a=c("getErrorSafe")(a);a.message="Error bulk updating threads: "+a.message;throw a})}g.getExistingThread=i;g.bulkGetExistingThread=j;g.getOrCreateThread=a;g.bulkGetOrCreateThread=b;g.createThread=l;g.prepareUpdatedThreadData=n}),98);
__d("MAWAdminMsgTxns",["MAWDbMsg","MAWDbThread","MAWDbThreadTxns","MAWExternalId","MAWLocalizationType","MAWLocalizationUtils","MAWTimeUtils","MAWWriteBulkWriteIncomingAdminMsgTxns","MAWWriteMsgTxns","WALogger","WATimeUtils","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c){var e=a.ts;e=d("WATimeUtils").castUnixTimeToMillisTime(e);c=d("MAWTimeUtils").ensureValidMillisTime(c)||d("WATimeUtils").castToMillisTime(0);e=e>c?e:c;return babelHelpers["extends"]({},b,{newestMsgTs:e,oldestMsg:a.msgId,snippetMsg:a.msgId,snippetMsgTs:d("WATimeUtils").castUnixTimeToMillisTime(d("MAWDbMsg").getCanonicalTsFromMsg(a)),threadOrder:d("MAWDbThread").craftThreadOrder(e,b.jid)})}function b(a,b){return d("MAWDbThreadTxns").getThread(a,b).then(function(b){if(!b.success){d("WALogger").WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["writeReachabilityErrorAdminMsg failed to create or get 1:1 thread"])));return}b=b.value;var e=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg({adminMsgContent:[],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.REACHABILITY_ERROR,version:0},b.jid,d("MAWExternalId").generateExternalId(),d("WATimeUtils").castMillisTimeToUnixTime(d("WATimeUtils").millisTime()));return d("MAWWriteMsgTxns").writeMsg(a,e,b).then(c("emptyFunction"))})}function e(a,b,c){return d("MAWWriteBulkWriteIncomingAdminMsgTxns").writeE2EEAdminMsgsForIncomingCreatedThreadsWithAfterTxns(a,[b],c).then(function(a){a=a[0];return a})}function f(a){var b=d("MAWDbMsg").craftE2eeAdminMsgAltIndex(a.chatId);b=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg({adminMsgContent:[],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_DESCRIPTION,version:0},a.jid,d("MAWExternalId").generateExternalId(),d("WATimeUtils").castToUnixTime(0),b);return babelHelpers["extends"]({},b,{msgId:d("MAWDbMsg").craftMsgIdV2(a.chatId,1,b),sortOrderMs:0})}g.getUpdatedThreadForAdminMsg=a;g.writeReachabilityErrorAdminMsg=b;g.writeE2EEThreadDescriptionMsg=e;g.buildE2EEThreadDescriptionMsg=f}),98);
__d("MAWDexieCastToPromise",["Promise"],(function(a,b,c,d,e,f){"use strict";var g;function a(a){return(g||(g=b("Promise"))).resolve(a)}function c(a){return a}f.dexieCastToPromise_I_KNOW_WHAT_I_AM_DOING=a;f.promiseCastToDexiePromise_I_KNOW_WHAT_I_AM_DOING=c}),66);
__d("EphemeralMediaViewMode",[],(function(a,b,c,d,e,f){a=Object.freeze({READ_ONCE:0,REPLAYABLE:1,PERMANENT:2});f["default"]=a}),66);
__d("MAWRavenUtils",["EphemeralMediaViewMode","MAWMsg","RavenMessagingState"],(function(a,b,c,d,e,f,g){"use strict";var h=function(a){switch(a){case d("MAWMsg").MAWRavenMsgEphemeralMediaState.PERMANENT:return c("RavenMessagingState").PERMANENT;case d("MAWMsg").MAWRavenMsgEphemeralMediaState.UNSEEN:return c("RavenMessagingState").UNSEEN;case d("MAWMsg").MAWRavenMsgEphemeralMediaState.SEEN:return c("RavenMessagingState").SEEN;case d("MAWMsg").MAWRavenMsgEphemeralMediaState.REPLAYED:return c("RavenMessagingState").REPLAYED;case d("MAWMsg").MAWRavenMsgEphemeralMediaState.EXPIRED:return c("RavenMessagingState").EXPIRED}},i=function(a){switch(a){case d("MAWMsg").MAWRavenMsgEphemeralType.KEEP_IN_CHAT:return c("EphemeralMediaViewMode").PERMANENT;case d("MAWMsg").MAWRavenMsgEphemeralType.ALLOW_REPLAY:return c("EphemeralMediaViewMode").REPLAYABLE;case d("MAWMsg").MAWRavenMsgEphemeralType.VIEW_ONCE:return c("EphemeralMediaViewMode").READ_ONCE}};b=function(a,b){return{ephemeralMediaState:b,ephemeralMediaViewMode:i(a)}};function a(a,b){switch(b){case d("MAWMsg").MAWRavenMsgEphemeralType.VIEW_ONCE:return a===d("MAWMsg").MAWRavenMsgEphemeralMediaState.UNSEEN?c("RavenMessagingState").SEEN:h(a);case d("MAWMsg").MAWRavenMsgEphemeralType.ALLOW_REPLAY:if(a===d("MAWMsg").MAWRavenMsgEphemeralMediaState.UNSEEN)return c("RavenMessagingState").SEEN;else if(a===d("MAWMsg").MAWRavenMsgEphemeralMediaState.SEEN)return c("RavenMessagingState").REPLAYED;return h(a);case d("MAWMsg").MAWRavenMsgEphemeralType.KEEP_IN_CHAT:return h(a)}}g.getEphemeralMediaState=h;g.getEphemeralMediaViewMode=i;g.deriveRavenSettings=b;g.getNextRavenMessageEphemeralState=a}),98);
__d("MAWMediaAfterTxns",["MAWBridgeTypesCreators","MAWDbMedia","MAWDexieCastToPromise","MAWDexieTable","MAWIndexedDb","MAWMediaUtils","MAWRavenUtils","gkx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e,f,g,j){if(c("gkx")("9695"))return h(a,b,e,f,g,j);i(a,b,e,f,g,j);return d("MAWDexieTable").dexieResolve()}function h(a,b,c,e,f,g){return e.messages.where("msgId").anyOf(b.msgIds).toArray().then(function(h){var i=a.threadJid,k=d("MAWBridgeTypesCreators").getMsgIdsFilteredByJid(h,i);h=d("MAWMediaUtils").createHdTypesForBridgeMedia(h);i=a.ravenEphemeralType!=null&&a.ravenEphemeralMediaState!=null?d("MAWBridgeTypesCreators").createBridgeMedia({chatJid:i,filteredMsgIds:k,hasMediaForUI:c,hdTypes:h,media:b,ravenSettings:d("MAWRavenUtils").deriveRavenSettings(a.ravenEphemeralType,a.ravenEphemeralMediaState),sortOrderMs:a.sortOrderMs,transportKey:g}):d("MAWBridgeTypesCreators").createBridgeMedia({chatJid:i,filteredMsgIds:k,hasMediaForUI:c,hdTypes:h,media:b,sortOrderMs:a.sortOrderMs,transportKey:g});return j(e,babelHelpers["extends"]({},i,{skipShouldUpdateHasMore:f}))})}function i(a,b,e,f,g,h){c("promiseDone")(d("MAWDexieCastToPromise").dexieCastToPromise_I_KNOW_WHAT_I_AM_DOING(f.messages.where("msgId").anyOf(b.msgIds).toArray().then(function(c){var i=a.threadJid,j=d("MAWBridgeTypesCreators").getMsgIdsFilteredByJid(c,i);c=d("MAWMediaUtils").createHdTypesForBridgeMedia(c);i=a.ravenEphemeralType!=null&&a.ravenEphemeralMediaState!=null?d("MAWBridgeTypesCreators").createBridgeMedia({chatJid:i,filteredMsgIds:j,hasMediaForUI:e,hdTypes:c,media:b,ravenSettings:d("MAWRavenUtils").deriveRavenSettings(a.ravenEphemeralType,a.ravenEphemeralMediaState),sortOrderMs:a.sortOrderMs,transportKey:h}):d("MAWBridgeTypesCreators").createBridgeMedia({chatJid:i,filteredMsgIds:j,hasMediaForUI:e,hdTypes:c,media:b,sortOrderMs:a.sortOrderMs,transportKey:h});l(f,babelHelpers["extends"]({},i,{skipShouldUpdateHasMore:g}))})))}function j(a,b,e){if(c("gkx")("9695"))return k(a,b,e);l(a,b,e);return d("MAWDexieTable").dexieResolve()}function k(a,b,c){if(!m(b)){d("MAWIndexedDb").afterTransaction({tag:"NewMedia",value:b});return d("MAWDexieTable").dexieResolve()}return d("MAWMediaUtils").getBridgeMediaAnnotatedForDisplay(a,b,c).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"NewMedia",value:a})})}function l(a,b,e){if(!m(b))return d("MAWIndexedDb").afterTransaction({tag:"NewMedia",value:b});c("promiseDone")(d("MAWDexieCastToPromise").dexieCastToPromise_I_KNOW_WHAT_I_AM_DOING(d("MAWMediaUtils").getBridgeMediaAnnotatedForDisplay(a,b,e).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"NewMedia",value:a})})))}function m(a){if(a.ephemeralMediaState!=null||a.ephemeralMediaViewMode!=null)return!1;switch(a.mediaType){case d("MAWDbMedia").MEDIA_TYPE.IMAGE:case d("MAWDbMedia").MEDIA_TYPE.VIDEO:case d("MAWDbMedia").MEDIA_TYPE.GIF:case d("MAWDbMedia").MEDIA_TYPE.DOCUMENT_FILE:return!0;default:return!1}}g.handleNewMediaAfterTxn=a;g.handleNewMediaAfterTxnWithBridgeMedia=j}),98);
__d("MAWMediaBackupTxns",["FBLogger","MAWDbMediaTxns","MAWDexieTable","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=1;function m(a,b,e,f,g,n){n===void 0&&(n=0);return f==null?d("MAWDexieTable").dexieResolve():d("MAWDbMediaTxns").maybeGetMediaBackupRowFromObjectId(a,f).then(function(o){if(o==null){var p={mediaId:b,msgId:e,objectId:f};g!=null&&(p=babelHelpers["extends"]({},p,{fbid:g}));return a.mediaBackup.add(p).then(function(a){return babelHelpers["extends"]({},p,{mediaBackupId:a})})["catch"](function(j){if(j.name==="ConstraintError"){if(n<l){d("WALogger").WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to add mediaBackup entry. Will attempt a retry. Error: ",""])),j);return m(a,b,e,f,g,n+1)}throw c("FBLogger")("messenger_web").mustfixThrow("Failed to add mediaBackup entry. Original error: %s, %s",j.name,j.message)}d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to add mediaBackup entry: ",""])),j);throw j})}else if(o.mediaId!==b||o.msgId!==e){d("WALogger").ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] mediaId or msgId cannot differ for an objectId in mediaBackup"])));return o}else{if(o.fbid==null&&g!=null){var q=babelHelpers["extends"]({},o,{fbid:g});return a.mediaBackup.put(q).then(function(a){return q})}else d("WALogger").WARN(k||(k=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] fbid already exists for objectId"])));return o}})}g.linkMediaBackup=m}),98);
__d("WASortedLists",[],(function(a,b,c,d,e,f){"use strict";function a(){return[]}function b(){return[]}function c(a,b){return a.filter(b)}function d(a,b){return l(a.map(b))}function e(a,b){var c=a.length===b.length;for(var d=0;c&&d<a.length;d++)a[d]!==b[d]&&(c=!1);return c}function g(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return a;return a.concat([b]).sort()}function h(a,b){if(a.length<b.length)return!1;var c=!0;for(var d=0,e=0;c&&e<b.length;e++)do c=a[d]===b[e];while(!c&&++d<a.length);return c}function i(a,b){var c=[];for(var d=0,e=0;d<a.length;d++){var f=a[d];while(e<b.length&&f>b[e])e++;(e===b.length||f<b[e])&&c.push(f)}return c}function j(a,b){var c=[],d=0,e=0;while(d<a.length&&e<b.length){var f=a[d],g=b[e];f<g?d++:f===g?(c.push(f),d++,e++):e++}return c}function k(a,b){var c=[],d=0,e=0;while(d<a.length&&e<b.length)a[d]<b[e]?c.push(a[d++]):a[d]===b[e]?(c.push(a[d++]),e++):c.push(b[e++]);while(d<a.length)c.push(a[d++]);while(e<b.length)c.push(b[e++]);return c}function l(a){return m(a.slice().sort())}function m(a){var b=!1;for(var c=0;c<a.length-1;c++)a[c]===a[c+1]&&(b=!0);if(!b)return a;c=[];for(b=0;b<a.length-1;b++)a[b]!==a[b+1]&&c.push(a[b]);c.push(a[a.length-1]);return c}function n(a){return Array.from(a).sort()}function o(a){return a.slice().sort()}function p(a,b,c){var d=null;for(var e=0;!d&&e<a.length;e++)a[e]===b&&(d=a.slice(),d[e]=c,d=m(d.sort()));return d||a}function q(a){return[a]}function r(a){return a.length<1}function s(a,b,c){return a.slice(b,c)}f.emptySet=a;f.emptyList=b;f.filter=c;f.map=d;f.areEqual=e;f.addToSet=g;f.contains=h;f.subtract=i;f.intersect=j;f.joinUniq=k;f.sortAndDedupe=l;f.asSortedSet=n;f.sort=o;f.swapIn=p;f.singleElement=q;f.isEmpty=r;f.slice=s}),66);
__d("WAIsMp4",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a.length<8?!1:a[4]===102&&a[5]===116&&a[6]===121&&a[7]===112}f.isMp4=a}),66);
__d("WAIsWebP",[],(function(a,b,c,d,e,f){"use strict";function a(a){if(a.length<12)return!1;if(a[0]!==82||a[1]!==73||a[2]!==70||a[3]!==70)return!1;return a[8]!==87||a[9]!==69||a[10]!==66||a[11]!==80?!1:!0}f.isWebP=a}),66);
__d("WAMediaUtilsWasmUrl",["bx"],(function(a,b,c,d,e,f,g){"use strict";a=c("bx").getURL(c("bx")("237"));g.WAMediaUtilsWasmUrl=a}),98);
__d("WAMp4Check",["WAMediaUtilsWasmUrl","WAResultOrError","WASI","WAWasmModuleCache"],(function(a,b,c,d,e,f,g){"use strict";var h="input",i="output",j="/"+h,k="/"+i;function l(a){var b,c=a.input,d=a.stdout;a=a.stderr;return{args:["wamediautil","mp4check","--error-tolerance=2","--json-report="+i,h],fs:(b={},b[j]={path:j,timestamps:{access:new Date(),change:new Date(),modification:new Date()},mode:"binary",content:new Uint8Array(c)},b[k]={path:k,timestamps:{access:new Date(),change:new Date(),modification:new Date()},mode:"string",content:""},b),stdout:d,stderr:a}}function a(a){var b=a.getWasmModule,c=a.logError,e=a.logMessage;return async function(a){a=a.input;a=d("WASI").createWasi(l({input:a,stderr:c,stdout:e}));var f=a.getImportObject;a=a.start;var g=await b();g=await WebAssembly.instantiate(g,f());f=a(g);a=f.exitCode;g=f.fs;if(a!==0){c("mp4Check failed with exit code "+a);return d("WAResultOrError").makeError("invalid-media")}a=(f=g[k])==null?void 0:f.content;if(typeof a!=="string"){c("mp4check failed invalid result type");return d("WAResultOrError").makeError("runtime-error")}f=(g=JSON.parse(a))!=null?g:{};return d("WAResultOrError").makeResult({videoStreamReport:(f==null?void 0:f.video_stream_report)==null?null:{streamType:(a=f.video_stream_report)==null?void 0:a.stream_type,calculatedFps:(g=f.video_stream_report)==null?void 0:g.calculated_fps,nominalFps:(a=f.video_stream_report)==null?void 0:a.nominal_fps,videoWidth:(g=f.video_stream_report)==null?void 0:g.video_width,videoHeight:(a=f.video_stream_report)==null?void 0:a.video_height,duration:(g=f.video_stream_report)==null?void 0:g.duration,avgBitsPerSecond:(a=f.video_stream_report)==null?void 0:a.avg_bits_per_second},audioStreamReport:(f==null?void 0:f.audio_stream_report)==null?null:{streamType:(g=f.audio_stream_report)==null?void 0:g.stream_type,samplingRate:(a=f.audio_stream_report)==null?void 0:a.sampling_rate,numberOfChannels:(g=f.audio_stream_report)==null?void 0:g.number_of_channels,avgBitsPerSecond:(a=f.audio_stream_report)==null?void 0:a.avg_bits_per_second}})}}b=function(){return d("WAWasmModuleCache").loadWasmModule(d("WAMediaUtilsWasmUrl").WAMediaUtilsWasmUrl)};g.createMp4Check=a;g.getMp4CheckWasm=b}),98);
__d("WAParseWav",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b=new DataView(a);if(a.byteLength<44)return null;return b.getUint32(0)!==1380533830||b.getUint32(8)!==1463899717?null:a}function b(a){a=new DataView(a);var b=a.getUint16(22,!0);a=a.getUint32(24,!0);return{numChannels:b,sampleRate:a}}f.validateWav=a;f.parseWav=b}),66);
__d("WAWebPCheck",["WAResultOrError","WASI","WAWasmModuleCache","bx"],(function(a,b,c,d,e,f,g){"use strict";var h="input",i="/"+h;function j(a){var b,c=a.input,d=a.stdout;a=a.stderr;return{args:["webpcheck",h],fs:(b={},b[i]={path:i,timestamps:{access:new Date(),change:new Date(),modification:new Date()},mode:"binary",content:new Uint8Array(c)},b),stdout:d,stderr:a}}function a(a){var b=a.getWasmModule,c=a.logError,e=a.logMessage;return async function(a){a=a.input;a=d("WASI").createWasi(j({input:a,stderr:c,stdout:e}));var f=a.getImportObject;a=a.start;var g=await b();g=await WebAssembly.instantiate(g,f());f=a(g);a=f.exitCode;if(a!==0){c("WebPCheck failed with exit code "+a);return d("WAResultOrError").makeError("invalid-media")}return d("WAResultOrError").makeResult()}}var k=c("bx").getURL(c("bx")("6946"));b=function(){return d("WAWasmModuleCache").loadWasmModule(k)};g.createWebPCheck=a;g.getWebpCheckWasm=b}),98);
__d("WAValidateMedia",["WAIsMp4","WAIsOgg","WAIsWebP","WAMp4Check","WAParseWav","WAResultOrError","WATagsLogger","WAWebPCheck"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=d("WATagsLogger").TAGS(["WAValidateMedia"]);function a(a,b){b==null||b.addPoint("media_validation_start");return l(a).then(function(a){a.success?b==null||b.addPoint("media_validation_end",{bool:{is_validation_setup_failed:a.value.validationSetupFailed,is_validation_skipped:a.value.skipValidation},string:{validated_mime_type:a.value.mimeType}}):b==null||b.addPoint("media_validation_fail",{string:{validationError:a.error}});return a}).catch(function(c){k.ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["validateMedia threw an exception: ",""])),c);b==null||b.addPoint("media_validation_fail",{string:{validationError:c.toString()}});return d("WAResultOrError").makeResult({skipValidation:!0,mimeType:null,validatedPlaintext:a,validationSetupFailed:!0})})}function l(a){var b=new Uint8Array(a);if(d("WAIsWebP").isWebP(b))return o(a);if(d("WAIsMp4").isMp4(b))return p(a);if(d("WAIsOgg").isOgg(b))return Promise.resolve(d("WAResultOrError").makeResult({skipValidation:!1,mimeType:"audio/ogg",validatedPlaintext:a,validationSetupFailed:!1,audioStreamReport:null}));b=d("WAParseWav").validateWav(a);return b!=null?Promise.resolve(q(b)):Promise.resolve(d("WAResultOrError").makeResult({mimeType:null,skipValidation:!0,validatedPlaintext:a,validationSetupFailed:!1}))}var m=function(a){k.WARN(i||(i=babelHelpers.taggedTemplateLiteralLoose(["",""])),a)},n=function(a){k.LOG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["",""])),a)};async function o(a){var b=d("WAWebPCheck").createWebPCheck({getWasmModule:d("WAWebPCheck").getWebpCheckWasm,logError:m,logMessage:n});b=await b({input:a});return!b.success?d("WAResultOrError").makeError(b.error==="invalid-media"?"invalid-webp":b.error):d("WAResultOrError").makeResult({skipValidation:!1,mimeType:"image/webp",validatedPlaintext:a,validationSetupFailed:!1})}async function p(a){var b=d("WAMp4Check").createMp4Check({getWasmModule:d("WAMp4Check").getMp4CheckWasm,logError:m,logMessage:n});b=await b({input:a});if(!b.success)return d("WAResultOrError").makeError(b.error==="invalid-media"?"invalid-mp4":b.error);b=b.value;var c=b.videoStreamReport;b=b.audioStreamReport;return c==null?b==null?d("WAResultOrError").makeError("invalid-mp4"):d("WAResultOrError").makeResult({skipValidation:!1,mimeType:"audio/mp4",validatedPlaintext:a,validationSetupFailed:!1,audioStreamReport:b}):d("WAResultOrError").makeResult({skipValidation:!1,mimeType:"video/mp4",validatedPlaintext:a,validationSetupFailed:!1,videoStreamReport:c,audioStreamReport:b})}function q(a){var b=d("WAParseWav").parseWav(a),c=b.numChannels;b=b.sampleRate;return d("WAResultOrError").makeResult({skipValidation:!1,mimeType:"audio/wav",validatedPlaintext:a,validationSetupFailed:!1,audioStreamReport:{streamType:"LPCM",samplingRate:b,numberOfChannels:c}})}g.validateMedia=a}),98);
__d("MAWMediaManagementTxns",["BlobStorageTypes","EBLogger","MAWBridge","MAWBridgeTypesCreators","MAWDbChunkTxns","MAWDbMediaTxns","MAWDbMsgTxns","MAWDexieCastToPromise","MAWDexieTable","MAWMediaAfterTxns","MAWMediaBackupTxns","MAWMediaUtils","MAWMsgType","MAWODSProxy","MAWSupportedDocumentTypes","MAWWriteMsgTxns","MWFBLogger","WAErrorMessage","WAHashUtils","WAMediaUtils","WAOdsEnums","WASortedLists","WATimeUtils","WAValidateMedia","emptyFunction","gkx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q,r=d("MWFBLogger").MWMediaLogger.tags(["MAWMediaManagementTxns"]),s=c("gkx")("23924");function a(a,b,c,e){var f=c==null||b.type===d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE&&(s||!d("MAWSupportedDocumentTypes").isAllowedType((c=c.validatedDocumentFileInfo)==null?void 0:c.filename));return d("MAWWriteMsgTxns").prepareMsgWriteData(a,b,e).then(function(a){return babelHelpers.extends({},a,{shouldDropDocument:f})})}function b(a,b,c,e,f){f===void 0&&(f=!1);var g={validatedAudioInfo:b.validatedAudioInfo,validatedDocumentFileInfo:b.validatedDocumentFileInfo,validatedImageInfo:b.validatedImageInfo,validatedVideoInfo:b.validatedVideoInfo},h=d("WAMediaUtils").decodeMediaEntryData(b.mediaEntry);h=h.objectId!=null?d("WAMediaUtils").stringToDeliveryObjectId(h.objectId):null;return u(a,c,e,b.plaintextHash,b.mediaType,b.size,b.mediaEntry,g,h,void 0,f,void 0,b.accessibilitySummaryText)}function e(a,b,c,e,f,g,h){f===void 0&&(f=!1);h===void 0&&(h=!0);var i=d("MAWMediaUtils").genHMACPlaintextHash(b.plaintextHash);b=d("WAMediaUtils").decodeMediaEntryData(b.mediaEntry);b=b.objectId!=null?d("WAMediaUtils").stringToDeliveryObjectId(b.objectId):null;return d("MAWDexieTable").dexieAll([v(a,c,e,b,void 0,f),d("MAWDbChunkTxns").hasMediaChunk(a,i)]).then(function(b){var d=b[0];b=b[1];return w(a,c,d,f,g,h,b)})}function f(a,b,c,e,f,g,h,i){f===void 0&&(f=!1);g===void 0;i===void 0&&(i=!0);e={validatedAudioInfo:b.validatedAudioInfo,validatedDocumentFileInfo:b.validatedDocumentFileInfo,validatedImageInfo:b.validatedImageInfo,validatedVideoInfo:b.validatedVideoInfo};g=d("MAWMediaUtils").genHMACPlaintextHash(b.plaintextHash);var j=d("WAMediaUtils").decodeMediaEntryData(b.mediaEntry);j=j.objectId!=null?d("WAMediaUtils").stringToDeliveryObjectId(j.objectId):null;return d("MAWDexieTable").dexieAll([t(a,c,b.plaintextHash,b.mediaType,b.size,b.mediaEntry,e,j,void 0,f,b.accessibilitySummaryText),d("MAWDbChunkTxns").hasMediaChunk(a,g)]).then(function(b){var d=b[0];b=b[1];return w(a,c,d,f,h,i,b)})}function t(a,b,c,d,e,f,g,h,i,j,k){j===void 0&&(j=!1);return u(a,b.msgId,b.type,c,d,e,f,g,h,i,j,void 0,k).then(function(c){return v(a,b,c,h,void 0,j)})}function u(a,b,c,e,f,g,l,m,n,o,p,q,s){p===void 0&&(p=!1);q===void 0&&(q=0);s===void 0&&(s=null);return d("MAWDbMediaTxns").maybeGetMediaFromPlaintextHash(a,e).then(function(t){var v=new Map(t==null?void 0:t.mediaEntries),w=B(l,n,o);w!=null&&v.set(b,w);if(t){q>0&&r.DEBUG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Media found after retry for plaintextHash: ",""])),d("WAHashUtils").sanitisePlaintextHash(e));t.msgIds||r.mustfix("Media missing msgIds: media type=%s",t.mediaType);t.mediaType||r.mustfix("Media missing mediaType: type=%s ; msg type=%s",f,c);var x=babelHelpers.extends({},t,m,{accessibilitySummaryText:s!=null?s:void 0,mediaEntries:v,mediaType:(w=t.mediaType)!=null?w:f,msgIds:d("WASortedLists").addToSet(t.msgIds||d("WASortedLists").emptySet(),b)});return a.media.put(x).then(function(){return x})}else{var y=d("MAWMediaUtils").genHMACPlaintextHash(e),z=babelHelpers.extends({accessibilitySummaryText:s!=null?s:void 0,fbid:o!=null?o:void 0,hashedPlaintextHash:y,mediaEntries:v,mediaType:f,msgIds:d("WASortedLists").singleElement(b),objectId:n!=null?n:void 0,plaintextHash:e,size:g,ts:d("WATimeUtils").unixTime()},m);return a.media.add(z).then(function(a){return babelHelpers.extends({},z,{mediaId:a})}).catch(function(h){var t=d("WAErrorMessage").maybeGetMessageFromError(h);if(q>0){r.DEBUG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Media failed to link after retry: plaintextHash: ",", hashedPlaintextHash: ",". Error: ",""])),d("WAHashUtils").sanitisePlaintextHash(e),y,t);r.catching(h).MUSTFIX(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Media failed to link after retry."])));throw h}else{r.DEBUG(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Media failed to link. Possible duplicate? Will attempt a retry. For plaintextHash: ",", hashedPlaintextHash: ",". Error: ",""])),d("WAHashUtils").sanitisePlaintextHash(e),y,t);d("MAWODSProxy").odsBumpEntityKey({amount:1,entity:d("WAOdsEnums").Entity.MAW_MEDIA_DB_DUPLICATE_MEDIA,key:"retry"});return u(a,b,c,e,f,g,l,m,n,o,p,q+1,s)}})}})}function v(a,b,c,e,f,g){g===void 0&&(g=!1);g=g?d("MAWDexieTable").dexieResolve():d("MAWDbMsgTxns").updateMediaId(a,b,c.mediaId,c.plaintextHash);return g.then(function(){return d("MAWMediaBackupTxns").linkMediaBackup(a,c.mediaId,b.msgId,e,f).then(function(){return c})})}function w(a,b,c,e,f,g,h){e===void 0&&(e=!1);g===void 0&&(g=!0);d("EBLogger").EBLogger.tags(["restore","handleUnstoredDbMedia"]).DEBUG(l||(l=babelHelpers.taggedTemplateLiteralLoose(["Inserted media with plaintextHash: ",""])),d("WAHashUtils").sanitisePlaintextHash(c.plaintextHash));return b.type!==d("MAWMsgType").MSG_TYPE.REVOKED&&!e&&g?d("MAWMediaAfterTxns").handleNewMediaAfterTxn(b,c,h,a,void 0,f).then(function(){return c}):d("MAWDexieTable").dexieResolve(c)}var x=function(a,b,c,e,f,g,h,i,j,k,l){j===void 0&&(j=!1);return d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b).then(function(b){if(b==null)throw r.mustfixThrow("Do not have the media message in db when attachHashToMediaMsg");else return t(a,b,c,g,h,l,i,e,f,j,k)})},y=function(a,b,e){return d("MAWDbMediaTxns").maybeGetMediaFromHashedPlaintextHash(a,b).then(function(b){if(b!=null){var d=babelHelpers.extends({},b);e.validatedAudioInfo!=null&&(d.validatedAudioInfo=babelHelpers.extends({},b.validatedAudioInfo,e.validatedAudioInfo));e.validatedVideoInfo!=null&&(d.validatedVideoInfo=babelHelpers.extends({},b.validatedVideoInfo,e.validatedVideoInfo));e.validatedImageInfo!=null&&(d.validatedImageInfo=babelHelpers.extends({},b.validatedImageInfo,e.validatedImageInfo));e.validatedDocumentFileInfo!=null&&(d.validatedDocumentFileInfo=babelHelpers.extends({},b.validatedDocumentFileInfo,e.validatedDocumentFileInfo));return a.media.update(d.mediaId,d).then(c("emptyFunction"))}else r.WARN(m||(m=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] media entry is missing, can't update media info"])))})},z=function(a,b,c,e){return d("MAWDbMediaTxns").maybeGetMediaFromHashedPlaintextHash(a,b).then(function(b){if(b!=null){var f=e?b.mediaEntries.set(c,e):b.mediaEntries;b=babelHelpers.extends({},b,{mediaEntries:f});return a.media.update(b.mediaId,b)}else{r.MUSTFIX(n||(n=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][updateMediaWithEncodedMediaEntryData] media entry is missing, can't upate media with encoded data"])));return d("MAWDexieTable").dexieResolve()}})};function A(a,b,e,f,g,h,i,j,k,l,m,n){l===void 0&&(l=!1);return d("MAWDexieTable").dexieAll([x(a,b,f,g,h,i,k.size,j,l,m,n),d("MAWDbChunkTxns").getOrCreateMediaChunkWithPlaintextHash(a,f,e,k.type)]).then(function(a){a=a[0];c("gkx")("6236")&&(r.DEBUG(o||(o=babelHelpers.taggedTemplateLiteralLoose(["writing blob to storage"]))),void async function(){var a=await d("WAValidateMedia").validateMedia(e);a.success&&await d("MAWBridge").getBridge().fireAndForget("event","writeToMediaStorage",{blob:a.value.validatedPlaintext,fileName:d("BlobStorageTypes").toBlobFileName(f)})}());return a})}function B(a,b,c){var e;a=a;a!=null&&b!=null&&(e=d("WAMediaUtils").decodeMediaEntryData(a),a=d("WAMediaUtils").encodeMediaEntryWithUpdatedObjectId(e,b));a!=null&&c!=null&&(e=d("WAMediaUtils").decodeMediaEntryData(a),a=d("WAMediaUtils").encodeMediaEntryWithUpdatedFbid(e,c));return a}function C(a,b,c){var e=new Map();a.mediaEntries.forEach(function(a,f){var g=d("WAMediaUtils").decodeMediaEntryData(a);g=g.objectId===b?d("WAMediaUtils").encodeMediaEntryWithUpdatedFbid(g,c):a;e.set(f,g)});return e}function D(a,b,c,e,f){f===void 0&&(f=!0);var g=new Map();b.forEach(function(a){var b;b=(b=g.get(a.hashedPlaintextHash))!=null?b:[];b.push(a);g.set(a.hashedPlaintextHash,b)});return d("MAWDbMediaTxns").maybeBulkGetMediaFromHashedPlaintextHash(a,[].concat(Array.from(g.keys()))).then(function(h){var i=new Map(h.map(function(a){return[a.hashedPlaintextHash,a]})),j=new Map();b.forEach(function(a){var b=i.get(a.hashedPlaintextHash);if(a==null)return;var c=B(a==null?void 0:a.entry,a==null?void 0:a.objectId,a==null?void 0:a.fbId);if(b){var e=c?b.mediaEntries.set(a.msgId,c):b.mediaEntries;e=babelHelpers.extends({},b,{mediaEntries:e,msgIds:d("WASortedLists").addToSet(b.msgIds,a.msgId)});i.set(a.hashedPlaintextHash,e)}else K(j,a,c)});var k=new Map(),l=new Map();h=Array.from(j.values()).filter(function(a){return E(a,k,l)});return d("MAWDexieTable").dexieAll([a.media.bulkAdd(h),a.media.bulkPut(Array.from(i.values()))]).then(function(){return F(a,[].concat(Array.from(g.keys())),g,c,e,f)})})}function E(a,b,c){if(a.objectId!=null){var d=b.get(a.objectId);if(d!=null&&d!==a.hashedPlaintextHash){r.MUSTFIX(p||(p=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Same objectId assigned for different mediaIds. objectId: "," shared by  hashedPlaintextHashes: "," ",""])),a.objectId,d,a.hashedPlaintextHash);return!1}}if(a.fbid!=null){d=c.get(a.fbid);if(d!=null&&d!==a.hashedPlaintextHash){r.MUSTFIX(q||(q=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Same FBId assigned for different mediaIds. fbId: "," - shared by hashedPlaintextHashes: "," ",""])),a.fbid,d,a.hashedPlaintextHash);return!1}}a.objectId!=null&&b.set(a.objectId,a.hashedPlaintextHash);a.fbid!=null&&c.set(a.fbid,a.hashedPlaintextHash);return!0}function F(a,b,c,e,f,g){return d("MAWDbMediaTxns").maybeBulkGetMediaFromHashedPlaintextHash(a,b).then(function(b){return d("MAWDexieTable").dexieAll([I(a,b,c)]).then(function(){g&&G(b,c,e,a,f);return b})})}function G(a,b,e,f,g){a.forEach(function(a){var h=b.get(a.hashedPlaintextHash);h!=null&&!H(h)&&c("promiseDone")(d("MAWDexieCastToPromise").dexieCastToPromise_I_KNOW_WHAT_I_AM_DOING(f.messages.where("msgId").anyOf(a.msgIds).toArray().then(function(b){var c=d("MAWMediaUtils").createHdTypesForBridgeMedia(b);b=d("MAWBridgeTypesCreators").createBridgeMedia({chatJid:e,filteredMsgIds:d("MAWBridgeTypesCreators").getMsgIdsFilteredByJid(b,e),hasMediaForUI:!1,hdTypes:c,media:a,transportKey:g});return d("MAWMediaAfterTxns").handleNewMediaAfterTxnWithBridgeMedia(f,b)})))})}function H(a){return a.reduce(function(a,b){return a||b.isXMAShare},!1)}function I(a,b,c){b=b.reduce(function(a,b){var d;(d=c.get(b.hashedPlaintextHash))==null||d.filter(function(a){return a!=null&&!a.isXMAShare}).forEach(function(c){return a.set(c.msgId,b.mediaId)});return a},new Map());return d("MAWDbMsgTxns").bulkUpdateMediaId(a,b)}function J(a,b){var c;a=a?new Map([[b.msgId,a]]):new Map();return babelHelpers.extends({fbid:(c=b.fbId)!=null?c:void 0,hashedPlaintextHash:b.hashedPlaintextHash,mediaEntries:a,mediaType:b.mediaType,msgIds:d("WASortedLists").singleElement(b.msgId),objectId:(c=b.objectId)!=null?c:void 0,plaintextHash:b.plaintextHash,size:b.size,ts:d("WATimeUtils").unixTime()},b.mediaInfo)}function K(a,b,c){var d=a.get(b.hashedPlaintextHash);d==null?a.set(b.hashedPlaintextHash,J(c,b)):(c!=null&&d.mediaEntries.set(b.msgId,c),d.msgIds.push(b.msgId))}g.prepareMediaWriteData=a;g.handleUnstoredDbMediaCreation=b;g.handleUnstoredDbMediaLinking=e;g.handleUnstoredDbMedia=f;g.linkMedia=t;g.createOrUpdateMediaRow=u;g.attachHashToMediaMsg=x;g.updateMediaEntryWithValidatedMediaInfo=y;g.updateMediaWithEncodedMediaEntryData=z;g.attachHashAndSaveMedia=A;g.updateBackupFbidInMediaEntries=C;g.bulkLinkMedia=D;g.linkMessageAndMediaBackupForMediaList=F}),98);
__d("MAWAfterWriteMsgUtil",["$InternalEnum","ArmadilloDataTraceType","MAWBridgeMsg","MAWBridgeTrace","MAWDbMsg","MAWIndexedDb","MAWXMAUtils"],(function(a,b,c,d,e,f,g){"use strict";c=b("$InternalEnum").Mirrored(["DO_NOT_BUMP_THREAD","BUMP_LOCAL_ONLY","BUMP_LOCAL_AND_SERVER"]);function a(a){var b=a.dbMsg,c=a.isFirstMsg,e=a.openMessageOtid,f=a.openMessageParticipantCount,g=a.participantCount,h=a.quotedReplyAttachmentMeta;a=a.updatedThread;var i=a.authoritativeThreadKey;a=a.jid;if(b.altIndex===d("MAWDbMsg").SPAM_ALT_INDEX||b.altIndex===d("MAWDbMsg").FUTUREPROOF_SPAM_ALT_INDEX)return;d("MAWIndexedDb").afterTransaction({tag:"StartTrace",value:d("MAWBridgeTrace").createBridgeStartTraceData(b,a,d("ArmadilloDataTraceType").armadilloMessageSend,e,c,f,g,i)});d("MAWXMAUtils").isXMAStoryReply(b.xmaMessageType)||d("MAWIndexedDb").afterTransaction({tag:"NewMsg",value:d("MAWBridgeMsg").createBridgeMsg(b,h)})}g.WriteMsgAfterTxnBumpThreadOption=c;g.writeMsgAfterTransaction=a}),98);
__d("MAWWriteBulkWriteIncomingAdminMsgTxns",["MAWAdminMsgTxns","MAWAfterWriteMsgUtil","MAWDbMsgTxns","MAWDexieTable","MAWQplProxy","WALogger","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b){var c=[],e=[],f=[],g=new Map(),i=new Map(),j=b.map(function(b){return d("MAWDbMsgTxns").getThreadOldestMessageId(a,b.jid).then(function(a){return g.set(b.jid,a)})}),k=b.map(function(b){return d("MAWDbMsgTxns").getThreadNewestMessageMs(a,b.jid).then(function(a){return i.set(b.jid,a)})});return d("MAWDexieTable").dexieAll([j,k]).then(function(){b.forEach(function(a){a==null&&d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["OfflineBulkWriteAdminmsg - Missing thread when write e2ee thread description"])));var b=d("MAWAdminMsgTxns").buildE2EEThreadDescriptionMsg(a);a=d("MAWAdminMsgTxns").getUpdatedThreadForAdminMsg(b,a,i.get(a.jid));c.push(b);f.push(a);e.push({dbMsg:b,isFirstMsg:!1,updatedThread:a})});return{afterTransactionSyncMsgsData:e,e2eeThreadAdminMsgs:c,threadsToUpdate:f}})}function a(a,b,c){return j(a,b,c).then(function(a){var b=a.afterTransactionSyncMsgsData;a=a.threadsToUpdate;var c=new Map();b.forEach(function(a){var b=a.updatedThread.jid;c.set(b,{externalId:a.dbMsg.externalId,msgId:a.dbMsg.msgId})});return a.map(function(a){return{adminMsgParams:c.get(a.jid),thread:a}})})}function b(a,b,c){return j(a,b,c).then(function(a){var b=a.afterTransactionSyncMsgsData;a=a.threadsToUpdate;b.forEach(function(a){return d("MAWAfterWriteMsgUtil").writeMsgAfterTransaction(a)});return a})}function j(a,b,e){return i(a,b).then(function(b){var f=b.afterTransactionSyncMsgsData,g=b.e2eeThreadAdminMsgs,h=b.threadsToUpdate;e!=null&&d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25313175,"1551"),"write-bulk-admin-msgs-start",{instanceKey:e});return d("MAWDexieTable").dexieAll([a.messages.bulkAdd(g),a.threads.bulkPut(h)]).then(function(){e!=null&&d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25313175,"1551"),"write-bulk-admin-msgs-end",{instanceKey:e});return{afterTransactionSyncMsgsData:f,threadsToUpdate:h}})})}g.writeE2EEAdminMsgsForIncomingCreatedThreadsWithoutAfterTxns=a;g.writeE2EEAdminMsgsForIncomingCreatedThreadsWithAfterTxns=b}),98);
__d("IGDWEBUploadMessageUtils",["I64","MAWExtractMsFromExternalId","WALogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,b){var c=d("MAWExtractMsFromExternalId").extractMsFromExternalId((i||(i=d("I64"))).of_string(a));c==null&&d("WALogger").WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[sortOrder] Could not extract ms from externalId: ",""])),a);return d("WATimeUtils").castToMillisTime(Number(b)*1e3+(c!=null?c:0))}g.generateProtobufServerTs=a}),98);
__d("EncryptedBackupsUploadEntity",["$InternalEnum","EncryptedBackupsUtils","IGDWEBUploadMessageUtils","WAArmadilloBackupMessage.pb","WAByteArray","WAGlobals","WAJids","WATimeUtils","encodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return a instanceof ArrayBuffer?new Uint8Array(a):a}var h=b("$InternalEnum").Mirrored(["NEEDS_BACKUP","COMPLETED","NEEDS_BACKUP_RETRY","PERMANENT_FAILURE","EXPIRED","THREAD_DELETED","DELETION_PURGED","MESSAGE_DELETED","UPLOADING"]);b=b("$InternalEnum")({INVALID:"-1",IMAGE:"0",PTT:"1",DOCUMENT:"3",VIDEO:"4",GIF:"5",STICKER:"6",XMA:"22",MESSENGER_PREVIEW:"25"});function c(a){return a}function i(a){var b=a.messageApplication,c=a.msgId,e=a.reportingMeta;a=a.sortOrderMs;var f=d("WAJids").authorToUserId(c.author,d("WAJids").extractUserId(d("WAGlobals").getMyUserJid()));return d("encodeProtobuf").encodeProtobuf(d("WAArmadilloBackupMessage.pb").BackupMessageSpec,d("EncryptedBackupsUtils").asBackupMessage(f,c.externalId,a,e!=null?e:{frankingKey:null,frankingTag:null,frankingVersion:null,reportingContent:null,reportingTag:null},b)).readByteArrayView()}function e(a){return d("WAByteArray").uint8ArrayToBuffer(a)}function f(a){var b=a.attachmentContext,c=a.backupDirective,e=a.dbMsgType,f=a.instanceKey,g=a.isOpenEB,j=a.isRetroactiveUpload,k=a.legacyAttachmentContext,l=a.messageApplication,m=a.msgId,n=a.originalMsgProtocolId,o=a.reportingMeta,p=a.retryCount,q=a.senderId,r=a.serverTs,s=a.sortOrderMs,t=a.tags;a=a.triggerSource;l=i({messageApplication:l,msgId:m,reportingMeta:o,sortOrderMs:c.actionType===4?d("IGDWEBUploadMessageUtils").generateProtobufServerTs(m.externalId,r):s});o={backupActionType:c.actionType,backupDirective:c,dbMsgType:e,failTsMs:d("WATimeUtils").castToMillisTime(0),instanceKey:f,isOpenEB:g,isRetroactiveUpload:j,msgId:m,msgIdKey:d("EncryptedBackupsUtils").convertWAMsgIdToStringId(m),msgType:"text",originalMsgProtocolId:n,protobuf:l,retryCount:p,senderId:q,serverTs:r,sortOrderMs:s,supplementalKey:c.supplementalKey,tags:t,triggerSource:a,uploadStatus:h.NEEDS_BACKUP,uploadTsSec:d("WATimeUtils").unixTime()};b!=null&&(o=babelHelpers["extends"]({},o,{attachmentContext:b,legacyAttachmentContext:k,msgType:"media"}));return o}g.toEbBackupMessageBytes=a;g.EbUploadStatus=h;g.AttachmentContextMediaType=b;g.castToEBQueueId=c;g.encodeBackupMessage=i;g.getEbBackupMessageBytesBuffer=e;g.asEBUploadEntity=f}),98);
__d("EncryptedBackupsAttachmentProductType",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum")({MSGR:"msgr",IGD:"igd"});c=a;f["default"]=c}),66);
__d("MAWBridgeUpload",["MAWMainTraceUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.actionType,c=a.attachmentContext,d=a.attachmentContextArray,e=a.authTs,f=a.echoDocument,g=a.echoEncodingLatencyNs,i=a.errorCode,j=a.errorMessage,k=a.messageId,l=a.messageType,m=a.productType,n=a.protoMsg,o=a.sortOrderMs,p=a.threadId,q=a.traceId;a=a.uploadTrackingInstanceKey;c=h(c,m!=null?m:"msgr",d);return{actionType:b,attachmentBackupContext:c,authTs:e,echoDocument:f,echoEncodingLatencyNs:g,errorCode:i,errorMessage:j,messageId:k,messageType:l,protoMsg:n,sortOrderMs:o,threadId:p,traceId:q,uploadTrackingInstanceKey:a}}function b(a,b,c,d,e,f){return{actionType:f,echoDocument:e,folderType:b,threadId:a,transportKey:c,ts:d}}function c(a,b,c,d,e,f,g,h){return{deliveryObjectId:a,mediaType:b,messageId:c,productType:d,threadId:e,threadJid:f,traceId:h,ts:g}}function h(a,b,c){if(c==null)return void 0;else{a=c.map(function(a){return{attachmentTraceId:d("MAWMainTraceUtils").createTraceId(),mediaType:a.mediaType,zippyObjectId:a.mediaObjectId}});c={attachmentInfos:a,productType:b};return c}}g.createBridgeUploadMessage=a;g.createBridgeDeleteMessagesOfThread=b;g.createBridgeUploadAttachment=c;g.createBridgeUploadAttachmentBackupContext=h}),98);
__d("EBUploadSentDeletedMessage",["EBLogger","EncryptedBackupsUploadEntity","I64","MAWBridge","MAWBridgeUpload","MAWMessageSortOrderUtils","MAWMpsGating","MAWTraceUtils","WAGlobals","WAJids","WATimeUtils","cr:21382","gkx","promiseDone","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=c("requireDeferred")("EBAPI").__setRef("EBUploadSentDeletedMessage"),k=d("EBLogger").EBLogger.tags(["EBUploadSentDeletedMessage"]);function a(a,e){if(d("MAWMpsGating").isEbUploadViaMpsEnabled()){k.INFO(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Skipping upload, as it should have been processed by MPS"])));return}var f=a.author;if(f===d("WAJids").AUTHOR_SYSTEM)return;if(c("gkx")("11710"))c("promiseDone")(j.load().then(function(b){return b.uploadDeletedMessage({msgId:{author:f,chat:e,externalId:a.externalId},sender:a.author,serverTs:(b=a.serverTs)!=null?b:a.ts,sortOrderMs:d("WATimeUtils").castToMillisTime(d("MAWMessageSortOrderUtils").generateAuthoritativeMessageSortOrder(a))})}));else{var g,l=d("MAWTraceUtils").createTraceId(),m=d("MAWMessageSortOrderUtils").generateAuthoritativeMessageSortOrder(a);g=[d("MAWBridgeUpload").createBridgeUploadMessage({actionType:2,authTs:a.serverTs,echoDocument:null,echoEncodingLatencyNs:null,errorCode:null,errorMessage:null,messageId:a.externalId,messageType:a.type,protoMsg:{backupActionType:3,msgId:{author:f,chat:e,externalId:a.externalId},originalMsgProtocolId:null,protobuf:d("EncryptedBackupsUploadEntity").toEbBackupMessageBytes(new Uint8Array(0)),senderId:(i||(i=d("I64"))).of_string(d("WAJids").authorToUserId(a.author,d("WAJids").extractUserId(d("WAGlobals").getMyUserJid()))),serverTs:(g=a.serverTs)!=null?g:a.ts,sortOrderMs:d("WATimeUtils").castToMillisTime(m)},sortOrderMs:m,threadId:d("WAJids").threadIdForChatJid(e),traceId:l,uploadTrackingInstanceKey:null})];b("cr:21382")!=null?c("promiseDone")(b("cr:21382").uploadMessagesFromWorker(g)):d("MAWBridge").getBridge().fireAndForget("event","uploadMessagesToBackupV2",{checkPoint:[],messages:g,qpl:[]})}}g.sendDeleteEchoMessage__DEPRECATED_DO_NOT_USE=a}),98);
__d("MAWAsArmadilloApplication",["FBLogger","MAWMsgType","MAWVault","MAWXMAEncodeUtils","WAArmadilloApplication.pb","WAGlobals","WAJids","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e){switch(a.type){case d("MAWMsgType").MSG_TYPE.XMA:if((b==null?void 0:b.xma)==null)throw c("FBLogger")("messenger_web").mustfixThrow("XMA content should have XMA payload");return d("MAWXMAEncodeUtils").encodeXMA(a,b);case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:return h(a,e);case d("MAWMsgType").MSG_TYPE.RAVEN_ACTION:return i(a);default:throw c("FBLogger")("messenger_web").mustfixThrow(a.type+" should not be handled as ArmadilloApplication")}}function h(a,b){var c;if(a.type!==d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE||((c=a.quote)==null?void 0:c.content)==null||b==null)return null;c=a.quote.content;var e=d("WAJids").interpretAndValidateJid(b),f=d("WAJids").isAuthorMe(a.author)?d("WAGlobals").getMyUserJid():a.author,g=d("WAJids").isAuthorMe(c.author)?d("WAGlobals").getMyUserJid():c.author;function h(){if(e.jidType==="msgrUser")return g;return e.jidType==="group"?e.groupJid:null}function i(){if(f===g)return null;return e.jidType==="group"?g:null}b=h();h=i();if(b==null)return null;if(a)return{payload:{content:{bumpExistingMessage:{key:{fromMe:f===g,id:c.externalId,participant:h,remoteJid:b}}}}}}function b(a){var b,c,e;b=(b=a.quote)==null?void 0:b.content;var f=b==null||(c=b.msgContent)==null?void 0:c.content,g=b==null?void 0:b.expirationTs;a=a==null||(e=a.msgContent)==null?void 0:e.content;if(b==null||f==null||a==null)return null;b=g!=null?d("WATimeUtils").castUnixTimeToMillisTime(g):void 0;return{payload:{content:{noteReplyMessage:{noteText:{text:d("MAWVault").unvault(f)},noteTimestampMs:b,textContent:{text:d("MAWVault").unvault(a)}}}}}}function i(a){var b=a.ravenActionToMsgExternalId;if(b==null)throw c("FBLogger")("messenger_web").mustfixThrow("msg ravenActionToMsgExternalId is null in encodeRavenActionMessage");var e=Number(a.actionType),f;if(e===0)f=d("WAArmadilloApplication.pb").ARMADILLO_CONTENT_RAVEN_ACTION_NOTIF_MESSAGE_ACTION_TYPE.PLAYED;else if(e===1)f=d("WAArmadilloApplication.pb").ARMADILLO_CONTENT_RAVEN_ACTION_NOTIF_MESSAGE_ACTION_TYPE.SCREENSHOT;else if(e===2)f=d("WAArmadilloApplication.pb").ARMADILLO_CONTENT_RAVEN_ACTION_NOTIF_MESSAGE_ACTION_TYPE.FORCE_DISABLE;else throw c("FBLogger")("messenger_web").mustfixThrow("msg actionType is not in enum in encodeRavenActionMessage");e=a.actionTimestamp;e==null&&(e=d("WATimeUtils").castMilliSecondsToUnixTime(Date.now()));a={actionTimestamp:e,actionType:f,key:{id:b}};return{payload:{content:{ravenActionNotifMessage:a}}}}g.asArmadilloApplication=a;g.encodeNoteReplyMessage=b}),98);
__d("validateMAWMediaAndComposeEntryForProtoMsg",["FBLogger","WAMediaUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){if(b==null)throw c("FBLogger")("messenger_web").mustfixThrow("DbMedia is null in validateMediaAndComposeEntryForProtoMsg");if(a!=null&&b.mediaId!=null){if(!b.msgIds.includes(a))throw c("FBLogger")("messenger_web").mustfixThrow("the media ("+b.mediaId+") is not linked to the msg ("+a+")");a=b.mediaEntries.get(a)}else a=b.mediaEntry;if(a==null)throw c("FBLogger")("messenger_web").mustfixThrow("media entry not found in validateMediaAndComposeEntryForProtoMsg");var d=b.plaintextHash;d=h(d,a);return[b,d]}function h(a,b){var e=d("WAMediaUtils").mediaEntryDataToRawData(a,b);a=["fileSha256","mediaKey","fileEncSha256","directPath","mediaKeyTimestamp"];b=a.filter(function(a){return e[a]==null});if(b.length>0)throw c("FBLogger")("messenger_web").mustfixThrow("missing fields in mediaEntryData: "+b.toString());return e}g.validateMAWMediaAndComposeEntryForProtoMsg=a;g.validateMediaEntry=h}),98);
__d("MAWAsConsumerApplication",["FBLogger","I64","LSIntEnum","MAWDbMedia","MAWJids","MAWMsgType","MAWVault","WAAssertUnreachable","WAConsumerApplication.pb","WAGlobals","WAJids","WAMediaHdType","WAMediaTransport.pb","encodeMAWDocumentFileMessage","encodeProtobuf","gkx","validateMAWMediaAndComposeEntryForProtoMsg"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j="image/jpeg",k="video/mp4",l="audio/wav",m="audio/ogg",n="image/gif",o="image/webp",p=c("gkx")("4644")?"application/octet-stream":"application/pdf",q=new ArrayBuffer(0);function a(a,b,e,f){switch(a.type){case d("MAWMsgType").MSG_TYPE.TEXT:return t(a);case d("MAWMsgType").MSG_TYPE.IMAGE:return u(a,b);case d("MAWMsgType").MSG_TYPE.VIDEO:return C(a,b);case d("MAWMsgType").MSG_TYPE.PTT:return F(a,b);case d("MAWMsgType").MSG_TYPE.REVOKED:return I(a.revokedExternalId);case d("MAWMsgType").MSG_TYPE.GIF:return C(a,b);case d("MAWMsgType").MSG_TYPE.STICKER:return z(a,b);case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return d("encodeMAWDocumentFileMessage").encodeFileMessage(a,b);case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE:case d("MAWMsgType").MSG_TYPE.SK_DISTRIBUTION:return null;case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:throw c("FBLogger")("messenger_web").mustfixThrow("Implemented ephemeral setting message in MAWAsConsumerApplication");case d("MAWMsgType").MSG_TYPE.XMA:throw c("FBLogger")("messenger_web").mustfixThrow("XMA content message is not consumer application. It should be addressed as ArmadilloApplication");case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:case d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case d("MAWMsgType").MSG_TYPE.ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case d("MAWMsgType").MSG_TYPE.ICDC_ALERT:case d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME:throw c("FBLogger")("messenger_web").mustfixThrow("We do not support converting to protoMsg with "+a.type+" type","maw_db");case d("MAWMsgType").MSG_TYPE.RAVEN:case d("MAWMsgType").MSG_TYPE.RAVEN_ACTION:throw c("FBLogger")("messenger_web").mustfixThrow("Raven content message is not consumer application. It should be addressed as ArmadilloApplication");case d("MAWMsgType").MSG_TYPE.EDIT_ACTION:throw c("FBLogger")("messenger_web").mustfixThrow("We do not support editing messages right now since the sending flow is not implemented yet. ");case d("MAWMsgType").MSG_TYPE.GROUP_INVITE:return J(a,e);case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:throw c("FBLogger")("messenger_web").mustfixThrow("Bump message is not consumer application. It should be addressed as ArmadilloApplication");case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:return M(a,f);case d("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE:throw c("FBLogger")("messenger_web").mustfixThrow("We do not support group poll creation messages yet as the sending flow is not implemented.");case d("MAWMsgType").MSG_TYPE.GROUP_POLL_UPDATE:throw c("FBLogger")("messenger_web").mustfixThrow("We do not support group poll update messages yet as the sending flow is not implemented.");default:return c("WAAssertUnreachable")(a.type)}}function b(a,b){if(b==null)return r(a);else switch(b.mediaType){case d("MAWDbMedia").MEDIA_TYPE.IMAGE:return v(a.msgId,b);case d("MAWDbMedia").MEDIA_TYPE.VIDEO:return D(a.msgId,b);case d("MAWDbMedia").MEDIA_TYPE.PTT:return G(a.msgId,b);case d("MAWDbMedia").MEDIA_TYPE.GIF:return D(a.msgId,b);case d("MAWDbMedia").MEDIA_TYPE.STICKER:return A(a.msgId,b);default:return null}}function r(a){var b=null;if(a.type===d("MAWMsgType").MSG_TYPE.REVOKED&&a.msgContent!=null&&a.msgContent.content!=null)b=a.msgContent.content;else if(a.type===d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME&&a.msgContent!=null)b=a.msgContent;else return null;return{payload:{content:{messageText:{mentionedJid:[],text:d("MAWVault").unvault(b)}}}}}function s(a){if(a==null)return;a=a===1?d("WAConsumerApplication.pb").CONSUMER_APPLICATION_METADATA_SPECIAL_TEXT_SIZE.SMALL:a===2?d("WAConsumerApplication.pb").CONSUMER_APPLICATION_METADATA_SPECIAL_TEXT_SIZE.MEDIUM:d("WAConsumerApplication.pb").CONSUMER_APPLICATION_METADATA_SPECIAL_TEXT_SIZE.LARGE;return{specialTextSize:a}}function t(a){var b={payload:{content:{messageText:{commands:a.msgContent.commands,mentionedJid:a.msgContent.mentionedJids,text:d("MAWVault").unvault(a.msgContent.content)}}}};a=s(a.specialTextSize);a!=null&&(b.metadata=a);return b}function u(a,b){return v(a.msgId,b,a)}function v(a,b,c){a=d("validateMAWMediaAndComposeEntryForProtoMsg").validateMAWMediaAndComposeEntryForProtoMsg(a,b);b=a[0];a=a[1];return y(b,a,c)}function w(a){switch(a){case d("WAMediaHdType").HD_TYPE_NONE:return d("WAMediaTransport.pb").IMAGE_TRANSPORT_ANCILLARY_HD_TYPE.NONE;case d("WAMediaHdType").HD_TYPE_LQ_4K:return d("WAMediaTransport.pb").IMAGE_TRANSPORT_ANCILLARY_HD_TYPE.LQ_4K;case d("WAMediaHdType").HD_TYPE_HQ_4K:return d("WAMediaTransport.pb").IMAGE_TRANSPORT_ANCILLARY_HD_TYPE.HQ_4K;default:a;return void 0}}function x(a,b,c){a={ancillary:{hdType:w((c=c==null?void 0:c.hdType)!=null?c:(c=a.validatedImageInfo)==null?void 0:c.hdType),height:(c=a.validatedImageInfo)==null?void 0:c.height,scanLengths:((c=b.progressiveJpegDetails)==null?void 0:c.scanLengths)||[],scansSidecar:(c=b.progressiveJpegDetails)==null?void 0:c.sidecar,width:(c=a.validatedImageInfo)==null?void 0:c.width},integral:{transport:{ancillary:{fileLength:a.size,mimetype:j,objectId:b.objectId,thumbnail:{downloadableThumbnail:b.downloadableThumbnail,jpegThumbnail:void 0,thumbnailHeight:(c=a.validatedImageInfo)==null?void 0:c.jpegThumbnailHeight,thumbnailWidth:(c=a.validatedImageInfo)==null?void 0:c.jpegThumbnailWidth}},integral:{directPath:b.directPath,fileEncSha256:b.fileEncSha256,fileSha256:b.fileSha256,mediaKey:b.mediaKey,mediaKeyTimestamp:b.mediaKeyTimestamp}}}};return d("encodeProtobuf").encodeProtobuf(d("WAMediaTransport.pb").ImageTransportSpec,a).readBuffer()}function y(a,b,c){a=x(a,b,c);return{payload:{content:{imageMessage:{caption:{mentionedJid:[]},image:{payload:a,version:1}}}}}}function e(a){function b(){var b=d("WAJids").validateGroupJid(a.threadJid);if(b!=null)return b;return d("WAJids").isAuthorMe(a.author)?a.threadJid:d("WAGlobals").getMyUserJid()}b=b();return{payload:{content:{editMessage:{key:{fromMe:!0,id:a.originalMsgExternalId,remoteJid:b},message:{mentionedJid:a.msgContent.mentionedJids,text:d("MAWVault").unvault(a.msgContent.content)},timestampMs:a.editTs*1e3}}}}}function z(a,b){return A(a.msgId,b)}function A(a,b){a=d("validateMAWMediaAndComposeEntryForProtoMsg").validateMAWMediaAndComposeEntryForProtoMsg(a,b);b=a[0];a=a[1];return B(b,a)}function B(a,b){var c;a={ancillary:{accessibilityLabel:a.accessibilitySummaryText,height:(c=a.validatedImageInfo)==null?void 0:c.height,width:(c=a.validatedImageInfo)==null?void 0:c.width},integral:{transport:{ancillary:{fileLength:a.size,mimetype:o,objectId:b.objectId,thumbnail:{thumbnailHeight:(c=a.validatedImageInfo)==null?void 0:c.jpegThumbnailHeight,thumbnailWidth:(c=a.validatedImageInfo)==null?void 0:c.jpegThumbnailWidth}},integral:{directPath:b.directPath,fileEncSha256:b.fileEncSha256,fileSha256:b.fileSha256,mediaKey:b.mediaKey,mediaKeyTimestamp:b.mediaKeyTimestamp}}}};c=d("encodeProtobuf").encodeProtobuf(d("WAMediaTransport.pb").StickerTransportSpec,a);return{payload:{content:{stickerMessage:{sticker:{payload:c.readBuffer(),version:1}}}}}}function C(a,b){return D(a.msgId,b)}function D(a,b){a=d("validateMAWMediaAndComposeEntryForProtoMsg").validateMAWMediaAndComposeEntryForProtoMsg(a,b);b=a[0];a=a[1];return E(b,a)}function E(a,b){var c,e=a.mediaType===d("MAWDbMedia").MEDIA_TYPE.GIF,f=e?a.validatedImageInfo:a.validatedVideoInfo;c={ancillary:{accessibilityLabel:a.accessibilitySummaryText,gifPlayback:e,height:f==null?void 0:f.height,seconds:e?void 0:(c=a.validatedVideoInfo)==null?void 0:c.duration,sidecar:b.sidecar,width:f==null?void 0:f.width},integral:{transport:{ancillary:{fileLength:a.size,mimetype:e?n:k,objectId:b.objectId,thumbnail:e?{thumbnailHeight:f==null?void 0:f.jpegThumbnailHeight,thumbnailWidth:f==null?void 0:f.jpegThumbnailWidth}:{downloadableThumbnail:b.downloadableThumbnail,jpegThumbnail:void 0,thumbnailHeight:f==null?void 0:f.jpegThumbnailHeight,thumbnailWidth:f==null?void 0:f.jpegThumbnailWidth}},integral:{directPath:b.directPath,fileEncSha256:b.fileEncSha256,fileSha256:b.fileSha256,mediaKey:b.mediaKey,mediaKeyTimestamp:b.mediaKeyTimestamp}}}};a=d("encodeProtobuf").encodeProtobuf(d("WAMediaTransport.pb").VideoTransportSpec,c);return{payload:{content:{videoMessage:{caption:{mentionedJid:[]},video:{payload:a.readBuffer(),version:1}}}}}}function F(a,b){return G(a.msgId,b)}function G(a,b){a=d("validateMAWMediaAndComposeEntryForProtoMsg").validateMAWMediaAndComposeEntryForProtoMsg(a,b);b=a[0];a=a[1];return H(b,a)}function H(a,b){var e;e={ancillary:{seconds:(e=a.validatedAudioInfo)==null?void 0:e.duration},integral:{audioFormat:c("gkx")("3053")?d("WAMediaTransport.pb").AUDIO_TRANSPORT_INTEGRAL_AUDIO_FORMAT.OPUS:void 0,transport:{ancillary:{fileLength:a.size,mimetype:c("gkx")("3053")?m:l,objectId:b.objectId,thumbnail:{jpegThumbnail:q}},integral:{directPath:b.directPath,fileEncSha256:b.fileEncSha256,fileSha256:b.fileSha256,mediaKey:b.mediaKey,mediaKeyTimestamp:b.mediaKeyTimestamp}}}};a=d("encodeProtobuf").encodeProtobuf(d("WAMediaTransport.pb").AudioTransportSpec,e);return{payload:{content:{audioMessage:{audio:{payload:a.readBuffer(),version:1},ptt:!0}}}}}function I(a){return{payload:{applicationData:{revoke:{key:{fromMe:!0,id:a}}}}}}function f(a){function b(){var b=d("WAJids").isAuthorMe(a.author)?d("WAGlobals").getMyUserJid():a.author,c=d("WAJids").isAuthorMe(a.reactToAuthor)?d("WAGlobals").getMyUserJid():a.reactToAuthor;return b===c?!0:!1}b=b();var c=d("WAJids").interpretAsGroupJid(a.threadJid)!=null;c={groupingKey:a.groupingKey==null?void 0:a.groupingKey,key:{fromMe:b,id:a.reactToExternalId,participant:c&&!b?a.reactToAuthor:void 0,remoteJid:a.threadJid},senderTimestampMs:a.senderTimestampMs,text:a.reaction==null?void 0:a.reaction};return{payload:{content:{reactionMessage:c}}}}function J(a,b){if(a.threadJid==null)throw c("FBLogger")("messenger_web").mustfixThrow("msg threadJid is null in encodeGroupInviteMessage");if(b==null)throw c("FBLogger")("messenger_web").mustfixThrow("DbGroupInvite is null in encodeGroupInviteMessage");var e=d("WAJids").interpretAsGroupJid(a.threadJid);if(e==null)throw c("FBLogger")("messenger_web").mustfixThrow("groupJid is null in encodeGroupInviteMessage");return{payload:{content:{groupInviteMessage:{groupJid:e,groupName:a.groupName,inviteCode:b.inviteCode,inviteExpiration:b.inviteExpirationTs}}}}}function K(a){return(h||(h=d("I64"))).equal(a.displayedContentTypes,(i||(i=d("LSIntEnum"))).ofNumber(1))||(h||(h=d("I64"))).equal(a.displayedContentTypes,(i||(i=d("LSIntEnum"))).ofNumber(256))||a.textHasLinks||a.isUnsent?L(a):null}function L(a){var b;b=(b=a.mentionIds)==null||(b=b.split(","))==null?void 0:b.map(d("MAWJids").toUserJid);return{payload:{content:{messageText:{mentionedJid:b!=null?b:[],text:a.text}}}}}function M(a,b){if(a.receiverFetchId==null)throw c("FBLogger")("messenger_web").mustfixThrow("Cannot generate receiver fetch message without receiver fetch id");if(b==null)throw c("FBLogger")("messenger_web").mustfixThrow("Cannot generate receiver fetch message without receiver fetch info");switch(b.type){case"sticker":return N(a,b);default:throw c("FBLogger")("messenger_web").mustfixThrow("Unsupported receiver fetch type: "+b.type)}}function N(a,b){if(a.receiverFetchId==null)throw c("FBLogger")("messenger_web").mustfixThrow("Cannot generate receiver fetch sticker message without receiver fetch id");a={ancillary:{height:b.previewHeight,isThirdParty:!1,receiverFetchId:a.receiverFetchId,width:b.previewWidth},integral:{receiverFetchId:a.receiverFetchId,transport:{ancillary:{mimetype:o,thumbnail:{thumbnailHeight:b.previewHeight,thumbnailWidth:b.previewWidth}},integral:{}}}};b=d("encodeProtobuf").encodeProtobuf(d("WAMediaTransport.pb").StickerTransportSpec,a);return{payload:{content:{stickerMessage:{sticker:{payload:b.readBuffer(),version:1}}}}}}g.IMAGE_MIME_TYPE=j;g.VIDEO_MIME_TYPE=k;g.AUDIO_WAV_MIME_TYPE=l;g.AUDIO_OGG_MIME_TYPE=m;g.GIF_MIME_TYPE=n;g.STICKER_MIME_TYPE=o;g.FILE_MIME_TYPE=p;g.emptyAudioFileArrayBuffer=q;g.asConsumerApplication=a;g.deletedMsgAsConsumerApplicationForSpamReporting=b;g.encodeConsumerApplicationMetadata=s;g.encodeMediaHdType=w;g.encodeValidatedMediaToImageTransport=x;g.encodeValidatedImageMessage=y;g.encodeEditMessage=e;g.encodeValidatedStickerMessage=B;g.encodeValidatedVideoMessage=E;g.encodeValidatedAudioMessage=H;g.encodeReactionMessage=f;g.asConsumerApplicationLSDb=K}),98);
__d("encodeMAWDocumentFileMessage",["MAWAsConsumerApplication","WAMediaTransport.pb","encodeProtobuf","validateMAWMediaAndComposeEntryForProtoMsg"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return h(a.msgId,b)}function h(a,b){a=d("validateMAWMediaAndComposeEntryForProtoMsg").validateMAWMediaAndComposeEntryForProtoMsg(a,b);b=a[0];a=a[1];return i(b,a)}function i(a,b){b={ancillary:{},integral:{transport:{ancillary:{fileLength:a.size,mimetype:d("MAWAsConsumerApplication").FILE_MIME_TYPE,objectId:b.objectId,thumbnail:{jpegThumbnail:new ArrayBuffer(1),thumbnailHeight:1,thumbnailWidth:1}},integral:{directPath:b.directPath,fileEncSha256:b.fileEncSha256,fileSha256:b.fileSha256,mediaKey:b.mediaKey,mediaKeyTimestamp:b.mediaKeyTimestamp}}}};b=d("encodeProtobuf").encodeProtobuf(d("WAMediaTransport.pb").DocumentTransportSpec,b);return{payload:{content:{documentMessage:{document:{payload:b.readBuffer(),version:1},fileName:(b=a.validatedDocumentFileInfo)==null?void 0:b.filename}}}}}g.encodeFileMessage=a;g.encodeValidatedFileMessage=i}),98);
__d("WAMsgIdToMessageKey",["WAGlobals","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.author,c=a.externalId;a=a.chat;var e=d("WAJids").isAuthorMe(b),f=d("WAJids").interpretAsGroupJid(a);b=e?d("WAGlobals").getMyUserJid():b;a=a;f=f!=null?b:void 0;return{fromMe:e,id:c,remoteJid:a,participant:f}}g.msgIdToMessageKey=a}),98);
__d("WAAsConsumerApplication",["WAAssertUnreachable","WAConsumerApplication.pb","WAMsgIdToMessageKey","WAMsgType","err"],(function(a,b,c,d,e,f,g){"use strict";b="image/jpeg";e="video/mp4";f="audio/wav";var h="image/gif",i="image/webp";function a(a){switch(a.type){case d("WAMsgType").MSG_TYPE.TEXT:return j(a);case d("WAMsgType").MSG_TYPE.REACTION:return k(a);case d("WAMsgType").MSG_TYPE.REVOKED:return l(a);default:return c("WAAssertUnreachable")(a.type)}}function j(a){var b={payload:{content:{messageText:{mentionedJid:[],text:a.msgContent.content}}}};if(a.specialTextSize!=null){a=a.specialTextSize===1?d("WAConsumerApplication.pb").CONSUMER_APPLICATION_METADATA_SPECIAL_TEXT_SIZE.SMALL:a.specialTextSize===2?d("WAConsumerApplication.pb").CONSUMER_APPLICATION_METADATA_SPECIAL_TEXT_SIZE.MEDIUM:d("WAConsumerApplication.pb").CONSUMER_APPLICATION_METADATA_SPECIAL_TEXT_SIZE.LARGE;b.metadata={specialTextSize:a}}return b}function k(a){if(a.reactToMsgId==null)throw c("err")("cannot send reaction that reacts to no message");var b=d("WAMsgIdToMessageKey").msgIdToMessageKey(a.reactToMsgId);b={groupingKey:a.groupingKey==null?void 0:a.groupingKey,key:b,senderTimestampMs:a.ts,text:a.reaction==null?void 0:a.reaction};return{payload:{content:{reactionMessage:b}}}}function l(a){a={remoteJid:a.id.chat,fromMe:!0,id:a.revokedExternalId};return{payload:{applicationData:{revoke:{key:a}}}}}g.IMAGE_MIME_TYPE=b;g.VIDEO_MIME_TYPE=e;g.AUDIO_MIME_TYPE=f;g.GIF_MIME_TYPE=h;g.STICKER_MIME_TYPE=i;g.asConsumerApplication=a;g.encodeTextMessage=j;g.encodeReactionMessage=k}),98);
__d("WAFrankingTypes",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}function b(a){return a}f.castToFrankingTag=a;f.castToFrankingKey=b}),66);
__d("WAFranking",["$InternalEnum","WACryptoDependencies","WACryptoHmac","WACryptoUtils","WAFrankingTypes","WAGlobals","WAPREList","WAPREMetrics"],(function(a,b,c,d,e,f,g){"use strict";var h=32,i=0,j=b("$InternalEnum").Mirrored(["KEEP","DROP"]);function a(){var a=new Uint8Array(h);d("WACryptoDependencies").getCrypto().getRandomValues(a);return d("WAFrankingTypes").castToFrankingKey(a)}function c(a){return a!=null?a:i}function e(a,b){return d("WACryptoHmac").hmacSha256(a,b).then(function(a){return d("WAFrankingTypes").castToFrankingTag(new Uint8Array(a))})}async function k(a,b,c,e){switch(e){case void 0:case 0:e=await d("WACryptoHmac").hmacSha256(b,a);return d("WACryptoUtils").uint8ArraysEqual(new Uint8Array(e),c);default:return!0}}async function f(a,b){var c;if(!d("WAGlobals").getConfig().isFrankingEnabled()||a.version==="v3"&&a.type==="instamadillo")return{decision:j.KEEP,updatedReportingMeta:b};var e=d("WAGlobals").getConfig().isFrankingDropOnInvalid();if((b==null?void 0:b.frankingTag)!=null&&((c=a.metadata)==null?void 0:c.frankingKey)==null){b.frankingTag=null;b.reportingTag=null;return{decision:j.KEEP,updatedReportingMeta:b}}if((b==null?void 0:b.frankingTag)!=null&&a.version==="v3"&&a.type==="subprotocol"&&((c=a.metadata)==null?void 0:c.frankingKey)!=null&&a.frankingContent!=null){c=b.frankingTag;var f=a.frankingContent,g=a.metadata.frankingVersion;a=d("WAFrankingTypes").castToFrankingKey(new Uint8Array(a.metadata.frankingKey));var h=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.FRANKING_VALIDATION);if(a==null){h.endFail("tagButNoKey");return e?{decision:j.DROP,updatedReportingMeta:b}:{decision:j.KEEP,updatedReportingMeta:b}}if(!await k(new Uint8Array(f),a,c,g)){h.endFail("tagMismatch");return e?{decision:j.DROP,updatedReportingMeta:b}:{decision:j.KEEP,updatedReportingMeta:b}}b.frankingKey=a;b.reportingContent=f;h.endSuccess();return{decision:j.KEEP,updatedReportingMeta:b}}return d("WAGlobals").getConfig().isFrankingDropOnMissing()?{decision:j.DROP,updatedReportingMeta:b}:{decision:j.KEEP,updatedReportingMeta:b}}g.FrankingDecision=j;g.createFrankingKey=a;g.getFrankingVersion=c;g.genFrankingTag=e;g.validateFrankingTag=k;g.handleAndValidateFrankingFromIncomingMsg=f}),98);
__d("WAAsMessageApplication",["WAAsConsumerApplication","WAConsumerApplication.pb","WAFranking","WAMsgApplication.pb","encodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b;switch(a.type){default:b=d("WAAsConsumerApplication").asConsumerApplication(a)}var c=a.forwardingScore!=null?a.forwardingScore:0;a=a.isForwarded!=null?a.isForwarded:!1;c={metadata:{chatEphemeralSetting:null,forwardingScore:c,frankingKey:d("WAFranking").createFrankingKey(),frankingVersion:d("WAFranking").getFrankingVersion(),isForwarded:a,quotedMessage:null}};if(b!=null){a=d("encodeProtobuf").encodeProtobuf(d("WAConsumerApplication.pb").ConsumerApplicationSpec,b);c.payload={subProtocol:{consumerMessage:{payload:a.readBuffer(),version:1}}}}return d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,c).readByteArrayView()}function b(a){return a}function c(a){return a.buffer}g.asMessageApplication=a;g.castToMessageApplicationBytes=b;g.castMessageApplicationBytesToBytes=c}),98);
__d("MAWAsMessageApplication",["I64","LSIntEnum","LSMessageReplySourceTypeV2","MAWAsArmadilloApplication","MAWAsConsumerApplication","MAWJids","MAWMsgType","WAArmadilloApplication.pb","WAAsMessageApplication","WAConsumerApplication.pb","WAFranking","WAGlobals","WAJids","WAMsgApplication.pb","encodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,b,c,e,f,g){return d("WAAsMessageApplication").castToMessageApplicationBytes(d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,j(a,b,c,e,f,g)).readByteArrayView())}function j(a,b,c,e,f,g){var h,i;switch(a.type){case d("MAWMsgType").MSG_TYPE.RAVEN_ACTION:h=d("MAWAsArmadilloApplication").asArmadilloApplication(a);break;case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:h=d("MAWAsArmadilloApplication").asArmadilloApplication(a,void 0,f);break;case d("MAWMsgType").MSG_TYPE.XMA:h=d("MAWAsArmadilloApplication").asArmadilloApplication(a,e);break;default:i=d("MAWAsConsumerApplication").asConsumerApplication(a,b,c,g)}var j,k;f=a.forwardingScore!=null?a.forwardingScore:0;e=a.isForwarded!=null?a.isForwarded:!1;if(a.quote!=null){b=a.quote;j={participant:b.content.author===d("WAJids").AUTHOR_ME?d("WAGlobals").getMyDeviceJid():b.content.author,stanzaId:b.content.externalId}}if(a.ephemeralSetting){c=a.ephemeralSetting;a.type===d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE?k={ephemeralExpiration:c.ephemeralExpirationInSec,isEphemeralSettingReset:a.isEphemeralSettingReset}:k={ephemeralExpiration:c.ephemeralExpirationInSec,ephemeralSettingTimestamp:c.ephemeralLastUpdatedOrSetTimestamp*1e3}}g={metadata:{chatEphemeralSetting:k,forwardingScore:f,frankingKey:o(a.reportingMeta),frankingVersion:d("WAFranking").getFrankingVersion(),groupId:a.groupId,groupIndex:a.groupIndex,groupSize:a.groupSize,isForwarded:e,quotedMessage:j}};if(i!=null){b=d("encodeProtobuf").encodeProtobuf(d("WAConsumerApplication.pb").ConsumerApplicationSpec,i);g.payload={subProtocol:{consumerMessage:{payload:b.readBuffer(),version:1}}}}else if(h!=null){c=d("encodeProtobuf").encodeProtobuf(d("WAArmadilloApplication.pb").ArmadilloSpec,h);g.payload={subProtocol:{armadillo:{payload:c.readBuffer(),version:1}}}}return g}function b(a){var b=d("MAWAsConsumerApplication").asConsumerApplicationLSDb(a),e,f,g=a.isForwarded!=null?a.isForwarded:!1,j=g?1:0;a.replySourceTypeV2&&!(h||(h=d("I64"))).equal(a.replySourceTypeV2,(i||(i=d("LSIntEnum"))).ofNumber(c("LSMessageReplySourceTypeV2").NONE))&&a.replyToUserId!=null&&(e={participant:a.replyToUserId===d("WAJids").AUTHOR_ME?d("WAGlobals").getMyDeviceJid():d("MAWJids").toUserJid((h||(h=d("I64"))).to_string(a.replyToUserId)),stanzaId:a.messageId});j={metadata:{chatEphemeralSetting:f,forwardingScore:j,frankingKey:d("WAFranking").createFrankingKey(),frankingVersion:d("WAFranking").getFrankingVersion(),groupId:(j=a==null?void 0:a.groupId)!=null?j:void 0,groupIndex:a.groupIndex!=null?(h||(h=d("I64"))).to_float(a.groupIndex):void 0,groupSize:a.groupSize!=null?(h||(h=d("I64"))).to_float(a.groupSize):void 0,isForwarded:g,quotedMessage:e}};if(b!=null){a=d("encodeProtobuf").encodeProtobuf(d("WAConsumerApplication.pb").ConsumerApplicationSpec,b);j.payload={subProtocol:{consumerMessage:{payload:a.readBuffer(),version:1}}}}return j}function e(a){return d("WAAsMessageApplication").castToMessageApplicationBytes(d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,k(a)).readByteArrayView())}function k(a){a=d("MAWAsConsumerApplication").encodeReactionMessage(a);a=d("encodeProtobuf").encodeProtobuf(d("WAConsumerApplication.pb").ConsumerApplicationSpec,a);return{metadata:{frankingKey:d("WAFranking").createFrankingKey(),frankingVersion:d("WAFranking").getFrankingVersion()},payload:{subProtocol:{consumerMessage:{payload:a.readBuffer(),version:1}}}}}function f(a){var b=d("MAWAsArmadilloApplication").encodeNoteReplyMessage(a);if(b==null)return{metadata:{frankingKey:d("WAFranking").createFrankingKey(),frankingVersion:d("WAFranking").getFrankingVersion()}};a=a.ephemeralSetting;a=a?{ephemeralExpiration:a.ephemeralExpirationInSec,ephemeralSettingTimestamp:a.ephemeralLastUpdatedOrSetTimestamp*1e3}:void 0;b=d("encodeProtobuf").encodeProtobuf(d("WAArmadilloApplication.pb").ArmadilloSpec,b);return{metadata:{chatEphemeralSetting:a,frankingKey:d("WAFranking").createFrankingKey(),frankingVersion:d("WAFranking").getFrankingVersion()},payload:{subProtocol:{armadillo:{payload:b.readBuffer(),version:1}}}}}function l(a){return d("WAAsMessageApplication").castToMessageApplicationBytes(d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,m(a)).readByteArrayView())}function m(a){a=d("MAWAsConsumerApplication").encodeEditMessage(a);a=d("encodeProtobuf").encodeProtobuf(d("WAConsumerApplication.pb").ConsumerApplicationSpec,a);return{metadata:{frankingKey:d("WAFranking").createFrankingKey(),frankingVersion:d("WAFranking").getFrankingVersion()},payload:{subProtocol:{consumerMessage:{payload:a.readBuffer(),version:1}}}}}function n(a,b){var c;b=d("MAWAsConsumerApplication").deletedMsgAsConsumerApplicationForSpamReporting(a,b);if(b==null)return null;b=d("encodeProtobuf").encodeProtobuf(d("WAConsumerApplication.pb").ConsumerApplicationSpec,b);return{metadata:{frankingKey:o(a.reportingMeta),frankingVersion:((c=a.reportingMeta)==null?void 0:c.frankingVersion)!=null?(c=a.reportingMeta)==null?void 0:c.frankingVersion:d("WAFranking").getFrankingVersion()},payload:{subProtocol:{consumerMessage:{payload:b.readBuffer(),version:1}}}}}function o(a){if((a==null?void 0:a.frankingKey)!=null)return a.frankingKey;else return d("WAFranking").createFrankingKey()}g.encodeMessageApplication=a;g.asMessageApplication=j;g.asMessageApplicationLSDb=b;g.encodeReactionMessageApplication=e;g.asReactionMessageApplication=k;g.asNoteReplyMessageApplication=f;g.encodeEditMessageApplication=l;g.asEditMessageApplication=m;g.deletedMsgAsMessageApplicationForSpamReporting=n}),98);
__d("MAWXMAEncodeUtils",["MAWAsConsumerApplication","MAWAsMessageApplication","MAWMsgType","MAWParseSubprotocolVersionConsts","MAWVault","WALogger","WAMsgApplication.pb","encodeProtobuf","validateMAWMediaAndComposeEntryForProtoMsg"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b,c){a=d("validateMAWMediaAndComposeEntryForProtoMsg").validateMAWMediaAndComposeEntryForProtoMsg(a,b);b=a[0];a=a[1];return{payload:d("MAWAsConsumerApplication").encodeValidatedMediaToImageTransport(b,a),version:c}}function a(a,b){var c=a.msgContent,e=a.msgId;a=c||{};c=a.commands;var f=a.content;a=a.mentionedJids;var g=b.associatedMessage,j=b.favicon,k=b.header,l=b.previews;b=b.xma;var m=null;if(g!=null)if(g.type!==d("MAWMsgType").MSG_TYPE.TEXT)d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Non-text associated message for the XMA content is not supported"])));else{g=d("MAWAsMessageApplication").asMessageApplication(g);g=d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,g);m={payload:g.readBuffer(),version:d("MAWParseSubprotocolVersionConsts").ASSOCIATED_MESSAGE_SUBPROTOCOL_VERSION}}g=k!=null&&e!=null?i(e,k,d("MAWParseSubprotocolVersionConsts").XMA_HEADER_SUBPROTOCOL_VERSION):null;k=j!=null&&e!=null?i(e,j,d("MAWParseSubprotocolVersionConsts").XMA_FAVICON_SUBPROTOCOL_VERSION):null;j=l!=null&&e!=null?l.map(function(a){return i(e,a,d("MAWParseSubprotocolVersionConsts").XMA_PREVIEW_SUBPROTOCOL_VERSION)}):null;l=b.defaultCTA==null?void 0:[b.defaultCTA].concat(b.ctas).filter(Boolean);return{payload:{content:{extendedContentMessage:{associatedMessage:m!=null?m:void 0,commands:c,contentRef:b.contentRef,ctas:l,favicon:k!=null?k:void 0,headerImage:g!=null?g:void 0,headerTitle:b.headerTitle,maxSubtitleNumOfLines:b.maxSubtitleNumOfLines,maxTitleNumOfLines:b.maxTitleNumOfLines,mentionedJid:a,messageText:f==null?void 0:d("MAWVault").unvault(f),overlayDescription:b.overlayDescription,overlayIconGlyph:b.overlayIconGlyph,overlayTitle:b.overlayTitle,previews:j!=null?j:[],sentWithMessageId:m?b.externalId:void 0,subtitleText:b.subtitleText,targetExpiringAtSec:b.targetExpiringAtSec,targetId:b.targetId,targetType:b.targetType,targetUsername:b.targetUsername,titleText:b.titleText,xmaDataclass:b.xmaDataclass,xmaLayoutType:b.xmaLayoutType}}}}}g.encodeXMA=a}),98);
__d("MAWBuildIncomingMsgs",["MAWAckLevel","MAWDbMsg","MAWMsgType","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h=6*d("WATimeUtils").HOUR_SECONDS;function a(a,b){var c=a.author;a=a.externalId;return{ack:d("MAWAckLevel").ACK.received,altIndex:void 0,author:c,externalId:a,serverTs:b,ts:b,type:d("MAWMsgType").MSG_TYPE.CIPHERTEXT}}function b(a,b){var c=a.author;a=a.externalId;return{ack:d("MAWAckLevel").ACK.failed,altIndex:void 0,author:c,externalId:a,serverTs:b,ts:b,type:d("MAWMsgType").MSG_TYPE.UNAVAILABLE}}function c(a,b){var c;return{ack:a.ack,author:a.author,externalId:a.externalId,messageDeleteForMeTs:d("WATimeUtils").castToUnixTime(d("WATimeUtils").unixTime()+h),msgContent:(c=d("MAWDbMsg").getMsgContent(a))==null?void 0:c.content,threadJid:b.jid,ts:a.ts,type:d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME}}function e(a,b,c){return{ack:a.ack,altIndex:void 0,author:a.author,externalId:c.externalId,msgContent:d("MAWDbMsg").getMsgContent(a),originalTs:a.ts,revokedExternalId:c.revokedExternalId,threadJid:b.jid,ts:c.ts,type:d("MAWMsgType").MSG_TYPE.REVOKED,unsendMsgContentDeleteTs:d("WATimeUtils").castToUnixTime(d("WATimeUtils").unixTime()+h)}}g.REVOKE_CONTENT_EXPIRATION_IN_SEC=h;g.buildUnstoredCiphertextMsg=a;g.buildUnstoredUnavailableMsg=b;g.buildUnstoredDeleteForMeMsg=c;g.buildUnstoredRevokedMsg=e}),98);
__d("MAWDbEditMsgHistoryTxns",["MAWAckLevel","MAWDbEditMsgHistory","MAWDexieTable","MAWVault","MWFBLogger","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=d("MWFBLogger").MWLogger.tags(["maw_db","txn","MAWDbEditMsgHistoryTxns"]);function a(a,b){var c=[];if(b.length===0)return d("MAWDexieTable").dexieResolve(c);b=b.filter(function(a){return a.editCount!=null&&a.editCount>0});var e=b.map(function(a){return[a.externalId,a.threadJid]});if(e.length===0)return d("MAWDexieTable").dexieResolve([]);var f=b.reduce(function(a,b){b.msgId!=null&&a.set(b.externalId,b.msgId);return a},new Map()),g=b.reduce(function(a,b){b.msgId!=null&&a.set(b.externalId,b);return a},new Map());return m(a,e).then(function(a){if(a.length===0){l.MUSTFIX(h||(h=babelHelpers.taggedTemplateLiteralLoose(["No edit history found for the messages despite there being an editCount greater than 0"])));return[]}for(a of a){var b=f.get(a.originalMsgExternalId);b!=null&&c.push(babelHelpers["extends"]({},a,{editMsgHistoryId:d("MAWDbEditMsgHistory").convertToEditMsgHistoryId64(a.editMsgHistoryId),originalMsgId:b}));b=g.get(a.originalMsgExternalId);b!=null&&(a.threadJid!==b.threadJid&&l.MUSTFIX(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Edit history threadJid does not match original message threadJid"]))))}return c})}function m(a,b){return a.editMsgHistory.where(["originalMsgExternalId","threadJid"]).anyOf(b).toArray()}function b(a,b){return b==null?d("MAWDexieTable").dexieResolve():a.editMsgHistory.get({editMsgHistoryId:b})}function e(a,b,c){return a.editMsgHistory.where("originalMsgExternalId").equals(c).filter(function(a){return a.editExternalId===b.externalId&&a.author===b.author&&a.threadJid===b.chat}).toArray().then(function(a){if(a.length>1){var b=a.map(function(a){return""+a.editTs.toString()});b=new Set(b).size===1;!b?l.MUSTFIX(j||(j=babelHelpers.taggedTemplateLiteralLoose(["[getEditHistoryMsgByEditedProtocolMsgId] Can't have "," messages with the same editExternalId!"])),a.length):l.MUSTFIX(k||(k=babelHelpers.taggedTemplateLiteralLoose(["[getEditHistoryMsgByEditedProtocolMsgId] Suspected multiple instances of same message!"])))}return a[0]})}function f(a,b){return b==null?d("MAWDexieTable").dexieResolve([]):a.editMsgHistory.where("originalMsgExternalId").equals(b.externalId).filter(function(a){return a.author===b.author&&a.threadJid===b.chat}).toArray().then(function(a){var b=[];a.forEach(function(a){if(a==null)return;b.push(a)});return b})}function n(a,b){return a.editMsgHistory.bulkGet(b)}function o(a,b){return a.editMsgHistory.bulkAdd(b,{allKeys:!0}).then(function(a){return d("MAWDexieTable").dexieResolve(a)})}function p(a,b,c,d){return d.then(function(d){return q(a,b,c,d)})}function q(a,b,c,e){var f=[];return a.editMsgHistory.where("originalMsgExternalId").equals(b).filter(function(a){return a.threadJid===e&&a.author===c&&(a.sendStatus==null||a.sendStatus>=d("MAWAckLevel").ACK.sent)}).toArray().then(function(a){a.forEach(function(a){f.push({messageId:a.editExternalId,originalMessageId:a.originalMsgExternalId,text:d("MAWVault").unvault(a.msgContent.content),timestamp:a.editTs})});return f})}function r(a,b,d,e){return a.editMsgHistory.where("originalMsgExternalId").equals(b).filter(function(a){return a.threadJid===e&&a.author===d})["delete"]().then(c("emptyFunction"))}var s=function(a,b){return a.editMsgHistory.where(["originalMsgExternalId","threadJid"]).anyOf(b)["delete"]().then(function(){return d("MAWDexieTable").dexieResolve(b.length)})};function t(a,b,c){return a.editMsgHistory.put(babelHelpers["extends"]({},b,{msgContent:c.msgContent})).then(function(){})}g.loadEditMsgHistory=a;g.getEditHistoryByOriginalMsgExternalIdAndThreadJid=m;g.maybeGetEditMsgHistoryFromEditMsgHistoryId=b;g.getEditHistoryMsgByEditedProtocolMsgId=e;g.maybeGetEditMsgHistoryFromProtocolMsgId=f;g.bulkGetEditMsgHistorys=n;g.bulkAddEditMsgHistory=o;g.getEditHistoryAsEchoWithJidPromise=p;g.getEditHistoryAsEcho=q;g.bulkRemoveEditHistory=r;g.deleteExpiredEditMsgHistory=s;g.updateEditMsgHistoryWithNewIncomingMsg=t}),98);
__d("MAWDbPendingStanza",["WAAssertUnreachable"],(function(a,b,c,d,e,f,g){"use strict";var h="revoked",i="deleteForMe",j="deleteThread";b="Revoked";d="DeleteForMe";e="DeleteThread";f={DELETE_FOR_ME:d,DELETE_THREAD:e,REVOKED:b};function a(a){switch(a){case"Revoked":return h;case"DeleteForMe":return i;case"DeleteThread":return j;default:return c("WAAssertUnreachable")(a)}}g.PENDING_REVOKED=h;g.PENDING_DELETE_FOR_ME=i;g.REVOKED=b;g.DELETE_FOR_ME=d;g.PENDING_TYPE=f;g.getPendingSuffix=a}),98);
__d("MAWDeleteThreadUtil",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b=[];a.forEach(function(a){if(a.pendingContent.type==="DeleteThread"){a=a.pendingContent.content.metaSyncMessageRange.lastMessageTimestamp;a!=null&&b.push(a)}});if(b.length===0)return null;b.sort(function(a,b){return b-a});a=b[0];return{lastMessageTimestamp:a}}function b(a,b){return b!=null&&b.lastMessageTimestamp>=a}f.getLatestDeleteThreadInfo=a;f.isMsgDeletedViaDeleteThread=b}),66);
__d("MAWMsgCleaner",["MAWLoggerUtils","MWFBLogger","Promise","WAAssertUnreachable","WAShiftTimer","WATimeUtils","WorkerScheduler","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;a="Unsend";e="Ephemeral";f="DeleteForMe";var l="PendingStanza",m="Xma",n="IGDDM",o="Quote",p=d("MWFBLogger").MWLogger.tags([d("MAWLoggerUtils").Tag.MsgCleaner,d("MAWLoggerUtils").Tag.CleanerUpdate]);f={DELETE_FOR_ME:f,EPHEMERAL:e,IGDDM:n,PENDING_STANZA:l,QUOTE:o,UNSEND:a,XMA:m};var q;function r(){q==null&&(q=d("WorkerScheduler").makeScheduler("cleaner",{concurrency:1,maxConcurrency:1,maxThrottleMs:8e3}));return q}e=function(){function a(a,b){var e=this;this.$1=new(d("WAShiftTimer").ShiftTimer)(function(){c("promiseDone")(e.$2())});this.getNextTs=a.getNextTs;this.removeExpired=a.removeExpired;this.cleanerType=b;this.purgeEnabled=a.purgeEnabled;this.$1.forceRunNow()}var e=a.prototype;e.update=function(a){var b=s(this.cleanerType);p.DEBUG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["","::update ",""])),b,a);this.$1.onOrBefore(d("WATimeUtils").cappedMillisecondsUntil(a))};e.$2=function(){var a=this,c=function(){if(!a.purgeEnabled())return(k||(k=b("Promise"))).resolve();var c=s(a.cleanerType);p.DEBUG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["","::_purgeNow"])),c);return a.removeExpired().then(function(b){b>0&&p.DEBUG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["","::_purgeNow "," msgs' content cleaned"])),c,b);return a.getNextTs()}).then(function(b){b!=null&&a.update(b)})};if(this.$3!=null)return(k||(k=b("Promise"))).resolve();this.$3=r().task({fn:c,name:this.cleanerType,priority:d("WorkerScheduler").BACKGROUND_PRIORITY});return this.$3.run()["finally"](function(){a.$3=null})};return a}();function s(a){switch(a){case"Unsend":return"UnsendMsgCleaner";case"Ephemeral":return"EphemeralCleaner";case"DeleteForMe":return"DeleteForMeCleaner";case"PendingStanza":return"PendingStanzaCleaner";case"Xma":return"XmaCleaner";case"IGDDM":return"IGDDisappearingMsgCleaner";case"Quote":return"QuoteCleaner";default:return c("WAAssertUnreachable")(a)}}n=e;g.CLEANER_TYPE=f;g.MsgCleaner=e;g.MSG_CLEANER_FOR_TESTING_ONLY=n}),98);
__d("MAWPendingStanzaCleaner",["FBLogger","MAWMsgCleaner","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=null;function a(a){j==null&&(j=new(d("MAWMsgCleaner").MsgCleaner)(a,d("MAWMsgCleaner").CLEANER_TYPE.PENDING_STANZA))}function b(a){if(j==null){var b="Trying to add new PendingStanzaCleanerTimestamp before the cleaner is initialized!";d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["",""])),b);throw c("FBLogger")("messenger_web").mustfixThrow(b)}else d("WALogger").DEV(i||(i=babelHelpers.taggedTemplateLiteralLoose(["PendingStanzaCleaner: Adding timestamps (",")"])),a),j.update(a)}function e(){return j}function f(){j=null}g.startPendingStanzaCleaner=a;g.addNewPendingStanzaCleanerTimestamp=b;g.getPendingStanzaCleaner_FOR_TESTING_ONLY=e;g.resetPendingStanzaCleaner_FOR_TESTING_ONLY=f}),98);
__d("MAWDbPendingStanzaTxns",["MAWDbPendingStanza","MAWDeleteThreadUtil","MAWPendingStanzaCleaner","WAJids","WATimeUtils","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b,c,e,f){var g=d("MAWDbPendingStanza").getPendingSuffix(f);return a.pendingStanzas.where("externalIdWithType").equals(b+"_"+g).filter(function(a){a=a.pendingContent;return a.type===f&&a.content.author===c&&a.content.threadJid===e}).first()}function a(a,b,c,e){return h(a,b,c,e,d("MAWDbPendingStanza").PENDING_TYPE.REVOKED)}function b(a,b,c,e){return h(a,b,c,e,d("MAWDbPendingStanza").PENDING_TYPE.DELETE_FOR_ME)}function e(a,b){var e=b.map(function(a){a=a.expirationInSeconds;return d("WATimeUtils").castToUnixTime(d("WATimeUtils").unixTime()+a)});b=b.map(function(a,b){var c=a.content,f=a.externalId;a=a.pendingStanzaType;return{deleteTs:e[b],externalIdWithType:f+"_"+d("MAWDbPendingStanza").getPendingSuffix(a),pendingContent:c}});return a.pendingStanzas.bulkAdd(b).then(function(){return e.forEach(d("MAWPendingStanzaCleaner").addNewPendingStanzaCleanerTimestamp)}).then(c("emptyFunction"))}function f(a,b,c,e,f){f=d("MAWDbPendingStanza").getPendingSuffix(f);var g=d("WATimeUtils").castToUnixTime(d("WATimeUtils").unixTime()+c);c={deleteTs:g,externalIdWithType:e+"_"+f,pendingContent:b};return a.pendingStanzas.add(c).then(function(){d("MAWPendingStanzaCleaner").addNewPendingStanzaCleanerTimestamp(g)})}function i(a,b){var c=d("MAWDbPendingStanza").getPendingSuffix(d("MAWDbPendingStanza").PENDING_TYPE.DELETE_THREAD);return a.pendingStanzas.where("externalIdWithType").equals(b+"_"+c).toArray().then(function(a){return d("MAWDeleteThreadUtil").getLatestDeleteThreadInfo(a)})}function j(a){return a.pendingStanzas.toArray()}function k(a,b){b=b.map(function(a){return a.rowId});return a.pendingStanzas.bulkDelete(b)}function l(a){var b,c;return(a==null||(b=a.pendingContent)==null?void 0:b.type)===d("MAWDbPendingStanza").PENDING_TYPE.REVOKED?a==null||(c=a.pendingContent)==null?void 0:c.content:null}function m(a,b){var c=d("MAWDbPendingStanza").getPendingSuffix(d("MAWDbPendingStanza").PENDING_TYPE.DELETE_THREAD);b=b.map(function(a){return a+"_"+c});return a.pendingStanzas.where("externalIdWithType").anyOf(b).toArray().then(function(a){a=a.reduce(function(a,b){var c=a.get(b.externalIdWithType);c==null?a.set(b.externalIdWithType,[b]):c.push(b);return a},new Map());var b=new Map();a.forEach(function(a,c){c=d("WAJids").unsafeCoerceToChatJid(c.split("_")[0]);a=d("MAWDeleteThreadUtil").getLatestDeleteThreadInfo(a);a!=null&&b.set(c,a)});return b})}g.maybeGetPendingStanzaByExternalId=h;g.maybeGetPendingRevokedStanza=a;g.maybeGetPendingDeletedStanza=b;g.bulkPutPendingStanzas=e;g.putPendingStanza=f;g.maybeGetDeleteThreadFromPendingStanza=i;g.getAllPendingStanzas=j;g.deletePendingStanzas=k;g.getRevokedContent=l;g.bulkGetDeleteThreadPendingStanzas=m}),98);
__d("MAWDeleteForMeMsgContentCleaner",["FBLogger","MAWMsgCleaner","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=null;function a(a){j==null&&(j=new(d("MAWMsgCleaner").MsgCleaner)(a,d("MAWMsgCleaner").CLEANER_TYPE.DELETE_FOR_ME))}function b(a){if(j==null){var b="Trying to add new DeleteForMeContentCleanerTimestamp before the cleaner is initialized!";d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["",""])),b);throw c("FBLogger")("messenger_web").mustfixThrow(b)}else d("WALogger").DEV(i||(i=babelHelpers.taggedTemplateLiteralLoose(["DeleteForMeMsgContentCleaner: Adding timestamps (",")"])),a),j.update(a)}function e(){return j}function f(){j=null}g.startDeleteForMeMsgContentCleaner=a;g.addNewDeleteForMeMsgContentCleanerTimestamp=b;g.getDeleteForMeMsgContentCleaner_FOR_TESTING_ONLY=e;g.resetDeleteForMeMsgContentCleaner_FOR_TESTING_ONLY=f}),98);
__d("MAWBridgeMsgCountdown",["MAWDbMsg","MAWLoggerUtils","MWFBLogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=d("MWFBLogger").MWLogger.tags(["bridge",d("MAWLoggerUtils").Tag.Countdown]);function a(a){return{msgs:a.map(function(a){var b,c=a.messageExpirationTs;b=(b=a.ephemeralSetting)==null?void 0:b.ephemeralExpirationInSec;if(c==null||b==null)return;var e=d("WATimeUtils").cappedMillisecondsUntil(c);if(e<=0){j.DEBUG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Calling the messages starting countdown bridge event with remaning time less or equal to 0 (expired message)"])));return}var f=b*1e3;e>f&&(e=f);j.DEBUG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["createBridgeMsgsStartCountdown: msg ",", expiration ",", ms until countdown ",", duration ",""])),a.msgId,c,e,b);return{countdownTs:c,millisecondsUntilCountdownTs:e,msgId:a.msgId,threadJid:a.threadJid,ts:d("MAWDbMsg").getCanonicalTsFromMsg(a)}}).filter(Boolean)}}function b(a,b){return{countdownTs:b,msgId:a}}g.createBridgeMsgsStartCountdown=a;g.createBridgeMsgClearCountdown=b}),98);
__d("MAWEphemeralCleaner",["MAWLoggerUtils","MAWMsgCleaner","MWFBLogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i=null,j=d("MWFBLogger").MWLogger.tags([d("MAWLoggerUtils").Tag.Ephemeral,d("MAWLoggerUtils").Tag.MsgCleaner,d("MAWLoggerUtils").Tag.CleanerTimestamp,"backend"]);function a(a){var b=a.backendFns;a=a.uiFns;if(i==null){var c;i={backend:new((c=d("MAWMsgCleaner")).MsgCleaner)(b,c.CLEANER_TYPE.EPHEMERAL),ui:new c.MsgCleaner(a,c.CLEANER_TYPE.EPHEMERAL)}}}function b(a,b){if(i==null)throw j.mustfixThrow("Trying to add new ephemeral timestamp before the cleaner is initialized!");else{var c=i,d=c.backend;c=c.ui;j.DEBUG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["EphemeralCleaner: Adding timestamps for UI(",") and backend(",")"])),a,b);c.update(a);d.update(b)}}function c(){return i}function e(){i=null}g.startEphemeralCleaner=a;g.addNewEphemeralTimestamp=b;g.getEphemeralCleaner_FOR_TESTING_ONLY=c;g.resetEphemeralCleaner_FOR_TESTING_ONLY=e}),98);
__d("MAWEphemeralSettingsCache",["MAWBridge","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h=new Map();function i(a,b){h.set(a,b)}function a(a){var b={ephemeralExpirationInSec:0,ephemeralLastUpdatedOrSetTimestamp:d("WATimeUtils").castToUnixTime(0)};return(a=h.get(a))!=null?a:b}async function b(a){var b={ephemeralExpirationInSec:0,ephemeralLastUpdatedOrSetTimestamp:d("WATimeUtils").castToUnixTime(0)};if(!h.has(a)){var c=await d("MAWBridge").getBridge().sendAndReceive("event","getLSDBEphemeralSetting",{chatJid:a});i(a,c!=null?c:b)}}g.setEphemeralSettingCache=i;g.getEphemeralSettingCache=a;g.requestLSDBCacheForJid=b}),98);
__d("MAWEphemeralUtil",["FBLogger","MAWAckLevel","MAWBridgeMsgCountdown","MAWExternalId","MAWIndexedDb","MAWLocalizationType","MAWMsgType","WAArmadilloApplication.pb","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,b){var c=b.ephemeralExpirationInSec!==a.ephemeralExpirationInSec&&b.ephemeralLastUpdatedOrSetTimestamp===a.ephemeralLastUpdatedOrSetTimestamp;return c||a.ephemeralLastUpdatedOrSetTimestamp>b.ephemeralLastUpdatedOrSetTimestamp}function b(a,b,c){if(a==null)return!0;a=a.ephemeralSetting;if(a!=null&&a.ephemeralExpirationInSec===b){d("WALogger").DEV(h||(h=babelHelpers.taggedTemplateLiteralLoose(["New ephemeral duration should be different from the existing duration"])));return!1}if(a!=null&&a.ephemeralLastUpdatedOrSetTimestamp>c){d("WALogger").DEV(i||(i=babelHelpers.taggedTemplateLiteralLoose(["The new ephemeral setting timestamp should be greater than the existing timestamp"])));return!1}return!0}function e(a){a={ack:d("MAWAckLevel").ACK.sent,altIndex:void 0,author:d("WAJids").AUTHOR_SYSTEM,externalId:d("MAWExternalId").generateExternalId(),msgContent:{adminMsgContent:[],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_MINUTES},ts:a,type:d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN};return{unstoredDbMedia:null,unstoredDbMsg:a,unstoredDbReaction:null}}function f(a,b){var e;switch(b){case d("WAArmadilloApplication.pb").ARMADILLO_CONTENT_SCREENSHOT_ACTION_SCREENSHOT_TYPE.SCREENSHOT_IMAGE:e=d("WAArmadilloApplication.pb").ARMADILLO_CONTENT_SCREENSHOT_ACTION_SCREENSHOT_TYPE.SCREENSHOT_IMAGE;break;case d("WAArmadilloApplication.pb").ARMADILLO_CONTENT_SCREENSHOT_ACTION_SCREENSHOT_TYPE.SCREEN_RECORDING:e=d("WAArmadilloApplication.pb").ARMADILLO_CONTENT_SCREENSHOT_ACTION_SCREENSHOT_TYPE.SCREEN_RECORDING;break;default:throw c("FBLogger")("messenger_web").mustfixThrow("Received unexpected screenshot action type")}b={ack:d("MAWAckLevel").ACK.sent,altIndex:void 0,author:d("WAJids").AUTHOR_SYSTEM,externalId:d("MAWExternalId").generateExternalId(),msgContent:{adminMsgContent:[],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_TAKE_SCREENSHOT,screenshotActionType:e},ts:a,type:d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION};return{unstoredDbMedia:null,unstoredDbMsg:b,unstoredDbReaction:void 0}}function j(a){return d("WAJids").switchOnMsgrChatJidType(a,{group:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("Received invalid chatJid. We only support ephemeral messaging in 1:1 threads.")},user:function(a){return a}})}function k(a){a!=null&&a.messageExpirationTs!=null&&a.ephemeralCounterStarted===!0&&d("MAWIndexedDb").afterTransaction({tag:"MsgClearCountdown",value:d("MAWBridgeMsgCountdown").createBridgeMsgClearCountdown(a.msgId,a.messageExpirationTs)})}g.isLocalSettingOutdated=a;g.shouldUpdateForOutgoingUserEphemeralSettingChange=b;g.buildUnstoredDbEphemeralSettingMsgWithoutContentPlaceholder=e;g.buildUnstoredDbEphemeralScreenshotActionMsgWithoutContentPlaceholder=f;g.getUserJidForEphemeralSetting=j;g.maybeClearEphemeralMsgCountdown=k}),98);
__d("MAWEphemeralSettingsTxns",["DateConsts","MAWDbThreadTxns","MAWDexieTable","MAWEphemeralSettingsCache","MAWEphemeralUtil","MAWIndexedDb","MAWLoggerUtils","MAWUserJidWrapper","MWFBLogger","WAJids","WAResultOrError","WATimeUtils","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p=d("MWFBLogger").MWLogger.tags(["maw_db","txn",(o=d("MAWLoggerUtils")).Tag.Ephemeral,o.Tag.SettingChange,o.Tag.Incoming]),q=d("MWFBLogger").MWLogger.tags(["maw_db","txn",o.Tag.Ephemeral,o.Tag.SettingChange,o.Tag.Outgoing]),r=null,s=90*d("DateConsts").SEC_PER_DAY;function a(a,b,c,e,f,g,l,m,n){if(c<0||c>s){l=d("WAJids").interpretAndValidateJid(g.jid).toString();throw p.mustfixThrow("EphemeralSetting duration is invalid "+c+", jidType: "+l)}m={ephemeralExpirationInSec:c,ephemeralLastUpdatedOrSetTimestamp:e};p.DEBUG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Handle Incoming Ephemeral Setting duration: ",", lastUpdated: ",". Thread: ",", Author: ",""])),c,e,String(g),b);l=d("WAJids").interpretAsUserJid(g.jid);if(l==null){p.MUSTFIX(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Received invalid chat jid for incoming ephemeral settings"])));return d("MAWDexieTable").dexieResolve(r)}c=d("WAJids").isAuthorMe(b)?d("MAWUserJidWrapper").getMyUserJid():b;b=d("MAWEphemeralSettingsCache").getEphemeralSettingCache(g.jid);var o=b==null?void 0:b.ephemeralExpirationInSec,q=b==null?void 0:b.ephemeralLastUpdatedOrSetTimestamp;if(n){if(b!=null&&!d("MAWEphemeralUtil").isLocalSettingOutdated(m,b))if(e!==q){p.DEBUG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Sending Sync Response with duration ",", timestamp ",""])),o,q);return d("MAWDexieTable").dexieResolve({outOfSyncEphemeralSetting:{chatJid:g.jid,correctEphemeralExpirationInSec:b.ephemeralExpirationInSec,correctEphemeralLastUpdatedOrSetTimestamp:b.ephemeralLastUpdatedOrSetTimestamp}})}else{p.DEBUG(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Ephemeral setting in sync"])));return d("MAWDexieTable").dexieResolve(r)}d("MAWIndexedDb").afterTransaction({tag:"EphemeralSettingsUpdatedForUI",value:{author:d("WAJids").userIdFromJid(c),chatJid:g.jid,ephemeralSettingArgs:m,isEphemeralSettingReset:f}});return d("MAWDexieTable").dexieResolve(r)}n={ephemeralSetting:m,ephemeralSyncResponseBackoffInfo:void 0,userJid:l};return a.ephemeralSettings.put(n).then(function(){return r})}function b(a,b,c,e,f){var g=c;if(g<0)throw q.mustfixThrow("Ephemeral duration should be 0 or more");var h=d("MAWEphemeralUtil").getUserJidForEphemeralSetting(b);return d("MAWDbThreadTxns").getThread(a,b).then(function(b){return!b.success?d("WAResultOrError").makeResult({shouldUpdateSetting:!1}):a.ephemeralSettings.get({userJid:h}).then(function(b){if(!d("MAWEphemeralUtil").shouldUpdateForOutgoingUserEphemeralSettingChange(b,g,e))return d("WAResultOrError").makeResult({shouldUpdateSetting:!1});b=b==null?{ephemeralSetting:{ephemeralExpirationInSec:g,ephemeralLastUpdatedOrSetTimestamp:e},userJid:h}:babelHelpers["extends"]({},b,{ephemeralSetting:{ephemeralExpirationInSec:g,ephemeralLastUpdatedOrSetTimestamp:e}});return a.ephemeralSettings.put(b).then(function(){return d("WAResultOrError").makeResult({shouldUpdateSetting:!0})})})})}function e(a,b,e){var f=d("MAWEphemeralUtil").getUserJidForEphemeralSetting(b);return a.ephemeralSettings.get({userJid:f}).then(function(b){if(b==null||b.ephemeralSetting==null){q.MUSTFIX(l||(l=babelHelpers.taggedTemplateLiteralLoose(["Contact "," "," and ephemeral setting "," should not be null when receiving the server ack for outgoing ephemeral setting change"])),f,String(b),String(b==null?void 0:b.ephemeralSetting));throw q.mustfixThrow("Contact and ephemeral setting should not be null when receiving the server ack for outgoing ephemeral setting change")}b=babelHelpers["extends"]({},b,{ephemeralSetting:{ephemeralExpirationInSec:b.ephemeralSetting.ephemeralExpirationInSec,ephemeralLastUpdatedOrSetTimestamp:e}});return a.ephemeralSettings.put(b).then(c("emptyFunction"))})}function f(a,b){a=d("WAJids").interpretAsUserJid(b);a==null&&q.mustfixThrow("Unexpected chatJid input to isEphemeralMessagesEnabledForContact");a=d("MAWEphemeralSettingsCache").getEphemeralSettingCache(b);if(a.ephemeralLastUpdatedOrSetTimestamp===d("WATimeUtils").castToUnixTime(0))return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError("no_ephemeral_setting"));return a!=null&&a.ephemeralExpirationInSec>0?d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeResult({outOfSyncEphemeralSetting:{chatJid:b,correctEphemeralExpirationInSec:a.ephemeralExpirationInSec,correctEphemeralLastUpdatedOrSetTimestamp:a.ephemeralLastUpdatedOrSetTimestamp}})):d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError("no_ephemeral_setting"))}function t(a,b){return a.ephemeralSettings.get({userJid:b}).then(function(c){if((c==null?void 0:c.ephemeralSyncResponseBackoffInfo)==null){p.DEBUG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["maybeResetEphemeralSyncResponseBackoffInfo no op for ",""])),b);return d("WAResultOrError").makeResult()}c.ephemeralSyncResponseBackoffInfo=void 0;p.DEBUG(n||(n=babelHelpers.taggedTemplateLiteralLoose(["maybeResetEphemeralSyncResponseBackoffInfo reset for ",""])),b);return a.ephemeralSettings.put(c).then(function(){return d("WAResultOrError").makeResult()})})}g.handleAndWriteIncomingEphemeralSetting=a;g.handleAndWriteOutgoingUserEphemeralSettingChange=b;g.updateContactWhenEphemeralSettingChangeMarkedSent=e;g.getOutOfSyncEphemeralSettingForIncomingNonEphemeralMsg=f;g.maybeResetEphemeralSyncResponseBackoffInfo=t}),98);
__d("MAWEphemeralMsgTxns",["EBLogger","EBUploadSentDeletedMessage","MAWBridgeMsgCountdown","MAWDbMsg","MAWDbMsgTxns","MAWDbThreadTxns","MAWDbXMATxns","MAWDexieTable","MAWEphemeralCleaner","MAWEphemeralConsts","MAWEphemeralMsgUtils","MAWEphemeralSettingsTxns","MAWIndexedDb","MAWLoggerUtils","MAWODSProxy","MAWThreadSnippetUtils","MWFBLogger","WAJids","WAOdsEnums","WATimeUtils","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n=d("MWFBLogger").MWLogger.tags([(f=d("MAWLoggerUtils")).Tag.Ephemeral,f.Tag.SettingSync,f.Tag.Incoming]),o=d("MWFBLogger").MWLogger.tags([f.Tag.Ephemeral,f.Tag.OnRead,f.Tag.Countdown]);function p(a,b,c){c===void 0&&(c=function(){return!0});return d("MAWDbMsgTxns").getThreadMessagesBySortOrder(a,b,!1,!0).filter(c).limit(1).toArray().then(function(a){return{needsUpdate:!0,value:(a=a[0])!=null?a:null}})}function q(a,b,c){return c.size===0?d("MAWDexieTable").dexieResolve():d("MAWDbThreadTxns").getThread(a,b).then(function(b){if(!b.success)return;var e=b.value;return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").getThreadOldestMessageId(a,e.jid),d("MAWDbMsgTxns").getThreadNewestMessageId(a,e.jid)]).then(function(b){var f=b[0],g=b[1];if(f==null||g==null)return;b=d("MAWEphemeralMsgUtils").filterNonExpiredMsg(c);var h=c.has(f)?p(a,e.jid,b):d("MAWDexieTable").dexieResolve({needsUpdate:!1});b=c.has(g)?d("MAWDbMsgTxns").getThreadMessagesBySortOrder(a,e.jid,!0,!1).filter(b).reverse().limit(1).toArray().then(function(b){b=b[0];return b!=null&&d("MAWThreadSnippetUtils").isDbMsgDisabledForThreadSnippet(b)?d("MAWThreadSnippetUtils").recalculateSnippetFromScratch_EXPENSIVE(a,e,c).then(function(a){return{needsUpdate:!0,value:a!=null?a:null}}):{needsUpdate:!0,value:b!=null?b:null}}):d("MAWDexieTable").dexieResolve({needsUpdate:!1});return d("MAWDexieTable").dexieAll([h,b]).then(function(b){var c,h=b[0];b=b[1];if(!h.needsUpdate&&!b.needsUpdate)return;c=b.needsUpdate?(c=(c=b.value)==null?void 0:c.msgId)!=null?c:void 0:g;b=b.needsUpdate?b.value!=null?d("WATimeUtils").castUnixTimeToMillisTime(d("MAWDbMsg").getCanonicalTsFromMsg(b.value)):void 0:e.snippetMsgTs;h=babelHelpers["extends"]({},e,{oldestMsg:h.needsUpdate?(h=(h=h.value)==null?void 0:h.msgId)!=null?h:null:f,snippetMsg:c,snippetMsgTs:b});a.threads.put(h)})})})}function a(a,b,c){c===void 0&&(c=!0);if(b==null||b.ephemeralSetting==null||b.ephemeralSetting.ephemeralExpirationInSec===0)return d("MAWDexieTable").dexieResolve(b);var e=d("WATimeUtils").castToUnixTime(b.ts+b.ephemeralSetting.ephemeralExpirationInSec),f=d("WATimeUtils").castToUnixTime(e+d("MAWEphemeralConsts").ephemeralReportingWindowInSeconds);b.ebTimestampMs!=null&&(d("EBUploadSentDeletedMessage").sendDeleteEchoMessage__DEPRECATED_DO_NOT_USE(b,b.threadJid),d("EBLogger").EBLogger.tags(["eb_restore"]).WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Delete DM backup - S472027 follow up"]))),d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.EB_RESTORE,key:"restore_dm_s472027"}));return r(a,[{messageDeleteTs:f,messageExpirationTs:e,msgId:b.msgId,readTsForLogging:b.ts}]).then(function(a){var b=a[0],e=a[1];a=a[2];a.length>0&&(o.DEBUG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["markEphemeralMessageAsSent EphemeralCounter: Showing UI counter for ",""])),String(a.map(function(a){return a.msgId}))),c&&d("MAWIndexedDb").afterTransaction({tag:"MsgsStartCountdown",value:d("MAWBridgeMsgCountdown").createBridgeMsgsStartCountdown(a)}));b!=null&&e!=null&&d("MAWEphemeralCleaner").addNewEphemeralTimestamp(b,e);return a[0]})}function r(a,b){var c=b.map(function(a){return a.msgId});return d("MAWDbXMATxns").getXMAMsgIdsFromAssociatedMsgIds(a,c).then(function(d){var e=new Map();b.forEach(function(a){e.set(a.msgId,{messageDeleteTs:a.messageDeleteTs,messageExpirationTs:a.messageExpirationTs,readTsForLogging:a.readTsForLogging});var b=d.get(a.msgId);b!=null&&e.set(b,{messageDeleteTs:a.messageDeleteTs,messageExpirationTs:a.messageExpirationTs,readTsForLogging:a.readTsForLogging})});var f=null,g=null,h=[],i=Array.from(new Set(c.concat(Array.from(d.values()))));return a.messages.where("msgId").anyOf(i).toArray().then(function(b){if(b.length===0)return;b.forEach(function(a){var b=a.messageExpirationTs,c=a.messageDeleteTs,d=e.get(a.msgId),i=d==null?void 0:d.messageExpirationTs;d=d==null?void 0:d.messageDeleteTs;o.DEBUG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["updating ephemeral timestamp msg ",", existing expiration ",", existing deletion ",", updated expiration ",", updated deletion ",""])),a.msgId,b,c,i,d);if(i==null||d==null)return;if(a.ephemeralCounterStarted===!0)return;f==null?f=i:i<f&&(f=i);g==null?g=d:d<g&&(g=d);b=babelHelpers["extends"]({},a,{ephemeralCounterStarted:!0,messageDeleteTs:d,messageExpirationTs:i});h.push(b)});return a.messages.bulkPut(h)}).then(function(){return[f,g,h]})})}function b(a,b){if(b.size===0)return d("MAWDexieTable").dexieResolve();var e=[];b.forEach(function(b,c){e.push(q(a,c,b))});return d("MAWDexieTable").dexieAll(e).then(c("emptyFunction"))}function e(a,b,e,f,g){if(b==null)return d("MAWDexieTable").dexieResolve();n.DEBUG(k||(k=babelHelpers.taggedTemplateLiteralLoose(["maybeUpdateEphemeralSettingOrCheckOutOfSyncAfterWritingIncomingMsg: Message from ",", chat ",", type ",""])),e,f.jid,b.type);var h=d("MAWDexieTable").dexieResolve();if(b.ephemeralSetting==null)d("WAJids").switchOnMsgrChatJidType(f.jid,{group:function(){return d("MAWEphemeralSettingsTxns").maybeResetEphemeralSyncResponseBackoffInfo(a,e).then(c("emptyFunction"))},user:function(){d("MAWDbMsg").isMsgEligibleForTriggeringEphemeralSyncResponse(b)&&(h=d("MAWEphemeralSettingsTxns").getOutOfSyncEphemeralSettingForIncomingNonEphemeralMsg(a,f.jid).then(function(a){var b;return a==null||(b=a.value)==null?void 0:b.outOfSyncEphemeralSetting}))}});else if(b.messageExpirationTs!=null&&b.messageDeleteTs!=null){var i=b.ephemeralSetting,j=b.messageDeleteTs,o=b.messageExpirationTs;n.DEBUG(l||(l=babelHelpers.taggedTemplateLiteralLoose(["incoming msg is ephemeral: duration ",", timestamp ",""])),i.ephemeralExpirationInSec,i.ephemeralLastUpdatedOrSetTimestamp);d("MAWEphemeralCleaner").addNewEphemeralTimestamp(o,j);h=d("MAWEphemeralSettingsTxns").handleAndWriteIncomingEphemeralSetting(a,e,i.ephemeralExpirationInSec,i.ephemeralLastUpdatedOrSetTimestamp,!1,f,g,null,!0).then(function(a){return a==null?void 0:a.outOfSyncEphemeralSetting})}return h.then(function(b){if(b!=null)n.DEBUG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["incoming msg is out of sync: correct duration ",", correct timestamp ",""])),b.correctEphemeralExpirationInSec,b.correctEphemeralLastUpdatedOrSetTimestamp);else return d("MAWEphemeralSettingsTxns").maybeResetEphemeralSyncResponseBackoffInfo(a,e).then(c("emptyFunction"))})}g.markEphemeralMessageAsSent=a;g.bulkUpdateEphemeralMessageTimestamps=r;g.updateThreadsOnMessagesExpiredFromUi=b;g.syncEphemeralSettingOnIncomingMsg=e}),98);
__d("MAWExpiredQuoteCleaner",["FBLogger","MAWMsgCleaner","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=null;function a(a){j==null&&(j=new(d("MAWMsgCleaner").MsgCleaner)(a,d("MAWMsgCleaner").CLEANER_TYPE.QUOTE))}function b(a){if(j==null){var b="Trying to add new addNewExpiredQuoteCleanerTimestamp before the cleaner is initialized!";d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["",""])),b);throw c("FBLogger")("messenger_web").mustfixThrow(b)}else d("WALogger").DEV(i||(i=babelHelpers.taggedTemplateLiteralLoose(["ExpiredQuoteCleaner: Adding timestamps backend(",")"])),a),j.update(a)}function e(){return j}function f(){j=null}g.startExpiredQuoteCleaner=a;g.addNewExpiredQuoteCleanerTimestamp=b;g.getExpiredQuoteCleaner_FOR_TESTING_ONLY=e;g.resetExpiredQuoteCleaner_FOR_TESTING_ONLY=f}),98);
__d("isWAFTSContentSearchEnabled",["isE2EEConversationSearchEnabled","isMAWUniversalSearchEnabled"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("isE2EEConversationSearchEnabled")()||c("isMAWUniversalSearchEnabled")()}g["default"]=a}),98);
__d("MAWFTSTxns",["MAWDexieTable","isWAFTSContentSearchEnabled","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h=c("justknobx")._("1146");function a(a,b){return!c("isWAFTSContentSearchEnabled")()?d("MAWDexieTable").dexieResolve(null):a.ftsPurgeBacklog.put({externalId:b})}function b(a,b){return!c("isWAFTSContentSearchEnabled")()||!h?d("MAWDexieTable").dexieResolve(null):a.ftsBackloggedMessages.put({rowId:b})}function e(a,b){return!c("isWAFTSContentSearchEnabled")()||!h?d("MAWDexieTable").dexieResolve(null):a.ftsBackloggedMessages.bulkPut(b.map(function(a){return{rowId:a}}))}function f(a,b){return!c("isWAFTSContentSearchEnabled")()?d("MAWDexieTable").dexieResolve(null):a.ftsPurgeThreadBacklog.put({chatJid:b})}g.maybePutMessageToPurgeBacklog=a;g.maybePutMessageToBacklog=b;g.maybePutMessagesToBacklog=e;g.maybePutThreadToPurgeBacklog=f}),98);
__d("MAWThreadEventConst",[],(function(a,b,c,d,e,f){"use strict";a="placeholderConvertSubscription";f.PLACEHOLDER_CONVERT_SUBSCRIPTION=a}),66);
__d("MAWUpdateQuotedMsgTxns",["MAWAuthor","MAWBridgeMsg","MAWDbXMATxns","MAWDexieTable","MAWIndexedDb","MAWLoadReplyMediaTxns","MAWMsgType","WAJids"],(function(a,b,c,d,e,f,g){"use strict";var h=function(a,b,c,e,f,g,h){var i=d("MAWAuthor").getAuthorUserJid(e);return a.messages.where("quoteExternalId").equals(c).toArray().then(function(c){if(c.length===0)return;var e=c;(h==null||!h)&&(e=c.filter(function(a){var c=a.quote;a=a.threadJid;return d("MAWAuthor").getAuthorUserJid(c==null?void 0:c.content.author)===i&&a===b}));var j=e.map(function(a){var b;b=Object.assign({},(b=a.quote)==null?void 0:b.content,f.content);b=babelHelpers["extends"]({},a.quote,f,{content:b});b.content.msgId==null&&g!=null&&(b.content.msgId=g);return babelHelpers["extends"]({},a,{quote:b})});return a.messages.bulkPut(j).then(function(){return j})})},i=function(a,b,c,e,f){f===void 0&&(f=d("MAWMsgType").MSG_TYPE.UNAVAILABLE);f={content:{mediaId:void 0,msgContent:void 0,type:f}};return h(a,b,c,e,f).then(function(a){if(a==null)return;a.forEach(function(a){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(a)})})})};b=function(a,b,c){c===void 0&&(c=d("MAWMsgType").MSG_TYPE.UNAVAILABLE);var e=b.author,f=b.chat,g=b.externalId;return a.threads.get({jid:f}).then(function(b){if(b==null)return;return i(a,b.jid,g,e,c)})};var j=function(a,b,c,e){var f=c.author,g=c.externalId,i=c.mediaId,j=c.msgContent,k=c.msgId,l=c.plaintextHash,m=c.ts,n=c.type;if(d("WAJids").isAuthorSystem(f))return d("MAWDexieTable").dexieResolve();var o={author:f,chat:b,externalId:g};if(!d("MAWMsgType").isQuotedMsgType(n))return d("MAWDexieTable").dexieResolve();var p=d("MAWDexieTable").dexieResolve(null);c.type===d("MAWMsgType").MSG_TYPE.XMA&&(p=d("MAWDbXMATxns").maybeGetXMAPayloadFromProtocolMsgId(a,o).then(function(a){return a.success===!1?d("MAWDexieTable").dexieResolve(null):d("MAWDexieTable").dexieResolve(a.value)}));return p.then(function(c){var d,o,p,q;d={author:f,externalId:g,mediaId:(d=c==null||(o=c.defaultPreview)==null?void 0:o.mediaId)!=null?d:i,msgContent:j,plaintextHash:(d=c==null||(p=c.defaultPreview)==null?void 0:p.plaintextHash)!=null?d:l,ts:m,type:n,xmaMessageType:c==null||(q=c.xma)==null?void 0:q.targetType};return h(a,b,g,f,{content:d},k,e)})};function a(a,b,c){return d("MAWDexieTable").dexieAll([j(a,c,b),d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,b)]).then(function(c){var e=c[0];c=c[1];if(e!=null)return d("MAWDexieTable").dexieResolve(k(b,c)).then(function(){d("MAWDexieTable").dexieAll(e.map(function(b){return d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,b).then(function(a){k(b,a);return b})}))});else return d("MAWDexieTable").dexieResolve([])})}function k(a,b){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(a,b)})}g.disassociateQuotedMsg=i;g.disassociateQuotedMessageByProtocolMsgId=b;g.associateQuotedMessage=j;g.associateAllReplies=a;g.issueReplyMsgUpdate=k}),98);
__d("MAWCreateE2EEMetadataThreadFromThreadActivityUpdate",["FBLogger","MAWAuthoritativeThreadsCache","MAWDbThreadTxns","MAWDexieTable","MAWFolderTypes","MAWIndexedDb"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var c=b.bumpTimestampMs,e=b.chatJid;b=b.source;var f=h(b);return d("MAWAuthoritativeThreadsCache").AuthoritativeThreadsCache.has(e)||f==="invalid_source"?d("MAWDexieTable").dexieResolve():d("MAWDbThreadTxns").getThread(a,e).then(function(a){var b;a=a.value;if((a==null?void 0:a.authoritativeThreadKey)!=null){d("MAWAuthoritativeThreadsCache").AuthoritativeThreadsCache.add(a.jid);return}d("MAWIndexedDb").afterTransaction({tag:"CreateE2EEMetadataThreadV2",value:{bumpTimestampMs:c,creationSource:f,folderId:(b=a==null?void 0:a.folder)!=null?b:d("MAWFolderTypes").INBOX,jid:e,optimisticThreadKey:a==null?void 0:a.optimisticThreadKey}})})}function h(a){switch(a){case"outgoing_msg":return"outgoing_message";case"incoming_msg":return"incoming_message";case"inserted_admin_msg":case"eb_restore":case"deleted_msg":return"invalid_source";default:a;throw c("FBLogger")("messenger_web").mustfixThrow("Unknown thread update source")}}g.maybeCallCreateE2EEMetadataThreadHandler=a}),98);
__d("MAWThreadLatestTimestampCache",["I64","MAWGetBumpTimestampMs"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){function a(){this.$1=new Map()}var b=a.prototype;b.isLatestTs=function(a,b){a=this.$1.get(a);b=d("MAWGetBumpTimestampMs").getBumpTimestampMs(b);return a==null||(h||(h=d("I64"))).ge(b,a)};b.isNewerThanLatestTs=function(a,b){a=this.$1.get(a);b=d("MAWGetBumpTimestampMs").getBumpTimestampMs(b);return a==null||(h||(h=d("I64"))).gt(b,a)};b.monotonicIncrease=function(a,b){b=d("MAWGetBumpTimestampMs").getBumpTimestampMs(b);var c=this.$1.get(a);(c==null||(h||(h=d("I64"))).gt(b,c))&&this.$1.set(a,b)};b.get=function(a){return this.$1.get(a)};b.set=function(a,b){b=d("MAWGetBumpTimestampMs").getBumpTimestampMs(b);this.$1.set(a,b)};b.clear=function(){this.$1.clear()};return a}();b=new a();g.ThreadLatestTimestampCache=a;g.ThreadLastActivityTsCache=b}),98);
__d("MAWUpdateThreadActivity",["FBLogger","MAWCreateE2EEMetadataThreadFromThreadActivityUpdate","MAWDexieTable","MAWGetBumpTimestampMs","MAWGetThreadUpdateType","MAWIndexedDb","MAWThreadLatestTimestampCache","MAWThreadNewestMsgOrReactionUtils","MAWTransactionMode","MAWUpdateThreadListItemUtils","WAJids"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({threads:(a=d("MAWTransactionMode")).READONLY},"updateThreadActivityFromInsertion",function(a){return function(b,c,d){return h(a,b,c,d)}});function h(a,b,c,e){if(!j(c,b,e))return d("MAWDexieTable").dexieResolve();d("MAWThreadLatestTimestampCache").ThreadLastActivityTsCache.monotonicIncrease(c,b);var f={bumpTimestampMs:d("MAWGetBumpTimestampMs").getBumpTimestampMs(b),chatJid:c,source:e};return d("MAWCreateE2EEMetadataThreadFromThreadActivityUpdate").maybeCallCreateE2EEMetadataThreadHandler(a,f).then(function(){return d("MAWIndexedDb").afterTransaction({tag:"UpdateThreadActivity",value:{bumpTimestampMs:f.bumpTimestampMs,chatJid:c,source:f.source}})})}e=d("MAWIndexedDb").makeMsgrTransactor({messages:a.READONLY,reactions:a.READONLY,threads:a.READONLY},"updateThreadActivityFromDeletion",function(a){return function(b,c){return i(a,b,c)}});function i(a,b,c){return!j(c,b,"deleted_msg")?d("MAWDexieTable").dexieResolve():d("MAWThreadNewestMsgOrReactionUtils").getNewestMsgOrReactionForBump(a,c).then(function(a){if(a==null)return;d("MAWThreadLatestTimestampCache").ThreadLastActivityTsCache.set(c,a);d("MAWIndexedDb").afterTransaction({tag:"UpdateThreadActivity",value:{bumpTimestampMs:d("MAWGetBumpTimestampMs").getBumpTimestampMs(a),chatJid:c,source:"deleted_msg"}})})}function j(a,b,e){if(!d("MAWGetThreadUpdateType").isThreadUpdateTypeEligibleForBump(b)||d("MAWUpdateThreadListItemUtils").isSpamMessage(b)||d("MAWUpdateThreadListItemUtils").isOptimisticMessage(b))return!1;switch(e){case"outgoing_msg":return!0;case"incoming_msg":return d("MAWThreadLatestTimestampCache").ThreadLastActivityTsCache.isNewerThanLatestTs(a,b)&&(b.author!==d("WAJids").AUTHOR_ME||d("MAWUpdateThreadListItemUtils").isRTCXMAMessage(b));case"eb_restore":return!1;case"inserted_admin_msg":return!1;case"deleted_msg":return d("MAWThreadLatestTimestampCache").ThreadLastActivityTsCache.isLatestTs(a,b);default:e;throw c("FBLogger")("messenger_web").mustfixThrow("Unknown thread update source")}}g.updateThreadActivityFromInsertion=b;g.updateThreadActivityFromInsertionTxn=h;g.updateThreadActivityFromDeletion=e;g.updateThreadActivityFromDeletionTxn=i}),98);
__d("MAWBridgeParticipants",["MAWBridgeParticipantsUpdatedHandler","WAJids","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(a){var b=a.deliveredWatermarkTs,c=a.threadJid,e=a.type;a=a.userJid;return babelHelpers["extends"]({deliveredWatermarkTs:b||d("WATimeUtils").castToUnixTime(0),fbid:d("WAJids").extractUserId(a)},d("MAWBridgeParticipantsUpdatedHandler").mawToLsParticipantTypeConversion(e),{lastReadActionTs:d("WATimeUtils").castToUnixTime(0),readWatermarkTs:d("WATimeUtils").castToUnixTime(0),threadJid:c})}function a(a){return{participants:a.map(function(a){return h(a)})}}g.createBridgeParticipant=h;g.createBridgeParticipants=a}),98);
__d("MAWDbParticipantTxns",["MAWBridgeParticipants","MAWBridgeTypesCreators","MAWCurrentUser","MAWDbParticipant","MAWDexieTable","MAWIndexedDb","MAWODSProxy","MAWUserJidWrapper","MWFBLogger","WAJids","WAOdsEnums","WAResultOrError","WATimeUtils","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(a,b,c,d){d===void 0&&(d=!0);return n(a,c.map(function(a){return babelHelpers["extends"]({},a,{chatJid:b})}),d)}function l(a,b){d("WAJids").switchOnMsgrChatJidType(a.threadJid,{group:c("emptyFunction"),user:function(c){a.userJid!==c&&a.userJid!==d("MAWUserJidWrapper").getMyUserJid()&&d("MWFBLogger").MWLogger.tags(["db","txn"]).mustfix("Attempting to insert participant to a mismatched one-on-one thread at %s",b)}})}function m(a){var b=a.addressable,c=a.chatJid,e=a.type;a=a.userJid;return{addressable:b,deliveredWatermarkTs:d("WATimeUtils").castToUnixTime(0),id:d("MAWDbParticipant").craftParticipantId(c,a),lastReadWatermarkTs:d("WATimeUtils").castToUnixTime(0),threadJid:c,type:e!=null?e:"participant",userJid:a}}function n(a,b,c){c===void 0&&(c=!0);if(b.length===0)return d("MAWDexieTable").dexieResolve([]);var e=b.map(function(a){return m(a)});e.forEach(function(a){return l(a,"bulkAddParticipantsInThreads")});return a.participants.bulkPut(e).then(function(){c&&d("MAWIndexedDb").afterTransaction({tag:"ParticipantsUpdated",value:d("MAWBridgeParticipants").createBridgeParticipants(e)});return e})}function o(a,b,c,e){e===void 0&&(e=!0);var f=new Set([b,d("MAWUserJidWrapper").getMyUserJid()]);b=c.filter(function(a){a=a.userJid;return!f.has(a)}).map(function(a){var b=a.threadJid;a=a.userJid;return[b,a]});b.length>0&&d("MAWODSProxy").odsBumpEntityKey({amount:1,entity:d("WAOdsEnums").Entity.MAW_ONE_TO_ONE_THREAD_PARTICIPANT_CLEANUP,key:d("MAWCurrentUser").isEmployee()?"employee":"public"});return q(a,b,e)}function p(a,b,c,e){e===void 0&&(e=!0);var f=Array.from(new Set([b,d("MAWUserJidWrapper").getMyUserJid()])),g=new Set(c.map(function(a){return a.userJid})),h=f.filter(function(a){return!g.has(a)});h=h.map(function(a){return{type:"participant",userJid:a}});return k(a,b,h,e).then(function(a){var b=f.reduce(function(b,d){var e=a.find(function(a){return a.userJid===d}),f=c.find(function(a){return a.userJid===d});e!=null&&f==null?b.push(e):f!=null&&b.push(f);return b},[]);return b})}function a(a,b,c){c===void 0&&(c=!0);return u(a,b).then(function(d){return o(a,b,d,c).then(function(e){return p(a,b,d,c)})})}function b(a,b){b.forEach(function(a){return l(a,"bulkUpdateParticipants")});return a.participants.bulkPut(b).then(function(){b.length>0&&d("MAWIndexedDb").afterTransaction({tag:"ParticipantsUpdated",value:d("MAWBridgeParticipants").createBridgeParticipants(b)});return b})}function e(a,b,c){if(c.length===0)return d("MAWDexieTable").dexieResolve();c=c.map(function(a){return[b,a]});return q(a,c)}function f(a,b,c){if(b.length===0)return d("MAWDexieTable").dexieResolve();b=b.map(function(a){return[a,c]});return q(a,b)}function q(a,b,c){c===void 0&&(c=!0);return a.participants.where(["threadJid","userJid"]).anyOf(b).toArray().then(function(b){return a.participants.bulkDelete(b.map(function(a){return a.id})).then(function(){c&&b.forEach(function(a){var b=a.threadJid;a=a.userJid;return d("MAWIndexedDb").afterTransaction({tag:"ParticipantRemoved",value:{threadJid:b,userId:d("WAJids").extractUserId(a)}})})})})}function r(a,b){return a.participants.where("threadJid").equals(b)["delete"]()}function s(a,b,c,d,e){return t(a,[{deliveredWatermarkTs:c,lastReadActionTs:e,lastReadWatermarkTs:d,participantKey:b}]).then(function(a){return a[0]})}function t(a,b,c){if(b.length===0)return d("MAWDexieTable").dexieResolve([]);var e=new Map(),f=[];b.forEach(function(a){f.push(a.participantKey),e.set(JSON.stringify(a.participantKey),a)});return a.participants.where(["threadJid","userJid"]).anyOf(f).toArray().then(function(b){b.length!==f.length&&(c!=null&&c.DEBUG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["bulkUpdateParticipantTimestamps: missing participants "," vs ",""])),b.length,f.length));var g=[],k=[];b.forEach(function(a){var b=e.get(JSON.stringify([a.threadJid,a.userJid]));if(b==null){c!=null&&c.DEBUG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["bulkUpdateParticipantTimestamps: missing tsData for participant ",", ",""])),a.threadJid,a.userJid);return}var d=b.deliveredWatermarkTs,f=b.lastReadActionTs;b=b.lastReadWatermarkTs;var h=a.deliveredWatermarkTs,l=a.lastReadWatermarkTs,m=a.lastReadActionTs,n=d>h,o=b>l,p=m==null||f>m;c!=null&&c.DEBUG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["bulkUpdateParticipantTimestamps: participant ",", "," deliveredWatermarkTs: ",", lastReadWatermarkTs: ",", lastReadActionTs: ",""])),a.threadJid,a.userJid,d,b,f);if(!n&&!o&&!p){k.push(a);return}g.push(babelHelpers["extends"]({},a,{deliveredWatermarkTs:n?d:h,lastReadActionTs:p?f:m,lastReadWatermarkTs:o?b:l}))});g.forEach(function(a){return l(a,"bulkUpdateParticipantTimestamps")});return a.participants.bulkPut(g).then(function(){g.forEach(function(a){d("MAWIndexedDb").afterTransaction({tag:"ReceivedReceipt",value:d("MAWBridgeTypesCreators").createBridgeReceivedReceipt(a.threadJid,d("WAJids").extractUserId(a.userJid),a.deliveredWatermarkTs)})});return[].concat(g,k)})})}function u(a,b){return a.participants.where("threadJid").equals(b).toArray()}function v(a,b){return a.participants.where("threadJid").anyOf(b).toArray()}function w(a,b){return u(a,b).then(function(a){return a.filter(function(a){return a.type==="invitedParticipant"})})}function x(a,b,c){return a.participants.where(["threadJid","userJid"]).equals([b,c]).first().then(function(a){return a==null?d("WAResultOrError").makeError("missing"):d("WAResultOrError").makeResult(a)})}function y(a,b){return a.participants.where(["threadJid","userJid"]).anyOf(b).toArray().then(function(a){var c=new Map(a.map(function(a){return[JSON.stringify([a.threadJid,a.userJid]),a]}));return b.map(function(a){return c.get(JSON.stringify(a))})})}g.bulkAddParticipants=k;g.logIfIllegalParticipant=l;g.bulkAddParticipantsInThreads=n;g.deleteIncorrectParticipantsInOneToOneThread=o;g.addMissingParticipantsInOneToOneThread=p;g.bulkRemoveIncorrectAndInsertMissingParticipantsInOneToOneThread=a;g.bulkUpdateParticipants=b;g.bulkDeleteParticipantsInThread=e;g.bulkDeleteParticipantAcrossThreads=f;g.bulkDeleteParticipants=q;g.deleteAllParticipantsForThread=r;g.updateParticipantTimestamps=s;g.bulkUpdateParticipantTimestamps=t;g.getParticipantsInThread=u;g.getParticipantsInThreads=v;g.getInvitedParticipantsInThread=w;g.getParticipant=x;g.bulkGetParticipants=y}),98);
__d("MAWWriteMsgSideEffectTxns",["MAWDbMsg","MAWDbParticipantTxns","MAWDexieTable"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var c=d("MAWDbMsg").getCanonicalTsFromMsg(b),e=b.author;return e!=="@me"&&e!=="@system"?d("MAWDbParticipantTxns").updateParticipantTimestamps(a,[b.threadJid,e],c,c,c):d("MAWDexieTable").dexieResolve()}g.updateParticipantTimestampsForMsg=a}),98);
__d("MAWWriteMsgTxns",["EBUploadSentDeletedMessage","FBLogger","MAWAfterWriteMsgUtil","MAWAsMessageApplication","MAWBridgeMsg","MAWBuildIncomingMsgs","MAWDbEditMsgHistoryTxns","MAWDbMsg","MAWDbMsgTxns","MAWDbPendingStanzaTxns","MAWDbReactionsTxns","MAWDbThread","MAWDbThreadTxns","MAWDbUnrenderedMsgTxns","MAWDeleteForMeMsgContentCleaner","MAWDeleteThreadUtil","MAWDexieTable","MAWEphemeralMsgTxns","MAWExpiredQuoteCleaner","MAWFTSTxns","MAWFolderTypes","MAWGetMsgQuoteTxn","MAWGetOrCreateThreadTxns","MAWGetThreadUpdateTypeForAdminMsg","MAWIndexedDb","MAWJidUtils","MAWLoadReplyMediaTxns","MAWLocalizationType","MAWLocalizationUtils","MAWMessageSortOrderUtils","MAWMpsGating","MAWMsgType","MAWThreadEventConst","MAWThreadUpdateType","MAWTimeUtils","MAWUpdateQuotedMsgTxns","MAWUpdateThreadActivity","MAWUseProtocolMsgIdForMsgId","MAWWriteMsgSideEffectTxns","MAWWriteRevokeMessageTxns","ODS","WAAsMessageApplication","WAJids","WALogger","WAMsgApplication.pb","WATimeUtils","encodeProtobuf","promiseDone","qex","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=["rowId"],i,j,k,l,m=c("requireDeferred")("EBAPI").__setRef("MAWWriteMsgTxns");function n(a,b,e,f){var g=e.ts;g=[d("WATimeUtils").castUnixTimeToMillisTime(g),e.type===d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN];var h=g[0],i=g[1];return d("MAWGetOrCreateThreadTxns").getExistingThread(a,b.jid).then(function(b){if(b==null)throw c("FBLogger")("messenger_web").mustfixThrow("at this point there's always a thread - checking for updates");var g=d("MAWDbMsgTxns").getThreadOldestMessageBySortOrder(a,b.jid),j=d("MAWDbMsgTxns").getThreadNewestMessageBySortOrder(a,b.jid);return d("MAWDexieTable").dexieAll([g,j]).then(function(a){var c,g,j,k=a[0];a=a[1];var l=d("MAWUseProtocolMsgIdForMsgId").shouldUseProtocolMsgIdForMsgId()?null:a==null?1:d("MAWDbMsg").getInChatMsgIdFromMsgId(a.msgId)+1;c=d("WATimeUtils").castToMillisTime((c=a==null?void 0:a.sortOrderMs)!=null?c:0);c=h>c&&!i?h:c;g=(g=d("MAWTimeUtils").ensureValidMillisTime(b.lastReadMsgTs))!=null?g:0;j=d("WATimeUtils").castToMillisTime((j=a==null?void 0:a.sortOrderMs)!=null?j:0);g=g<j;j=e.author===d("WAJids").AUTHOR_ME||e.type===d("MAWMsgType").MSG_TYPE.ADMIN&&d("MAWLocalizationUtils").isParticipantChangeAdminMsg(e.msgContent.adminType)&&!g;g=babelHelpers["extends"]({},e,{msgId:l!=null?d("MAWDbMsg").craftMsgIdV2(b.chatId,l,e):d("MAWJidUtils").formatProtocolMsgIdFromMsg(e)});l=d("MAWDbMsgTxns").calculateOldestMsg(k,a,g,f);a=l.oldestMsg;return{isOldestMsgUpdated:k!=null&&a!==k.msgId,msgId:g.msgId,prevOldestMsg:k,updatedSnippet:void 0,updatedThread:babelHelpers["extends"]({},b,{lastReadMsg:j?g.msgId:b.lastReadMsg,lastReadMsgTs:j?c:b.lastReadMsgTs,newestMsgTs:c,oldestMsg:a,snippetMsg:b.snippetMsg,snippetMsgTs:b.snippetMsgTs,threadOrder:d("MAWDbThread").craftThreadOrder(c,b.jid)})}})})}function a(a,b,c,e){return a.messages.where(["threadJid","sortOrderMs"]).equals([c.jid,e]).filter(function(a){return a.type!==d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN&&a.type!==d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION?!1:a.type===b.type&&a.msgContent.adminType===b.msgContent.adminType}).first().then(function(d){return d!=null?d:p(a,b,c)})}function b(a,b,c,e){return a.messages.where(["threadJid","sortOrderMs"]).equals([c.jid,e]).filter(function(a){return a.type===d("MAWMsgType").MSG_TYPE.ADMIN&&a.msgContent.adminType===b.msgContent.adminType}).first().then(function(e){if(e!=null){(l||(l=d("ODS"))).bumpEntityKey(600,"maw_write_msg_txns_deduped_admin_message",b.msgContent.adminType);return e}return p(a,b,c)})}function e(a,b,c){return a.messages.where("threadJid").equals(c.jid).filter(function(a){return a.type===d("MAWMsgType").MSG_TYPE.ADMIN&&(a.msgContent.adminType===d("MAWLocalizationType").LOCALIZATION_TYPE.TWO_USERS_CONNECTED||a.msgContent.adminType===d("MAWLocalizationType").LOCALIZATION_TYPE.TWO_USERS_CONNECTED_ONE_MSPLIT)}).first().then(function(e){if(e!=null){(l||(l=d("ODS"))).bumpEntityKey(600,"maw_write_msg_txns_deduped_admin_message",b.msgContent.adminType);return e}return p(a,b,c)})}function o(a,b){return a.messages.add(b).then(function(a){return babelHelpers["extends"]({},b,{rowId:a})})}function p(a,b,c,e){e===void 0&&(e={});e=e;var f=e.isFirstMsg,g=f===void 0?!1:f;f=e.isOutgoing;var h=f===void 0?!1:f,j=e.openMessageOtid,k=e.openMessageParticipantCount,l=e.optimisticMsg,m=e.participantCount,p=e.quotedReplyAttachmentMeta;f=e.shouldUpdateUi;var q=f===void 0?!0:f;f=e.sortOrderMs;return n(a,c,b,f).then(function(c){c.isOldestMsgUpdated;var e=c.msgId;c.prevOldestMsg;var f=c.updatedThread;c=babelHelpers["extends"]({},b,{msgId:e,sortOrderMs:d("MAWMessageSortOrderUtils").generateAuthoritativeMessageSortOrder(b)});return d("MAWDexieTable").dexieAll([o(a,c),a.threads.put(f),d("MAWFTSTxns").maybePutMessageToBacklog(a,c.externalId)]).then(function(b){var c=b[0];b[1];h&&d("WALogger").LOG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["writeMsgAfterTransaction - sortOrderMs: ",""])),c.sortOrderMs);q&&d("MAWAfterWriteMsgUtil").writeMsgAfterTransaction({dbMsg:c,isFirstMsg:g,openMessageOtid:j,openMessageParticipantCount:k,optimisticMsg:l,participantCount:m,quotedReplyAttachmentMeta:p,updatedThread:f});b=c.type===d("MAWMsgType").MSG_TYPE.ADMIN?d("MAWUpdateThreadActivity").updateThreadActivityFromInsertionTxn(a,c,c.threadJid,x(c)):d("MAWDexieTable").dexieResolve();return b.then(function(){return c})})})}function q(a,b,e){return d("MAWGetOrCreateThreadTxns").getExistingThread(a,e.jid).then(function(f){if(f==null)throw c("FBLogger")("messenger_web").mustfixThrow("at this point there's always a thread - checking for updates");return(d("MAWUseProtocolMsgIdForMsgId").shouldUseProtocolMsgIdForMsgId()?d("MAWDexieTable").dexieResolve(null):d("MAWDbUnrenderedMsgTxns").getNextUnrenderedMsgIdNumberForThread(a,f)).then(function(c){var g=babelHelpers["extends"]({},b,{msgId:c!=null?d("MAWDbMsg").craftUnrenderedMsgId(f.chatId,c):d("MAWJidUtils").formatProtocolMsgIdFromExternalId(e.jid,b.externalId)});return d("MAWDexieTable").dexieAll([a.unrenderedMessages.add(g),a.threads.put(f)]).then(function(a){var b=a[0];a[1];return babelHelpers["extends"]({},g,{rowId:b})})})})}function f(a,b,c){return d("MAWDexieTable").dexieAll([r(a,b,c),d("MAWDbEditMsgHistoryTxns").getEditHistoryByOriginalMsgExternalIdAndThreadJid(a,[[b.externalId,c.jid]]).then(function(a){return{editMsgHistories:a,originalEditMsgHistory:a.find(function(a){return a.editExternalId===b.externalId})}})]).then(function(a){var b=a[0];a=a[1];var c=a.editMsgHistories;a=a.originalEditMsgHistory;return babelHelpers["extends"]({},b,{editMsgHistories:c,existingEditMsgHistory:a!=null?a:null})})}function r(a,b,c){c=[b.externalId,c.jid,b.author];var e=c[0],f=c[1];c=c[2];return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByExternalId(a,e,f,c),d("MAWDbPendingStanzaTxns").maybeGetPendingRevokedStanza(a,e,c,f),d("MAWDbPendingStanzaTxns").maybeGetPendingDeletedStanza(a,e,c,f),d("MAWDbMsgTxns").checkIfMsgIsDeletedForMeOrRevoked(a,e,f,c),d("MAWDbPendingStanzaTxns").maybeGetDeleteThreadFromPendingStanza(a,f).then(function(a){return d("MAWDeleteThreadUtil").isMsgDeletedViaDeleteThread(b.ts,a)})]).then(function(a){var b=a[0],c=a[1],d=a[2],e=a[3];a=a[4];return{existingMsg:b!=null?b:null,isDeletedWithThread:a,isDeleteForMeOrRevoked:e,pendingDeleteForMeStanza:d!=null?d:null,pendingRevokedStanza:c!=null?c:null}})}function s(a,b,c,e,f){e===void 0&&(e=!0);return d("MAWDbPendingStanzaTxns").maybeGetPendingRevokedStanza(a,b.externalId,b.author,c.jid).then(function(g){if(g!=null)return v(a,b,c,g,!0);g=b.author;d("WALogger").DEV(j||(j=babelHelpers.taggedTemplateLiteralLoose(["handle"," Msg: Message from ",", chat ",""])),b.type,g,c.jid);var h=babelHelpers["extends"]({},babelHelpers["extends"]({},b,{threadJid:c.jid}));c.folder===d("MAWFolderTypes").FOLDER_ID.OTHER&&(h.altIndex=h.altIndex===d("MAWDbMsg").FUTUREPROOF_ALT_INDEX?d("MAWDbMsg").FUTUREPROOF_SPAM_ALT_INDEX:d("MAWDbMsg").SPAM_ALT_INDEX);return d("MAWGetMsgQuoteTxn").getMsgQuoteInfo(a,h,c.jid,f).then(function(b){b!=null&&(h=babelHelpers["extends"]({},h,{quote:b==null?void 0:b.quote,quoteExpirationTs:b==null?void 0:b.quote.content.expirationTs,quoteExternalId:b==null?void 0:b.quoteExternalId}));b=h.quoteExpirationTs;b!=null&&b>d("WATimeUtils").unixTime()&&d("MAWExpiredQuoteCleaner").addNewExpiredQuoteCleanerTimestamp(b);return d("MAWDexieTable").dexieAll([d("MAWUpdateQuotedMsgTxns").associateQuotedMessage(a,c.jid,h),d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,h),d("MAWLoadReplyMediaTxns").getReplyMediaForMsg(a,h)]).then(function(b){var f=b[0],g=b[1],i=b[2];return p(a,h,c,{quotedReplyAttachmentMeta:g,shouldUpdateUi:e}).then(function(b){return d("MAWDexieTable").dexieAll([d("MAWWriteMsgSideEffectTxns").updateParticipantTimestampsForMsg(a,h),d("MAWEphemeralMsgTxns").markEphemeralMessageAsSent(a,b,e)]).then(function(a){a=a[1];f!=null&&(e&&f.forEach(function(a){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(a,i)})}));return a||b})})})})})}function t(a,b,c,e,f,g){var i=babelHelpers["extends"]({},babelHelpers["extends"]({},b,{msgId:c.msgId,protocolMsgId:c.protocolMsgId,rowId:c.rowId,serverTs:c.serverTs,sortOrderMs:c.sortOrderMs,threadJid:e.jid,ts:c.ts}));return d("MAWDexieTable").dexieAll([d("MAWUpdateQuotedMsgTxns").associateQuotedMessage(a,e.jid,i),d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,i),d("MAWLoadReplyMediaTxns").getReplyMediaForMsg(a,i),d("MAWGetMsgQuoteTxn").getMsgQuoteInfo(a,i,e.jid,g),d("MAWDbMsgTxns").getThreadNewestMessageId(a,e.jid)]).then(function(g){var j=g[0],k=g[1],l=g[2],m=g[3],n=g[4];i=babelHelpers["extends"]({},i,{quote:m==null?void 0:m.quote,quoteExternalId:m==null?void 0:m.quoteExternalId});return((g=c.editCount)!=null?g:0)>0&&f!=null&&b.type===d("MAWMsgType").MSG_TYPE.TEXT?d("MAWDbEditMsgHistoryTxns").updateEditMsgHistoryWithNewIncomingMsg(a,f,b).then(function(){return c}):a.messages.put(i).then(function(){return d("MAWDbThreadTxns").needsRetroactiveReadReceiptInThread(a,i)}).then(function(b){if(b){i.altIndex=d("MAWDbMsg").craftToBeReadAltIndex(e.chatId);return a.messages.put(i)}}).then(function(){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(i,l)});d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(i,k)});d("MAWIndexedDb").afterTransactionThreadEvent({chatJid:e.jid,msgId:i.msgId},d("MAWThreadEventConst").PLACEHOLDER_CONVERT_SUBSCRIPTION);j!=null&&j.forEach(function(a){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(a,l)})});if(i.msgId===n){var b=i;b.rowId;b=babelHelpers.objectWithoutPropertiesLoose(b,h);d("MAWWriteMsgSideEffectTxns").updateParticipantTimestampsForMsg(a,b)}return i})})}function u(a,b,c,e){var f=d("MAWBuildIncomingMsgs").buildUnstoredDeleteForMeMsg(b,c);return d("MAWDexieTable").dexieAll([d("MAWDbReactionsTxns").deleteReactionsByUniqueMsgIdentifiers(a,[{author:f.author,chatJid:f.threadJid,externalId:f.externalId}]),q(a,f,c),a.pendingStanzas["delete"](e.rowId),d("MAWFTSTxns").maybePutMessageToPurgeBacklog(a,b.externalId)]).then(function(a){a[0];a=a[1];d("MAWDeleteForMeMsgContentCleaner").addNewDeleteForMeMsgContentCleanerTimestamp(f.messageDeleteForMeTs);return babelHelpers["extends"]({},f,{msgId:a.msgId,rowId:a.rowId})})}function v(a,b,e,f,g){g===void 0&&(g=!1);var h=d("MAWDbPendingStanzaTxns").getRevokedContent(f);if(h==null)throw c("FBLogger")("messenger_web").mustfixThrow("missing revoked content");b=d("MAWBuildIncomingMsgs").buildUnstoredRevokedMsg(b,e,h);return d("MAWDexieTable").dexieAll([p(a,b,e),a.pendingStanzas["delete"](f.rowId)]).then(function(b){var c=b[0];return d("MAWWriteRevokeMessageTxns").markIncomingMessageRevoked(a,c,e).then(function(){!d("MAWMpsGating").isEbUploadViaMpsEnabled()&&g&&(w(c,g),d("EBUploadSentDeletedMessage").sendDeleteEchoMessage__DEPRECATED_DO_NOT_USE(c,c.threadJid));return c})})}function w(a,b){if(a.type!==d("MAWMsgType").MSG_TYPE.REVOKED){d("WALogger").WARN(k||(k=babelHelpers.taggedTemplateLiteralLoose(["buildRevokeProtobufAndUpload: msgInDb is not of type Revoked"])));return}var e=d("MAWAsMessageApplication").asMessageApplication(a),f={bytes:d("WAAsMessageApplication").castToMessageApplicationBytes(d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,e).readByteArrayView()),version:"v3"},g=d("MAWJidUtils").toProtocolMsgId(a);g!=null&&c("promiseDone")(m.load().then(function(c){return c.uploadSentMessage({dbMsg:a,media:null,messageApplication:e,messageApplicationBytes:f.bytes,protocolMsgId:g,serverTs:(c=(c=a.originalTs)!=null?c:a.serverTs)!=null?c:a.ts,triggerSource:b?"upload-pending-stanza":"upload-sent-message",xmaPayload:null})}))}function x(a){if(c("qex")._("1849")!==!0)return"inserted_admin_msg";a=d("MAWGetThreadUpdateTypeForAdminMsg").getThreadUpdateTypeForAdminMsg(a)===d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD;return a?"incoming_msg":"outgoing_msg"}g.writeDedupedEphemeralSettingAdminMessage=a;g.writeDedupedAdminMessage=b;g.writeDedupedUsersConnectedAdminMessage=e;g.writeMsg=p;g.writeUnrenderedMsg=q;g.prepareTextMsgWriteData=f;g.prepareMsgWriteData=r;g.writeNewIncomingMsg=s;g.writeCiphertextUpdate=t;g.handleDeleteForMeMessage=u;g.handleOutOfOrderRevokedMessage=v}),98);
__d("MAWDbDeletedMessages",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({ChatDelete:"chat_delete",Revoke:"revoke"});f.DbDeletedMsgReasonEnum=a}),66);
__d("MAWMediaManagerDeferred",["promiseDone","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("MAWMediaManager").__setRef("MAWMediaManagerDeferred");function a(a){c("promiseDone")(h.load().then(function(b){b.getMawMediaManager().dequeueDownload(a)}))}g.dequeueDownload=a}),98);
__d("MAWUnsendMsgContentCleaner",["FBLogger","MAWMsgCleaner","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=null;function a(a){j==null&&(j=new(d("MAWMsgCleaner").MsgCleaner)(a,d("MAWMsgCleaner").CLEANER_TYPE.UNSEND))}function b(a){if(j==null){var b="Trying to add new UnsendMsgContentCleanerTimestamp before the cleaner is initialized!";d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["",""])),b);throw c("FBLogger")("messenger_web").mustfixThrow(b)}else d("WALogger").DEV(i||(i=babelHelpers.taggedTemplateLiteralLoose(["UnsendMsgContentCleaner: Adding timestamps (",")"])),a),j.update(a)}function e(){return j}function f(){j=null}g.startUnsendMsgContentCleaner=a;g.addNewUnsendMsgContentCleanerTimestamp=b;g.getUnsendMsgContentCleaner_FOR_TESTING_ONLY=e;g.resetUnsendMsgContentCleaner_FOR_TESTING_ONLY=f}),98);
__d("MAWWriteDeleteMessageTxns",["EBUploadSentDeletedMessage","MAWAckLevel","MAWDbMsg","MAWDbMsgTxns","MAWDbPendingStanza","MAWDbReactionsTxns","MAWDbThreadTxns","MAWDbXMATxns","MAWDeleteForMeMsgContentCleaner","MAWDexieTable","MAWFTSTxns","MAWIndexedDb","MAWMediaManagerDeferred","MAWMsgType","MAWPendingStanzaCleaner","MAWThreadSnippetBuildTxns","MAWUpdateQuotedMsgTxns","MAWUpdateThreadActivity","MAWXMAUtils","WAResultOrError","WATimeUtils","emptyFunction","gkx","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h=6*d("WATimeUtils").HOUR_SECONDS,i=30*d("WATimeUtils").DAY_SECONDS;function a(a,b){var c=b.protocolMsgId,e=c.author;b=c.chat;var f=c.externalId;return d("MAWDexieTable").dexieAll([d("MAWDbThreadTxns").getThread(a,b),a.unrenderedMessages.get({externalId:f}),d("MAWFTSTxns").maybePutMessageToPurgeBacklog(a,f)]).then(function(b){var g=b[0];b=b[1];if(!g.success)return d("WAResultOrError").makeError("missing_thread");return b!=null&&b.threadJid===g.value.jid&&b.author===e?d("WAResultOrError").makeError("duplicate_delete_for_me"):d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,c).then(function(b){if(b==null){var h={ack:d("MAWAckLevel").ACK.received,author:e,externalId:f,threadJid:g.value.jid,type:d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME},k=d("WATimeUtils").castToUnixTime(d("WATimeUtils").unixTime()+i);h={deleteTs:k,externalIdWithType:f+"_"+d("MAWDbPendingStanza").PENDING_DELETE_FOR_ME,pendingContent:{content:h,type:d("MAWDbPendingStanza").PENDING_TYPE.DELETE_FOR_ME}};return a.pendingStanzas.add(h).then(function(){d("MAWPendingStanzaCleaner").addNewPendingStanzaCleanerTimestamp(k);return d("WAResultOrError").makeResult()})}return d("MAWDexieTable").dexieResolve(j(a,b,e,c.chat,g.value)).then(function(){return d("WAResultOrError").makeResult()})})})}function j(a,b,e,f,g){var i,j=d("MAWDexieTable").dexieResolve();d("MAWXMAUtils").isXMAStoryReply((i=b.quote)==null?void 0:i.content.xmaMessageType)&&(j=k(a,b));var m={ack:b.ack,author:e,externalId:b.externalId,mediaId:b.mediaId,messageDeleteForMeTs:d("WATimeUtils").castToUnixTime(d("WATimeUtils").unixTime()+h),msgContent:(i=d("MAWDbMsg").getMsgContent(b))==null?void 0:i.content,msgId:b.msgId,quote:b.quote,reportingMeta:b.reportingMeta,serverTs:void 0,threadJid:f,ts:b.ts,type:d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME,xmaMessageType:b.xmaMessageType};i=d("MAWDexieTable").dexieAll([l(a,b.author,b.externalId,b.threadJid),d("MAWDbMsgTxns").deleteDbMsg(a,b.rowId),j]).then(function(e){e=e[0];e=e.concat(b);c("gkx")("23914")&&c("justknobx")._("1071")&&e.forEach(function(a){return d("EBUploadSentDeletedMessage").sendDeleteEchoMessage__DEPRECATED_DO_NOT_USE(a,g.jid)});if(d("MAWDbMsg").isMediaMsg(b)){e=b.mediaId;var f=b.plaintextHash;e!=null&&(f!=null?(d("MAWMediaManagerDeferred").dequeueDownload(f),d("MAWIndexedDb").afterTransaction({tag:"MediaExpired",value:{mediaId:e,msgId:b.msgId,plaintextHash:f,threadJid:b.threadJid}})):d("MAWIndexedDb").afterTransaction({tag:"MediaExpired",value:{mediaId:e,msgId:b.msgId,threadJid:b.threadJid}}))}return d("MAWDexieTable").dexieAll([d("MAWThreadSnippetBuildTxns").refreshThreadSnippet(a,g),d("MAWUpdateThreadActivity").updateThreadActivityFromDeletionTxn(a,b,b.threadJid)]).then(c("emptyFunction"))});return i.then(function(){return d("MAWDexieTable").dexieAll([a.unrenderedMessages.add(m),d("MAWDbReactionsTxns").deleteReactionsByUniqueMsgIdentifiers(a,[{author:e,chatJid:b.threadJid,externalId:b.externalId}]),d("MAWUpdateQuotedMsgTxns").disassociateQuotedMsg(a,b.threadJid,b.externalId,b.author,d("MAWMsgType").MSG_TYPE.REVOKED)]).then(function(){return d("MAWDbMsgTxns").maybeUpdateThreadMsgsForDeleteForMe(a,g.jid,b.msgId,b.sortOrderMs).then(function(){d("MAWDeleteForMeMsgContentCleaner").addNewDeleteForMeMsgContentCleanerTimestamp(m.messageDeleteForMeTs);return d("WAResultOrError").makeResult()})})})}function k(a,b){return d("MAWDbXMATxns").maybeGetXMAFromAssociatedMsgId(a,b.msgId).then(function(b){return d("MAWDbMsgTxns").maybeGetMsg(a,b==null?void 0:b.msgId).then(function(b){if(b!=null)return d("MAWDbMsgTxns").deleteDbMsg(a,b.rowId)})})}function l(a,b,c,e){return a.messages.where("quoteExternalId").equals(c).filter(function(a){var c;return a.type===d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE&&((c=a.quote)==null?void 0:c.content.author)===b&&a.threadJid===e}).toArray().then(function(b){if(b.length===0)return d("MAWDexieTable").dexieResolve([]);var c=b.map(function(a){return a.rowId});return d("MAWDbMsgTxns").bulkDeleteDbMsg(a,c).then(function(){return b})})}g.REVOKE_CONTENT_EXPIRATION_IN_SEC=h;g.handleDeleteForMe=a;g.deleteXMAStoryReplyMsg=k;g.deleteBumpMsgs=l}),98);
__d("MAWWriteRevokeMessageTxns",["EBUploadSentDeletedMessage","FBLogger","LSMEBTaskCreationSource","MAWAckLevel","MAWBridgeEventTransmitter","MAWBridgeMsg","MAWBridgeTypesCreators","MAWDbDeletedMessages","MAWDbMsg","MAWDbMsgTxns","MAWDbPendingStanza","MAWDbProtocolMsgIdMiddleware","MAWDbReactionsTxns","MAWDexieTable","MAWEphemeralUtil","MAWFTSTxns","MAWIndexedDb","MAWJidUtils","MAWMediaManagerDeferred","MAWMsgType","MAWPendingStanzaCleaner","MAWThreadSnippetBuildTxns","MAWUnsendMsgContentCleaner","MAWUpdateQuotedMsgTxns","MAWWriteDeleteMessageTxns","MAWWriteMsgTxns","MAWXMAUtils","WAJids","WATimeUtils","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h=6*d("WATimeUtils").HOUR_SECONDS,i=30*d("WATimeUtils").DAY_SECONDS;function a(a,b,e,f,g,h){if(h!=null&&f==null){h=babelHelpers["extends"]({},b,{originalTs:d("WATimeUtils").castMilliSecondsToUnixTime(h),threadJid:e.jid,unsendMsgContentDeleteTs:(h=b.serverTs)!=null?h:b.ts});return d("MAWWriteMsgTxns").writeMsg(a,h,e).then(function(a){return a.type==="Revoked"?a:null})}var k=d("WATimeUtils").castToUnixTime(d("WATimeUtils").unixTime()+i),m=b.author,n=b.externalId,o=b.revokedExternalId,p=g!=null?l(a,g):d("MAWDexieTable").dexieResolve();return d("MAWDexieTable").dexieAll([f==null?d("MAWDbMsgTxns").maybeGetMsgByExternalId(a,b.revokedExternalId,e.jid,b.author):d("MAWDexieTable").dexieResolve(f),d("MAWFTSTxns").maybePutMessageToPurgeBacklog(a,n)]).then(function(g){var h=g[0];(f==null||h!=null)&&c("FBLogger")("messenger_web").warn("Revoked message missing originalMsg incorrectly");if(h==null){g={deleteTs:k,externalIdWithType:o+"_"+d("MAWDbPendingStanza").PENDING_REVOKED,pendingContent:{content:{ack:d("MAWAckLevel").ACK.received,altIndex:void 0,author:m,externalId:n,revokedExternalId:o,threadJid:e.jid,ts:b.ts,type:"Revoked"},type:d("MAWDbPendingStanza").PENDING_TYPE.REVOKED}};return d("MAWDexieTable").dexieAll([a.pendingStanzas.add(g),p]).then(function(b){b[0];b=b[1];d("MAWPendingStanzaCleaner").addNewPendingStanzaCleanerTimestamp(k);d("MAWBridgeEventTransmitter").issuePointQueryOutsideTxn(o,d("WAJids").threadIdForChatJid(e.jid),void 0,c("LSMEBTaskCreationSource").POINT_QUERY_FROM_EB,e.jid);b===!0&&d("MAWThreadSnippetBuildTxns").refreshThreadSnippet(a,e)})}return p.then(function(){return j(a,h,e,b.externalId,b.revokedExternalId,b.serverTs,b.ts,!1)})})}function j(a,b,c,e,f,g,i,j){var l=babelHelpers["extends"]({},b,{altIndex:void 0,externalId:e,msgContent:d("MAWDbMsg").getMsgContent(b),originalTs:(e=b.serverTs)!=null?e:b.ts,revokedExternalId:f,serverTs:g,threadJid:c.jid,ts:i,type:"Revoked",unsendMsgContentDeleteTs:d("WATimeUtils").castToUnixTime(d("WATimeUtils").unixTime()+h)});d("MAWDbProtocolMsgIdMiddleware").appendProtocolMsgId(l);if(j){d("EBUploadSentDeletedMessage").sendDeleteEchoMessage__DEPRECATED_DO_NOT_USE(b,c.jid);return d("MAWDexieTable").dexieResolve(l)}return k(a,b,l,c).then(function(){return l})}function k(a,b,e,f){var g,h=d("MAWXMAUtils").isXMAStoryReply((g=b.quote)==null?void 0:g.content.xmaMessageType)?d("MAWWriteDeleteMessageTxns").deleteXMAStoryReplyMsg(a,b):d("MAWDexieTable").dexieResolve();g=d("MAWJidUtils").toProtocolMsgId(b);var i=g!=null?a.deletedMessages.add(babelHelpers["extends"]({},g,{reason:d("MAWDbDeletedMessages").DbDeletedMsgReasonEnum.Revoke})):d("MAWDexieTable").dexieResolve();return d("MAWWriteDeleteMessageTxns").deleteBumpMsgs(a,b.author,b.externalId,b.threadJid).then(function(g){return d("MAWDexieTable").dexieAll([a.messages.put(e),d("MAWDbReactionsTxns").deleteReactionsByUniqueMsgIdentifiers(a,[{author:e.author,chatJid:e.threadJid,externalId:e.revokedExternalId}]),d("MAWUpdateQuotedMsgTxns").disassociateQuotedMsg(a,e.threadJid,e.revokedExternalId,e.author,d("MAWMsgType").MSG_TYPE.REVOKED),h,i,d("MAWFTSTxns").maybePutMessageToPurgeBacklog(a,b.externalId)]).then(function(){if(b!=null&&!c("gkx")("11710")){var h=g.concat(b);h.forEach(function(a){return d("EBUploadSentDeletedMessage").sendDeleteEchoMessage__DEPRECATED_DO_NOT_USE(a,b.threadJid)})}d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(e)});if(b!=null&&d("MAWDbMsg").isMediaMsg(b)){h=b.mediaId;var i=b.plaintextHash;h!=null&&(i!=null?(d("MAWMediaManagerDeferred").dequeueDownload(i),d("MAWIndexedDb").afterTransaction({tag:"MediaExpired",value:{mediaId:h,msgId:b.msgId,plaintextHash:i,threadJid:b.threadJid}})):d("MAWIndexedDb").afterTransaction({tag:"MediaExpired",value:{mediaId:h,msgId:b.msgId,threadJid:b.threadJid}}))}d("MAWEphemeralUtil").maybeClearEphemeralMsgCountdown(b);return d("MAWThreadSnippetBuildTxns").refreshThreadSnippet(a,f)})})}function b(a,b,e){if(b.type!==d("MAWMsgType").MSG_TYPE.REVOKED)throw c("FBLogger")("messenger_web").mustfixThrow("Cant mark unrevoked message revoked");var f=d("MAWJidUtils").maybeToProtocolMsgId(b.author,b.threadJid,b.revokedExternalId),g=f!=null?a.deletedMessages.add(babelHelpers["extends"]({},f,{reason:d("MAWDbDeletedMessages").DbDeletedMsgReasonEnum.Revoke})):d("MAWDexieTable").dexieResolve();return d("MAWWriteDeleteMessageTxns").deleteBumpMsgs(a,b.author,b.revokedExternalId,b.threadJid).then(function(c){c.forEach(function(a){return d("EBUploadSentDeletedMessage").sendDeleteEchoMessage__DEPRECATED_DO_NOT_USE(a,b.threadJid)});c.length>0&&d("MAWIndexedDb").afterTransaction({tag:"DeleteMessages",value:d("MAWBridgeTypesCreators").createBridgeDeleteMessages(b.threadJid,c)});return d("MAWDexieTable").dexieAll([d("MAWDbReactionsTxns").deleteReactionsByUniqueMsgIdentifiers(a,[{author:b.author,chatJid:b.threadJid,externalId:b.revokedExternalId}]),d("MAWThreadSnippetBuildTxns").refreshThreadSnippet(a,e),g]).then(function(){d("MAWUnsendMsgContentCleaner").addNewUnsendMsgContentCleanerTimestamp(b.unsendMsgContentDeleteTs),d("MAWIndexedDb").afterTransaction({tag:"NewMsg",value:d("MAWBridgeMsg").createBridgeMsg(b)})})})}function l(a,b){return b.type===d("MAWMsgType").MSG_TYPE.CIPHERTEXT?a.messages["delete"](b.rowId).then(function(){d("MAWIndexedDb").afterTransaction({tag:"DeleteMessages",value:d("MAWBridgeTypesCreators").createBridgeDeleteMessages(b.threadJid,[b])});return!0}):d("MAWDexieTable").dexieResolve(!1)}g.REVOKE_CONTENT_EXPIRATION_IN_SEC=h;g.writeIncomingRevokeMsg=a;g.revokeUnstoredMsg=j;g.markExistingMsgRevoked=k;g.markIncomingMessageRevoked=b}),98);
__d("MAWConvertEchoMessagesToEBProtobufs",["MAWHandleEBRestoreWithHIM"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWHandleEBRestoreWithHIM").convertEchoMessagesToEBProtobufs(a,b)}g.convertEchoMessagesToEBProtobufs=a}),98);
__d("MAWUploadThreadTxns",["$InternalEnum","MAWFolderTypes"],(function(a,b,c,d,e,f,g){"use strict";var h=b("$InternalEnum")({INBOX:0,PENDING:1,OTHER:2,SPAM:3,ARCHIVED:4,HIDDEN:5});function i(a){switch(a){case d("MAWFolderTypes").FOLDER_ID.INBOX:return h.INBOX;case d("MAWFolderTypes").FOLDER_ID.PENDING:return h.PENDING;case d("MAWFolderTypes").FOLDER_ID.ARCHIVED:return h.ARCHIVED;default:return h.INBOX}}function a(a){return i(a).toString()}g.FolderType=h;g.getFolderTypeAsText=a}),98);
__d("MpsLogger",["FBLogger"],(function(a,b,c,d,e,f,g){"use strict";a=c("FBLogger")("mps");g.MpsLogger=a}),98);
__d("WormMemoryDriver",["WAResolvable","WormStoreFunctions","err"],(function(a,b,c,d,e,f,g){"use strict";var h=0;function i(){h+=1;return h}function a(){h=0}b=function(){function a(a){this.$2={};this.$3=Promise.resolve();this.$1=a;for(a of Object.keys(a))this.$2[a]=new Map()}var b=a.prototype;b.getSchema=function(){return this.$1};b.runInTransaction=function(a,b,c,e){var f=this,g=new(d("WAResolvable").Resolvable)();this.$3=this.$3.then(async function(){var d={};for(var e of Object.keys(f.$1))d[e]=new Map(f.$2[e]);e=a.reduce(function(a,b){return babelHelpers.extends({},a,(a={},a[b]=new j(d[b],f.$1[b]),a))},{});e={abort:function(){},commit:function(){return g.promise.then(function(){})},stores:e};e=await c(e);b==="readwrite"&&(f.$2=d);g.resolve(e)}).catch(function(a){g.reject(a)});return g.promise};b.close=function(){};b.init=function(a){return Promise.resolve()};return a}();var j=function(){function a(a,b){var d=this;this.readIndexRange=function(a,b,e){var f=d.$2.indexes;if(f==null)throw c("err")("No indexes found");f=f[a];if(f==null)throw c("err")("Index not found");var g=Array.from(d.$1.values());if(b!=null){var h;g=l(g,(h=(h=b.lessThan)!=null?h:b.lessThanOrEqual)!=null?h:b.only,b.lessThanOrEqual!=null||b.only!=null,(h=(h=b.greaterThan)!=null?h:b.greaterThanOrEqual)!=null?h:b.only,b.greaterThanOrEqual!=null||b.only!=null,f)}return Promise.resolve(d.$4(g,e,a))};this.$1=a;this.$2=b}var b=a.prototype;b.bulkAdd=function(a){var b=this;for(var d of a){this.$2.autoIncrement===!0&&d[this.$2.primaryKey]===void 0&&(d[this.$2.primaryKey]=i());if(this.$1.has(d[this.$2.primaryKey]))throw c("err")("Item with key already exists");this.$3(d);this.$1.set(d[this.$2.primaryKey],d)}return Promise.resolve(a.map(function(a){return a[b.$2.primaryKey]}))};b.bulkPut=function(a){for(a of a)this.$3(a),this.$1.set(a[this.$2.primaryKey],a);return Promise.resolve()};b.$3=function(a){var b=this,d=this.$2.indexes;if(d==null)return;for(d of Object.values(d)){if(typeof d!=="object"||d==null)continue;var e=d.fields,f=d.unique;if(f===!1)continue;var g=e.map(function(b){return a[b]}).join(":");f=function(d){if(d[b.$2.primaryKey]===a[b.$2.primaryKey])return 1;var f=e.map(function(a){return d[a]}).join(":");if(g===f)throw c("err")("ConstraintError")};for(var h of this.$1.values())if(f(h))continue}};b.bulkGet=function(a){var b=this;return Promise.resolve(a.map(function(a){return b.$1.get(a)}))};b.get=function(a){return Promise.resolve(this.$1.get(a))};b.getByIndex=function(a,b,c){return d("WormStoreFunctions").getByIndex(this,a,b,c)};b.readByKeyRange=function(a,b){var c;c=k(Array.from(this.$1.values()),(c=a.lessThan)!=null?c:a.lessThanOrEqual,a.lessThanOrEqual!=null,(c=a.greaterThan)!=null?c:a.greaterThanOrEqual,a.greaterThanOrEqual!=null,this.$2.primaryKey);return Promise.resolve(this.$4(c,b))};b.bulkDelete=function(a){for(a of a)this.$1.delete(a);return Promise.resolve()};b.delete=function(a){this.$1.delete(a);return Promise.resolve()};b.bulkUpsert=function(a,b){return d("WormStoreFunctions").bulkUpsert(this,this.$2,a,b)};b.readKeysByIndexRange=function(a,b,c){var d=this;return this.readIndexRange(a,b,c).then(function(a){return a.map(function(a){return a[d.$2.primaryKey]})})};b.getIndexRangeIterator=function(a,b,c,e){return d("WormStoreFunctions").getIndexRangeIterator(this.readIndexRange,this.$2,a,b,c,e)};b.$4=function(a,b,c){a=a;(b==null?void 0:b.filter)!=null&&(a=a.filter(b.filter));(b==null?void 0:b.order)!=null&&c!=null&&(a=a.sort(function(a,d){a=a[c];d=d[c];if(a===d)return 0;if(b.order==="desc")return d>a?1:-1;else return a>d?1:-1}));(b==null?void 0:b.limit)!=null&&(a=a.slice(0,b.limit));return a};b.readIndex=function(a,b,d){var e=this.$2.indexes;if(e==null)throw c("err")("No indexes found");var f=e[a];if(f==null)throw c("err")("Index not found");e=Array.from(this.$1.values());b!=null&&(e=e.filter(function(a){for(var c=0;c<f.fields.length;c++)if(a[f.fields[c]]!==b[c])return!1;return!0}));return Promise.resolve(this.$4(e,d,a))};b.readIndexKeys=function(a,b,c){var d=this;return this.readIndex(a,b,c).then(function(a){return a.map(function(a){return a[d.$2.primaryKey]})})};b.readAll=function(a){var b=this,c=Array.from(this.$1.values());(a==null?void 0:a.filter)!=null&&(c=c.filter(a.filter));(a==null?void 0:a.order)!=null&&(c=c.sort(function(c,d){c=c[b.$2.primaryKey];d=d[b.$2.primaryKey];if(c===d)return 0;if(a.order==="desc")return d>c?1:-1;else return c>d?1:-1}));(a==null?void 0:a.limit)!=null&&(c=c.slice(0,a.limit));return Promise.resolve(c)};b.readKeys=function(a){var b=this;return this.readAll(a).then(function(a){return a.map(function(a){return a[b.$2.primaryKey]})})};b.clear=function(){this.$1.clear();return Promise.resolve()};b.count=function(){return Promise.resolve(this.$1.size)};return a}();function k(a,b,c,d,e,f){return a.filter(function(a){if(d!=null&&d>a[f])return!1;if(b!=null&&b<a[f])return!1;if(b!=null&&c===!1&&a[f]===b)return!1;return d!=null&&e===!1&&a[f]===d?!1:!0})}function l(a,b,c,d,e,f){return a.filter(function(a){for(var g=0;g<f.fields.length;g++){if(d!=null&&d[g]>a[f.fields[g]])return!1;if(b!=null&&b[g]<a[f.fields[g]])return!1;if(g===f.fields.length-1){if(b!=null&&c===!1&&a[f.fields[g]]===b[g])return!1;if(d!=null&&e===!1&&a[f.fields[g]]===d[g])return!1}}return!0})}g.TEST_ONLY_resetPK=a;g.WormMemoryDriver=b;g.WormMemoryStore=j}),98);
__d("WebReverbSchema",["FBLogger","MAWWormOdsLogger","WAHex","Worm","WormEAR","WormIDbDriver","WormMemoryDriver"],(function(a,b,c,d,e,f,g){"use strict";e={autoIncrement:!0,indexes:{"[threadId+messageId]":{fields:["threadId","messageId"],unique:!0},"[threadId+timestampMs+messageId]":{fields:["threadId","timestampMs","messageId"],unique:!1},expiryTimestampMs:{fields:["expiryTimestampMs"],unique:!1},messageId:{fields:["messageId"],unique:!1},timestampMs:{fields:["timestampMs"],unique:!1}},nonEncryptedFields:["timestampMs","expiryTimestampMs","messageId","debugFlags"],primaryKey:"pk",secure:!0};f={autoIncrement:!0,indexes:{"[threadId+topLevelMessageId+supplementalKey]":{fields:["threadId","topLevelMessageId","supplementalKey"],unique:!0}},nonEncryptedFields:["topLevelMessageId"],primaryKey:"pk",secure:!0};var h={autoIncrement:!0,indexes:{"[threadId+deletedMessageId]":{fields:["threadId","deletedMessageId"],unique:!0},"[threadId+topLevelMessageId+supplementalKey]":{fields:["threadId","topLevelMessageId","supplementalKey"],unique:!1},deletionTimestampMs:{fields:["deletionTimestampMs"],unique:!1}},nonEncryptedFields:["topLevelMessageId","deletionTimestampMs"],primaryKey:"pk",secure:!0},i={autoIncrement:!0,indexes:{"[threadId+messageId+tag]":{fields:["threadId","messageId","tag"],unique:!0},"[threadId+tag+timestampMs]":{fields:["threadId","tag","timestampMs"],unique:!1}},nonEncryptedFields:["messageId","timestampMs","messagePk","tag"],primaryKey:"pk",secure:!0},j={autoIncrement:!1,indexes:{},primaryKey:"pk",secure:!0},k={dbMetadata:j,deleted:h,message:e,supplemental:f,tags:i};function a(a,b,e,f,g){b=d("WAHex").parseHex(b);var h="reverb";b=new(d("WormEAR").WormEAR)(k,h,b);var i=new(d("Worm").WormDatabase)(new(d("WormIDbDriver").WormIDbDriver)(a,h,k,b,d("MAWWormOdsLogger").wormOdsWorkerLogger,{blockingErrorThreshold:e,onBlockingError:f,onTransactionError:function(a){if(a instanceof d("WormEAR").DecryptionError){var b=a;c("FBLogger")("mps").mustfix("EAR decryption error in store: %s. Dropping corrupted entity %s",b.store,b.maybeHashedPk);void i.runInTransaction([b.store],"readwrite",function(a){a=a.stores[b.store];return b.maybeHashedPk!=null?a["delete"](b.maybeHashedPk):a.clear()},"delete-corrupted-entity")}}}),g);return i}function b(a){return new(d("Worm").WormDatabase)(new(d("WormMemoryDriver").WormMemoryDriver)(k),a)}g.schema=k;g.makeWebReverbSchema=a;g.makeInMemoryReverbSchema_TEST_ONLY=b}),98);
__d("WebReverbDB",["MpsLogger","WAResolvable","WebReverbSchema","err","getErrorSafe"],(function(a,b,c,d,e,f,g){"use strict";var h,i=new(d("WAResolvable").Resolvable)();async function a(a,b,e,f,g){try{a=d("WebReverbSchema").makeWebReverbSchema(a,b,e,f,g);h=a;await a.init();i.resolve(a);return a}catch(a){d("MpsLogger").MpsLogger.catching(c("getErrorSafe")(a)).mustfix("Error performing WebReverb init");throw a}}function b(){if(h==null)throw c("err")("Reverb DB is not initialized");return h}function e(){return i.promise}function f(a){return"WebReverb - "+a}g.makeWebReverb=a;g.getWebReverbDB=b;g.getDbPromise=e;g.mpsOp=f}),98);
__d("MpsReverbDbDump",["WebReverbDB","WormDump"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a=d("WebReverbDB").getWebReverbDB();return a.dump({dbMetadata:{customFields:{mawDBMessagesMigratedToTs:(a=d("WormDump")).wormNonSensitiveField,pk:a.wormNonSensitiveField}},deleted:{customFields:{deletedMessageId:a.wormNonSensitiveField,deletionMessageId:a.wormNonSensitiveField,deletionTimestampMs:a.wormNonSensitiveField,isLocalOnlyMessage:a.wormNonSensitiveField,pk:a.wormNonSensitiveField,supplementalKey:a.wormNonSensitiveField,threadId:a.wormNonSensitiveField,timestampMs:a.wormNonSensitiveField,topLevelMessageId:a.wormNonSensitiveField},limit:1e3},message:{customFields:{debugFlags:a.wormNonSensitiveField,expiryTimestampMs:a.wormNonSensitiveField,isLocalOnlyMessage:a.wormNonSensitiveField,isTransportErrorPlaceholder:a.wormNonSensitiveField,messageId:a.wormNonSensitiveField,pk:a.wormNonSensitiveField,senderId:a.wormNonSensitiveField,threadId:a.wormNonSensitiveField,timestampMs:a.wormNonSensitiveField},limit:2500},supplemental:{customFields:{messageId:a.wormNonSensitiveField,pk:a.wormNonSensitiveField,supplementalKey:a.wormNonSensitiveField,threadId:a.wormNonSensitiveField,timestampMs:a.wormNonSensitiveField,topLevelMessageId:a.wormNonSensitiveField},limit:1e3},tags:{customFields:{messageId:a.wormNonSensitiveField,messagePk:a.wormNonSensitiveField,pk:a.wormNonSensitiveField,threadId:a.wormNonSensitiveField,timestampMs:a.wormNonSensitiveField},limit:1e3}})}g.debugGetReverbDbDump=a}),98);
__d("WAPromiseQueue",["Promise"],(function(a,b,c,d,e,f){"use strict";var g;a=function(){function a(a){a===void 0&&(a=-1),this.$1=(g||(g=b("Promise"))).resolve(),this.$3=0,this.$2=a}var c=a.prototype;c.wait=function(){return this.$1};c.enqueueHandlers=function(a,b,c){var d=this;this.$3++;b=this.$1.then(function(){return a}).then(b,c);c=b.then();this.$1=h(b,this.$2)["finally"](function(){d.$3--});return c};c.enqueue=function(a){var b=this;this.$3++;a=this.$1.then(a);var c=a.then();this.$1=h(a,this.$2)["finally"](function(){b.$3--});return c};c.size=function(){return this.$3};return a}();c=function(){function a(a){a===void 0&&(a=-1),this.$1=new Map(),this.$2=a}var c=a.prototype;c.waitIfPending=function(a){return this.$1.get(a)};c.wait=function(a){return this.$1.get(a)||(g||(g=b("Promise"))).resolve()};c.enqueueHandlers=function(a,b,c,d){c=this.wait(a).then(function(){return b}).then(c,d);return this.$3(a,c)};c.enqueue=function(a,b){b=this.wait(a).then(b);return this.$3(a,b)};c.$3=function(a,b){var c=this,d=b.then(),e,f=function(){c.$1.get(a)===e&&c.$1["delete"](a)};e=h(b,this.$2).then(f,f);this.$1.set(a,e);return d};return a}();function h(a,c){if(c>=0)return new(g||(g=b("Promise")))(function(b){var d=function(){return void b()};a.then(d,d);setTimeout(d,c)});else return a.then(i,i)}function i(){}f.PromiseQueue=a;f.PromiseQueueMap=c}),66);
__d("WebMpsGetDistinctSupplementals",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){var c=new Map(a),d=new Map();b.forEach(function(a,b){var e=c.get(b);if(e==null)c.set(b,a),d.set(b,a);else{e=e.timestampMs;var f=a.timestampMs;f>e&&(c.set(b,a),d.set(b,a))}});return{supplementals:c,supplementalsToWriteToReverb:d}}f.getDistinctSupplementals=a}),66);
__d("WebMpsGetDistinctMessages",["WebMpsGetDistinctSupplementals"],(function(a,b,c,d,e,f,g){"use strict";var h=["debugFlags","expiryTimestampMs","isLocalOnlyMessage","isTransportErrorPlaceholder","pk"],i=["debugFlags","expiryTimestampMs","isLocalOnlyMessage","isTransportErrorPlaceholder","pk"];function a(a,b){var c=new Map(),e=new Map();a.forEach(function(a){var b=a.reverbTopLevel;b.debugFlags;var d=b.expiryTimestampMs;b.isLocalOnlyMessage;b.isTransportErrorPlaceholder;b.pk;b=babelHelpers.objectWithoutPropertiesLoose(b,h);e.set(a.reverbTopLevel.messageId,a);c.set(a.reverbTopLevel.messageId,{expiryTimestampMs:d,supplementalProtobufs:a.supplementalProtobufs,tags:a.tags,toplevelProtobuf:b})});var f=new Map(),g=new Map(),j=new Map();b.forEach(function(a){var b=a.supplementalProtobufs,h=a.tags,k=a.toplevelProtobuf,l=k.messageId,m=e.get(l);if(m==null||m.reverbTopLevel.isTransportErrorPlaceholder===!0)c.set(l,a),f.set(l,k),g.set(l,new Map(b)),j.set(l,h);else{a=m.supplementalProtobufs;k=d("WebMpsGetDistinctSupplementals").getDistinctSupplementals(a,b);h=k.supplementals;a=k.supplementalsToWriteToReverb;b=m.reverbTopLevel;b.debugFlags;k=b.expiryTimestampMs;b.isLocalOnlyMessage;b.isTransportErrorPlaceholder;b.pk;b=babelHelpers.objectWithoutPropertiesLoose(b,i);c.set(l,{expiryTimestampMs:k,supplementalProtobufs:h,tags:m.tags,toplevelProtobuf:b});a.size>0&&g.set(l,new Map(a))}});return{messages:Array.from(c.values()),supplementalMessagesToWriteToReverb:g,tagsToWriteToReverb:j,topLevelMessagesToWriteToReverb:f}}g.getDistinctMessages=a}),98);
__d("WebMpsReverbWrites",[],(function(a,b,c,d,e,f){"use strict";function a(a,b,c,d,e,f,g){var h=[e,d,c];return g(async function(g){var i=await g.stores.supplemental.getByIndex("[threadId+topLevelMessageId+supplementalKey]",h);if(((i=i==null?void 0:i.timestampMs)!=null?i:0)>=f)return;i={messageId:a,payload:b,supplementalKey:c,threadId:e,timestampMs:f,topLevelMessageId:d};await g.stores.supplemental.bulkUpsert("[threadId+topLevelMessageId+supplementalKey]",[{item:i,selector:h}])})}function b(a,b,c){var d=a.messageId,e=a.threadId;return c(async function(c){var f,g=await c.stores.message.getByIndex("[threadId+messageId]",[e,d]);if(g!=null&&!g.isTransportErrorPlaceholder)return;if(g!=null&&g.isTransportErrorPlaceholder&&b.isTransportErrorPlaceholder)return;var h=await c.stores.deleted.getByIndex("[threadId+deletedMessageId]",[a.threadId,a.messageId]),i=babelHelpers.extends({},a,{debugFlags:b.debugFlags,expiryTimestampMs:b.expiryTimestampMs,isLocalOnlyMessage:b.isLocalOnly,isTransportErrorPlaceholder:b.isTransportErrorPlaceholder,timestampMs:(f=g==null?void 0:g.timestampMs)!=null?f:a.timestampMs});if(!h){f=await c.stores.message.bulkUpsert("[threadId+messageId]",[{item:i,selector:[e,d]}]);var j=f[0];f=await c.stores.tags.readIndexRange("[threadId+messageId+tag]",{only:[e,d]});f.length>0&&await c.stores.tags.bulkDelete(f.map(function(a){return a.pk}));b.tags.length>0&&await c.stores.tags.bulkAdd(b.tags.map(function(a){return{messageId:i.messageId,messagePk:j,tag:a,threadId:i.threadId,timestampMs:i.timestampMs}}))}else h.payload=i.payload,await c.stores.deleted.bulkPut([h]),g!=null&&(g.timestampMs=a.timestampMs,await c.stores.message.bulkPut([g]))})}f.upsertSupplementalToReverb=a;f.upsertTopLevelToReverb=b}),66);
__d("WebMpsPersistMessagesFromEb",["MpsLogger","MpsTypes","WebMpsReverbWrites","WebReverbDB"],(function(a,b,c,d,e,f,g){"use strict";async function a(a){if(a.length===0||a.every(function(a){return a.topLevelProtobufs.size===0&&a.supplementalProtobufs.size===0&&a.tags.size===0}))return;try{await d("WebReverbDB").getWebReverbDB().runInTransaction(["message","supplemental","deleted","tags"],"readwrite",function(b){var c=a.map(function(a){var c=a.supplementalProtobufs,d=a.tags,e=a.threadId;a=a.topLevelProtobufs;return h(a,c,d,e,function(a){return a(b)})}).flat();return Promise.all(c)},"mps-persist-messages-from-eb")}catch(a){d("MpsLogger").MpsLogger.catching(a).mustfix("Runtime error performing persistMessagesFromEB");throw a}}function h(a,b,c,e,f){var g=[];a.forEach(function(a,b){g.push(d("WebMpsReverbWrites").upsertTopLevelToReverb(a,{actionType:d("MpsTypes").ActionType.UpsertTopLevel,debugFlags:["EB"],isLocalOnly:!1,isTransportErrorPlaceholder:!1,tags:(a=c.get(b))!=null?a:[],targetMessageId:b},f))});b.forEach(function(a,b){a.forEach(function(a,c){g.push(d("WebMpsReverbWrites").upsertSupplementalToReverb(a.messageId,a.payload,c,b,e,a.timestampMs,f))})});return g}g.persistMessagesFromEB=a}),98);
__d("WebMpsBatchLoadMessage",["MpsLogger","WAGetSafeQPLError","WAJids","WebMpsGetDistinctMessages","WebMpsPersistMessagesFromEb","WebReverbDB","err","getErrorSafe","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h=["pk","supplementalKey","threadId","topLevelMessageId"];async function i(a,b,e,f,g){try{g.metric.addPoint("load-message-from-reverb_start");var i=d("WebReverbDB").getWebReverbDB();i=await i.runInTransaction(["message","supplemental","tags"],"readonly",function(c){return Promise.all(b.map(function(b){var d=c.stores.message.readIndex("[threadId+messageId]",[a,b],{limit:1}),g=f?c.stores.tags.readIndexRange("[threadId+messageId+tag]",{only:[a,b]}):[],h=e?c.stores.supplemental.readIndexRange("[threadId+topLevelMessageId+supplementalKey]",{only:[a,b]}):[];return Promise.all([b,d,h,g])}))},"mps-load-message");g.metric.addPoint("load-message-from-reverb_end");var j=new Map();i.forEach(function(a){var b=a[0],c=a[1];c=c[0];var d=a[2];a=a[3];if(c==null)return null;var e=new Map();d.forEach(function(a){a.pk;var b=a.supplementalKey;a.threadId;a.topLevelMessageId;a=babelHelpers.objectWithoutPropertiesLoose(a,h);e.set(b,a)});d=a.map(function(a){a=a.tag;return a});j.set(b,{reverbTopLevel:c,supplementalProtobufs:e,tags:d})});return j}catch(a){g.metric.addPoint("load-message-from-reverb_fail");d("MpsLogger").MpsLogger.catching(c("getErrorSafe")(a)).mustfix("Runtime error performing loadMessageFromReverb");return new Map()}}async function j(a,b,e,f,g){try{g.metric.addPoint("load-message-from-eb-check_start");var h=e.isEbEnabled();g.metric.addPoint("load-message-from-eb-check_end",{bool:{ebEnabled:h}});if(!h)return new Map();g.metric.addPoint("load-message-from-eb_start");h=e.messagePointQuery;e=d("WAJids").validateChatJid(a);e=c("nullthrows")(e,"invalid threadId passed to validateThreadId: "+a);h=await h({chatJid:e,instanceKey:g.metric.getQPLAttrs().instanceKey,messageIds:b});if(h.success===!1)return new Map();e=f(h.value,a);g.metric.addPoint("load-message-from-eb_end");return new Map(e.map(function(a){return[a.toplevelProtobuf.messageId,a]}))}catch(a){g.metric.addPoint("load-message-from-eb_fail");b=c("getErrorSafe")(a);d("MpsLogger").MpsLogger.catching(b).mustfix("Runtime error performing loadFromEB");return new Map()}}async function a(a,b,e,f,g){var h=e.decodeAndParseEbProtobufs,k=e.eb;e=f.persistToReverb;var l=f.shouldFetchSupplementals,m=f.shouldFetchTags;f=f.strategy;try{g.metric.addPoint("load-message_start");l=i(a,b,l,m,g);m=function(){return j(a,b,k,h,g)};var n,o;switch(f){case"local-first":n=await l;var p=n.size===b.length;p?o=new Map():o=await m();break;case"full-fetch":p=await Promise.all([l,m()]);n=p[0];o=p[1];break;case"local-only":n=await l;o=new Map();break;case"remote-only":n=new Map();o=await m();break;default:f;throw c("err")("empty strategy")}p=b.map(function(a){var b=n.get(a);a=o.get(a);return d("WebMpsGetDistinctMessages").getDistinctMessages([b].filter(Boolean),[a].filter(Boolean))});e==="persist"&&void d("WebMpsPersistMessagesFromEb").persistMessagesFromEB(p.map(function(b){var c=b.supplementalMessagesToWriteToReverb,d=b.tagsToWriteToReverb;b=b.topLevelMessagesToWriteToReverb;return{supplementalProtobufs:c,tags:d,threadId:a,topLevelProtobufs:b}}));g.metric.addPoint("load-message_end");return p.map(function(a){return a.messages[0]})}catch(a){l=c("getErrorSafe")(a);g.metric.addPoint("load-message_fail",{string:{errorDescription:d("WAGetSafeQPLError").getSafeQPLErrorMessage(l)}});d("MpsLogger").MpsLogger.catching(l).mustfix("Runtime error performing loadMessage");throw l}}g.batchLoadMessage=a}),98);
__d("PackedMpsRange",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}f.packMpsRange=a}),66);
__d("WebMpsBatchLoadFromReverb",["MpsLogger","WebReverbDB","WebReverbSchema","WormRangeIterator","getErrorSafe"],(function(a,b,c,d,e,f,g){"use strict";var h=["pk","supplementalKey","threadId","topLevelMessageId"];async function i(a,b,c,e,f,g,i,j,k){var l=c[0],m=c[1],n=j?function(a){return a.isLocalOnlyMessage===!1}:void 0,o="[threadId+timestampMs+messageId]";function p(){var c=a.stores.message.getIndexRangeIterator(o,e,{greaterThanOrEqual:[b],lessThanOrEqual:[b]},n),d=m==null?[b,l]:[b,l,m];return c.read(d,f)}async function q(c){var g="[threadId+tag+timestampMs]";c=await Promise.all(Array.from(c).map(function(c){return a.stores.tags.getIndexRangeIterator(g,e,{greaterThanOrEqual:[b],lessThanOrEqual:[b]}).read([b,c,l],f)}));c=d("WormRangeIterator").mergeRanges(c,g,d("WebReverbSchema").schema.tags,e,f);var h=await Promise.all(c.data.map(function(b){return a.stores.message.getByIndex("[threadId+messageId]",[b.threadId,b.messageId],{filter:n})})).then(function(a){return a.filter(Boolean)});c=d("WormRangeIterator").makeCursorInfoFromList(h,o,d("WebReverbSchema").schema.message,c.cursorInfo.hasNext,c.cursorInfo.hasPrevious);return{cursorInfo:c,data:h}}k!=="all"?c=await q(k):c=await p();j=c;q=j.cursorInfo;k=j.data;p=await Promise.all(k.map(async function(c){var d=g?await a.stores.supplemental.readIndexRange("[threadId+topLevelMessageId+supplementalKey]",{only:[b,c.messageId]}):[],e=new Map();d.forEach(function(a){a.pk;var b=a.supplementalKey;a.threadId;a.topLevelMessageId;a=babelHelpers.objectWithoutPropertiesLoose(a,h);e.set(b,a)});d=i?await a.stores.tags.readIndexRange("[threadId+messageId+tag]",{only:[b,c.messageId]}):[];d=d.map(function(a){a=a.tag;return a});return{reverbTopLevel:c,supplementalProtobufs:e,tags:d}}));return{cursorInfo:{endCursor:q.endCursor!=null?[q.endCursor[1],q.endCursor[2]]:null,hasNext:q.hasNext,hasPrevious:q.hasPrevious,startCursor:q.startCursor!=null?[q.startCursor[1],q.startCursor[2]]:null},messages:p,threadId:b}}async function a(a,b,e,f,g,h){try{g.metric.addPoint("reverb_fetch_start");var j=d("WebReverbDB").getWebReverbDB();j=new Map(await j.runInTransaction(["message","supplemental","tags"],"readonly",function(c){return Promise.all(a.map(function(a){return i(c,a.threadId,a.from,a.direction,a.numMessages,b,e,f,h).then(function(b){return[a,b]})}))},"mps-load-messages"));g.metric.addPoint("reverb_fetch_end");return j}catch(a){j=c("getErrorSafe")(a);d("MpsLogger").MpsLogger.catching(j).mustfix("Runtime error performing WebMpsBatchLoadFromReverb");g.metric.addPoint("reverb_fetch_end",{bool:{reverbFail:!0}});return new Map()}}g.batchLoadMessagesFromReverb=a}),98);
__d("WebMpsLoadMessagesFromEb",["LSMEBTaskCreationSource","MSGDataclassTypes.flow","MpsLogger","MpsTypes","WAGetSafeQPLError","WAJids","WAPromiseDelays","WAResultOrError","getErrorSafe","justknobx","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return a!=="all"&&a.size===2&&a.has(d("MSGDataclassTypes.flow").MpsMessageTag.Video)&&a.has(d("MSGDataclassTypes.flow").MpsMessageTag.Photo)?c("LSMEBTaskCreationSource").MEDIA_GALLERY_RESTORE:void 0}async function i(a,b,e,f,g,i,j,k){try{var l=function(){d("MpsLogger").MpsLogger.mustfix("Timed out waiting for EB Fetch");j.metric.addPoint("eb_fetch_timeout");return d("WAResultOrError").makeError("timeout")};g=g.messageRangeQuery;var m=d("WAJids").validateChatJid(a);m=c("nullthrows")(m,"invalid threadId passed to validateThreadId: "+a);var n=Date.now()+6e4;b=Math.max(0,Math.min(b[0],n));n=h(k);k=await d("WAPromiseDelays").withTimeout(g({after:[""+b,void 0],chatJid:m,ctx:j,direction:e==="asc"?"after":"before",numMessages:f,source:n}),c("justknobx")._("3429"),l);if(k.success===!0){g=k.value;b=g.cursorInfo;m=b.endCursor;e=b.hasNext;f=b.hasPrevious;n=b.startCursor;l=g.messages;b=l!=null?i(l,a):[];j.metric.addPoint("eb_fetch_end");return d("WAResultOrError").makeResult({cursorInfo:{endCursor:m!=null?[Number(m[0]),d("MpsTypes").toMessageId(m[1])]:void 0,hasNext:e,hasPrevious:f,startCursor:n!=null?[Number(n[0]),d("MpsTypes").toMessageId(n[1])]:void 0},messages:b,threadId:a})}j.metric.addAnnotations({string:{ebFetchFailReason:k.error}});d("MpsLogger").MpsLogger.warn("EB Fetch Failed: %s",k.error);return d("WAResultOrError").makeError("eb-fetch")}catch(a){d("MpsLogger").MpsLogger.catching(c("getErrorSafe")(a)).mustfix("Runtime error performing loadMessageFromEB");j.metric.addAnnotations({string:{ebFetchFailReason:d("WAGetSafeQPLError").getSafeQPLErrorMessage(a)}});return d("WAResultOrError").makeError("eb-fetch")}}async function a(a,b,e,f){var g=b.decodeAndParseEbProtobufs,h=b.eb;try{b=h.isEbEnabled();if(!b)return new Map();b=!1;e.metric.addPoint("load-messages-from-eb_start");a=new Map((await Promise.all(a.map(function(a){return i(a.threadId,a.from,a.direction,a.numMessages,h,g,e,f).then(function(c){if(c.success===!1){b=!0;return null}return[a,c.value]})}))).filter(Boolean));b&&e.metric.addAnnotations({bool:{ebFetchFailed:!0}});e.metric.addPoint("load-messages-from-eb_end");return a}catch(b){a=c("getErrorSafe")(b);e.metric.addPoint("load-messages-from-eb_fail");d("MpsLogger").MpsLogger.catching(a).mustfix("Error fetching from EB");return new Map()}}g.loadMessagesFromEb=a}),98);
__d("WebMpsMergeMessageRangesFromDifferentSources",["WebMpsGetDistinctMessages","err","first","last"],(function(a,b,c,d,e,f,g){"use strict";var h=["debugFlags","expiryTimestampMs","isLocalOnlyMessage","isTransportErrorPlaceholder","pk"];function a(a,b,e,f,g){var i;i=d("WebMpsGetDistinctMessages").getDistinctMessages((i=b==null?void 0:b.messages)!=null?i:[],(i=a==null?void 0:a.messages)!=null?i:[]);var j=i.messages,k=i.supplementalMessagesToWriteToReverb,l=i.tagsToWriteToReverb;i=i.topLevelMessagesToWriteToReverb;if(b==null||a==null){var m=b!=null?babelHelpers["extends"]({},b,{messages:b.messages.map(function(a){var b=a.reverbTopLevel;a=a.supplementalProtobufs;b.debugFlags;var c=b.expiryTimestampMs;b.isLocalOnlyMessage;b.isTransportErrorPlaceholder;b.pk;b=babelHelpers.objectWithoutPropertiesLoose(b,h);return{expiryTimestampMs:c,supplementalProtobufs:a,tags:[],toplevelProtobuf:b}})}):a;if(m==null)throw c("err")("data-fetching-error");return{range:m,supplementalMessagesToWriteToReverb:k,tagsToWriteToReverb:l,topLevelMessagesToWriteToReverb:i}}m=a;a=[].concat(j).sort(function(a,b){return e==="asc"?a.toplevelProtobuf.timestampMs-b.toplevelProtobuf.timestampMs:b.toplevelProtobuf.timestampMs-a.toplevelProtobuf.timestampMs});j=a.slice(0,f);a=c("first")(j);f=c("last")(j);a=a!=null?[a.toplevelProtobuf.timestampMs,a.toplevelProtobuf.messageId]:void 0;f=f!=null?[f.toplevelProtobuf.timestampMs,f.toplevelProtobuf.messageId]:void 0;var n=f!=null?m.cursorInfo.hasNext||b.cursorInfo.hasNext:!1;m=a!=null?m.cursorInfo.hasPrevious||b.cursorInfo.hasPrevious:!1;return{range:{cursorInfo:{endCursor:f,hasNext:n,hasPrevious:m,startCursor:a},messages:j,threadId:g},supplementalMessagesToWriteToReverb:k,tagsToWriteToReverb:l,topLevelMessagesToWriteToReverb:i}}g.mergeMessageRangesFromDifferentSources=a}),98);
__d("WebMpsEbCache",["WAJids","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e,f,g){b=d("WAJids").validateChatJid(b);if(b==null)return[];a=a.getMetadataFromCache({chatJid:b,direction:c,numberOfMessages:e,referenceMessage:g,referenceTimestamp:f==null?null:d("WATimeUtils").castToMillisTime(f)});return a.success===!1?[]:a.value.map(function(a){var b=a.offlineThreadingId;a=a.sortOrderMs;return{offlineThreadingId:b,sortOrderMs:a}})}function b(a,b){if(a==null)return"no-match";if(b.length===0)return"no-match";var c=new Set(a.messages.map(function(a){return a.reverbTopLevel.messageId})),d=new Set(b.map(function(a){return a.offlineThreadingId}));if(c.size!==d.size)return"no-match";if(Array.from(c).every(function(a){return d.has(a)}))return"match";c=a.messages.map(function(a){return a.reverbTopLevel.timestampMs}).sort(function(a,b){return b-a});a=b.map(function(a){return a.sortOrderMs}).sort(function(a,b){return b-a});b=0;for(var e=0;e<c.length;e++){var f=c[e],g=a[b];if(f<g)return"no-match";if(f>g)continue;b++}return"reverb-newer"}g.loadEBMetadataCache=a;g.compareReverbVsMetadataCache=b}),98);
__d("WebMpsValidateReverbViaCacheAndFetchFromEb",["MpsLogger","WATimeUtils","WebMpsEbCache","WebMpsLoadMessagesFromEb"],(function(a,b,c,d,e,f,g){"use strict";async function a(a,b,c,e,f){var g=await b;b=new Map();if(f!=="all")return{eb:await d("WebMpsLoadMessagesFromEb").loadMessagesFromEb(a,c,e,f),reverb:g};a=a.filter(function(a){var b=a.direction,e=a.from,f=a.numMessages,h=a.threadId;h=d("WebMpsEbCache").loadEBMetadataCache(c.eb,h,b,f,d("WATimeUtils").castToMillisTime(e[0]),e[1]);f=d("WebMpsEbCache").compareReverbVsMetadataCache(g.get(a),h);d("MpsLogger").MpsLogger.debug("MPS Range query metadata comparison: ",f);if(f==="match")return!1;return b==="desc"&&f==="reverb-newer"?!1:!0});return a.length===0?{eb:b,reverb:g}:{eb:await d("WebMpsLoadMessagesFromEb").loadMessagesFromEb(a,c,e,f),reverb:g}}g.validateReverbViaCacheAndFetchFromEb=a}),98);
__d("WebMpsBatchLoadMessages",["MpsLogger","PackedMpsRange","WAGetSafeQPLError","WebMpsBatchLoadFromReverb","WebMpsLoadMessagesFromEb","WebMpsMergeMessageRangesFromDifferentSources","WebMpsPersistMessagesFromEb","WebMpsValidateReverbViaCacheAndFetchFromEb","err","getErrorSafe","gkx"],(function(a,b,c,d,e,f,g){"use strict";async function a(a,b,e,f){var g=e.persistToReverb,h=e.shouldFetchSupplementals,i=e.shouldFetchTags,j=e.shouldIgnoreLocalOnly,k=e.strategy;e=e.tagsFilter;a=a.map(function(a){return d("PackedMpsRange").packMpsRange(a)});try{f.metric.addPoint("mps_fetch_start");h=d("WebMpsBatchLoadFromReverb").batchLoadMessagesFromReverb(a,h,i,j,f,e);var l,m;switch(k){case"full-fetch":if(c("gkx")("15592")===!0){i=await d("WebMpsValidateReverbViaCacheAndFetchFromEb").validateReverbViaCacheAndFetchFromEb(a,h,b,f,e);l=i.reverb;m=i.eb}else{j=await Promise.all([h,d("WebMpsLoadMessagesFromEb").loadMessagesFromEb(a,b,f,e)]);l=j[0];m=j[1]}break;case"local-only":l=await h;m=new Map();break;case"remote-only":m=await d("WebMpsLoadMessagesFromEb").loadMessagesFromEb(a,b,f,e);l=new Map();break;default:k;throw c("err")("empty strategy")}i=a.map(function(a){var b=a.direction,c=a.numMessages,e=a.threadId,f=l.get(a);a=m.get(a);if(f==null&&a==null)return;a=d("WebMpsMergeMessageRangesFromDifferentSources").mergeMessageRangesFromDifferentSources(a,f,b,c,e);f=a.range;b=a.supplementalMessagesToWriteToReverb;c=a.tagsToWriteToReverb;a=a.topLevelMessagesToWriteToReverb;return{range:f,supplementalMessagesToWriteToReverb:b,tagsToWriteToReverb:c,threadId:e,topLevelMessagesToWriteToReverb:a}}).filter(Boolean);g==="persist"&&void d("WebMpsPersistMessagesFromEb").persistMessagesFromEB(i.map(function(a){var b=a.supplementalMessagesToWriteToReverb,c=a.tagsToWriteToReverb,d=a.threadId;a=a.topLevelMessagesToWriteToReverb;return{supplementalProtobufs:b,tags:c,threadId:d,topLevelProtobufs:a}}));return i.map(function(a){a=a.range;return a})}catch(a){j=c("getErrorSafe")(a);d("MpsLogger").MpsLogger.catching(j).mustfix("Runtime error performing loadMessages");f.metric.addAnnotations({string:{errorDescription:d("WAGetSafeQPLError").getSafeQPLErrorMessage(j)}});throw j}}g.batchLoadMessages=a}),98);
__d("WebMpsInsertionFlow",["MpsLogger","MpsTypes","WebMpsReverbWrites","WebReverbDB","err","justknobx","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";async function a(a){if(c("justknobx")._("4336"))try{await d("WebReverbDB").getWebReverbDB().runInTransaction(["message","supplemental","deleted","tags"],"readwrite",async function(b){for(var c of a)await i(c,function(a){return a(b)})},"mps-insertion-flow-shared");return new Map()}catch(a){d("MpsLogger").MpsLogger.catching(a).mustfix("Failed to persist messages")}return h(a)}async function h(a){var b=new Map(),c=async function(a){await i(a,function(a){return d("WebReverbDB").getWebReverbDB().runInTransaction(["message","supplemental","deleted","tags"],"readwrite",function(b){return a(b)},"mps-insertion-flow-separate")}).catch(function(c){b.set(a.message.messageId,c)})};for(a of a)await c(a);return b}function i(a,b){switch(a.directive.actionType){case d("MpsTypes").ActionType.UpsertTopLevel:return j(a,b);case d("MpsTypes").ActionType.UpsertSupplemental:return k(a,b);case d("MpsTypes").ActionType.DeleteTopLevel:return l(a,b);case d("MpsTypes").ActionType.DeleteTopLevelWithPlaceholder:return m(a,b);case d("MpsTypes").ActionType.DeleteSupplemental:return n(a,b);case d("MpsTypes").ActionType.DeleteThread:return o(a,b);case d("MpsTypes").ActionType.Noop:return Promise.resolve();case d("MpsTypes").ActionType.Unknown:case d("MpsTypes").ActionType.Preprocess:return Promise.reject(c("err")("this should not happen"))}}async function j(a,b){var c=a.directive;a=a.message;await d("WebMpsReverbWrites").upsertTopLevelToReverb(a,c,b)}async function k(a,b){var e=a.directive;a=a.message;var f=c("nullthrows")(e.supplementalKey);await d("WebMpsReverbWrites").upsertSupplementalToReverb(a.messageId,a.payload,f,e.targetMessageId,a.threadId,a.timestampMs,b)}function l(a,b){var c=a.message,d=a.directive.targetMessageId,e=[c.threadId,d];return b(async function(a){var b=await a.stores.message.getByIndex("[threadId+messageId]",e),f=await a.stores.deleted.getByIndex("[threadId+deletedMessageId]",e);if(((f=f==null?void 0:f.deletionTimestampMs)!=null?f:0)>=c.timestampMs)return;f={deletedMessageId:d,deletionMessageId:c.messageId,deletionMessagePayload:c.payload,deletionTimestampMs:c.timestampMs,isLocalOnlyMessage:!1,payload:b==null?void 0:b.payload,threadId:c.threadId,timestampMs:b==null?void 0:b.timestampMs};await a.stores.deleted.bulkUpsert("[threadId+deletedMessageId]",[{item:f,selector:e}]);b&&await a.stores.message.bulkDelete([b.pk])})}function m(a,b){var c=a.directive;a=a.message;return d("WebMpsReverbWrites").upsertTopLevelToReverb(a,c,b)}function n(a,b){var d=a.message,e=c("nullthrows")(a.directive.supplementalKey),f=a.directive.targetMessageId,g=[d.threadId,f,e];return b(async function(b){var c=await b.stores.supplemental.getByIndex("[threadId+topLevelMessageId+supplementalKey]",g);if(c==null)return;var h=await b.stores.deleted.getByIndex("[threadId+topLevelMessageId+supplementalKey]",g,{filter:function(a){return a.deletionTimestampMs>=d.timestampMs}});if(h)return;h={deletedMessageId:c.messageId,deletionMessageId:d.messageId,deletionMessagePayload:d.payload,deletionTimestampMs:d.timestampMs,isLocalOnlyMessage:a.directive.isLocalOnly,payload:c.payload,supplementalKey:e,threadId:d.threadId,timestampMs:c.timestampMs,topLevelMessageId:f};await b.stores.deleted.bulkUpsert("[threadId+topLevelMessageId+supplementalKey]",[{item:h,selector:g}]);await b.stores.supplemental.bulkDelete([c.pk])})}function o(a,b){var c=a.message;return b(async function(a){var b=await a.stores.supplemental.readKeysByIndexRange("[threadId+topLevelMessageId+supplementalKey]",{only:[c.threadId]});await a.stores.supplemental.bulkDelete(b);b=await a.stores.message.readIndexRange("[threadId+messageId]",{only:[c.threadId]});await a.stores.message.bulkDelete(b.map(function(a){return a.pk}));var d=await a.stores.tags.readKeysByIndexRange("[threadId+messageId+tag]",{only:[c.threadId]});await a.stores.tags.bulkDelete(d);d=await a.stores.deleted.readKeysByIndexRange("[threadId+deletedMessageId]",{only:[c.threadId]});await a.stores.deleted.bulkDelete(d);await a.stores.deleted.bulkAdd(b.map(function(a){return{deletedMessageId:a.messageId,deletionMessageId:c.messageId,deletionMessagePayload:c.payload,deletionTimestampMs:c.timestampMs,isLocalOnlyMessage:a.isLocalOnlyMessage,payload:a.payload,threadId:a.threadId,timestampMs:a.timestampMs}}))})}g.persistNewMessages=a}),98);
__d("MpsLogProcessorErrors",["MpsLogger","WAGetSafeQPLError"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e,f,g){d("MpsLogger").MpsLogger.catching(a).mustfix(b+" %s failed for message %s (source %s)",c,e,f);g.metric.addAnnotations({string:(b={},b[c.toLowerCase()+"Error"]=d("WAGetSafeQPLError").getSafeQPLErrorMessage(a),b)})}g.logProcessorError=a}),98);
__d("WebMpsPostprocess",["MpsLogProcessorErrors","MpsLogger"],(function(a,b,c,d,e,f,g){"use strict";async function a(a,b,c,e){var f=a,g=new Map();a=async function(a){var b=await a.process(f,c);b.size>0&&(b.forEach(function(b,f){g.set(f,b),d("MpsLogProcessorErrors").logProcessorError(b,"Postprocessor",a.name,f,e,c)}),f=f.filter(function(a){return!b.has(a.message.messageId)}))};for(b of b)await a(b);return{errors:g,msgs:f}}async function b(a,b,c){await Promise.all(b.map(async function(b){b=await b.process(a,c).catch(function(a){d("MpsLogger").MpsLogger.catching(a).mustfix("PostProcessor Runtime failure")});b!=null&&b.size>0&&b.forEach(function(a){d("MpsLogger").MpsLogger.catching(a).mustfix("PostProcessor fails")})}))}g.runCriticalPostprocessor=a;g.runNonCriticalPostprocessor=b}),98);
__d("WebMpsPreprocess",["MpsLogProcessorErrors"],(function(a,b,c,d,e,f,g){"use strict";async function a(a,b,c,e){var f=a,g=new Map();a=async function(a){var b=a.process!=null?a.process(f,c):await a.processAsync(f,c);f=b.payload;b.errors.forEach(function(b,f){g.set(f,b),d("MpsLogProcessorErrors").logProcessorError(b,"Preprocessor",a.name,f,e,c)})};for(b of b)await a(b);return{errors:g,msgs:f}}g.preprocess=a}),98);
__d("WebMpsPurgeDeletions",["DateConsts","QPLUserFlow","WebReverbDB","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h=30*d("DateConsts").MS_PER_DAY;function a(){var a=c("qpl")._(521474688,"2714"),b={instanceKey:Date.now()};c("QPLUserFlow").start(a,b);try{return d("WebReverbDB").getWebReverbDB().runInTransaction(["deleted","supplemental","tags","message"],"readwrite",async function(d){var e=Date.now()-h;e=await d.stores.deleted.readIndexRange("deletionTimestampMs",{lessThanOrEqual:[e]});var f=e.map(function(a){return[a.threadId,a.deletedMessageId]});c("QPLUserFlow").addAnnotations(a,{int:{num_deletions:e.length}},b);var g=Promise.all(f.map(function(a){return d.stores.supplemental.readKeysByIndexRange("[threadId+topLevelMessageId+supplementalKey]",{only:a})})).then(function(a){return a.flat()}).then(function(a){return d.stores.supplemental.bulkDelete(a)});f=Promise.all(f.map(function(a){return d.stores.tags.readKeysByIndexRange("[threadId+messageId+tag]",{only:a})})).then(function(a){return a.flat()}).then(function(a){return d.stores.tags.bulkDelete(a)});e=d.stores.deleted.bulkDelete(e.map(function(a){return a.pk}));await Promise.all([g,f,e]);c("QPLUserFlow").endSuccess(a,b)},"web-mps-purge-deletions")}catch(d){c("QPLUserFlow").endFailure(a,d,b);throw d}}g.purgeDeletions=a}),98);
__d("WebMpsPurgeExpiredMessages",["QPLUserFlow","WebReverbDB","qpl"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a=c("qpl")._(521484777,"2715"),b={instanceKey:Date.now()};c("QPLUserFlow").start(a,b);try{return d("WebReverbDB").getWebReverbDB().runInTransaction(["message","deleted"],"readwrite",async function(d){var e=Date.now(),f=await d.stores.message.readIndexRange("expiryTimestampMs",{lessThanOrEqual:[e]});c("QPLUserFlow").addAnnotations(a,{int:{num_expired_messages:f.length}},b);var g=await Promise.all(f.map(async function(a){var b=a.messageId;if(b!=null){a=await d.stores.deleted.getByIndex("[threadId+deletedMessageId]",[a.threadId,b]);return a==null?void 0:a.pk}return null})).then(function(a){return a.filter(Boolean)});await d.stores.deleted.bulkDelete(g);g=f.map(function(a){return{deletedMessageId:a.messageId,deletionMessageId:a.messageId,deletionMessagePayload:a.payload,deletionTimestampMs:e,isLocalOnlyMessage:!0,payload:a.payload,threadId:a.threadId,timestampMs:a.timestampMs}});await d.stores.deleted.bulkAdd(g);await d.stores.message.bulkDelete(f.map(function(a){return a.pk}));c("QPLUserFlow").endSuccess(a,b)},"web-mps-purge-deletions")}catch(d){c("QPLUserFlow").endFailure(a,d,b);throw d}}g.purgeExpiredMessages=a}),98);
__d("WebMpsScheduler",["WorkerScheduler","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){if(h==null){var a;h=d("WorkerScheduler").makeScheduler("MPS",{concurrency:(a=c("justknobx"))._("4338"),defaultSamplingRate:a._("4540"),maxConcurrency:a._("4338"),maxThrottleMs:a._("4339"),timeToStuckMs:a._("4337")})}return h}g.mpsScheduler=a}),98);
__d("mergeMaps",[],(function(a,b,c,d,e,f){"use strict";function a(){var a=new Map();for(var b=arguments.length,c=new Array(b),d=0;d<b;d++)c[d]=arguments[d];for(var e=0;e<c.length;e++){var f=c[e].keys(),g;while(!(g=f.next()).done)a.set(g.value,c[e].get(g.value))}return a}f["default"]=a}),66);
__d("schedulePeriodicTask",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){var c=async function(){try{await a()}finally{globalThis.setTimeout(c,b)}};globalThis.setTimeout(c,0)}f.schedulePeriodicTask=a}),66);
__d("WebMps",["DateConsts","MpsLogger","MpsReverbDbDump","WAPromiseQueue","WAResultOrError","WATimeUtils","WAWaitForUserUnblocked","WebMpsBatchLoadMessage","WebMpsBatchLoadMessages","WebMpsInsertionFlow","WebMpsPostprocess","WebMpsPreprocess","WebMpsPurgeDeletions","WebMpsPurgeExpiredMessages","WebMpsScheduler","WebReverbDB","WorkerScheduler","err","getErrorSafe","justknobx","memoizeWithArgsLFUCache","mergeMaps","nullthrows","schedulePeriodicTask"],(function(a,b,c,d,e,f,g){"use strict";var h=["debug"],i=["debug"],j;async function a(a){var b=a.db,e=a.dependencies;a=a.extensionConfiguration;if(j!=null)throw c("err")("MPS already initialised");await d("WebReverbDB").makeWebReverb(b.name,b.strEncKey,b.blockingErrorThreshold,b.onBlockingError,b.qplEvent);b=new k(a,e);j=b;return b}var k=function(){function a(a,b){var e=this;this.$2=[];this.$4=new(d("WAPromiseQueue").PromiseQueue)();this.batchLoadMessage=function(a){var b=a.config,f=a.debug,g=a.messageIds,h=a.threadId;return d("WebMpsScheduler").mpsScheduler().runTask({annotations:{string:{purpose:f.purpose,strategy:(a=b==null?void 0:b.strategy)!=null?a:"full-fetch"}},customFlags:{runtimeReliability:!0},eventSamplingRate:c("justknobx")._("4538"),fn:function(a){var c;return d("WebMpsBatchLoadMessage").batchLoadMessage(h,g,e.$1,{persistToReverb:(c=b==null?void 0:b.persistToReverb)!=null?c:"persist",shouldFetchSupplementals:(c=b==null?void 0:b.shouldFetchSupplementals)!=null?c:!0,shouldFetchTags:(c=b==null?void 0:b.shouldFetchTags)!=null?c:!0,strategy:(c=b==null?void 0:b.strategy)!=null?c:"full-fetch"},a)},name:"batch-load-message",priority:d("WorkerScheduler").BLOCKING_PRIORITY}).then(function(a){return d("WAResultOrError").makeResult(a)}).catch(function(a){a=c("getErrorSafe")(a);return d("WAResultOrError").DEPRECATED_makeError("runtime-error",a)})};this.$7=c("memoizeWithArgsLFUCache")(function(a){var b=a.config,f=a.debug,g=a.messageId,h=a.threadId;return d("WebMpsScheduler").mpsScheduler().runTask({annotations:{string:{purpose:f.purpose,strategy:(a=b==null?void 0:b.strategy)!=null?a:"full-fetch"}},customFlags:{runtimeReliability:!0},eventSamplingRate:c("justknobx")._("4536"),fn:function(a){var c;return d("WebMpsBatchLoadMessage").batchLoadMessage(h,[g],e.$1,{persistToReverb:(c=b==null?void 0:b.persistToReverb)!=null?c:"persist",shouldFetchSupplementals:(c=b==null?void 0:b.shouldFetchSupplementals)!=null?c:!0,shouldFetchTags:(c=b==null?void 0:b.shouldFetchTags)!=null?c:!0,strategy:(c=b==null?void 0:b.strategy)!=null?c:"full-fetch"},a).then(function(a){a.length!==1&&d("MpsLogger").MpsLogger.mustfix("loadMessage returned more than one message");return a[0]})},name:"load-message",priority:d("WorkerScheduler").BLOCKING_PRIORITY})},function(a){a.debug;a=babelHelpers.objectWithoutPropertiesLoose(a,h);return JSON.stringify(babelHelpers.extends({},a,{ebEnabled:e.$1.eb.isEbEnabled()}))},1,function(a){e.$2.push(a)});this.loadMessage=function(a){return e.$7(a).then(function(a){return d("WAResultOrError").makeResult(a)}).catch(function(a){e.$5();a=c("getErrorSafe")(a);return d("WAResultOrError").DEPRECATED_makeError("runtime-error",a)})};this.$8=function(a){var b=a.config,f=a.debug,g=a.ranges;return d("WebMpsScheduler").mpsScheduler().runTask({annotations:{string:{purpose:f.purpose,strategy:(a=b==null?void 0:b.strategy)!=null?a:"full-fetch"}},customFlags:{runtimeReliability:!0},eventSamplingRate:c("justknobx")._("4538"),fn:function(a){var c;return d("WebMpsBatchLoadMessages").batchLoadMessages(g.map(function(a){var b=a.direction,c=a.from,e=a.numMessages;a=a.threadId;return{direction:b,from:[d("WATimeUtils").miAdjustTimestamp(c[0]),c[1]],numMessages:e,threadId:a}}),e.$1,{persistToReverb:(c=b==null?void 0:b.persistToReverb)!=null?c:"persist",shouldFetchSupplementals:(c=b==null?void 0:b.shouldFetchSupplementals)!=null?c:!0,shouldFetchTags:(c=b==null?void 0:b.shouldFetchTags)!=null?c:!0,shouldIgnoreLocalOnly:(c=b==null?void 0:b.shouldIgnoreLocalOnly)!=null?c:!1,strategy:(c=b==null?void 0:b.strategy)!=null?c:"full-fetch",tagsFilter:(c=b==null?void 0:b.tagsFilter)!=null?c:"all"},a)},name:"thread-range-query",priority:d("WorkerScheduler").BLOCKING_PRIORITY})};this.batchLoadMessages=function(a){return e.$8(a).then(function(a){return d("WAResultOrError").makeResult(a)}).catch(function(a){a=c("getErrorSafe")(a);return d("WAResultOrError").DEPRECATED_makeError("runtime-error",a)})};this.$9=c("memoizeWithArgsLFUCache")(function(a){var b=a.config,f=a.debug,g=a.direction,h=a.from,i=a.numMessages,j=a.threadId;return d("WebMpsScheduler").mpsScheduler().runTask({annotations:{string:{purpose:f.purpose,strategy:(a=b==null?void 0:b.strategy)!=null?a:"full-fetch"}},customFlags:{runtimeReliability:!0},eventSamplingRate:c("justknobx")._("4538"),fn:function(a){var c;return d("WebMpsBatchLoadMessages").batchLoadMessages([{direction:g,from:[d("WATimeUtils").miAdjustTimestamp(h[0]),h[1]],numMessages:i,threadId:j}],e.$1,{persistToReverb:(c=b==null?void 0:b.persistToReverb)!=null?c:"persist",shouldFetchSupplementals:(c=b==null?void 0:b.shouldFetchSupplementals)!=null?c:!0,shouldFetchTags:(c=b==null?void 0:b.shouldFetchTags)!=null?c:!0,shouldIgnoreLocalOnly:(c=b==null?void 0:b.shouldIgnoreLocalOnly)!=null?c:!1,strategy:(c=b==null?void 0:b.strategy)!=null?c:"full-fetch",tagsFilter:(c=b==null?void 0:b.tagsFilter)!=null?c:"all"},a).then(function(a){a.length!==1&&d("MpsLogger").MpsLogger.mustfix("loadMessages returned more than one range");return a[0]})},name:"load-messages",priority:d("WorkerScheduler").BLOCKING_PRIORITY})},function(a){a.debug;a=babelHelpers.objectWithoutPropertiesLoose(a,i);return JSON.stringify(babelHelpers.extends({},a,{ebEnabled:e.$1.eb.isEbEnabled()}))},10/60,function(a){e.$2.push(a)});this.loadMessages=function(a){return e.$9(a).then(function(a){return d("WAResultOrError").makeResult(a)}).catch(function(a){e.$5();a=c("getErrorSafe")(a);return d("WAResultOrError").DEPRECATED_makeError("runtime-error",a)})};this.extensionConfiguration=a;this.$1=b;this.$3()}var b=a.prototype;b.saveNewMessages=function(a,b){var e=this,f=d("WebMpsScheduler").mpsScheduler().task({annotations:{string:{source:b.source}},customFlags:{runtimeReliability:!0},eventSamplingRate:c("justknobx")._("4535"),fn:async function(f){e.$5();f.metric.addPoint("preprocess_start");var g=await d("WebMpsPreprocess").preprocess(a,e.extensionConfiguration.preprocessors,f,b.source),h=g.errors;g=g.msgs;f.metric.addPoint("preprocess_end");g=g.map(function(a){return babelHelpers.extends({},a,{directive:c("nullthrows")(a.directive,"Preprocessed messages must have a directive")})});f.metric.addPoint("persist_start");var i=await d("WebMpsInsertionFlow").persistNewMessages(g);f.metric.addPoint("persist_end");f.metric.addPoint("postprocess_start");g=await e.$6(g,f,b.source);f.metric.addPoint("postprocess_end");return c("mergeMaps")(h,i,g)},name:"save-new-messages",priority:d("WorkerScheduler").BLOCKING_PRIORITY});return this.$4.enqueue(function(){return f.run()})};b.$6=async function(a,b,e){var f=this,g,h;try{a=await d("WebMpsPostprocess").runCriticalPostprocessor(a,this.extensionConfiguration.postProcessors.critical,b,e);g=a.errors;h=a.msgs}catch(a){e=c("getErrorSafe")(a);d("MpsLogger").MpsLogger.catching(e).mustfix("Message postprocessor failed with runtime error");throw e}d("WebMpsScheduler").mpsScheduler().runTask({eventSamplingRate:c("justknobx")._("4537"),fn:function(){return d("WebMpsPostprocess").runNonCriticalPostprocessor(h,f.extensionConfiguration.postProcessors.nonCritical,b)},name:"non-critical-postprocessors"}).catch(function(a){d("MpsLogger").MpsLogger.catching(a).mustfix("Non-critical postprocessor failed with runtime error %s",a)});return g};b.purgeDeletions=async function(){try{await d("WAWaitForUserUnblocked").waitForUserUnblocked(),await d("WebMpsScheduler").mpsScheduler().runTask({fn:d("WebMpsPurgeDeletions").purgeDeletions,name:"purge-deletions",priority:d("WorkerScheduler").BACKGROUND_PRIORITY})}catch(a){d("MpsLogger").MpsLogger.catching(c("getErrorSafe")(a)).mustfix("failed running purgeDeletions")}};b.purgeExpiredMessages=async function(){try{await d("WAWaitForUserUnblocked").waitForUserUnblocked(),await d("WebMpsScheduler").mpsScheduler().runTask({eventSamplingRate:c("justknobx")._("4539"),fn:d("WebMpsPurgeExpiredMessages").purgeExpiredMessages,name:"purge-expired-messages",priority:d("WorkerScheduler").BACKGROUND_PRIORITY})}catch(a){d("MpsLogger").MpsLogger.catching(c("getErrorSafe")(a)).mustfix("failed running purgeExpiredMessages")}};b.debugDbDump=function(){return d("MpsReverbDbDump").debugGetReverbDbDump()};b.$5=function(){this.$2.forEach(function(a){return a()})};b.$3=function(){var a=this;d("schedulePeriodicTask").schedulePeriodicTask(function(){return a.purgeDeletions()},d("DateConsts").MS_PER_MIN*20);d("schedulePeriodicTask").schedulePeriodicTask(function(){return a.purgeExpiredMessages()},d("DateConsts").MS_PER_MIN*10)};return a}();function b(){if(j==null)throw c("err")("MPS not initialised");return j}function e(){j=void 0}g.makeMps=a;g.mps=b;g.resetMps_TEST_ONLY=e}),98);
__d("MAWBridgeEventTransmitter",["EBAPI","EBAPIMessagePointQueryWithPersistence","EBLogger","I64","LSIntEnum","LSMEBTaskCreationSource","MAWBridge","MAWBridgeTrace","MAWBridgeTypesCreators","MAWBridgeUpload","MAWIndexedDb","MAWMpsGating","MAWUploadThreadTxns","MpsTypes","WAJids","WALogger","WATimeUtils","WebMps"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=new Map();function a(a,b,e,f,g){var m;d("WALogger").LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Issuing point query for message: ",""])),a);if(c("EBAPI").isEBEnabled()===!1)return;if(d("MAWMpsGating").isMpsPointQueryEnabled()||d("MAWMpsGating").isFullMpsEnabled()){void d("WebMps").mps().loadMessage({config:{shouldFetchSupplementals:!0,shouldFetchTags:!1,strategy:"full-fetch"},debug:{purpose:"issuePointQueryOutsideTxn"},messageId:d("MpsTypes").toMessageId(a),threadId:d("MpsTypes").toThreadId(g)}).then(function(a){a=a.value;if(a==null)return;void d("MAWBridge").getBridge().sendAndReceive("event","uiUpdate",{events:[{tag:"RestoreNativeOp",value:{chatJid:g,decryptedMessagesProtobufs:[{otid:a.toplevelProtobuf.messageId,supplementalProtobufs:new Map(a.supplementalProtobufs.entries().map(function(a){var b=a[0];a=a[1];return[b,{decryptedProtobuf:a.payload,protobufTimestampMS:a.timestampMs}]})),toplevelProtobuf:{decryptedProtobuf:a.toplevelProtobuf.payload,protobufTimestampMS:a.toplevelProtobuf.timestampMs}}],hasMoreAfter:!1,hasMoreBefore:!1,isPointQuery:!0,taskSource:(j||(j=d("LSIntEnum"))).ofNumber(f!=null?f:c("LSMEBTaskCreationSource").UNKNOWN),threadId:b}}]})["catch"](function(a){return d("EBLogger").EBLogger.tags(["eventTransmitter","mps"]).catching(a).warn("failure while executing UI update")})});return}l.has(b)||l.set(b,new Set());if((m=l.get(b))!=null&&m.has(a))return;(m=l.get(b))==null||m.add(a);c("EBAPIMessagePointQueryWithPersistence")({jid:g,messageId:a,sortOrderMs:e!=null?(k||(k=d("I64"))).of_string(e):void 0,source:(j||(j=d("LSIntEnum"))).unwrapIntEnum((k||(k=d("I64"))).of_float(f)),threadId:b})["catch"](function(a){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] GraphQL point restore unsuccessful: ",""])),a)})}function b(a,b){d("MAWIndexedDb").afterTransaction({tag:"DeleteMessagesOfThread",value:d("MAWBridgeUpload").createBridgeDeleteMessagesOfThread(d("WAJids").threadIdForChatJid(a.jid),d("MAWUploadThreadTxns").getFolderTypeAsText(a.folder),"AdvancedCrypto",b!=null?b:d("WATimeUtils").castToMillisTime(1),null,2)})}function e(a,b,c){d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"StartTrace",value:d("MAWBridgeTrace").createBridgeStartTraceData(a,b,c)}]})}function f(a,b,c){d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({cannotReplyReason:a,folder:b,threadJid:c})}]})}g.issuePointQueryOutsideTxn=a;g.deleteMessagesOfThreadAfterTxn=b;g.startTraceOutsideTxn=e;g.updateThreadOutsideTxn=f}),98);
__d("EchoConstants",[],(function(a,b,c,d,e,f){"use strict";a=new Set(["\0","\x01","\x02","\x03","\x04","\x05","\x06","\x07","\b","\t","\n","\v","\f","\r","\x0e","\x0f","\x10","\x11","\x12","\x13","\x14","\x15","\x16","\x17","\x18","\x19","\x1a","\x1b","\x1c","\x1d","\x1e","\x1f",'"'," ","(",")",",",":",";","<",">","@","[","]","\\"]);f.ADDRESS_LOCAL_KEY_CHARS_NEED_QUOTE=a}),66);
__d("EchoEncodingUtils",["EchoConstants","EchoMessage","FBLogger","MAWMsgType","WABase64"],(function(a,b,c,d,e,f,g){"use strict";var h=new Set(['"',"\\","\n","\r","\0"]),i=new Set(["\0","\x01","\x02","\x03","\x04","\x05","\x06","\x07","\b","\t","\n","\v","\f","\r","\x0e","\x0f","\x10","\x11","\x12","\x13","\x14","\x15","\x16","\x17","\x18","\x19","\x1a","\x1b","\x1c","\x1d","\x1e","\x1f",'"',"\\"]);function j(a,b){for(b of b)if(a.indexOf(b)>=0)return!0;return!1}function k(a,b,d){d===void 0&&(d=new Set());if(a.length<=0)throw c("FBLogger")("wmi_eb").mustfixThrow("The input string must be non-empty");var e=b;b==="conditional"&&(j(a,d)?e="always":e="never");if(e==="never")return a;b='"';for(d=0;d<a.length;d++){e=a[d];h.has(e)?(b+="\\",e==="\r"?b+="r":e==="\n"?b+="n":b+=e):b+=e}return b+'"'}function l(a){if(!Number.isSafeInteger(a))throw c("FBLogger")("wmi_eb").mustfixThrow("The input value must be a safe integer");return a.toString()}function m(a){var b="",c=a.displayName,e=a.localKey;a=a.transportKey;c!=null&&c.length>0&&(b+=k(c,"always")+" <");b+=k(e,"conditional",d("EchoConstants").ADDRESS_LOCAL_KEY_CHARS_NEED_QUOTE)+"@"+a;c!=null&&c.length>0&&(b+=">");return b}function n(a,b,c){c!=null&&c.length!==0&&a.set(b,k(c,"conditional",i))}function a(a,b,c){if(c!=null){c=l(c);n(a,b,c)}}function b(a,b,c){if(c!=null){c=l(c?1:0);n(a,b,c)}}function e(a,b,c){c!=null&&a.set(b,m(c))}function f(a,b,c){if(c!=null){var d="";c.forEach(function(a,b){d+=m(a),b<c.length-1&&(d+=", ")});a.set(b,d)}}function o(a){var b="";a.forEach(function(a,c){b=b+c+": "+a+"\r\n"});return b}function p(a){return d("WABase64").encodeB64UrlSafe(a)}function q(a){switch(a){case d("MAWMsgType").MSG_TYPE.TEXT:return d("EchoMessage").EchoXMessageContentType.TEXT;case d("MAWMsgType").MSG_TYPE.IMAGE:return d("EchoMessage").EchoXMessageContentType.IMAGE;case d("MAWMsgType").MSG_TYPE.VIDEO:return d("EchoMessage").EchoXMessageContentType.VIDEO;case d("MAWMsgType").MSG_TYPE.PTT:return d("EchoMessage").EchoXMessageContentType.AUDIO;case d("MAWMsgType").MSG_TYPE.STICKER:return d("EchoMessage").EchoXMessageContentType.STICKER;case d("MAWMsgType").MSG_TYPE.GIF:return d("EchoMessage").EchoXMessageContentType.GIF;case d("MAWMsgType").MSG_TYPE.XMA:return d("EchoMessage").EchoXMessageContentType.XMA;case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return d("EchoMessage").EchoXMessageContentType.DOCUMENT;case d("MAWMsgType").MSG_TYPE.REACTION:return d("EchoMessage").EchoXMessageContentType.REACTION;case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:return d("EchoMessage").EchoXMessageContentType.EPHEMERAL_SETTINGS;case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:return d("EchoMessage").EchoXMessageContentType.EPHEMERAL_SYNC_RESPONSE;case d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME:return d("EchoMessage").EchoXMessageContentType.MESSAGE_DELETE_FOR_ME;case d("MAWMsgType").MSG_TYPE.REVOKED:return d("EchoMessage").EchoXMessageContentType.UNSEND;case d("MAWMsgType").MSG_TYPE.GROUP_INVITE:return d("EchoMessage").EchoXMessageContentType.GROUP_INVITES;case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:return d("EchoMessage").EchoXMessageContentType.BUMP;default:return d("EchoMessage").EchoXMessageContentType.UNKNOWN}}g.echoSetStringField=n;g.echoSetIntField=a;g.echoSetBooleanField=b;g.echoSetAddressField=e;g.echoSetAddressListField=f;g.echoEncodeFields=o;g.convertMediaKeyToString=p;g.convertDbMsgTypeToXMessageContentType=q}),98);
__d("EchoCommonUtils",[],(function(a,b,c,d,e,f){"use strict";c="Echo-Doc-Version";function a(a,b){var c=a.localKey;a=a.transportKey;return c+"@"+a+"-"+b}function b(a,b,c){return a==null?{localKey:b,transportKey:c}:{displayName:a,localKey:b,transportKey:c}}f.ECHO_COMMON_FIELD_DOCUMENT_VERSION=c;f.getEchoAddressFieldNameWithSuffix=a;f.craftEchoAddress=b}),66);
__d("EchoDecodingUtils",["invariant","EchoConstants","WALogger"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k,l,m,n,o,p,q,r,s,t,u,v=new Set([]);function w(a,b){if(a.length===0)return;var c=a.indexOf(":");if(c===-1){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] This is a raw line and we cannot decode its field name and value."])));return}var e=a.substring(0,c).trim();a=a.substring(c+1).trim();if(e.length===0){d("WALogger").ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Field name is blank"])));return}if(a.length===0){b.has(e)&&b["delete"](e);return}b.set(e,a)}function x(a,b,c,e){c===void 0&&(c=new Set());var f=!1,g=b==="conditional"&&a[0]==='"',h="",i=g?1:0;while(i<a.length){var j=a[i];if(b==="conditional"&&!g&&j==='"')break;if(!g&&c.has(j))break;if(g&&!f&&j==='"'){g=!1;i++;break}if(g&&!f&&j==="\\"){if(i===a.length-1)break;f=!0}else f&&j==="r"?h+="\r":f&&j==="n"?h+="\n":h+=j,f=!1;i++}if(g||h.length===0){j=e!=null?e:"unknown";d("WALogger").ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Fail decoding because we didn't have a closing quote. Error Field: ",""])),j);return{remainder:a,result:null,success:!1}}return{remainder:a.substring(i),result:h,success:!0}}function y(a,b){if(a.length===0){d("WALogger").ERROR(l||(l=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] invalid input to echoDecodeAddress"])));return{remainder:a,result:null,success:!1}}var c=a.trimLeft();c=x(c,"conditional",d("EchoConstants").ADDRESS_LOCAL_KEY_CHARS_NEED_QUOTE,b);if(!c.success){d("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] conditional quote mode decode failed"])));return{remainder:a,result:null,success:!1}}c.result!=null||h(0,47923);if(c.remainder[0]==="@"){var e=z(c.remainder,c.result,b);return{remainder:e.remainder,result:e.result,success:e.success}}e=c.result;c=c.remainder.trimLeft();if(c.startsWith("<")){c=z(c.substring(1),void 0,b);b=c.result;var f=c.remainder;if(c.success&&b!=null&&f.startsWith(">"))if(e.length===0)return{remainder:f.substring(1),result:b,success:!0};else return{remainder:f.substring(1),result:babelHelpers["extends"]({},b,{displayName:e}),success:!0}}d("WALogger").ERROR(n||(n=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] echoDecodeAddress failed"])));return{remainder:a,result:null,success:!1}}function z(a,b,c){var e=b==null?a.trimLeft():a;b=b;if(b==null){var f=x(e,"conditional",d("EchoConstants").ADDRESS_LOCAL_KEY_CHARS_NEED_QUOTE,c);if(!f.success){d("WALogger").ERROR(o||(o=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] parse localKey in address failed"])));return{remainder:a,result:null,success:!1}}b=f.result;e=f.remainder}if(b==null||b.length===0||e[0]!=="@"){d("WALogger").ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] invalid localKey in address detected"])));return{remainder:a,result:null,success:!1}}f=x(e.substring(1),"never",d("EchoConstants").ADDRESS_LOCAL_KEY_CHARS_NEED_QUOTE,c);e=f.result;if(f.success&&e!=null&&e.length>0)return{remainder:f.remainder,result:{localKey:b,transportKey:e},success:!0};else{d("WALogger").ERROR(q||(q=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] invalid transportKey in address detected"])));return{remainder:a,result:null,success:!1}}}function A(a,b){if(a.length===0){d("WALogger").ERROR(r||(r=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] invalid input to echoDecodeAddressList detected"])));return{result:null,success:!1}}var c=y(a,b);if(!c.success){d("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Address  decode failed with value: ",""])),a);return{result:null,success:!1}}c.result!=null||h(0,47927);a=[c.result];c=c.remainder;while(c.startsWith(",")){var e=y(c.substring(1).trimLeft(),b);if(e.success)e.result!=null&&a.push(e.result),c=e.remainder;else break}return{result:a,success:!0}}function a(a){var b=new Map(),c=a.split("\r\n");if(c.length===1&&c[0]===a){d("WALogger").ERROR(t||(t=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Fail to decode if the input string does not have CRLF"])));return b}c.forEach(function(a){return w(a,b)});return b}function b(a,b){a=a.get(b);if(a==null||a.length===0||a==='""')return{result:null,success:!1};a=x(a,"conditional",v,b);b=a.result;a=a.success;return{result:b,success:a}}function c(a,b){a=B(a,b);return{result:(b=a.result)!=null?b:0,success:a.success}}function B(a,b){a=a.get(b);if(a==null||a.length===0)return{result:null,success:!1};a=parseInt(a,10);if(isNaN(a)){d("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] "," not a valid number in echo message"])),b);return{result:null,success:!1}}else return Number.isSafeInteger(a)?{result:a,success:!0}:{result:a>Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER,success:!0}}function e(a,b){a=C(a,b);return{result:(b=a.result)!=null?b:!1,success:a.success}}function C(a,b){a=B(a,b);return!a.success||a.result!==0&&a.result!==1?{result:null,success:!1}:{result:a.result===1,success:!0}}function f(a,b){a=a.get(b);if(a==null||a.length===0)return{result:null,success:!1};a=y(a,b);b=a.result;a=a.success;return{result:b,success:a}}function D(a,b){a=a.get(b);return a==null||a.length===0?{result:null,success:!1}:A(a,b)}function E(a,b){a=a.get(b);if(a==null||a.length===0)return{result:null,success:!1};b=a.split(",").map(function(a){return a.trim()}).filter(Boolean);return b.length===0?{result:null,success:!1}:{result:b,success:!0}}g.echoDecodeFields=a;g.echoDecodeStringField=b;g.echoDecodeIntField=c;g.echoDecodeNullableIntField=B;g.echoDecodeBooleanField=e;g.echoDecodeNullableBooleanField=C;g.echoDecodeAddressField=f;g.echoDecodeAddressListField=D;g.echoDecodeObjectIdListField=E}),98);
__d("EchoMessage",["$InternalEnum","EchoCommonUtils","EchoDecodingUtils","EchoEncodingUtils","EchoMessageMediaFieldUtils","EchoMessageMediaGroupFieldUtil","EchoMessageQuoteFieldUtils","EchoMessageReceiptStatusFieldUtils","EchoMessageXMAFieldUtils","FBLogger","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o="Message-ID",p="Thread-ID",q="Sort-Order",r="Display-Timestamp",s="Authoritative-Timestamp",t="From",u="Text",v="Text-Size",w="Send-Error",x="Is-Tombstoned",y="Expire-Timestamp",z="Delete-Timestamp",A="Ephemeral-Duration",B="Message-Content-Type",C="X-Message-Content-Type",D="Message-Content-Subtype",E="Is-Forwarded",F="X-Offline-Threading-ID",G="X-Thread-ID",H="X-Message-Placeholder-Type",I="Reactions",J="Reaction-Authoritative-Timestamps",K="X-Reaction-Offline-Threading-IDs",L="Echo-Serialization-Origin",M="Revoke-Sent-Timestamp",N="Revoke-Unsent-Timestamp",O="Edit-Count",P="Edit-Contents-",Q="Edit-Timestamps-";f="Group-ID";var R="Group-Index",S="Group-Size",T="Receiver-Fetch-Id",U="Message-Ephemerality-Type",V=1,W=(b=b("$InternalEnum"))({NONE:"none",SMALL:"small",MEDIUM:"medium",LARGE:"large"}),X=b({NONE:"none",UNSEND:"unsend"}),Y=b({DECRYPTION_FAILURE:"decryption_failure",UNSUPPORTED_NEEDS_UPDATE:"unsupported_needs_update",TEXT:"text",ADMIN_MESSAGE:"admin_message",MEDIA:"media",XMA:"xma",NULL_STATE:"null_state",PLACEHOLDER:"placeholder"}),aa=b({UNKNOWN:"unknown",TEXT:"text",IMAGE:"image",VIDEO:"video",AUDIO:"audio",STICKER:"sticker",GIF:"gif",URL:"url",EPHEMERAL_SETTINGS:"ephemeral_settings",LOCATION:"location",DOCUMENT:"document",UNSEND:"unsend",SCREENSHOT_ACTION:"screenshot_action",REACTION:"reaction",XMA:"xma",VISUAL_MESSAGE_VIDEO:"visual_message_video",VISUAL_MESSAGE_IMAGE:"visual_message_image",VISUAL_MESSAGE_ACTION:"visual_message_action",SCREEN_RECORDING_ACTION:"screen_recording_action",MESSAGE_DELETE_FOR_ME:"message_delete_for_me",ENCRYPTED_BACKUP_NEW_DEVICE_ENROLLMENT:"encrypted_backup_new_device_enrollment",SENDER_KEY:"sender_key",DELETE_THREAD:"delete_thread",READ_THREAD:"read_thread",UNREAD_THREAD:"unread_thread",REACTION_UNSEND:"reaction_unsend",GROUP_INVITES:"group_invites",EPHEMERAL_SYNC_RESPONSE:"ephemeral_sync_response",BUMP:"bump"}),Z=b({NO_PLACEHOLDER:"0",DECRYPTION_FAILURE:"-1",CLIENT_NOT_SUPPORTED_NEED_UPDATE:"-2",UNAVIALABLE_DEVICE:"-3"}),$=b({UNKNOWN:"Unknown",WEB:"Web",MOBILE:"Mobile"});function a(a){var b=new Map();ia(b,a);"mediaData"in a&&a.mediaData&&d("EchoMessageMediaFieldUtils").echoMessageSetMediaMetadataFields(b,a.mediaData);return d("EchoEncodingUtils").echoEncodeFields(b)}function ba(a,b){var c,e=[],f=new Set();b.forEach(function(c,g,h){c=g.startsWith(P);h=g.startsWith(Q);if(c||h){h=g.slice(c?P.length:Q.length);if(!f.has(h)){f.add(h);c=(g=d("EchoDecodingUtils").echoDecodeStringField(b,""+P+h).result)!=null?g:"";g=((g=d("EchoDecodingUtils").echoDecodeIntField(b,""+Q+h).result)!=null?g:0)/1e3;e.push({messageId:h,originalMessageId:a,text:c,timestamp:g})}}});c=(c=d("EchoDecodingUtils").echoDecodeIntField(b,O).result)!=null?c:0;return{editCount:c,editHistory:e}}function e(a){a=d("EchoDecodingUtils").echoDecodeFields(a);if(a.size===0){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] fieldsMap is empty for the echo message"])));return null}var b=d("EchoDecodingUtils").echoDecodeStringField(a,o),e=d("EchoDecodingUtils").echoDecodeStringField(a,p),f=d("EchoDecodingUtils").echoDecodeIntField(a,q),g=d("EchoDecodingUtils").echoDecodeIntField(a,r),O=d("EchoDecodingUtils").echoDecodeStringField(a,B),P=d("EchoDecodingUtils").echoDecodeStringField(a,C),Q=d("EchoDecodingUtils").echoDecodeStringField(a,D);if(b.success&&e.success&&f.success){b=b.result;if(b==null)throw c("FBLogger")("messenger_web").mustfixThrow("The decoded messageId cannot be null");e=e.result;if(e==null)throw c("FBLogger")("messenger_web").mustfixThrow("The decoded threadId cannot be null");O=O==null?void 0:O.result;if(O==null)throw c("FBLogger")("messenger_web").mustfixThrow("The decoded contentTypeString cannot be null");var R=ba(b,a),S=R.editCount;R=R.editHistory;Q={contentSubtype:fa(Q.result),contentType:da(O),displayTimestampMs:g.success?g.result:f.result,editCount:S,editHistory:R,messageId:b,sortOrderMs:f.result,threadId:e};O=ea(P.result);O!=null&&(Q.xContentType=O);g=d("EchoDecodingUtils").echoDecodeAddressField(a,t);g.success&&g.result!=null&&(Q.from=g.result);S=d("EchoDecodingUtils").echoDecodeNullableBooleanField(a,x);S.success&&S.result!=null&&(Q.isTombstoned=S.result);R=d("EchoDecodingUtils").echoDecodeStringField(a,u);R.success&&R.result!=null&&(Q.text=R.result);b=d("EchoDecodingUtils").echoDecodeStringField(a,v);if(b.success&&b.result!=null){f=ca(b.result);Q.textSize=f}e=d("EchoDecodingUtils").echoDecodeStringField(a,H);if(e.success&&e.result!=null){P=ga(e.result);Q.xMessagePlaceholderType=P}O=d("EchoDecodingUtils").echoDecodeStringField(a,w);O.success&&O.result!=null&&(Q.sendError=O.result);g=d("EchoDecodingUtils").echoDecodeNullableIntField(a,y);g.success&&g.result!=null&&(Q.expireTimestampMs=g.result);S=d("EchoDecodingUtils").echoDecodeNullableIntField(a,z);S.success&&S.result!=null&&(Q.deleteTimestampMs=S.result);R=d("EchoDecodingUtils").echoDecodeNullableIntField(a,A);R.success&&R.result!=null&&(Q.ephemeralDurationInSec=R.result);b=d("EchoDecodingUtils").echoDecodeStringField(a,U);b.success&&b.result!=null&&(b.result==="view_once"&&(Q.viewOnce=!0));f=d("EchoDecodingUtils").echoDecodeNullableIntField(a,s);f.success&&f.result!=null&&(Q.authoritativeTimestampMs=f.result);e=d("EchoMessageReceiptStatusFieldUtils").echoMessageDecodeReceiptStatusDataFields(a);e.length>0&&(Q.receiptStatusList=e);P=d("EchoDecodingUtils").echoDecodeNullableBooleanField(a,E);P.success&&P.result!=null&&(Q.isForwarded=P.result);d("EchoMessageMediaGroupFieldUtil").decodeMessageMediaGroupFields(a,Q);O=d("EchoDecodingUtils").echoDecodeStringField(a,F);O.success&&O.result!=null&&(Q.xOfflineThreadingId=O.result);g=d("EchoDecodingUtils").echoDecodeStringField(a,G);g.success&&g.result!=null&&(Q.xThreadId=g.result);S=d("EchoDecodingUtils").echoDecodeStringField(a,L);S.success&&S.result!=null&&(Q.serializationOrigin=ha(S.result));R=d("EchoDecodingUtils").echoDecodeNullableIntField(a,d("EchoCommonUtils").ECHO_COMMON_FIELD_DOCUMENT_VERSION);Q.version=R.success&&R.result!=null?R.result:V;b=d("EchoDecodingUtils").echoDecodeAddressListField(a,I);b.success&&b.result!=null&&(Q.reactions=b.result);f=d("EchoDecodingUtils").echoDecodeAddressListField(a,J);f.success&&f.result!=null&&(Q.reactionAuthoritativeTimestampMs=f.result);e=d("EchoDecodingUtils").echoDecodeAddressListField(a,K);e.success&&e.result!=null&&(Q.reactionXOfflineThreadingIds=e.result);P=d("EchoMessageQuoteFieldUtils").echoMessageDecodeQuoteFields(a);P!=null&&(Q.quoteData=P);O=(Q==null?void 0:Q.contentType)===Y.XMA&&a.has(d("EchoMessageMediaFieldUtils").ECHO_MESSAGE_FIELD_NAME_ATTACHMENT_TYPE)&&(a.has(d("EchoMessageMediaFieldUtils").ECHO_MESSAGE_FIELD_NAME_ATTACHMENT_OBJECT_ID)||a.has(d("EchoMessageMediaFieldUtils").ECHO_MESSAGE_FIELD_NAME_ATTACHMENT_OBJECT_IDS));g=a.has(T);if(a.has(T)){S=d("EchoMessageMediaFieldUtils").decodeReceiverFetchData(a);R=d("EchoDecodingUtils").echoDecodeStringField(a,T);b=R.result;f=R.success;S==null||!f||b==null?d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to decode media data for Receiver Fetch, Message origin: ",""])),Q.serializationOrigin):(Q.receiverFetchData=S,Q.receiverFetchId=b)}if(((Q==null?void 0:Q.contentType)===Y.MEDIA||O)&&!g){e=d("EchoMessageMediaFieldUtils").echoMessageDecodeMediaDataFields(a,Q==null?void 0:Q.contentType,Q==null?void 0:Q.xContentType);P="[labyrinth_web] mandatory media data is missing from media message, msgId: "+Q.messageId+".";e!=null?(e.length!==1&&e.length!==2&&((Q==null?void 0:Q.contentType)===Y.MEDIA&&d("WALogger").ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose([""," Message origin: ",""])),P,Q.serializationOrigin),(Q==null?void 0:Q.contentType)===Y.XMA&&d("WALogger").WARN(k||(k=babelHelpers.taggedTemplateLiteralLoose([""," Message origin: ",""])),P,Q.serializationOrigin)),Q.mediaData=e[0],e.length===2&&(Q.previewMediaData=e[1])):((Q==null?void 0:Q.contentType)===Y.MEDIA&&d("WALogger").ERROR(l||(l=babelHelpers.taggedTemplateLiteralLoose([""," Message origin: ",""])),P,Q.serializationOrigin),(Q==null?void 0:Q.contentType)===Y.XMA&&d("WALogger").WARN(m||(m=babelHelpers.taggedTemplateLiteralLoose([""," Message origin: ",""])),P,Q.serializationOrigin))}if(Q.contentType===Y.PLACEHOLDER&&Q.contentSubtype===X.UNSEND){R=d("EchoDecodingUtils").echoDecodeNullableIntField(a,M);R.success&&R.result!=null&&(Q.revokeSentTimestampMs=R.result);f=d("EchoDecodingUtils").echoDecodeNullableIntField(a,N);f.success&&f.result!=null&&(Q.revokeUnsentTimestampMS=f.result)}if(Q.contentType===Y.XMA){S=d("EchoMessageXMAFieldUtils").decodeXMAFields(a);if(S!=null)Q.xmaData=S;else{d("WALogger").ERROR(n||(n=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] mandatory xma data is missing from xma message, msgId: ",""])),Q.messageId);return null}}return Q}else return null}function ca(a){return(a=W.cast(a))!=null?a:W.NONE}function da(a){return(a=Y.cast(a))!=null?a:Y.TEXT}function ea(a){return aa.cast(a)}function fa(a){return(a=X.cast(a))!=null?a:X.NONE}function ga(a){return(a=Z.cast(a))!=null?a:Z.NO_PLACEHOLDER}function ha(a){return(a=$.cast(a))!=null?a:$.UNKNOWN}function ia(a,b){var c;(c=d("EchoEncodingUtils")).echoSetStringField(a,o,b.messageId);c.echoSetStringField(a,p,b.threadId);c.echoSetIntField(a,q,b.sortOrderMs);c.echoSetIntField(a,r,b.displayTimestampMs);c.echoSetIntField(a,s,b.authoritativeTimestampMs);c.echoSetAddressField(a,t,b.from);c.echoSetStringField(a,u,b.text);b.textSize!=null&&d("EchoEncodingUtils").echoSetStringField(a,v,b.textSize);b.xMessagePlaceholderType!=null&&d("EchoEncodingUtils").echoSetStringField(a,H,b.xMessagePlaceholderType);d("EchoEncodingUtils").echoSetStringField(a,w,b.sendError);d("EchoEncodingUtils").echoSetBooleanField(a,x,b.isTombstoned);d("EchoEncodingUtils").echoSetIntField(a,y,b.expireTimestampMs);d("EchoEncodingUtils").echoSetIntField(a,z,b.deleteTimestampMs);d("EchoEncodingUtils").echoSetIntField(a,A,b.ephemeralDurationInSec);b.contentType!=null&&d("EchoEncodingUtils").echoSetStringField(a,B,b.contentType);b.xContentType!=null&&d("EchoEncodingUtils").echoSetStringField(a,C,b.xContentType);d("EchoMessageReceiptStatusFieldUtils").echoMessageSetReceiptStatusDataFields(a,b.receiptStatusList);d("EchoEncodingUtils").echoSetBooleanField(a,E,b.isForwarded);d("EchoEncodingUtils").echoSetStringField(a,F,b.xOfflineThreadingId);d("EchoEncodingUtils").echoSetStringField(a,G,b.xThreadId);d("EchoEncodingUtils").echoSetIntField(a,d("EchoCommonUtils").ECHO_COMMON_FIELD_DOCUMENT_VERSION,b.version);b.contentSubtype!=null&&d("EchoEncodingUtils").echoSetStringField(a,D,b.contentSubtype);d("EchoEncodingUtils").echoSetAddressListField(a,I,b.reactions);d("EchoEncodingUtils").echoSetAddressListField(a,J,b.reactionAuthoritativeTimestampMs);d("EchoEncodingUtils").echoSetAddressListField(a,K,b.reactionXOfflineThreadingIds);d("EchoMessageQuoteFieldUtils").echoMessageSetQuoteFields(a,b);b.serializationOrigin!=null&&d("EchoEncodingUtils").echoSetStringField(a,L,b.serializationOrigin);b.revokeSentTimestampMs!=null&&d("EchoEncodingUtils").echoSetIntField(a,M,b.revokeSentTimestampMs);b.revokeUnsentTimestampMS!=null&&d("EchoEncodingUtils").echoSetIntField(a,N,b.revokeUnsentTimestampMS);d("EchoMessageMediaGroupFieldUtil").echoMessageSetMediaGroupFields(a,b);c=b.xmaData;c!=null&&d("EchoMessageXMAFieldUtils").echoMessageSetXMAFields(a,c);((c=b.editHistory)==null?void 0:c.length)>0&&(d("EchoEncodingUtils").echoSetIntField(a,O,b.editCount),b.editHistory.forEach(function(b){var c=b.messageId;c!=null&&(d("EchoEncodingUtils").echoSetStringField(a,P+c,b.text),d("EchoEncodingUtils").echoSetIntField(a,Q+c,b.timestamp*1e3))}));b.receiverFetchId!=null&&d("EchoEncodingUtils").echoSetStringField(a,T,b.receiverFetchId)}g.ECHO_SERIALIZATION_ORIGIN=L;g.ECHO_MESSAGE_FIELD_NAME_EDIT_COUNT=O;g.ECHO_MESSAGE_FIELD_NAME_EDIT_CONTENT_PREFIX=P;g.ECHO_MESSAGE_FIELD_NAME_EDIT_TS_PREFIX=Q;g.ECHO_MESSAGE_FIELD_GROUP_ID=f;g.ECHO_MESSAGE_FIELD_GROUP_INDEX=R;g.ECHO_MESSAGE_FIELD_GROUP_SIZE=S;g.ECHO_MESSAGE_FIELD_RECEIVER_FETCH_ID=T;g.ECHO_MESSAGE_FIELD_NAME_EPHEMERALITY_TYPE=U;g.ECHO_MESSAGE_MIGRATION_DOCUMENT_VERSION=V;g.MessageTextSize=W;g.EchoMessageContentSubtype=X;g.EchoMessageContentType=Y;g.EchoXMessageContentType=aa;g.EchoMessagePlaceholderType=Z;g.EchoSerializationOriginType=$;g.encodeEchoMessage=a;g.decodeEchoMessage=e}),98);
__d("EchoMessageMediaFieldUtils",["$InternalEnum","EchoDecodingUtils","EchoEncodingUtils","EchoMessage","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w="X-Object-Id",x="X-Attachment-Object-Ids",y="Attachment-Type",z="Content-Type",A="X-Encrypted-Hash",B="X-Attachment-Type",C="X-Backup-Ent-Fbid",D="X-Backup-Status",E="X-Content-Type",F="X-Direct-Path",G="Height",H="X-Media-Key",I="X-Media-Key-Timestamp",J="Playable-Duration",K="Preview-Height",L="Preview-Content-Type",M="Preview-Width",N="Size",O="Width",P="X-Plaintext-Hash",Q="File-Name",R="Header-Attribution-Content-Type",S=(f=b("$InternalEnum"))({IMAGE:"image",STICKER:"sticker",VIDEO:"video",GIF:"animated_image",PTT:"audio",XMA:"xma",DOCUMENT:"document"}),T=f({IMAGE_JPEG:"image/jpeg",IMAGE_PNG:"image/png",STICKER:"image/webp",GIF:"image/gif",AUDIO_MP4:"audio/mp4",AUDIO_WAV:"audio/wav",XMA:"xma"}),U=f({INVALID:"-1",IMAGE:"0",PTT:"1",AUDIO:"2",DOCUMENT:"3",VIDEO:"4",GIF:"5",STICKER:"6",PROFILE_PICTURE:"7",APP_STATE:"8",HISTORY_SYNC:"9",THUMBNAIL_IMAGE:"10",THUMBNAIL_VIDEO:"11",THUMBNAIL_GIF:"12",THUMBNAIL_DOCUMENT:"13",THUMBNAIL_LINK:"14",NOVI_IMAGE:"15",NOVI_VIDEO:"16",KYCID:"17",WAFFLE_IMAGE:"18",WAFFLE_VIDEO:"19",WAFFLE_GIF:"20",PAYMENT_BG_IMAGE:"21",XMA_IMAGE:"22",PAYMENT_BR_DOCUMENT:"23",BIZ_COVER_PHOTO:"24",MESSENGER_PREVIEW:"25"}),V=f({FULL:"full",PREVIEW:"preview"});function W(a,b){var c=a.attachmentObjectId,e=a.attachmentType,f=a.backupEntFbid,g=a.directPath,n=a.filename,o=a.encryptedHash,p=a.height,q=a.mediaBackupStatus,r=a.mediaContentType,s=a.mediaKey,t=a.mediaKeyTimestamp,u=a.mediaPlayableDuration,v=a.plaintextHash,w=a.previewContentHeight,x=a.previewContentType,y=a.previewContentWidth,z=a.size,A=a.width,B=a.xAttachmentType,C=a.xContentType,D=a.xmaData;a=a.mediaEntryData;if(c==null)d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Missing attachment object id from required media metadata fields, msgId: ",""])),b);else if(e==null)d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Missing attachment type from required media metadata fields, msgId: ",""])),b);else if(g==null)d("WALogger").ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Missing direct path field from required media metadata fields, msgId: ",""])),b);else if(v==null)d("WALogger").ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Missing plaintextHash field from required media metadata fields, msgId: ",""])),b);else if(C==null)d("WALogger").ERROR(l||(l=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Missing xContentType field from required media metadata fields, msgId: ",""])),b);else if(B==null)d("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Missing xAttachmentType field from required media metadata fields, msgId: ",""])),b);else return{attachmentObjectId:c,attachmentType:e,backupEntFbid:f,directPath:g,encryptedHash:o,filename:n,height:p,mediaBackupStatus:q,mediaContentType:r,mediaEntryData:a,mediaKey:s,mediaKeyTimestamp:t,mediaPlayableDuration:u,plaintextHash:v,previewContentHeight:w,previewContentType:x,previewContentWidth:y,size:z,width:A,xAttachmentType:B,xContentType:C,xmaData:D}}function a(a,b){var c;(c=d("EchoEncodingUtils")).echoSetStringField(a,w,b.attachmentObjectId);c.echoSetStringField(a,y,b.attachmentType);c.echoSetStringField(a,P,b.plaintextHash);c.echoSetStringField(a,A,b.encryptedHash);c.echoSetIntField(a,N,b.size);c.echoSetStringField(a,H,b.mediaKey);c.echoSetIntField(a,I,b.mediaKeyTimestamp);c.echoSetStringField(a,F,b.directPath);b.mediaContentType!=null&&d("EchoEncodingUtils").echoSetStringField(a,z,b.mediaContentType);d("EchoEncodingUtils").echoSetIntField(a,O,b.width);d("EchoEncodingUtils").echoSetIntField(a,G,b.height);b.previewContentType!=null&&d("EchoEncodingUtils").echoSetStringField(a,L,b.previewContentType);b.headerAttributionContentType!=null&&d("EchoEncodingUtils").echoSetStringField(a,R,b.headerAttributionContentType);d("EchoEncodingUtils").echoSetIntField(a,M,b.previewContentWidth);d("EchoEncodingUtils").echoSetIntField(a,K,b.previewContentHeight);d("EchoEncodingUtils").echoSetIntField(a,J,b.mediaPlayableDuration);b.xAttachmentType!=null&&d("EchoEncodingUtils").echoSetStringField(a,B,b.xAttachmentType);d("EchoEncodingUtils").echoSetStringField(a,E,b.xContentType);d("EchoEncodingUtils").echoSetStringField(a,C,b.backupEntFbid);d("EchoEncodingUtils").echoSetStringField(a,D,b.mediaBackupStatus);d("EchoEncodingUtils").echoSetStringField(a,Q,b.filename)}function c(a,b,c){var e={},f=!1,g=!1,h=!1;if(ba(a)){var i=$(a,b,c);if(i==null){d("WALogger").ERROR(n||(n=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] multi blob media message: primary attachment object id is null. msgType: "," mediaType: ",""])),b,c);return null}i.length!==2&&d("WALogger").ERROR(o||(o=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Unable to get primary and secondary attachment object ids"])));c=!1;var j=!1,k=i[0];i=i[1];var l={};f=Z(a,e,k);c=Z(a,l,i);g=Y(a,e,b,k,k);j=Y(a,l,b,i,k);h=X(a,e,k);k=X(a,l,i);if(!f||!g||!h||!c||!j||!k)return null;i=d("EchoDecodingUtils").echoDecodeStringField(a,"X-Offline-Threading-ID").result;c=W(e,i);j=W(l,i);if(c!=null&&j!=null)return[c,j]}else{f=Z(a,e);g=Y(a,e,b);h=X(a,e);if(!f||!g||!h)return null;k=W(e);if(k!=null)return[k]}return null}function X(a,b,c){var e,f=d("EchoDecodingUtils").echoDecodeStringField(a,"X-Offline-Threading-ID").result;e=(e=a.get(d("EchoMessage").ECHO_SERIALIZATION_ORIGIN))!=null?e:"";c=[{fieldName:"height",id:G},{fieldName:"width",id:O},{fieldName:"size",id:N},{fieldName:"previewContentHeight",id:K},{fieldName:"previewContentWidth",id:M},{fieldName:"mediaKeyTimestamp",id:c!=null?c+"-"+I:I}];var g=[{attachmentTypes:[U.VIDEO,U.AUDIO],fieldName:"mediaPlayableDuration",id:J}];for(g of g){var h=g.attachmentTypes,i=g.fieldName,j=g.id;j=d("EchoDecodingUtils").echoDecodeIntField(a,j);var k=j.result;j=j.success;if(j&&k!=null)b[i]=k;else if(!(b.xAttachmentType!=null&&!aa(h,b.xAttachmentType)||b.attachmentType===S.XMA)){d("WALogger").ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Missing "," from media fields. xAttachmentType: ",", AttachmentType: ",". EchoOrigin: "," xOfflineThreadingId: ",""])),i,b.xAttachmentType,b.attachmentType,e,f);return!1}}c.map(function(f){var c=f.fieldName;f=f.id;f=d("EchoDecodingUtils").echoDecodeIntField(a,f);var e=f.result;f=f.success;f&&e!=null&&(b[c]=e)});return!0}function Y(a,b,c,e,f){var g,h=d("EchoDecodingUtils").echoDecodeStringField(a,"X-Offline-Threading-ID").result,i,j;g=(g=a.get(d("EchoMessage").ECHO_SERIALIZATION_ORIGIN))!=null?g:"";var k=[{fieldName:"filename",id:Q}];e!=null&&f!=null?(b.attachmentObjectId=e,i=[{fieldName:"plaintextHash",id:e+"-"+P},{fieldName:"directPath",id:e+"-"+F},{fieldName:"xContentType",id:e+"-"+E}],k.push({fieldName:"mediaKey",id:e+"-"+H}),j=f+"-"+C,e=e+"-"+A):(i=[{fieldName:"attachmentObjectId",id:w},{fieldName:"plaintextHash",id:P},{fieldName:"directPath",id:F},{fieldName:"xContentType",id:E}],k.push({fieldName:"mediaKey",id:H}),j=C,e=A);k.push({fieldName:"backupEntFbid",id:j});k.push({fieldName:"mediaContentType",id:z});k.push({fieldName:"encryptedHash",id:e});j=f!=null?f+"-"+D:D;k.push({fieldName:"mediaBackupStatus",id:j});e=[];for(f of i){j=f.fieldName;i=f.id;i=d("EchoDecodingUtils").echoDecodeStringField(a,i);var l=i.result;i=i.success;i&&l!=null?b[j]=l:e.push(j)}if(e.length>0){i=e.join(", ");c===d("EchoMessage").EchoMessageContentType.XMA?d("WALogger").WARN(q||(q=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Missing "," from media fields. AttachmentType: "," EchoOrigin: ",""])),i,b.attachmentType,g):d("WALogger").ERROR(r||(r=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Missing "," from media fields. AttachmentType: "," EchoOrigin: "," xOfflineThreadingId: ",""])),i,b.attachmentType,g,h);return!1}k.map(function(e){var f=e.fieldName;e=e.id;e=d("EchoDecodingUtils").echoDecodeStringField(a,e);var c=e.result;e=e.success;e&&c!=null&&(b[f]=c)});return!0}function Z(a,b,c){var e,f=d("EchoDecodingUtils").echoDecodeStringField(a,"X-Offline-Threading-ID").result;e=(e=a.get(d("EchoMessage").ECHO_SERIALIZATION_ORIGIN))!=null?e:"";var g=d("EchoDecodingUtils").echoDecodeStringField(a,y);g=g.result==="file"?S.DOCUMENT:S.cast(g.result);g!=null&&(b.attachmentType=g);var h=d("EchoDecodingUtils").echoDecodeStringField(a,L);h=T.cast(h.result);h!=null&&(b.previewContentType=h);var i=d("EchoDecodingUtils").echoDecodeStringField(a,R);i=i.result;i!=null&&(b.headerAttributionContentType=i);i=d("EchoDecodingUtils").echoDecodeStringField(a,c!=null?c+"-"+B:B);i.success&&i.result!=null&&(a=ca(i.result),a!=null&&(b.xAttachmentType=a));if(g!=null&&(h!=null||g===S.DOCUMENT||g===S.PTT))return!0;else d("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Missing enum fields from media fields: attachmentType: "," mediaPreviewContentType: "," mediaAttachmentType: "," EchoOrigin: "," xOfflineThreadingId: ",""])),g,h,i,e,f);return!1}function aa(a,b){return a.reduce(function(a,c){return a||c===b},!1)}function ba(a){return a.has(x)}function $(a,b,c){var e=d("EchoDecodingUtils").echoDecodeObjectIdListField(a,x),f=e.result;e=e.success;if(!e||f==null||f.length!==2){d("WALogger").ERROR(t||(t=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] multi blob media message: can not parse objects ids. "," msgType: "," mediaType: ",""])),f,b,c);return null}e=f.find(function(b){b=b+"-"+D;b=d("EchoDecodingUtils").echoDecodeStringField(a,b);var c=b.result;b=b.success;if(b&&c!=null)return!0});if(e!=null){b=e===f[0]?f[1]:f[0];return[e,b]}e=f.find(function(b){b=b+"-"+E;b=d("EchoDecodingUtils").echoDecodeStringField(a,b);var c=b.result;b=b.success;if(b&&c!=null&&V.cast(c)===V.FULL)return!0});if(e!=null){c=e===f[0]?f[1]:f[0];return[e,c]}return f}function ca(a){var b=U.cast(a);b==null&&d("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Invalid media attachment type: ",""])),a);return b!=null?b:U.INVALID}function e(a){var b={};b=Z(a,b);if(!b)return null;b=d("EchoDecodingUtils").echoDecodeStringField(a,z);var c=d("EchoDecodingUtils").echoDecodeIntField(a,G),e=d("EchoDecodingUtils").echoDecodeIntField(a,O);a=d("EchoDecodingUtils").echoDecodeStringField(a,y);if(!b.success||!c.success||!e.success||!a.success||b.result==null||c.result==null||e.result==null||a.result==null){d("WALogger").ERROR(v||(v=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Missing media fields for receiver fetch"])));return null}return{mimetype:b.result,previewHeight:c.result,previewWidth:e.result,type:a.result}}g.ECHO_MESSAGE_FIELD_NAME_ATTACHMENT_OBJECT_ID=w;g.ECHO_MESSAGE_FIELD_NAME_ATTACHMENT_OBJECT_IDS=x;g.ECHO_MESSAGE_FIELD_NAME_ATTACHMENT_TYPE=y;g.AttachmentType=S;g.EchoMessageMediaPreviewType=T;g.EchoMessageActMediaAttachmentType=U;g.convertMediaMetadataDetailsToMediaMetadata=W;g.echoMessageSetMediaMetadataFields=a;g.echoMessageDecodeMediaDataFields=c;g.setMediaIntFields=X;g.setMediaEnumFields=Z;g.getAttachmentObjectIdsFromMultiBlobMediaMsg=$;g.decodeReceiverFetchData=e}),98);
__d("EchoMessageMediaGroupFieldUtil",["EchoDecodingUtils","EchoEncodingUtils","EchoMessage"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){b.groupId!=null&&d("EchoEncodingUtils").echoSetStringField(a,d("EchoMessage").ECHO_MESSAGE_FIELD_GROUP_ID,b.groupId),b.groupIndex!=null&&d("EchoEncodingUtils").echoSetIntField(a,d("EchoMessage").ECHO_MESSAGE_FIELD_GROUP_INDEX,b.groupIndex),b.groupSize!=null&&d("EchoEncodingUtils").echoSetIntField(a,d("EchoMessage").ECHO_MESSAGE_FIELD_GROUP_SIZE,b.groupSize)}function b(a,b){var c=d("EchoDecodingUtils").echoDecodeStringField(a,d("EchoMessage").ECHO_MESSAGE_FIELD_GROUP_ID);c.success&&c.result!=null&&(b.groupId=c.result);c=d("EchoDecodingUtils").echoDecodeIntField(a,d("EchoMessage").ECHO_MESSAGE_FIELD_GROUP_INDEX);c.success&&c.result!=null&&(b.groupIndex=c.result);c=d("EchoDecodingUtils").echoDecodeIntField(a,d("EchoMessage").ECHO_MESSAGE_FIELD_GROUP_SIZE);c.success&&c.result!=null&&(b.groupSize=c.result)}g.echoMessageSetMediaGroupFields=a;g.decodeMessageMediaGroupFields=b}),98);
__d("EchoMessageQuoteFieldUtils",["$InternalEnum","EchoDecodingUtils","EchoEncodingUtils"],(function(a,b,c,d,e,f,g){"use strict";var h="Reply-Message-Id",i="Reply-Message-Sender",j="Reply-Sort-Order",k="Reply-Type",l="Reply-Status",m=b("$InternalEnum").Mirrored(["BUMP"]),n=b("$InternalEnum")({VALID:"valid"});function a(a){var b={quoteMessageId:"<not set>",quoteMessageSender:{localKey:"<not set>",transportKey:"<not set>"},quoteSortOrderInMs:0},c=o(a,b),d=p(a,b),e=q(a,b);a=r(a,b);return!c||!d||!e||!a?null:b}function c(a,b){b=b.quoteData;if(b==null)return;d("EchoEncodingUtils").echoSetStringField(a,h,b.quoteMessageId);d("EchoEncodingUtils").echoSetAddressField(a,i,b.quoteMessageSender);d("EchoEncodingUtils").echoSetIntField(a,j,b.quoteSortOrderInMs);b.status!=null&&d("EchoEncodingUtils").echoSetStringField(a,l,b.status);b.replyType!=null&&d("EchoEncodingUtils").echoSetStringField(a,k,b.replyType)}function o(a,b){var c=[{fieldName:"quoteMessageSender",id:i}];for(c of c){var e=c.fieldName,f=c.id;f=d("EchoDecodingUtils").echoDecodeAddressField(a,f);var g=f.result;f=f.success;if(f&&g!=null)b[e]=g;else return!1}return!0}function p(a,b){var c=[{fieldName:"quoteMessageId",id:h}];for(c of c){var e=c.fieldName,f=c.id;f=d("EchoDecodingUtils").echoDecodeStringField(a,f);var g=f.result;f=f.success;if(f&&g!=null)b[e]=g;else return!1}return!0}function q(a,b){var c=[{fieldName:"quoteSortOrderInMs",id:j}];for(c of c){var e=c.fieldName,f=c.id;f=d("EchoDecodingUtils").echoDecodeIntField(a,f);var g=f.result;f=f.success;if(f&&g!=null)b[e]=g;else return!1}return!0}function r(a,b){var c=d("EchoDecodingUtils").echoDecodeStringField(a,k);c=m.cast(c.result);c!=null&&(b.replyType=c);c=d("EchoDecodingUtils").echoDecodeStringField(a,l);a=n.cast(c.result);a!=null&&(b.status=a);return!0}g.EchoMessageQuoteReplyType=m;g.EchoMessageQuoteStatus=n;g.echoMessageDecodeQuoteFields=a;g.echoMessageSetQuoteFields=c}),98);
__d("EchoMessageReceiptStatusFieldUtils",["$InternalEnum","EchoCommonUtils","EchoDecodingUtils","EchoEncodingUtils","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i="Receipt-Status",j="Receipt-Timestamp",k=b("$InternalEnum")({UNKNOWN:"unknown",SENDING:"sending",SERVER_RECEIVED:"server_received",DELIVERED:"delivered",READ:"read",ERROR:"error",NON_RETRYABLE_ERROR:"non_retryable_error"});function a(a,b){if(b==null||b.length===0)return;b.forEach(function(b){d("EchoEncodingUtils").echoSetStringField(a,d("EchoCommonUtils").getEchoAddressFieldNameWithSuffix(b.address,i),b.status),b.timestampMs!=null&&d("EchoEncodingUtils").echoSetIntField(a,d("EchoCommonUtils").getEchoAddressFieldNameWithSuffix(b.address,j),b.timestampMs)})}function c(a){var b=[];l(a).forEach(function(c){var e=d("EchoCommonUtils").getEchoAddressFieldNameWithSuffix(c,i);e=d("EchoDecodingUtils").echoDecodeStringField(a,e);if(e.success){e=(e=k.cast(e.result))!=null?e:k.UNKNOWN;var f=d("EchoCommonUtils").getEchoAddressFieldNameWithSuffix(c,j);f=d("EchoDecodingUtils").echoDecodeNullableIntField(a,f);f.result!=null?b.push({address:c,status:e,timestampMs:f.result}):b.push({address:c,status:e})}});return b}function l(a){var b=new Set();for(a of a.keys())if(a.includes(i))try{var c=a.split("@"),e=c[0];c=m(c[1]);b.add({localKey:e,transportKey:c})}catch(a){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Error occurred while decoding participants from echo doc, error: ",""])),a)}return Array.from(b)}function m(a){a=a.split(i);return a[0].split("-")[0]}g.MessageReceiptStatus=k;g.echoMessageSetReceiptStatusDataFields=a;g.echoMessageDecodeReceiptStatusDataFields=c}),98);
__d("EchoMessageXMAFieldUtils",["$InternalEnum","EchoDecodingUtils","EchoEncodingUtils","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l="XMA-Default-CTA",m="XMA-Gating-Type",n="XMA-Header-Subtitle",o="XMA-Header-Title",p="XMA-Is-Tombstoned",q="XMA-Layout-Type",r="XMA-Max-Subtitle-Num-Lines",s="XMA-Max-Title-Num-Lines",t="XMA-Subtitle-Text",u="XMA-Target-Expiry",v="XMA-Target-ID",w="XMA-Target-Type",x="XMA-Target-Username",y="XMA-Title-Text",z="XMA-Content-Ref",A="XMA-Dataclass",B=b("$InternalEnum").Mirrored(["SINGLE","HSCROLL","VSTACK","PORTRAIT","STANDARD_DXMA","LIST_DXMA","GRID"]),C=b("$InternalEnum").Mirrored(["NONE","IG_STORY_PHOTO_MENTION","IG_SINGLE_IMAGE_POST_SHARE","IG_MULTIPOST_SHARE","IG_SINGLE_VIDEO_POST_SHARE","IG_STORY_PHOTO_SHARE","IG_STORY_VIDEO_SHARE","IG_CLIPS_SHARE","IG_IGTV_SHARE","IG_SHOP_SHARE","IG_PROFILE_SHARE","IG_STORY_PHOTO_HIGHLIGHT_SHARE","IG_STORY_VIDEO_HIGHLIGHT_SHARE","IG_STORY_REPLY","IG_STORY_REACTION","FB_FEED_SHARE","FB_STORY_REPLY","FB_STORY_SHARE","FB_STORY_MENTION","FB_FEED_VIDEO_SHARE","FB_GAMING_CUSTOM_UPDATE","FB_PRODUCER_STORY_REPLY","FB_PROFILE_DIRECTORY_ITEM","MSG_EXTERNAL_LINK_SHARE","MSG_RECEIVER_FETCH","RTC_AUDIO_CALL","RTC_VIDEO_CALL","RTC_MISSED_AUDIO_CALL","RTC_MISSED_VIDEO_CALL","RTC_GROUP_AUDIO_CALL","RTC_GROUP_VIDEO_CALL","FB_EVENT","FB_SHORT","MSG_LOCATION_SHARING","MSG_LOCATION_SHARING_V2","MSG_MEMORIES_SHARE"]),D=b("$InternalEnum").Mirrored(["NONE","PRIVATE","SENSITIVE","MISINFORMATION","MEDIA_LABEL","POST_COVER","POST_LABEL","WARNING_SCREENS","INFO","EYE_OFF","NEWS_OFF","WARNING"]);function a(a,b){b.xmaLayoutType!=null&&d("EchoEncodingUtils").echoSetStringField(a,q,b.xmaLayoutType),b.xmaTargetType!=null&&d("EchoEncodingUtils").echoSetStringField(a,w,b.xmaTargetType),d("EchoEncodingUtils").echoSetStringField(a,x,b.xmaTargetUsername),d("EchoEncodingUtils").echoSetStringField(a,v,b.xmaTargetId),b.xmaTargetExpiry!=null&&d("EchoEncodingUtils").echoSetIntField(a,u,b.xmaTargetExpiry),d("EchoEncodingUtils").echoSetStringField(a,l,b.xmaDefaultCTA),d("EchoEncodingUtils").echoSetStringField(a,o,b.xmaHeaderTitle),d("EchoEncodingUtils").echoSetStringField(a,n,b.xmaHeaderSubtitle),d("EchoEncodingUtils").echoSetStringField(a,y,b.xmaTitleText),d("EchoEncodingUtils").echoSetStringField(a,t,b.xmaSubtitleText),b.xmaMaxTitleNumLines!=null&&d("EchoEncodingUtils").echoSetIntField(a,s,b.xmaMaxTitleNumLines),b.xmaMaxSubtitleNumLines!=null&&d("EchoEncodingUtils").echoSetIntField(a,r,b.xmaMaxSubtitleNumLines),b.xmaGatingType!=null&&d("EchoEncodingUtils").echoSetStringField(a,m,b.xmaGatingType),b.xmaDataclass!=null&&d("EchoEncodingUtils").echoSetStringField(a,A,b.xmaDataclass),d("EchoEncodingUtils").echoSetBooleanField(a,p,b.xmaIsTombstoned),b.xmaContentRef!=null&&d("EchoEncodingUtils").echoSetStringField(a,z,b.xmaContentRef)}function c(a){var b=G(a,p);if(b==null){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Missing xmaIsTombstoned from xma fields"])));return null}var c=D.cast(d("EchoDecodingUtils").echoDecodeStringField(a,m).result),e=B.cast(d("EchoDecodingUtils").echoDecodeStringField(a,q).result),f=C.cast(d("EchoDecodingUtils").echoDecodeStringField(a,w).result);return{xmaContentRef:E(a,z),xmaDataclass:E(a,A),xmaDefaultCTA:E(a,l),xmaGatingType:c,xmaHeaderSubtitle:E(a,n),xmaHeaderTitle:E(a,o),xmaIsTombstoned:b,xmaLayoutType:e,xmaMaxSubtitleNumLines:F(a,r),xmaMaxTitleNumLines:F(a,s),xmaSubtitleText:E(a,t),xmaTargetExpiry:F(a,u),xmaTargetId:E(a,v),xmaTargetType:f,xmaTargetUsername:E(a,x),xmaTitleText:E(a,y)}}function E(a,b){a=d("EchoDecodingUtils").echoDecodeStringField(a,b);var c=a.result;a=a.success;if(a&&c!=null)return c;else d("WALogger").WARN(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Missing "," from media fields"])),b)}function F(a,b){a=d("EchoDecodingUtils").echoDecodeIntField(a,b);var c=a.result;a=a.success;if(a&&c!=null)return c;else d("WALogger").WARN(j||(j=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Missing "," from xma fields"])),b)}function G(a,b){a=d("EchoDecodingUtils").echoDecodeBooleanField(a,b);var c=a.result;a=a.success;if(a&&c!=null)return c;else d("WALogger").WARN(k||(k=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Missing "," from xma fields"])),b)}g.XMALayoutType=B;g.XMAContentType=C;g.XMAGatingType=D;g.echoMessageSetXMAFields=a;g.decodeXMAFields=c}),98);
__d("MAWConvertXMATargetTypeToExtendedContentTargetType",["EchoMessageXMAFieldUtils","WAArmadilloXMA.pb","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){switch(a){case d("EchoMessageXMAFieldUtils").XMAContentType.IG_STORY_PHOTO_MENTION:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_MENTION;case d("EchoMessageXMAFieldUtils").XMAContentType.IG_SINGLE_IMAGE_POST_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_IMAGE_POST_SHARE;case d("EchoMessageXMAFieldUtils").XMAContentType.IG_MULTIPOST_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_MULTIPOST_SHARE;case d("EchoMessageXMAFieldUtils").XMAContentType.IG_SINGLE_VIDEO_POST_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_VIDEO_POST_SHARE;case d("EchoMessageXMAFieldUtils").XMAContentType.IG_STORY_PHOTO_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_SHARE;case d("EchoMessageXMAFieldUtils").XMAContentType.IG_STORY_VIDEO_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_SHARE;case d("EchoMessageXMAFieldUtils").XMAContentType.IG_CLIPS_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_CLIPS_SHARE;case d("EchoMessageXMAFieldUtils").XMAContentType.IG_IGTV_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_IGTV_SHARE;case d("EchoMessageXMAFieldUtils").XMAContentType.IG_SHOP_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SHOP_SHARE;case d("EchoMessageXMAFieldUtils").XMAContentType.IG_PROFILE_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_PROFILE_SHARE;case d("EchoMessageXMAFieldUtils").XMAContentType.IG_STORY_PHOTO_HIGHLIGHT_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_HIGHLIGHT_SHARE;case d("EchoMessageXMAFieldUtils").XMAContentType.IG_STORY_VIDEO_HIGHLIGHT_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_HIGHLIGHT_SHARE;case d("EchoMessageXMAFieldUtils").XMAContentType.IG_STORY_REPLY:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REPLY;case d("EchoMessageXMAFieldUtils").XMAContentType.IG_STORY_REACTION:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REACTION;case d("EchoMessageXMAFieldUtils").XMAContentType.FB_FEED_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_SHARE;case d("EchoMessageXMAFieldUtils").XMAContentType.FB_STORY_REPLY:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_REPLY;case d("EchoMessageXMAFieldUtils").XMAContentType.FB_STORY_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_SHARE;case d("EchoMessageXMAFieldUtils").XMAContentType.FB_STORY_MENTION:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_MENTION;case d("EchoMessageXMAFieldUtils").XMAContentType.FB_FEED_VIDEO_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_VIDEO_SHARE;case d("EchoMessageXMAFieldUtils").XMAContentType.FB_GAMING_CUSTOM_UPDATE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_GAMING_CUSTOM_UPDATE;case d("EchoMessageXMAFieldUtils").XMAContentType.FB_PRODUCER_STORY_REPLY:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_PRODUCER_STORY_REPLY;case d("EchoMessageXMAFieldUtils").XMAContentType.MSG_EXTERNAL_LINK_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_EXTERNAL_LINK_SHARE;case d("EchoMessageXMAFieldUtils").XMAContentType.RTC_AUDIO_CALL:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_AUDIO_CALL;case d("EchoMessageXMAFieldUtils").XMAContentType.RTC_VIDEO_CALL:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_VIDEO_CALL;case d("EchoMessageXMAFieldUtils").XMAContentType.RTC_MISSED_AUDIO_CALL:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_AUDIO_CALL;case d("EchoMessageXMAFieldUtils").XMAContentType.RTC_MISSED_VIDEO_CALL:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_VIDEO_CALL;case d("EchoMessageXMAFieldUtils").XMAContentType.RTC_GROUP_AUDIO_CALL:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_AUDIO_CALL;case d("EchoMessageXMAFieldUtils").XMAContentType.RTC_GROUP_VIDEO_CALL:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_VIDEO_CALL;case d("EchoMessageXMAFieldUtils").XMAContentType.FB_EVENT:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_EVENT;case d("EchoMessageXMAFieldUtils").XMAContentType.FB_SHORT:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_SHORT;case d("EchoMessageXMAFieldUtils").XMAContentType.MSG_RECEIVER_FETCH:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_RECEIVER_FETCH;case d("EchoMessageXMAFieldUtils").XMAContentType.MSG_LOCATION_SHARING:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_LOCATION_SHARING;case d("EchoMessageXMAFieldUtils").XMAContentType.MSG_LOCATION_SHARING_V2:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_LOCATION_SHARING_V2;case d("EchoMessageXMAFieldUtils").XMAContentType.MSG_MEMORIES_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_MEMORIES_SHARE;default:d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Not a valid xmaTargetType: ",""])),a);return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_EXTERNAL_LINK_SHARE}}g.convertXMATargetTypeToExtendedContentTargetType=a}),98);
__d("MAWHandleEchoMsgsRestoreApiUtils",["$InternalEnum","EBLogger","EchoMessage","EchoMessageMediaFieldUtils","MAWAckLevel","MAWConvertXMATargetTypeToExtendedContentTargetType","MAWEBRestoreTrackingUtils","MAWJids","MAWMsgType","MAWRepliesRestoreUtils","WAJids","WAResultOrError","WAStanzaUtils","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p=d("EBLogger").EBLogger.tags(["restore"]);c=b("$InternalEnum")({INITIAL_RESTORE:"initial_restore",POINT_RESTORE:"point_restore",PAGINATED_RESTORE:"paginated_restore"});function q(a,b){b=b==null?p:p.tags([b]);var c=a.contentType;switch(c){case d("EchoMessage").EchoMessageContentType.TEXT:return a.xContentType===d("EchoMessage").EchoXMessageContentType.BUMP?d("WAResultOrError").makeResult(d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE):d("WAResultOrError").makeResult(d("MAWMsgType").MSG_TYPE.TEXT);case d("EchoMessage").EchoMessageContentType.MEDIA:return a.receiverFetchId!=null&&a.receiverFetchData!=null?d("WAResultOrError").makeResult(d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH):a.mediaData==null?d("WAResultOrError").makeError("media_mandatory_fields_missing"):d("WAResultOrError").makeResult(r(a.mediaData));case d("EchoMessage").EchoMessageContentType.PLACEHOLDER:if(a.contentSubtype===d("EchoMessage").EchoMessageContentSubtype.UNSEND)return d("WAResultOrError").makeResult(d("MAWMsgType").MSG_TYPE.REVOKED);b.MUSTFIX(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Message has unsupported message content type: ",", xContentType: ",",\n      subcontent type: "," ,\n      origin: ",""])),d("EchoMessage").EchoMessageContentType.getName(c),a.xContentType!=null?d("EchoMessage").EchoXMessageContentType.getName(a.xContentType):"unknown",d("EchoMessage").EchoMessageContentSubtype.getName(a.contentSubtype),a.serializationOrigin!=null?d("EchoMessage").EchoSerializationOriginType.getName(a.serializationOrigin):"unknown");return d("WAResultOrError").makeError("unsupported_message_type");case d("EchoMessage").EchoMessageContentType.XMA:return d("WAResultOrError").makeResult(d("MAWMsgType").MSG_TYPE.XMA);case d("EchoMessage").EchoMessageContentType.DECRYPTION_FAILURE:return d("WAResultOrError").makeResult(d("MAWMsgType").MSG_TYPE.CIPHERTEXT);default:b.MUSTFIX(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Message has unsupported message content type: ",""])),d("EchoMessage").EchoMessageContentType.getName(c));return d("WAResultOrError").makeError("unsupported_message_type")}}function r(a){switch(a.attachmentType){case d("EchoMessageMediaFieldUtils").AttachmentType.IMAGE:return d("MAWMsgType").MSG_TYPE.IMAGE;case d("EchoMessageMediaFieldUtils").AttachmentType.STICKER:return d("MAWMsgType").MSG_TYPE.STICKER;case d("EchoMessageMediaFieldUtils").AttachmentType.VIDEO:return d("MAWMsgType").MSG_TYPE.VIDEO;case d("EchoMessageMediaFieldUtils").AttachmentType.GIF:return d("MAWMsgType").MSG_TYPE.GIF;case d("EchoMessageMediaFieldUtils").AttachmentType.PTT:return d("MAWMsgType").MSG_TYPE.PTT;case d("EchoMessageMediaFieldUtils").AttachmentType.XMA:return d("MAWMsgType").MSG_TYPE.XMA;case d("EchoMessageMediaFieldUtils").AttachmentType.DOCUMENT:return d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE}}function a(a,b,c,e,f,g){var h,i=a.from;if(i==null){p.MUSTFIX(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Author info is missing from msg: ",""])),e);return d("WAResultOrError").makeError("author_missing")}var l=q(a,f);if(l.success===!1)return d("WAResultOrError").makeError(l.error);if(l==null)return d("WAResultOrError").makeError("unsupported_message_type");l=l.value;if((h=a.isTombstoned)!=null?h:!1)return d("WAResultOrError").makeError("message_tombstoned");switch(l){case d("MAWMsgType").MSG_TYPE.TEXT:case d("MAWMsgType").MSG_TYPE.REVOKED:case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:return y(a,b,c,i,l,e,f,g);case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.PTT:case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return s(a,b,c,i,l,e);case d("MAWMsgType").MSG_TYPE.XMA:return u(a,b,c,i,l,e);case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:return d("WAResultOrError").makeResult(B(a,b,c,i,l,e));case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:return v(a,b,c,i,l,e);default:p.MUSTFIX(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Encountered unsupported media type: ",""])),l);return d("WAResultOrError").makeError("unsupported_message_type")}}function s(a,b,c,d,e,f){a=z(a,b,c,d,e,f);return t(e,a)}function t(a,b){switch(a){case d("MAWMsgType").MSG_TYPE.IMAGE:return d("WAResultOrError").makeResult(babelHelpers["extends"]({},b,{type:d("MAWMsgType").MSG_TYPE.IMAGE}));case d("MAWMsgType").MSG_TYPE.STICKER:return d("WAResultOrError").makeResult(babelHelpers["extends"]({},b,{type:d("MAWMsgType").MSG_TYPE.STICKER}));case d("MAWMsgType").MSG_TYPE.VIDEO:return d("WAResultOrError").makeResult(babelHelpers["extends"]({},b,{type:d("MAWMsgType").MSG_TYPE.VIDEO}));case d("MAWMsgType").MSG_TYPE.GIF:return d("WAResultOrError").makeResult(babelHelpers["extends"]({},b,{type:d("MAWMsgType").MSG_TYPE.GIF}));case d("MAWMsgType").MSG_TYPE.PTT:return d("WAResultOrError").makeResult(babelHelpers["extends"]({},b,{type:d("MAWMsgType").MSG_TYPE.PTT}));case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return d("WAResultOrError").makeResult(babelHelpers["extends"]({},b,{type:d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE}));default:p.MUSTFIX(l||(l=babelHelpers.taggedTemplateLiteralLoose(["Unsupported media message type: ",""])),a);return d("WAResultOrError").makeError("unsupported_media_type")}}function u(a,b,c,e,f,g){var h;if(((h=a.xmaData)==null?void 0:h.xmaTargetType)==null){p.MUSTFIX(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Mandatory XMA Data missing for XMA message: ",""])),g);return d("WAResultOrError").makeError("xma_mandatory_fields_missing")}h=a.xmaData.xmaTargetType;b=z(a,b,c,e,f,g);c=babelHelpers["extends"]({},b,{type:d("MAWMsgType").MSG_TYPE.XMA,xmaMessageType:d("MAWConvertXMATargetTypeToExtendedContentTargetType").convertXMATargetTypeToExtendedContentTargetType(h)});e=a.text;e!=null&&(c.msgContent={content:e});return d("WAResultOrError").makeResult(c)}function v(a,b,c,e,f,g){if(a.receiverFetchData==null){p.MUSTFIX(n||(n=babelHelpers.taggedTemplateLiteralLoose(["Mandatory receiver fetch data missing for receiver fetch message: ",""])),g);return d("WAResultOrError").makeError("receiver_fetch_mandatory_fields_missing")}b=z(a,b,c,e,f,g);return d("WAResultOrError").makeResult(babelHelpers["extends"]({},b,{receiverFetchId:a.receiverFetchId,type:d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH}))}function w(a){if(a==null)return void 0;else switch(a){case d("EchoMessage").MessageTextSize.SMALL:return 1;case d("EchoMessage").MessageTextSize.MEDIUM:return 2;case d("EchoMessage").MessageTextSize.LARGE:return 3;default:return void 0}}function x(a){if(a.text==null)return null;return a.editHistory.length===0?a.text:a.editHistory.sort(function(a,b){return a.timestamp-b.timestamp})[0].text}function y(a,b,c,e,f,g,h,i){var j=h==null?p:p.tags([h]);i=i==="first_edit_content"?x(a):a.text;if(i==null){d("MAWEBRestoreTrackingUtils").addQPLRestorePointWithAnnotationsWorker({annotations:{string:{empty_content_msg_type:f}},pointName:"unstored_text_message_empty",traceId:h});j.MUSTFIX(o||(o=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Message content is empty for the message: ",", type: ",""])),g,f);return d("WAResultOrError").makeError("text_message_content_empty")}j=z(a,b,c,e,f,g,h);if(f===d("MAWMsgType").MSG_TYPE.REVOKED){i!=null&&(j.msgContent={content:i});a.revokeSentTimestampMs!=null&&(j.originalTs=d("WATimeUtils").castToUnixTime(a.revokeSentTimestampMs));return d("WAResultOrError").makeResult(babelHelpers["extends"]({},j,{revokedExternalId:d("WAStanzaUtils").toStanzaId("0"),type:d("MAWMsgType").MSG_TYPE.REVOKED,unsendMsgContentDeleteTs:a.revokeUnsentTimestampMS!=null?d("WATimeUtils").castToUnixTime(a.revokeUnsentTimestampMS):j.ts}))}if(f===d("MAWMsgType").MSG_TYPE.CIPHERTEXT)return d("WAResultOrError").makeResult(babelHelpers["extends"]({},j,{msgContent:{content:i},specialTextSize:w(a.textSize),type:d("MAWMsgType").MSG_TYPE.CIPHERTEXT}));b=babelHelpers["extends"]({},j,{msgContent:{content:i},specialTextSize:w(a.textSize),type:d("MAWMsgType").MSG_TYPE.TEXT});return d("WAResultOrError").makeResult(babelHelpers["extends"]({},b,{editCount:Math.max(a.editHistory.length-1,0),groupId:a.groupId,groupIndex:a.groupIndex,groupSize:a.groupSize}))}function z(a,b,c,e,f,g,h){h=A(e,c);e={ack:h===d("WAJids").AUTHOR_ME?d("MAWAckLevel").ACK.sent:d("MAWAckLevel").ACK.received,altIndex:void 0,author:h,externalId:g,groupId:a.groupId,groupIndex:a.groupIndex,groupSize:a.groupSize,isForwarded:a.isForwarded,sortOrderMs:a.sortOrderMs,threadJid:b,ts:d("WATimeUtils").castToUnixTime(a.displayTimestampMs/1e3),type:f};a.authoritativeTimestampMs!=null?e.serverTs=d("WATimeUtils").castToUnixTime(a.authoritativeTimestampMs/1e3):e.serverTs=d("WATimeUtils").castToUnixTime(a.sortOrderMs/1e3);if(a.quoteData!=null){h=d("MAWRepliesRestoreUtils").getQuoteDataFromEchoMessage(a,c);h!=null&&(e.quote=h,e.quoteExternalId=h.content.externalId)}return e}function A(a,b){a=d("MAWJids").toUserJid(a.localKey);return a===b?d("WAJids").AUTHOR_ME:a}function B(a,b,c,e,f,g){a=z(a,b,c,e,f,g);return babelHelpers["extends"]({},a,{type:d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE})}g.MAWRestoreType=c;g.getDbMsgTypeFromEchoMessage=q;g.getUnstoredDbMessageFromEchoMessage=a;g.resolveAuthorFromEchoAddress=A}),98);
__d("MAWUnsafeCoerce",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}f.unsafeCoerce=a}),66);
__d("MAWBulkEditMsgsTxns",["FBLogger","MAWAckLevel","MAWBridgeMsg","MAWDbEditMsgHistoryTxns","MAWDexieTable","MAWIndexedDb","MAWJidUtils","MAWLoadReplyMediaTxns","MAWUnsafeCoerce","MAWUserJidWrapper","WAJids","WAMsgMap","WAMsgType"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var c=new Set(),e=[];b.forEach(function(a){var b=a.chatJid;a=a.msg;c.add(b);e.push(a.originalMsgExternalId)});return d("MAWDexieTable").dexieAll([a.messages.where("externalId").anyOf(e).toArray(),a.messages.where("quoteExternalId").anyOf(e).toArray(),a.editMsgHistory.where("originalMsgExternalId").anyOf(e).toArray()]).then(function(a){var b=a[0],c=a[1];a=a[2];return{editMsgHistory:a,originalMsgs:b,quoteMessages:c}})}function b(a,b,e){var f=e.editMsgHistory,g=e.originalMsgs,h=e.quoteMessages,j=g.reduce(function(a,b){var c=d("MAWJidUtils").toProtocolMsgId(b);return c==null?a:a.set(c,b)},new(d("WAMsgMap").MsgMap)());e=f.reduce(function(a,b){var c=d("MAWJidUtils").toProtocolMsgId(b);return c==null?a:a.set(c,b)},new(d("WAMsgMap").MsgMap)());g=i(b,{messageHistoriesToEdit:e,messagesToEdit:j});f=g[0];var k=g[1],l=g[2];return d("MAWDbEditMsgHistoryTxns").bulkAddEditMsgHistory(a,f).then(function(){var b=new(d("WAMsgMap").MsgMap)();k.entries().forEach(function(a){var e=a[0];a=a[1];var f=j.get(e);if(f==null){c("FBLogger")("messenger_web").warn("Cannot find the original msg for the edit action.");return}if(f.type!==d("WAMsgType").MSG_TYPE.TEXT&&f.type!==d("WAMsgType").MSG_TYPE.CIPHERTEXT)throw c("FBLogger")("messenger_web").mustfixThrow("Only text or cipher text can be edited. Original msg type: %s",f.type);f=babelHelpers["extends"]({},f,{editCount:((f=f.editCount)!=null?f:0)+((f=l.get(e))!=null?f:0),msgContent:a.editMsgContent,type:d("WAMsgType").MSG_TYPE.TEXT});b.set(e,f)});var e=h.map(function(a){var e=a.quote,f=a.quoteExternalId,g=a.threadJid;if(e==null){c("FBLogger")("messenger_web").warn("[edit message] Failed to get the quoted content for a msg that has been quoted.",a.externalId);return}var h=e.content.author;h=d("MAWJidUtils").maybeToProtocolMsgId(h==="@me"?d("MAWUserJidWrapper").getMyUserJid():h,g,f);if(h==null)return;g=b.get(h);if(g==null)return;return babelHelpers["extends"]({},a,{quote:babelHelpers["extends"]({},e,{content:babelHelpers["extends"]({},e.content,{msgContent:babelHelpers["extends"]({},g.msgContent)})})})}).filter(Boolean);return a.messages.bulkPut(b.values().concat(e)).then(function(){b.values().forEach(function(b){return d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,b).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(b,a)})})})}).then(function(){e.forEach(function(a){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(a)})})})})}function h(a,b){var e;switch(a.type){case d("WAMsgType").MSG_TYPE.TEXT:case d("WAMsgType").MSG_TYPE.EDIT_ACTION:return{author:a.author,editExternalId:a.externalId,editTs:(e=a.serverTs)!=null?e:a.ts,msgContent:(e=a.editMsgContent)!=null?e:d("MAWUnsafeCoerce").unsafeCoerce(a.msgContent),originalMsgExternalId:(e=a.originalMsgExternalId)!=null?e:a.externalId,sendStatus:d("MAWAckLevel").ACK.sent,specialTextSize:a.specialTextSize,threadJid:b};case d("WAMsgType").MSG_TYPE.CIPHERTEXT:return{author:a.author,editExternalId:a.externalId,editTs:(e=a.serverTs)!=null?e:a.ts,msgContent:{content:""},originalMsgExternalId:a.externalId,sendStatus:d("MAWAckLevel").ACK.sent,specialTextSize:a.specialTextSize,threadJid:b};default:a.type;throw c("FBLogger")("messenger_web").mustfixThrow("MAWBulkEditMsgsTxns::getMessageHistory: Unexpected msg type")}}function i(a,b){var e=b.messageHistoriesToEdit,f=b.messagesToEdit,g=[],i=new(d("WAMsgMap").MsgMap)(),j=new(d("WAMsgMap").MsgMap)();a.forEach(function(a){var b=a.chatJid;a=a.msg;var k=d("MAWJidUtils").maybeToProtocolMsgId(a.author,b,a.originalMsgExternalId);if(k==null)throw c("FBLogger")("messenger_web").mustfixThrow("[protocolMsgId] Cannot get the protocol id for the edit action. isAuthorSystem = %s; chatJid = %s; externalId = %s",d("WAJids").isAuthorSystem(a.author),!!b,!!a.originalMsgExternalId);var l=d("MAWJidUtils").maybeToProtocolMsgId(a.author,b,a.externalId);if(l==null)throw c("FBLogger")("messenger_web").mustfixThrow("[editMsgProtocolMsgId] Cannot get the protocol id for the edit action. isAuthorSystem = %s; chatJid = %s; externalId = %s",d("WAJids").isAuthorSystem(a.author),!!b,!!a.externalId);if(e.get(l)==null){g.push(h(a,b));l=(l=j.get(k))!=null?l:0;var m=f.get(k);j.set(k,l+1);if(e.get(k)==null&&l===0&&m!=null){if(m.type!==d("WAMsgType").MSG_TYPE.TEXT&&m.type!==d("WAMsgType").MSG_TYPE.CIPHERTEXT)throw c("FBLogger")("messenger_web").mustfixThrow("Only text or cipher text can be edited. Original msg type: %s",m.type);g.push(h(m,b))}}l=i.get(k);m=l==null?void 0:l.serverTs;b=a==null?void 0:a.serverTs;(m==null||b==null||m<b)&&i.set(k,a)});return[g,i,j]}g.prepareDataForMessageEdit=a;g.bulkEditMsgs=b;g.getMessageHistory=h}),98);
__d("MAWConvertXMAGatingTypeToExtendedContentOverlayIconGlyph",["EchoMessageXMAFieldUtils","WAArmadilloXMA.pb","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){switch(a){case d("EchoMessageXMAFieldUtils").XMAGatingType.INFO:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.INFO;case d("EchoMessageXMAFieldUtils").XMAGatingType.EYE_OFF:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.EYE_OFF;case d("EchoMessageXMAFieldUtils").XMAGatingType.NEWS_OFF:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.NEWS_OFF;case d("EchoMessageXMAFieldUtils").XMAGatingType.WARNING:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.WARNING;case d("EchoMessageXMAFieldUtils").XMAGatingType.PRIVATE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.PRIVATE;case d("EchoMessageXMAFieldUtils").XMAGatingType.NONE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.NONE;default:d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Not a valid xmaGatingType: ",""])),a);return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.NONE}}g.convertXMAGatingTypeToExtendedContentOverlayIconGlyph=a}),98);
__d("MAWConvertXMALayoutTypeToExtendedContentXMLLayoutType",["EchoMessageXMAFieldUtils","WAArmadilloXMA.pb","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){switch(a){case d("EchoMessageXMAFieldUtils").XMALayoutType.SINGLE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_XMA_LAYOUT_TYPE.SINGLE;case d("EchoMessageXMAFieldUtils").XMALayoutType.PORTRAIT:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_XMA_LAYOUT_TYPE.PORTRAIT;case d("EchoMessageXMAFieldUtils").XMALayoutType.HSCROLL:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_XMA_LAYOUT_TYPE.HSCROLL;case d("EchoMessageXMAFieldUtils").XMALayoutType.STANDARD_DXMA:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_XMA_LAYOUT_TYPE.STANDARD_DXMA;case d("EchoMessageXMAFieldUtils").XMALayoutType.LIST_DXMA:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_XMA_LAYOUT_TYPE.LIST_DXMA;case d("EchoMessageXMAFieldUtils").XMALayoutType.GRID:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_XMA_LAYOUT_TYPE.GRID;default:d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Not a valid xmaLayoutType: ",""])),a);return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_XMA_LAYOUT_TYPE.SINGLE}}g.convertXMALayoutTypeToExtendedContentXMLLayoutType=a}),98);
__d("MAWEchoToProtobufConversionLoggingUtils",["QPLUserFlow","qpl"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){c("QPLUserFlow").start(c("qpl")._(521484676,"2684"),{annotations:b,instanceKey:a})}function b(a,b,d){c("QPLUserFlow").endFailure(c("qpl")._(521484676,"2684"),b,{annotations:d,instanceKey:a})}function d(a,b){c("QPLUserFlow").endSuccess(c("qpl")._(521484676,"2684"),{annotations:b,instanceKey:a})}function e(a,b,d){d&&c("QPLUserFlow").addAnnotations(c("qpl")._(521484676,"2684"),d,{instanceKey:a}),c("QPLUserFlow").addPoint(c("qpl")._(521484676,"2684"),b,{instanceKey:a})}g.startQplUserFlow=a;g.endFailure=b;g.endSuccess=d;g.addPoint=e}),98);
__d("MessageBackupSupplementalKeyGenerator",["$InternalEnum","MAWJids","WAGlobals","WAJids","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h=b("$InternalEnum")({REACTION:"reaction",EDIT:"edit",RAVEN_ACTION_MESSAGE:"raven_action_message"}),i=":";function a(a,b){return""+a+i+b}function c(a){return a.split(i)[1]}function j(a,b){b=b.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");b=new RegExp("^"+b,"i");return b.test(a)}function e(a){return j(a,h.REACTION)}function f(a){return j(a,h.EDIT)}function k(a){return j(a,h.RAVEN_ACTION_MESSAGE)}function l(a){var b=a.split(i);if(b.length===1)return{rawIdentifierString:a,type:"poll_update"};var c=b[0];if(b.length<2||b.length>3)return{prefix:c,rawIdentifierString:a,type:"unknown"};var e=b[1];e=d("MAWJids").toUserJid(e);if(c===h.REACTION)return{senderJid:e,type:"reaction"};b=b.length===3?d("WATimeUtils").castToMillisTime(Number(b[2])):null;if(c===h.RAVEN_ACTION_MESSAGE)return{senderJid:e,type:"raven_action_message"};if(b==null)return{prefix:c,rawIdentifierString:a,type:"unknown"};return c===h.EDIT?{senderJid:e,ts:b,type:"edit"}:{prefix:c,rawIdentifierString:a,type:"unknown"}}function m(a){switch(a.type){case"edit":return""+h.EDIT+i+d("WAJids").extractUserId(a.senderJid)+i+a.ts.toString();case"reaction":return""+h.REACTION+i+d("WAJids").extractUserId(a.senderJid);case"raven_action_message":return""+h.RAVEN_ACTION_MESSAGE+i+d("WAJids").extractUserId(a.senderJid);case"poll_update":return a.rawIdentifierString}}function n(a){var b;if(d("WAJids").isAuthorMe(a))b=d("WAGlobals").getMyUserJid();else{a=d("WAJids").interpretAndValidateJid(a);if(a.jidType==="msgrUser")b=a.userJid;else return null}a=d("WAJids").userIdFromJid(b);return""+h.REACTION+i+a}function o(a,b){var c;if(d("WAJids").isAuthorMe(a))c=d("WAGlobals").getMyUserJid();else{a=d("WAJids").interpretAndValidateJid(a);if(a.jidType==="msgrUser")c=a.userJid;else return null}a=d("WAJids").userIdFromJid(c);return""+h.EDIT+i+a+i+b.toString()}g.SupplementalKeyPrefix=h;g.SUPPLEMENTAL_KEY_DELIMITER=i;g.createMessageSupplementalKey_DEPRECATED=a;g.getSupplementalSenderId_DEPRECATED=c;g.isSupplementalProtobufAReaction=e;g.isSupplementalProtobufAnEdit=f;g.isSupplementalProtobufARavenAction=k;g.parseIdentifierString=l;g.toIdentifierString=m;g.createReactionSupplementalKey=n;g.createEditSupplementalKey=o}),98);
__d("PersistedQueuesSchema",["MAWWormOdsLogger","WAHex","Worm","WormEAR","WormIDbDriver"],(function(a,b,c,d,e,f,g){"use strict";b={autoIncrement:!0,indexes:{"[jid+priority+stanzaId]":{fields:["jid","priority","stanzaId"],unique:!1},priority:{fields:["priority"],unique:!1}},nonEncryptedFields:["priority","stanzaId"],primaryKey:"stanzaQueueId",secure:!0};c={autoIncrement:!0,indexes:{},nonEncryptedFields:["uploadStatus","uploadTsSec","backupActionType"],primaryKey:"queueId",secure:!0};e={autoIncrement:!0,indexes:{},primaryKey:"queueId",secure:!0};f={autoIncrement:!0,indexes:{},primaryKey:"queueId",secure:!0};var h={danglingQueue:e,ebSenderUploadQueueV3:f,ebUploadQueue:c,stanzaQueue:b};function a(a,b,c,e,f,g){b=d("WAHex").parseHex(b);var i="pqdb";b=new(d("WormEAR").WormEAR)(h,i,b);return new(d("Worm").WormDatabase)(new(d("WormIDbDriver").WormIDbDriver)(a,i,h,b,d("MAWWormOdsLogger").wormOdsWorkerLogger,{blockingErrorThreshold:c,onBlockingError:e,onTransactionError:f}),g)}g.makePersistedQueueSchema=a}),98);
__d("PersistedQueueDB",["FBLogger","PersistedQueuesSchema","WAResolvable","WormEAR","err","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i=new(d("WAResolvable").Resolvable)();async function a(a){var b=a.blockingErrorThreshold,e=a.dbName,f=a.onBlockingError,g=a.qplEvent;a=a.strEncKey;try{e=d("PersistedQueuesSchema").makePersistedQueueSchema(e,a,b,f,function(a){if(a instanceof d("WormEAR").DecryptionError){var b=a;c("FBLogger")("messenger_web").mustfix("EAR decryption error in store: %s. Dropping corrupted entity",b.store);c("promiseDone")((a=(a=h)==null?void 0:a.runInTransaction([b.store],"readwrite",function(a){a=a.stores[b.store];return b.maybeHashedPk!=null?a.delete(b.maybeHashedPk):a.clear()},"delete-corrupted-entity"))!=null?a:Promise.resolve())}},g);h=e;await e.init();i.resolve(e);return e}catch(a){c("FBLogger")("messenger_web").catching(a).mustfix("Error performing PersistedQueue init: %s",a);throw a}}function b(){if(h==null)throw c("err")("PersistedQueue is not initialized");return h}function e(){return i.promise}g.makePersistedQueues=a;g.getPersistedQueues=b;g.getDbPromise=e}),98);
__d("WAThrottle",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){var c=0,d=null,e;function f(){var f=Date.now(),g=f-c;for(var h=arguments.length,i=new Array(h),j=0;j<h;j++)i[j]=arguments[j];e=i;g>=b?(clearTimeout(d),d=null,a.apply(void 0,i),c=Date.now()):d==null&&(d=setTimeout(function(){return a.apply(void 0,e)},b-g))}return f}f.throttle=a}),66);
__d("PersistedQueueApi",["PersistedQueueDB","WALogger","WAThrottle"],(function(a,b,c,d,e,f,g){"use strict";var h;b=1e3*60*60;var i=function(a,b){return"PersistedQueue:"+a+":"+b};function a(){return{ack:k,clear:l,delete:m,index:j,keys:o,read:n,write:p}}function j(a,b){return{equals:function(c){return{read:function(e){return d("PersistedQueueDB").getPersistedQueues().runInTransaction([a],"readonly",function(d){return d.stores[a].readIndexRange(b,{only:c},e)},i(a,"index-equal"))}}},keys:function(){return d("PersistedQueueDB").getPersistedQueues().runInTransaction([a],"readonly",function(c){return c.stores[a].readIndexKeys(b)},"index-keys")},read:async function(c){var e=await d("PersistedQueueDB").getPersistedQueues().runInTransaction([a],"readonly",function(d){return d.stores[a].readIndex(b,void 0,c)},i(a,"index-read"));return e}}}function k(a,b){return m(a,b)}function l(a){return d("PersistedQueueDB").getPersistedQueues().runInTransaction([a],"readwrite",function(b){return b.stores[a].clear()},i(a,"clear"))}function m(a,b){return d("PersistedQueueDB").getPersistedQueues().runInTransaction([a],"readwrite",async function(c){c=c.stores[a];await c.bulkDelete(b);r(a)},i(a,"delete"))}function n(a,b){return d("PersistedQueueDB").getPersistedQueues().runInTransaction([a],"readonly",function(c){return c.stores[a].readAll(b)},i(a,"read"))}function o(a){return d("PersistedQueueDB").getPersistedQueues().runInTransaction([a],"readonly",function(b){return b.stores[a].readKeys()},i(a,"keys"))}function p(a,b){return d("PersistedQueueDB").getPersistedQueues().runInTransaction([a],"readwrite",function(c){return c.stores[a].bulkAdd(b)},i(a,"write"))}function q(a){return d("PersistedQueueDB").getPersistedQueues().runInTransaction([a],"readwrite",async function(b){b=b.stores[a];var c=await b.readAll({limit:1});c.length===0&&await b.clear()},i(a,"ClearIfEmpty"))}var r=d("WAThrottle").throttle(function(a){q(a).catch(function(b){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[PersistedQueueV2] Error during PQ clear operation of ",": ",""])),a,b)})},b);g.persistedQueueApi=a;g.persistedQueueIndex=j;g.persistedQueueAck=k;g.persistedQueueClear=l;g.persistedQueueDelete=m;g.persistedQueueRead=n;g.persistedQueueKeys=o;g.persistedQueueWrite=p;g.clearIfEmpty=q}),98);
__d("WAMapContentTypeToFbType",[],(function(a,b,c,d,e,f){"use strict";function a(a){switch(a){case"text":return"text";case"media":return"media";case"reaction":return"reaction";case"live_location":case"pay":case"product_list":case"poll_creation":case"poll_vote":case"scheduled_call":return"text";default:return"text"}}f.mapContentTypeToFbType=a}),66);
__d("WAPersistedQueueCache",["WAResolvable","WAShiftTimer","WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c){var e=d("WATagsLogger").TAGS(["PersistedQueue",a,"cache"]),f=[],g=new(d("WAResolvable").Resolvable)(),i=c!=null?c:{},j=new(d("WAShiftTimer").ShiftTimer)(function(){void m()});return{commit:function(){return m()},add:function(a){f.push(a);a=g;k();l();return a.promise},config:function(a){i=a}};function k(){i.cacheSize!=null&&f.length>=i.cacheSize&&void m()}function l(){if(i.maxDelay!=null){var a=i.maxDelay;j.cancel();j.onOrAfter(a)}}async function m(){if(f.length===0)return;j.cancel();var a=f;f=[];var c=g;g=new(d("WAResolvable").Resolvable)();try{await b(a),c.resolve()}catch(a){e.ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Error during flush: ",""])),a);c.reject(a);throw a}}}g.makePersistedQueueCache=a}),98);
__d("WAPersistedQueue",["WALogger","WAPersistedQueueCache","WAPubSub"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=function(){function a(a,b,c){var e=this;this.$1=d("WAPubSub").simplePubSub();this.$3=a;this.$4=b;this.$2=d("WAPersistedQueueCache").makePersistedQueueCache(a,function(c){return b.write(a,c).then(function(){d("WALogger").DEV(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[PersistedQueue] flush: ","}"])),c.length),e.$1.publish({type:"flush"})})},c)}var b=a.prototype;b.subscribe=function(a){return this.$1.subscribe(a)};b.index=function(a){return this.$4.index(this.$3,a)};b.keys=function(){return this.$4.keys(this.$3)};b.read=function(a){return this.$4.read(this.$3,a)};b.addAndCommit=function(a){var b=this;d("WALogger").DEV(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[PersistedQueue] new entry & commit"])));this.$1.publish({type:"new_entity"});return this.$4.write(this.$3,a).then(function(){d("WALogger").DEV(j||(j=babelHelpers.taggedTemplateLiteralLoose(["[PersistedQueue] flush: ","}"])),a.length),b.$1.publish({type:"flush"})})};b.commit=function(){return this.$2.commit()};b.ack=function(a){return this.$4.ack(this.$3,a)};b["delete"]=function(a){return this.$4["delete"](this.$3,a)};b.clear=function(){return this.$4.clear(this.$3)};return a}();function a(a,b,c){return new k(a,b,c)}g.PersistedQueue=k;g.initPersistedQueue=a}),98);
__d("WAProtocolQueue",["PersistedQueueApi","WAGlobals","WAJids","WALogger","WAMapContentTypeToFbType","WAPersistedQueue"],(function(a,b,c,d,e,f,g){"use strict";var h,i=5e3,j=null;function k(a){if(j!=null){d("WALogger").WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Protocol Queue is already initialized"])));return j}a=d("WAPersistedQueue").initPersistedQueue("stanzaQueue",a,{cacheSize:null,maxDelay:i});j=a;return j}function l(){return!j?k(d("PersistedQueueApi").persistedQueueApi()):j}f=function(){function a(){this.$1=[],this.$2=[],this.$3=[]}var b=a.prototype;b.enqueue=function(a,b,c){this.$1.push(a),b&&this.$2.push(b),c&&this.$3.push(c)};b.flush=function(a,b,c,d,e){a=this.$1;var f=this.$2,g=this.$3;this.$1=[];this.$2=[];this.$3=[];return l().addAndCommit(a).then(function(){return f.forEach(function(a){return a()})})["catch"](function(a){return g.forEach(function(b){return b(a)})})};return a}();var m=new f();function a(a){return a.map(function(a){return a.type==="message"?n(a):babelHelpers["extends"]({},a)})}function n(a){switch(a.subtype){case"unavailable":var b=a,c=d("WAJids").extractUserJid(b.from);c={id:{author:d("WAGlobals").getMyUserJid()===c?"@me":c,chat:b.jid,externalId:b.stanzaId},ts:b.serverTs,type:"UnavailableMsg"};return{incomingType:"wa",jid:b.jid,message:{decrypted:c,details:{count:null,externalId:b.stanzaId,from:d("WAJids").switchOnMsgrChatJidType(b.jid,{group:function(a){return{author:b.from,chat:a,groupJid:a,type:"group"}},user:function(a){return{author:b.from,chat:a,deviceJid:b.from,type:"device"}}}),hideDecryptionFailure:!1,isInstamadillo:!1,offline:b.offline,recipient:b.recipient,reportingMeta:b.reportingMeta,retryCount:b.retryCount,ts:b.serverTs,type:d("WAMapContentTypeToFbType").mapContentTypeToFbType(b.contentType)}},priority:b.priority,stanzaId:b.stanzaId,stanzaQueueId:a.stanzaQueueId,type:b.type};case"armadillo":var e=a;c=d("WAJids").extractUserJid(e.from);c={folder:e.fbFolderId,id:{author:d("WAGlobals").getMyUserJid()===c?"@me":c,chat:e.jid,externalId:e.stanzaId},msg:e.message,recipientsCount:null,reportingMeta:e.reportingMeta,ts:e.serverTs,type:"IncomingMsg"};return{incomingType:a.incomingType,jid:e.jid,message:{decrypted:c,details:{count:null,externalId:e.stanzaId,from:d("WAJids").switchOnMsgrChatJidType(e.jid,{group:function(a){return{author:e.from,chat:a,groupJid:a,type:"group"}},user:function(a){return{author:e.from,chat:a,deviceJid:e.from,type:"device"}}}),hideDecryptionFailure:!1,isInstamadillo:!1,offline:e.offline,recipient:e.recipient,reportingMeta:e.reportingMeta,retryCount:e.retryCount,ts:e.serverTs,type:d("WAMapContentTypeToFbType").mapContentTypeToFbType(e.contentType)}},priority:e.priority,stanzaId:e.stanzaId,stanzaQueueId:a.stanzaQueueId,type:e.type,ebTimestampMs:e.ebTimestampMs};case"instamadillo":var f=a;c=d("WAJids").extractUserJid(f.from);c={folder:f.fbFolderId,id:{author:d("WAGlobals").getMyUserJid()===c?"@me":c,chat:f.jid,externalId:f.stanzaId},msg:f.message,recipientsCount:null,reportingMeta:f.reportingMeta,ts:f.serverTs,type:"InstamadilloMsg"};return{incomingType:"wa",jid:f.jid,message:{decrypted:c,details:{count:null,externalId:f.stanzaId,from:d("WAJids").switchOnMsgrChatJidType(f.jid,{group:function(a){return{author:f.from,chat:a,groupJid:a,type:"group"}},user:function(a){return{author:f.from,chat:a,deviceJid:f.from,type:"device"}}}),hideDecryptionFailure:!1,isInstamadillo:!0,offline:f.offline,recipient:f.recipient,reportingMeta:f.reportingMeta,retryCount:f.retryCount,ts:f.serverTs,type:d("WAMapContentTypeToFbType").mapContentTypeToFbType(f.contentType)}},priority:f.priority,stanzaId:f.stanzaId,stanzaQueueId:a.stanzaQueueId,type:f.type};case"ciphertext":c=function(){if(g.contentType==="reaction")return!1;return g.hideDecryptionFailure===!0?!1:!0};var g=a,h=d("WAJids").extractUserJid(g.from);c={createPlaceholder:c(),id:{author:d("WAGlobals").getMyUserJid()===h?"@me":h,chat:g.jid,externalId:g.stanzaId},ts:g.serverTs,type:"IncomingCiphertextMsg"};return{incomingType:"wa",jid:g.jid,message:{decrypted:c,details:{count:null,type:d("WAMapContentTypeToFbType").mapContentTypeToFbType(g.contentType),externalId:g.stanzaId,from:d("WAJids").switchOnMsgrChatJidType(g.jid,{group:function(a){return{author:g.from,chat:a,groupJid:a,type:"group"}},user:function(a){return{author:g.from,chat:a,deviceJid:g.from,type:"device"}}}),hideDecryptionFailure:!1,isInstamadillo:!1,offline:g.offline,recipient:g.recipient,reportingMeta:g.reportingMeta,retryCount:g.retryCount,ts:g.serverTs}},priority:g.priority,stanzaId:g.stanzaId,stanzaQueueId:a.stanzaQueueId,type:g.type};default:a;return babelHelpers["extends"]({},a)}}var o=9,p=7,q=5,r=2;function b(a){return a}function c(a){return a}function e(a){return a}g.initProtocolQueue=k;g.protocolQueue=l;g.PQFlushable=f;g.pqFlushable=m;g.mapProtocolEntriesV2toV1=a;g.mapProcolQueueMessageV2toV1=n;g.WAProtocolQueuePriorityHigh=o;g.WAProtocolQueuePriorityMid=p;g.WAProtocolQueuePriorityLow=q;g.WAProtocolQueuePriorityBackground=r;g.appdataApplicationProtocol=b;g.extractSubProtocolFromAppdataProtocol=c;g.numberToStanzaQueueId=e}),98);
__d("MAWHandleEBRestoreWithHIM",["EBAPIWorkerCheck","EchoMessage","EncryptedBackupsUploadEntity","FBLogger","MAWAckLevel","MAWAsMessageApplication","MAWBulkEditMsgsTxns","MAWConvertXMAGatingTypeToExtendedContentOverlayIconGlyph","MAWConvertXMALayoutTypeToExtendedContentXMLLayoutType","MAWConvertXMATargetTypeToExtendedContentTargetType","MAWDbMsg","MAWEchoToProtobufConversionLoggingUtils","MAWFrontendMediaUtils","MAWHandleEchoMediaMsgsRestoreV2","MAWHandleEchoMsgsRestoreApiUtils","MAWHandleEchoReactionsRestore","MAWHandleEchoXMARestoreV2","MAWJids","MAWMsgType","MAWODSProxy","MAWParseXMAProtocol","MAWUnsafeCoerce","MAWUserJidWrapper","MessageBackupSupplementalKeyGenerator","Random","WAGlobals","WAHashUtils","WAJids","WALogger","WALongInt","WAOdsEnums","WAProtocolQueue","WAResultOrError","WASortedLists","WAStanzaUtils","WATimeUtils","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h=["originalTs","threadJid","unsendMsgContentDeleteTs"],i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z;function A(a,b){if(a==="@me"||a==="@system")return b;else return a}function B(a,b,c,e,f){var g=[];if(a.reactionXOfflineThreadingIds!=null)for(var h=0;h<a.reactionXOfflineThreadingIds.length;++h){var i=d("MAWHandleEchoReactionsRestore").getReactionsForReactionStore(b,c,e,null,f,a);i=i.map(function(a){return{decodedMsg:{unstoredDbMedia:void 0,unstoredDbMsg:void 0,unstoredDbReaction:a,unstoredDbReceiverFetchInfo:void 0},stanza:E(a.externalId,a.ts,A(a.author,c),b,"reaction")}});g.push.apply(g,i)}return g}function C(a,b,c,e,f){return e.map(function(e){if(e.messageId==null){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] messageId is null in edit, original externalId: ",""])),a);f!=null&&d("MAWEchoToProtobufConversionLoggingUtils").addPoint(f,"getUnstoredDbEditsFromEcho_messageId_missing");return null}var g=e.messageId;return{decodedMsg:{unstoredDbEditActionMsg:{ack:d("MAWAckLevel").ACK.sent,author:c,editMsgContent:{content:e.text},externalId:d("WAStanzaUtils").toStanzaId(g),originalMsgExternalId:a,serverTs:d("WATimeUtils").castToUnixTime(e.timestamp),ts:d("WATimeUtils").castToUnixTime(e.timestamp),type:d("MAWMsgType").MSG_TYPE.EDIT_ACTION},unstoredDbMedia:void 0,unstoredDbMsg:void 0,unstoredDbReaction:void 0},stanza:E(d("WAStanzaUtils").toStanzaId(g),d("WATimeUtils").castToUnixTime(e.timestamp),c,b,"text")}}).filter(Boolean)}function a(a,b){return a.map(J).filter(Boolean).map(function(a){return D(a,b)})}function D(a,b){var e,f=d("MAWUserJidWrapper").getMyUserJid(),g=a.from,h=d("MAWHandleEchoMsgsRestoreApiUtils").getDbMsgTypeFromEchoMessage(a);if(g==null||h==null)return[];h=a.xOfflineThreadingId;if(h==null){c("FBLogger")("labyrinth_web").warn("xOfflineThreadingId is null for Echo message");return[]}h=d("WAStanzaUtils").toStanzaId(h);e=d("WATimeUtils").castToUnixTime(((e=a.authoritativeTimestampMs)!=null?e:a.sortOrderMs)/1e3);g=d("MAWJids").toUserJid(g.localKey);var i=I(a,b,f,h,"echo_content");if(i.success===!1)return[];i=i.value;f=B(a,b,f,h,g);var j=a.contentType===d("EchoMessage").EchoMessageContentType.TEXT||a.contentType===d("EchoMessage").EchoMessageContentType.PLACEHOLDER?"text":"media";a=C(h,b,g,a.editHistory);return[{decodedMsg:i,stanza:E(h,e,g,b,j)}].concat(f,a)}function E(a,b,c,e,f){var g={applicationPayload:new Uint8Array(0).buffer,backupDirective:null,icdc:null,metadata:null,protobuf:new Uint8Array(0),subprotocol:new Uint8Array(0),subprotocolType:"consumerMessage",type:"subprotocol",version:"v3"};g={folder:null,id:{author:c,chat:e,externalId:a},msg:g,recipientsCount:null,reportingMeta:null,ts:b,type:"IncomingMsg"};return{incomingType:"ebrestore",jid:e,message:{decrypted:g,details:{count:0,externalId:a,from:d("WAJids").switchOnMsgrChatJidType(e,{group:function(a){return{author:d("WAJids").defaultDeviceJidForUser(c),chat:a,groupJid:a,type:"group"}},user:function(a){return{author:d("WAJids").defaultDeviceJidForUser(c),chat:a,deviceJid:d("WAJids").defaultDeviceJidForUser(c),type:"device"}}}),hideDecryptionFailure:!0,isInstamadillo:!1,offline:null,recipient:null,reportingMeta:null,retryCount:0,ts:b,type:f}},priority:d("WAProtocolQueue").WAProtocolQueuePriorityLow,stanzaId:a,stanzaQueueId:d("MAWUnsafeCoerce").unsafeCoerce(-1),type:"message"}}function F(a){if(a.mediaData==null)return d("WAResultOrError").makeResult(null);var b=a.previewMediaData,c=a.sortOrderMs,e=a.xOfflineThreadingId,f=a.mediaData,g=f.attachmentObjectId,h=f.backupEntFbid,i=f.directPath,l=f.encryptedHash,m=f.filename,n=f.height,o=f.mediaContentType,p=f.mediaKey,q=f.mediaKeyTimestamp,r=f.mediaPlayableDuration,s=f.plaintextHash,t=f.previewContentHeight,u=f.previewContentWidth,v=f.size;f=f.width;var w=a.contentType===d("EchoMessage").EchoMessageContentType.XMA;o=d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(o||"",w);w=o.mediaType;o=o.serverMediaType;var x=d("WAHashUtils").stringToPlaintextHash(d("MAWHandleEchoMediaMsgsRestoreV2").getBase64WithoutPadding(s)),y=null;if(b!=null)try{y=d("MAWHandleEchoMediaMsgsRestoreV2").constructRawDownloadableThumbnail(b),y!=null&&y.objectId==null&&d("WALogger").ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] downloadableThumbnail was created without metadata, source: protobuf"])))}catch(b){d("WALogger").ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Unable to construct downloadableThumbnail from previewMediaData: ",", msg id: ",". Echo message origin ",""])),b,e,a.serializationOrigin)}if(p==null)return d("WAResultOrError").makeError("missing_media_key");if(l==null)return d("WAResultOrError").makeError("missing_encrypted_hash");b=d("MAWHandleEchoMediaMsgsRestoreV2").constructMediaEntry(x,l,p,i,q,o,m,h,g,y,v);e=d("MAWHandleEchoMediaMsgsRestoreV2").getMediaInfo({filename:m,height:n,mediaPlayableDuration:r,mediaType:w,previewContentHeight:t,previewContentWidth:u,width:f});a=e.validatedAudioInfo;x=e.validatedDocumentFileInfo;l=e.validatedImageInfo;p=e.validatedVideoInfo;return d("WAResultOrError").makeResult({mediaEntry:b,mediaType:w,msgIds:d("WASortedLists").asSortedSet(new Set()),plaintextHash:d("WAHashUtils").stringToPlaintextHash(s),size:v||0,ts:q!=null?d("WATimeUtils").castToUnixTime(q):d("WATimeUtils").castMilliSecondsToUnixTime(c),validatedAudioInfo:a,validatedDocumentFileInfo:x,validatedImageInfo:l,validatedVideoInfo:p})}function G(a,b){if(a.xmaData==null||a.from==null||a.xOfflineThreadingId==null)return d("WAResultOrError").makeResult(null);var c=a.from,e=a.serializationOrigin,f=a.xmaData;a=a.xOfflineThreadingId;var g=f.xmaContentRef,h=f.xmaDataclass,i=f.xmaDefaultCTA,j=f.xmaGatingType,k=f.xmaHeaderSubtitle,n=f.xmaHeaderTitle,o=f.xmaIsTombstoned,p=f.xmaLayoutType,q=f.xmaMaxSubtitleNumLines,r=f.xmaMaxTitleNumLines,s=f.xmaSubtitleText,t=f.xmaTargetExpiry,u=f.xmaTargetId,v=f.xmaTargetType,w=f.xmaTargetUsername;f=f.xmaTitleText;if(v==null){d("WALogger").ERROR(l||(l=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Mandatory XMA Data missing for XMA message. Echo message origin ",""])),e);return d("WAResultOrError").makeError("xma_mandatory_fields_missing")}v=d("MAWConvertXMATargetTypeToExtendedContentTargetType").convertXMATargetTypeToExtendedContentTargetType(v);var x;i!=null&&(x=d("MAWHandleEchoXMARestoreV2").getDefaultCTA(i));if(x!=null&&!d("MAWParseXMAProtocol").isValidCTA(x,v,!0)){d("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] defautlCTA failed validation check. Echo message origin ",""])),e);return d("WAResultOrError").makeError("xma_cta_validation_failure")}var y;j!=null&&(y=d("MAWConvertXMAGatingTypeToExtendedContentOverlayIconGlyph").convertXMAGatingTypeToExtendedContentOverlayIconGlyph(j));var z;t!=null&&(z=d("WATimeUtils").castToUnixTime(t));var A;p!=null&&(A=d("MAWConvertXMALayoutTypeToExtendedContentXMLLayoutType").convertXMALayoutTypeToExtendedContentXMLLayoutType(p));return d("WAResultOrError").makeResult({unstoredDbXMA:{author:d("MAWJids").toUserJid(c.localKey),contentRef:g,ctas:[],defaultCTA:x,externalId:d("WAStanzaUtils").toStanzaId(a),headerTitle:n,isTombstoned:o,maxSubtitleNumOfLines:q,maxTitleNumOfLines:r,overlayDescription:k,overlayIconGlyph:y,overlayTitle:n,subtitleText:s,targetExpiringAtSec:z,targetId:u,targetType:v,targetUsername:w,threadJid:b,titleText:f,xmaDataclass:h,xmaLayoutType:A}})}function H(a){if(a.receiverFetchId==null||a.receiverFetchData==null)return d("WAResultOrError").makeResult(null);var b=a.receiverFetchData,c=a.receiverFetchId;if(b.type!=="sticker"){d("WALogger").ERROR(n||(n=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Unsupported receiver fetch message type: ",". Echo message origin ",""])),b.type,a.serializationOrigin);return d("WAResultOrError").makeError("unsupported_message_type")}return d("WAResultOrError").makeResult({mimetype:b.mimetype,previewHeight:b.previewHeight,previewWidth:b.previewWidth,receiverFetchId:c,type:b.type})}function I(a,b,c,e,f){c=d("MAWHandleEchoMsgsRestoreApiUtils").getUnstoredDbMessageFromEchoMessage(a,b,c,e,void 0,f);if(c.success===!1)return d("WAResultOrError").makeError(c.error);e=c.value;e.originalTs;e.threadJid;e.unsendMsgContentDeleteTs;f=babelHelpers.objectWithoutPropertiesLoose(e,h);f.sortOrderMs=a.sortOrderMs;c=F(a);if(c.success===!1)return c;e=G(a,b);if(e.success===!1)return d("WAResultOrError").makeError(e.error);b=e.value;e=H(a);if(e.success===!1)return d("WAResultOrError").makeError(e.error);a=e.value;return d("WAResultOrError").makeResult({unstoredDbMedia:c.value,unstoredDbMsg:f,unstoredDbReaction:void 0,unstoredDbReceiverFetchInfo:a!=null?a:void 0,unstoredXMA:b!=null?b:void 0})}function J(a){try{return d("EchoMessage").decodeEchoMessage(a)}catch(a){d("WALogger").ERROR(o||(o=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to decode echo message: ",""])),a);return null}}function b(a,b){if(!d("EBAPIWorkerCheck").runningInWorker)throw c("FBLogger")("messenger_web").mustfixThrow("convertEchoMessagesToEBProtobufs should be called from the worker thread");var e=a.map(function(a){return K(a,b)}).filter(Boolean);d("MAWODSProxy").odsBumpEntityKey({amount:e.length,entity:d("WAOdsEnums").Entity.EB_RESTORE,key:"echo2protobuf.success"});e.length!==a.length&&(d("WALogger").WARN(p||(p=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to convert all echo messages to protobuf. Chat: ",", echo messages count: ",", converted echo messages count: ",""])),b,a.length,e.length),d("MAWODSProxy").odsBumpEntityKey({amount:a.length-e.length,entity:d("WAOdsEnums").Entity.EB_RESTORE,key:"echo2protobuf.fail"}));return e}function K(a,b){var e=c("Random").uint32();d("MAWEchoToProtobufConversionLoggingUtils").startQplUserFlow(e);a=J(a);if(a==null){d("WALogger").ERROR(q||(q=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][echo2protobuf] Failed to decode echo message"])));d("MAWEchoToProtobufConversionLoggingUtils").endFailure(e,"echo_decode_failure");return null}var f=d("WAGlobals").getMyUserJid(),g=a.from,h=a.sortOrderMs,i=a.xOfflineThreadingId;h=d("WATimeUtils").castToMillisTime(h);if(i==null||g==null){d("WALogger").ERROR(r||(r=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][echo2protobuf] One of the mandatory fields is null for Echo message. Echo message origin ",""])),a.serializationOrigin);d("MAWEchoToProtobufConversionLoggingUtils").endFailure(e,"mandatory_fields_missing");return null}var j=d("MAWJids").toUserJid(g.localKey);g=d("WAStanzaUtils").toStanzaId(i);i=I(a,b,f,g,"first_edit_content");if(i.success===!1){d("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][echo2protobuf] Failed to extract UnstoredDbMsg from EchoMessage: ",""])),i.error);d("MAWEchoToProtobufConversionLoggingUtils").endFailure(e,"echo_message_parsing_failure_"+i.error);return null}if(i.value.unstoredDbMsg==null){d("WALogger").ERROR(t||(t=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][echo2protobuf] Failed to extract UnstoredDbMsg from EchoMessage: unstoredDbMsg missing in UnstoredDbContent"])));d("MAWEchoToProtobufConversionLoggingUtils").endFailure(e,"unstoredDbMsg_conversion_failure_unstoredDbMsg_missing");return null}i=i.value;var k=i.unstoredDbMedia,l=i.unstoredDbMsg,m=i.unstoredDbReceiverFetchInfo;i=i.unstoredXMA;var n={author:j,chat:b,externalId:g};l!=null&&(l.msgId=d("MAWDbMsg").stanzaIdToMsgId(g));(i==null?void 0:i.unstoredDbXMA)!=null&&(i.unstoredDbXMA.msgId=d("MAWDbMsg").stanzaIdToMsgId(g));k!=null&&(k.msgIds=d("WASortedLists").asSortedSet(new Set([d("MAWDbMsg").stanzaIdToMsgId(g)])));var o;(i==null?void 0:i.unstoredDbXMA)!=null&&(o={associatedMessage:null,defaultPreview:k!=null?k:null,favicon:null,header:k!=null?k:null,previews:k!=null?[k]:null,xma:i.unstoredDbXMA});var p={frankingKey:null,frankingTag:null,frankingVersion:null,reportingContent:null,reportingTag:null},A;try{A={decryptedProtobuf:d("EncryptedBackupsUploadEntity").getEbBackupMessageBytesBuffer(d("EncryptedBackupsUploadEntity").encodeBackupMessage({messageApplication:d("MAWAsMessageApplication").encodeMessageApplication(l,k,null,o,b,c("justknobx")._("3632")?m:null),msgId:n,reportingMeta:p,sortOrderMs:h})),protobufTimestampMS:h}}catch(a){d("MAWEchoToProtobufConversionLoggingUtils").endFailure(e,"top_level_protobuf_encoding_failure");d("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][echo2protobuf] Exception when trying to encode top-level protobuf: ",""])),a);return null}var D=new Map();i=C(g,b,j,a.editHistory).map(function(a){return(a=a.decodedMsg)==null?void 0:a.unstoredDbEditActionMsg}).filter(Boolean).filter(function(a){return a.externalId!==a.originalMsgExternalId}).map(function(a){return d("MAWBulkEditMsgsTxns").getMessageHistory(a,b)});i.length>0&&d("MAWEchoToProtobufConversionLoggingUtils").addPoint(e,"convert_edits");i.forEach(function(a){var c=a.author,f=a.editTs;c=d("MessageBackupSupplementalKeyGenerator").createEditSupplementalKey(c,d("WATimeUtils").castUnixTimeToMillisTime(f));if(c==null){d("MAWEchoToProtobufConversionLoggingUtils").addPoint(e,"edit_supplemental_key_generation_failure");d("WALogger").ERROR(v||(v=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][echo2protobuf] Failed to create edit supplemental key"])));return}if(a.editExternalId==null){d("MAWEchoToProtobufConversionLoggingUtils").addPoint(e,"edit_supplemental_key_generation_failure");d("WALogger").ERROR(w||(w=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][echo2protobuf] Failed to fetch edit external id"])));return}var g=a.editExternalId;try{D.set(c,{decryptedProtobuf:d("EncryptedBackupsUploadEntity").getEbBackupMessageBytesBuffer(d("EncryptedBackupsUploadEntity").encodeBackupMessage({messageApplication:d("MAWAsMessageApplication").encodeEditMessageApplication(a),msgId:{author:j,chat:b,externalId:g},reportingMeta:p,sortOrderMs:d("WATimeUtils").castUnixTimeToMillisTime(a.editTs)})),protobufTimestampMS:d("WATimeUtils").castUnixTimeToMillisTime(f)})}catch(a){d("MAWEchoToProtobufConversionLoggingUtils").addPoint(e,"edit_supplemental_protobuf_encoding_failure"),d("WALogger").ERROR(x||(x=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Exception when trying to encode edit supplemental protobuf: ",""])),a)}});l=B(a,b,f,g,j).map(function(a){return(a=a.decodedMsg)==null?void 0:a.unstoredDbReaction}).filter(Boolean);l.length>0&&d("MAWEchoToProtobufConversionLoggingUtils").addPoint(e,"convert_reactions");l.forEach(function(a){var c=a.author,f=a.senderTimestampMs,g=a.ts;f=f!=null?d("WATimeUtils").castToMillisTime(d("WALongInt").numberOrThrowIfTooLarge(f)):d("WATimeUtils").castUnixTimeToMillisTime(g);g=d("MessageBackupSupplementalKeyGenerator").createReactionSupplementalKey(c);if(g==null){d("MAWEchoToProtobufConversionLoggingUtils").addPoint(e,"reaction_supplemental_key_generation_failure");d("WALogger").ERROR(y||(y=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][echo2protobuf] Failed to create reaction supplemental key"])));return}try{D.set(g,{decryptedProtobuf:d("EncryptedBackupsUploadEntity").getEbBackupMessageBytesBuffer(d("EncryptedBackupsUploadEntity").encodeBackupMessage({messageApplication:d("MAWAsMessageApplication").encodeReactionMessageApplication(a),msgId:{author:j,chat:b,externalId:a.externalId},reportingMeta:p,sortOrderMs:f})),protobufTimestampMS:f})}catch(a){d("MAWEchoToProtobufConversionLoggingUtils").addPoint(e,"reaction_supplemental_protobuf_encoding_failure"),d("WALogger").ERROR(z||(z=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Exception when trying to encode reaction supplemental protobuf: ",""])),a)}});d("MAWEchoToProtobufConversionLoggingUtils").endSuccess(e);return{otid:g,supplementalProtobufs:D,toplevelProtobuf:A}}g.convertEchoMessages=a;g.convertEchoMessagesToEBProtobufs=b}),98);
__d("MAWCastToMsgrServerMediaType",["EncryptedBackupsUploadEntity","MAWDbMedia","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(a,b){b===void 0&&(b=!1);if(b&&a==="image")return"xma";switch(a){case"image":case"video":case"gif":case"sticker":return a;case"document":return"file";case"ptt":return"audio";case"xma-image":return"xma";case"preview":return"preview";default:d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["invalid mediaType: "," for castToMsgrServerMediaType method"])),a);return null}}function b(a,b){b===void 0&&(b=!1);if(b&&a===d("MAWDbMedia").MEDIA_TYPE.IMAGE)return"xma";switch(a){case"Image":return"image";case"Video":return"video";case"Gif":return"gif";case"Sticker":return"sticker";case"DocumentFile":return"file";case"Ptt":return"audio";default:d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["invalid client mediaType: "," for castClientMediaTypeToServerMediaType method"])),a);return null}}function c(a){switch(a){case d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.IMAGE:return"image";case d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.VIDEO:return"video";case d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.GIF:return"gif";case d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.STICKER:return"sticker";case d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.DOCUMENT:return"file";case d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.PTT:return"audio";case d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.XMA:return"xma";case d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.MESSENGER_PREVIEW:return"preview";default:d("WALogger").ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["invalid attachment mediaType: "," for castMediaAttachmentTypeToServerMediaType method"])),a);return null}}g.castToMsgrServerMediaType=a;g.castClientMediaTypeToServerMediaType=b;g.castMediaAttachmentTypeToServerMediaType=c}),98);
__d("WADbDeviceRegistration",["gkx"],(function(a,b,c,d,e,f,g){"use strict";a=25;b=6;d=b;e="https://reg-e2ee.facebook.com";f=c("gkx")("13108")?"https://reg-e2ee.messenger.com":e;c="https://v.whatsapp.net";var h="https://reg-e2ee.instagram.com",i="/v2/fb_icdc_fetch",j="/v2/fb_register_v2",k="Device has already been registered to WA servers",l="Device registration finished successfully",m="Device registration retries failed "+b+" times. No longer attempting registration.",n="Device registration response was null",o="Current user id is zero",p="CryptoAuthToken is empty",q="CryptoAuthToken is expired",r={failed:"failed",finished:"finished"};g.MAX_USERS_FOR_NOTIFY_DEVICE_CHANGE=a;g.MAX_DEVICE_REGISTRATION_RETRIES=b;g.MAX_ROTATE_CRYPTO_AUTH_TOKEN_RETRIES=d;g.REG_FB_DOMAIN=e;g.REG_MSGR_DOMAIN=f;g.REG_WA_DOMAIN=c;g.REG_IGD_DOMAIN=h;g.ICDC_ENDPOINT=i;g.REGISTRATION_ENDPOINT=j;g.DEVICE_ALREADY_REGISTERED=k;g.DEVICE_SUCCESSFULLY_REGISTERED=l;g.FAILED_REGISTRATION_RETRIES=m;g.NULL_RESPONSE_FROM_SERVER=n;g.DEVICE_REGISTER_ERROR_ZERO_AS_USER_ID=o;g.DEVICE_REGISTER_ERROR_EMPTY_CAT_TOKEN=p;g.DEVICE_REGISTER_ERROR_EXPIRED_CAT_TOKEN=q;g.RegistrationStatesEnum=r}),98);
__d("WorkerUtils",[],(function(a,b,c,d,e,f){"use strict";function b(){try{return"WorkerGlobalScope"in a&&a instanceof a.WorkerGlobalScope}catch(a){return!1}}function c(){try{return"SharedWorkerGlobalScope"in a&&a instanceof a.SharedWorkerGlobalScope}catch(a){return!1}}f.isWorkerContext=b;f.isSharedWorkerContext=c}),66);
__d("getOrchestratorVersion",["qex"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a;return(a=c("qex")._("263"))!=null?a:"default"}g["default"]=a}),98);
__d("MAWMainWebWorkerConfig",["MAWGK","MAWParseXMAFBConfig","WADbDeviceRegistration","WorkerUtils","getOrchestratorVersion","gkx","justknobx","qex"],(function(a,b,c,d,e,f,g){"use strict";var h,i=1;a={S508658PreventOldSessionLookupAndPromote:function(){return c("gkx")("12674")},armadilloWebProcessFutureproof:function(){return c("MAWGK").armadillo_web_process_futureproof},batchSize:function(){return c("justknobx")._("1866")},getDevicesV2:function(){return c("gkx")("4551")},getSignalFutureMessagesMax:function(){return c("justknobx")._("847")},icdcAlertTriggerFailureCounter:function(){return c("justknobx")._("1970")},icdcCooldownIntervalInMinutes:function(){return c("justknobx")._("1971")},icdcIntervalInMinutes:function(){return c("justknobx")._("1972")},isDocumentReceiveEnabled:function(){return!c("gkx")("23924")},isEphemeralMessagesEnabled:function(){return!0},isFrankingDropOnInvalid:function(){return c("gkx")("23973")},isFrankingDropOnMissing:function(){return c("gkx")("23974")},isFrankingEnabled:function(){return c("justknobx")._("1347")},isGifEnabled:function(){return!0},isICDCErrorEnabled:function(){return c("gkx")("23975")},isMediaFallbackToAlternativeHmacSaltsEnabled:function(){return c("gkx")("23976")},isMetaAiInvocationMessageRenderEnabled:function(){return c("gkx")("12661")},isOctetStreamAttachmentMimeTypeEnabled:function(){return c("gkx")("4644")},isPollsEnabled:function(){return c("qex")._("3169")===!0},isProgressiveJpegSendEnabled:function(){return c("justknobx")._("2412")},isSenderKeyPredistributionEnabled:function(){return c("gkx")("23981")},isSharedWorkerContext:function(){return(h||(h=d("WorkerUtils"))).isSharedWorkerContext()},isStickerEnabled:function(){return!0},isStickerReceiverFetchEnabled:function(){return c("justknobx")._("3677")},isStoryMentionXMAEnabled:function(){return!0},jpegThumbnailTargetByteSizeKB:function(){return c("justknobx")._("2338")},maxPrekeysToUpload:function(){return 200},maxUsersForNotifyDeviceChange:function(){return d("WADbDeviceRegistration").MAX_USERS_FOR_NOTIFY_DEVICE_CHANGE},offlineQueueStuckTimeoutMs:function(){return c("justknobx")._("3264")},oneQueueTimeoutMs:function(){return c("justknobx")._("2583")},orchestratorVersion:function(){return c("getOrchestratorVersion")()},pjpegPreviewAvoidLastScan:function(){return c("justknobx")._("67")},sendMsgWithoutJob:function(){return!0},sessionDropIfTooOld:function(){return c("justknobx")._("2240")},shouldDeviceStateTimesout:function(){return!0},skipDownloadablePreviewForProgressiveJpeg:function(){return!0},skipProcessingGroupInvite:function(){return c("justknobx")._("3899")},useLongSessionDrop:function(){return c("gkx")("1244")},waDanglingQueue:function(){return c("justknobx")._("1921")}};b={productTypeForEBAttachments:"msgr",shouldFallbackToPreviewForFailedProgressiveJpeg:function(){return c("gkx")("2909")},supportedTypesVersion:function(){return c("MAWGK").armadillo_web_process_futureproof?i+1:i},supportedXMATargetTypes:function(){return d("MAWParseXMAFBConfig").FB_FULLY_SUPPORTED_TARGET_TYPES}};g.waConfig=a;g.mawConfig=b}),98);
__d("MAWConfig",["MAWMainWebWorkerConfig"],(function(a,b,c,d,e,f,g){"use strict";var h=d("MAWMainWebWorkerConfig").mawConfig;function a(){return h}function b(a){h=a}g.getConfig=a;g.setConfig=b}),98);
__d("MAWGetMsgForProtocolMsgIdTxn",["MAWDbMsgTxns","MAWIndexedDb","MAWTransactionMode","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({messages:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY},"getMsgForProtocolMsgIdTxn",function(a){return function(b){return d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b).then(function(a){return a!=null?d("WAResultOrError").makeResult(a):d("WAResultOrError").makeError("message-not-found")})}});g.getMsgForProtocolMsgIdTxn=a}),98);
__d("MAWJobsIndexedDb",["FBLogger","MAWCurrentUser","MAWErrorObject","MAWIndexedDbMetadata","MAWQplProxy","MAWTransactionMode","Promise","WAExceededStorageQuota","WALogger","WAWorkerGlobalScope","emptyFunction","promiseDone","qex","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=null,k=null,l="jobs";function m(){return c("qex")._("940")}function n(){if(j==null)throw c("FBLogger")("messenger_web").mustfixThrow("JobDB IndexDB should've been initialized");return j}function o(){if(k==null)throw c("FBLogger")("messenger_web").mustfixThrow("JobDB IndexDB should've been initialized");return k.then(function(){return n()})}function a(){return j!=null}var p=[function(a){a=a.target.result;a=a.createObjectStore(l,{autoIncrement:!0,keyPath:"jobId"});a.createIndex("uniqKey","uniqKey")},c("emptyFunction"),c("emptyFunction")];function e(a){k=null;j=null;return q(a).then(function(){return j.version})}function q(a){if(k!=null)return k;if(j!=null)return(i||(i=b("Promise"))).resolve();var e=d("MAWCurrentUser").getID(),f=d("MAWIndexedDbMetadata").jobsDbName(e),g=(e=a!=null?a:m())!=null?e:p.length,l=c("qpl")._(25310776,"6155");k=new(i||(i=b("Promise")))(function(a,b){var c=indexedDB.open(f,g);c.onupgradeneeded=function(a){for(var b=0;b<p.length;b++){var c=p[b],d=b+1;r(a,d)&&c(a)}};c.onsuccess=function(b){var c=b.target.result;c.onversionchange=function(){var a;d("MAWQplProxy").sendQplPointThroughBridge(l,"database_jobs_db_versionchange");d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[JobsDb initialization] upgradeneeded is triggered in another worker. This should not happen."])));c.close();(a=d("WAWorkerGlobalScope").workerGlobalScope.location)==null||a.reload==null||a.reload()};j=c;d("MAWQplProxy").sendQplPointThroughBridge(l,"database_jobs_db_ready");a()};c.onerror=function(){d("MAWQplProxy").sendQplPointThroughBridge(l,"database_jobs_db_failed"),b(c.error)}});return k}function r(a,b){var c=a.newVersion;a=a.oldVersion;return a<b&&c>=b}function s(a){return a===d("MAWTransactionMode").READWRITE?"readwrite":"readonly"}function f(a,b,e,f){var g=s(b);return function(b){return function(){for(var h=arguments.length,i=new Array(h),l=0;l<h;l++)i[l]=arguments[l];var m=f!=null?d("MAWQplProxy").startQplUserFlow(f):null,n=function(f){return o().then(function(c){var e=function(b){b=c.transaction(a,b!=null?s(b):g,{durability:"relaxed"});d("WAExceededStorageQuota").listenToQuotaExceededError(b);return b.objectStore(a)};return b.apply(void 0,[e].concat(i))}).then(function(a){m==null||m.endSuccess();return a})["catch"](function(b){m==null||m.endFail("job_transaction_fail");b=d("MAWErrorObject").getErrorObject(b);if((b==null?void 0:b.name)==="InvalidStateError"&&f===1){k=null;j=null;c("promiseDone")(q());return n(f-1)}if(b instanceof Error)throw c("FBLogger")("maw_db").catching(b).mustfixThrow("%s:%s - Error performing transaction in jobDB transactor v2",e,a);throw c("FBLogger")("maw_db").mustfixThrow("%s:%s - Error performing transaction in jobDB transactor v2",e,a)})};return n(1)}}}g.getJobsDbVersion=m;g.getJobDB=n;g.isJobDBInitted=a;g.dbMigrations=p;g.makeJobsDbIgnoringPreviousCreations=e;g.makeJobsDb=q;g.makeJobsTransactor=f}),98);
__d("MAWJobPersistenceAccessorsApi",["MAWJobActionsV2","MAWJobsIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a,b,c;return{deletePersistedJob:(a=d("MAWJobsIndexedDb")).makeJobsTransactor("jobs",(b=d("MAWTransactionMode")).READWRITE,"deletePersistedJob")((c=d("MAWJobActionsV2")).deletePersistedJob),loadAllJobs:a.makeJobsTransactor("jobs",b.READONLY,"loadAllJobs")(c.readAllPersistedJobs),maybeCreateJob:a.makeJobsTransactor("jobs",b.READWRITE,"maybeCreateJob")(c.maybeCreateJob),readPersistedJob:a.makeJobsTransactor("jobs",b.READONLY,"readPersistedJob")(c.readPersistedJob),updatePersistedJob:a.makeJobsTransactor("jobs",b.READWRITE,"updatePersistedJob")(c.updatePersistedJob)}}g.getJobPersistenceAccessors=a}),98);
__d("WAJobRequirement",["Promise","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i;c=function(){function a(a){var c=this;this.$1=(i||(i=b("Promise"))).resolve();this.$2=!0;this.$3=null;this.$4=function(){var a=c.$3;if(a!=null){c.$3=null;return(i||(i=b("Promise"))).all(a).then(c.$4)}c.$2=!0};this.name=a}var c=a.prototype;c.addBlocker=function(a){var c=this;a=a["catch"](function(a){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["JobRequirement[","] blocker errored ",""])),c.name,a).sendLogs("job-blocker-rejected")});if(this.$2)this.$2=!1,this.$1=(i||(i=b("Promise"))).all([this.$1,a]).then(this.$4);else{var e=this.$3;e!=null?e.push(a):this.$3=[a]}};c.waitUntilSatisfied=function(){return this.$1};c.isSatisfied=function(){return this.$2};c.isSatisfiable=function(){return!0};return a}();e=function(a){function c(c){c=a.call(this,c)||this;a.prototype.addBlocker.call(c,new(i||(i=b("Promise")))(function(){}));return c}babelHelpers.inheritsLoose(c,a);var d=c.prototype;d.addBlocker=function(){};d.isSatisfiable=function(){return!1};return c}(c);function a(a,c){var d=a.filter(function(a){return!a.isSatisfiable()});if(d.length>0){var e=d.map(function(a){return a.name});return function(a){c==null||c("unsatisfiable",e,a);return d[0].waitUntilSatisfied()}}var f=a.map(function(){return(i||(i=b("Promise"))).resolve()}),g=(i||(i=b("Promise"))).resolve(),h=null,j=function(){if(f.every(function(b,c){return b===a[c].waitUntilSatisfied()})){h=null;return}var c=[],d=a.map(function(a){var b=a.waitUntilSatisfied();a.isSatisfied()||(c.push(a.name),void b.then(function(){var b=c.indexOf(a.name);c.splice(b,1)}));return b});f=d;h=c;return(i||(i=b("Promise"))).all(d).then(j)};return function(a){if(h==null){var b=j();b!=null&&(g=g.then(function(){return b}))}c==null||c(h==null?"satisfied":"unsatisfied",h,a);return g}}g.JobRequirement=c;g.UnsatisfiableJobRequirement=e;g.joinRequirements=a}),98);
__d("WAJobPriorityBucket",["WAJobOrchestratorTypes","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i;a=function(){function a(a){this.tasks=[];this.pendingTasks=[];this.lastJobStartedTimestampMs=null;this.jobMaxConcurrency=(a=a.jobMaxConcurrencyMap)!=null?a:{}}var b=a.prototype;b.updateConfig=function(a){this.jobMaxConcurrency=(a=a.jobMaxConcurrencyMap)!=null?a:{}};b.getStats=function(){return[].concat(this.tasks,this.pendingTasks).reduce(function(a,b){var c;c=(c=a[b.jobName])!=null?c:0;a[b.jobName]=c+1;return a},{})};b.next=function(){var a=this;if(this.tasks.length===0)return null;var b=this.pendingTasks.reduce(function(a,b){var c;c=(c=a.get(b.jobName))!=null?c:0;a.set(b.jobName,c+1);return a},new Map()),c=this.tasks.filter(function(c){var e;return((e=b.get(c.jobName))!=null?e:0)<((e=a.jobMaxConcurrency[c.jobName])!=null?e:d("WAJobOrchestratorTypes").DEFAULT_CONCURRENCY)});return c.length>0?[c[0]]:null};b.add=function(a,b,c,d){c={jobId:c,jobInfo:b,jobName:a,run:d};this.tasks.push(c);return c};b.markJobTaskPending=function(a){this.pendingTasks.includes(function(b){return b.jobId===a.jobId})&&d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Assertion failed::markJobTaskPending found jobId: "," in pending tasks"])),a.jobId).sendLogs("JobOrchestrator::markJobTaskPending"),this.lastJobStartedTimestampMs=Date.now(),this.pendingTasks.push(a),this.tasks=this.tasks.filter(function(b){return b.jobId!==a.jobId})};b.markJobTaskDone=function(a){this.pendingTasks=this.pendingTasks.filter(function(b){return b.jobId!==a}),this.tasks.includes(function(b){return b.jobId===a})&&d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Assertion failed::markJobTaskDone found jobId: "," in scheduled tasks"])),a).sendLogs("JobOrchestrator::markJobTaskDone")};b.count=function(){return this.tasks.length};b.pendingCount=function(){return this.pendingTasks.length};b.clearWaitingTasks=function(){this.tasks=[]};b.clear=function(){this.tasks=[],this.pendingTasks=[]};b.getLastJobStartedTimestamp=function(){return this.lastJobStartedTimestampMs};return a}();b=function(a){function b(){return a.apply(this,arguments)||this}babelHelpers.inheritsLoose(b,a);var c=b.prototype;c.next=function(){var a=this,b,c;if(this.tasks.length===0)return null;var d=this.pendingTasks.reduce(function(a,b){var c;c=(c=a.get(b.jobName))!=null?c:0;a.set(b.jobName,c+1);return a},new Map()),e=this.tasks.filter(function(b){var c;return((c=d.get(b.jobName))!=null?c:0)<((c=a.jobMaxConcurrency[b.jobName])!=null?c:1)});if(e.length===0)return null;b=(b=this.jobMaxConcurrency[e[0].jobName])!=null?b:1;c=(c=d.get(e[0].jobName))!=null?c:0;if(b>1&&c<b){var f=e.filter(function(a){return a.jobName===e[0].jobName});b=Math.min(f.length,b-c);return f.slice(0,b)}return[e[0]]};return b}(a);g.BaseJobBucket=a;g.LowJobBucket=b}),98);
__d("WAMetrics",["Promise","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){var a=d("WATimeUtils").performanceAbsoluteNow();return new(h||(h=b("Promise")))(function(b){setTimeout(function(){b(d("WATimeUtils").performanceAbsoluteNow()-a)},0)})}g.getEventLoopDelay=a}),98);
__d("WAConcurrentBucketJobQueue",["WABase64","WACryptoDependencies","WACustomError","WAJobOrchestratorTypes","WAJobPriorityBucket","WALogger","WAMetrics","WANullthrows","WAPromiseTimeout","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=30,k=new Map([[d("WAJobOrchestratorTypes").JOB_PRIORITY.HIGH,5],[d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW,1]]);function l(a){a=new Uint8Array(a);d("WACryptoDependencies").getCrypto().getRandomValues(a);return d("WABase64").encodeB64(a)}a=function(){function a(){this.$1=!1,this.$2=0,this.$3=0,this.$4=0,this.$5=new Map(),this.$6=new Map(),this.$7=new Map(),this.$9=0}var b=a.prototype;b.init=function(a,b){var e,f,g;if(this.$1)throw c("err")("WAConcurrentBucketJobQueue has already initialized");this.$4=(e=a==null?void 0:a.bestEffortWaitTimeoutSec)!=null?e:j;this.$2=a.maxConcurrency;this.$3=a.maxConcurrency;this.$8=b;this.$7=this.$11(a==null?void 0:a.jobPrioritiesQuota);this.$6=new Map(this.$7);this.$5=new Map();this.$9=Date.now();b=new(d("WAJobPriorityBucket").BaseJobBucket)({jobMaxConcurrencyMap:(e=a.maxConcurrencyPerJob)!=null?e:{}});e=new(d("WAJobPriorityBucket").LowJobBucket)({jobMaxConcurrencyMap:(e=a.maxConcurrencyPerJob)!=null?e:{}});f=new(d("WAJobPriorityBucket").LowJobBucket)({jobMaxConcurrencyMap:(f=a.maxConcurrencyPerJob)!=null?f:{}});g=new(d("WAJobPriorityBucket").BaseJobBucket)({jobMaxConcurrencyMap:(g=a.maxConcurrencyPerJob)!=null?g:{}});a=new(d("WAJobPriorityBucket").BaseJobBucket)({jobMaxConcurrencyMap:(a=a.maxConcurrencyPerJob)!=null?a:{}});this.$5.set(d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION,b);this.$5.set(d("WAJobOrchestratorTypes").JOB_PRIORITY.HIGH,b);this.$5.set(d("WAJobOrchestratorTypes").JOB_PRIORITY.OFFLINE,g);this.$5.set(d("WAJobOrchestratorTypes").JOB_PRIORITY.HISTORY_SYNC,a);this.$5.set(d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW,e);this.$5.set(d("WAJobOrchestratorTypes").JOB_PRIORITY.BEST_EFFORT,f);this.$1=!0};b.updateConfig=function(a){this.$3+=a.maxConcurrency-this.$2,this.$2=a.maxConcurrency,this.$5.forEach(function(b){return b.updateConfig({jobMaxConcurrencyMap:(b=a.maxConcurrencyPerJob)!=null?b:{}})}),this.$7=this.$11(a==null?void 0:a.jobPrioritiesQuota),d("WALogger").LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[job-orchestator]: updated WAConcurrentBucketJobQueue config"])))};b.isInitialized=function(){return this.$1};b.clearQueue=function(){if(!this.$1)throw c("err")("WAConcurrentBucketJobQueue not initialized");this.$5.forEach(function(a){return a.clear()})};b.clearQueueByPriority=function(a){if(!this.$1)throw c("err")("WAConcurrentBucketJobQueue not initialized");(a=this.$5.get(a))==null||a.clearWaitingTasks()};b.getIntStats=function(){var a=this,b=function(b){var c;b=a.$5.get(b);return((c=b==null?void 0:b.count())!=null?c:0)+((c=b==null?void 0:b.pendingCount())!=null?c:0)};return{highPriorityBucketSize:b(d("WAJobOrchestratorTypes").JOB_PRIORITY.HIGH),lowPriorityBucketSize:b(d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW),bestEffortPriorityBucketSize:b(d("WAJobOrchestratorTypes").JOB_PRIORITY.BEST_EFFORT)}};b.getStringStats=function(){var a=this,b=function(b){var c=(b=(b=a.$5.get(b))==null?void 0:b.getStats())!=null?b:{};b=Object.keys(c).reduce(function(a,b){var d=a[0];a=a[1];var e=c[b];return e>d?[e,b]:[d,a]},[0,null]);b=b[1];return b};return{highPriorityMaxJob:b(d("WAJobOrchestratorTypes").JOB_PRIORITY.HIGH),lowPriorityMaxJob:b(d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW),bestEffortPriorityMaxJob:b(d("WAJobOrchestratorTypes").JOB_PRIORITY.BEST_EFFORT)}};b.enqueue=function(a,b,e,f){var g,h=this;if(!this.$1)return Promise.reject(c("err")("WAConcurrentBucketJobQueue not initialized"));var i,j,k=new Promise(function(a,b){i=a,j=b}),m=babelHelpers.extends({priority:d("WAJobOrchestratorTypes").DEFAULT_JOB_PRIORITY},e),n=this.getJobBucketByType(m.priority);if(!n)return Promise.reject(c("err")("WAConcurrentBucketJobQueue no bucket for job with name "+a+" was found."));void d("WAMetrics").getEventLoopDelay().then(function(a){f!=null&&f.isActive()&&(f==null||f.addPoint("measure_event_loop_delay",{int:{eventLoopDelay:a}}))});f==null||f.addPoint("scheduling_job",{string:babelHelpers.extends({},this.getStringStats(),{priority:m.priority}),int:babelHelpers.extends({},this.getIntStats(),{maxTimeoutMs:(g=e==null?void 0:e.maxTimeoutMs)!=null?g:0})});var o=m.priority+"-"+a+"-"+((g=e==null?void 0:e.jobId)!=null?g:l(8));g=n.add(a,m,o,async function(){try{h.$8.logJobStarted(o);var a=await h.$12(b(),e==null?void 0:e.maxTimeoutMs);h.$8.logJobCompleted(o);i(a)}catch(a){a instanceof d("WACustomError").TimeoutError?h.$8.logJobTimeout(o):h.$8.logJobError(o),j(a)}});this.$8.logJobCreated({jobId:o,jobName:a,jobPriority:m.priority,pendingJobsCount:n.count()});e&&e.priority===d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION&&void this.$13(g);this.$14();return k};b.getAvailableThreadsCount=function(){return this.$3};b.getJobQuotaConfig=function(){return this.$7};b.getRemainingJobCountMap=function(){return this.$6};b.getJobBucketByType=function(a){return this.$5.get(a)};b.getSnapshot=function(a){a=this.getJobBucketByType(a);return!a?null:a.getStats()};b.$11=function(a){var b;!a?b=new Map(k):b=new Map(a);b.set(d("WAJobOrchestratorTypes").JOB_PRIORITY.BEST_EFFORT,0);return b};b.$15=function(a){return(a=this.$6.get(a))!=null?a:0};b.$16=function(){this.$6=new Map(this.$7)};b.$17=function(a){var b=this;a===void 0&&(a=!0);var c=0,e=null,f=0;this.$5.forEach(function(a,d){c+=a==null?void 0:a.count();f+=b.$15(d);if(e!=null)return;a.count()>0&&b.$15(d)>0&&(e=a)});var g=e==null||f===0;g&&this.$16();if(this.$18(c,g))return this.getJobBucketByType(d("WAJobOrchestratorTypes").JOB_PRIORITY.BEST_EFFORT);return e==null&&a?this.$17(!1):e};b.$18=function(a,b){var c=this;function e(a,b){var c=Date.now();return a>c?!1:c-a<b*1e3}function f(a,b){a=Math.ceil(a-Date.now())+b*1e3;return a>0?a:0}var g=this.getJobBucketByType(d("WAJobOrchestratorTypes").JOB_PRIORITY.BEST_EFFORT);a=a-((a=g==null?void 0:g.count())!=null?a:0);var h=g==null?void 0:g.getLastJobStartedTimestamp();if((g==null?void 0:g.count())===0)return!1;if(h==null&&e(this.$9,this.$4)){if(this.$10==null){g=f(this.$9,this.$4);this.$10=setTimeout(function(){c.$14(),c.$10=null},g)}return!1}return a>0&&h!=null&&e(h,this.$4)?!1:b};b.$19=function(a){a=this.$20(a);return c("WANullthrows")(this.$5.get(a))};b.$20=function(a){var b=a.split("-")[0];b=d("WAJobOrchestratorTypes").JOB_PRIORITY.cast(b);if(!b)throw c("err")("ConcurrentBucketQueue cannot extract known job priority type from id: "+a);return b};b.$21=function(a){a=this.$20(a);this.$15(a)>0?this.$6.set(a,this.$15(a)-1):this.$6.set(a,0)};b.$14=function(){var a=this;while(this.$3>0){var b=this.$17();b=b==null?void 0:b.next();if(b==null)break;b.forEach(function(b){a.$21(b.jobId),void a.$13(b)})}};b.$12=function(a,b){return b!==void 0?d("WAPromiseTimeout").promiseTimeout(a,b):a};b.$13=async function(a){var b=this,c=this.$19(a.jobId);this.$3--;c.markJobTaskPending(a);var e=a.run,f=a.jobId,g=a.jobName;try{await this.$12(e(),((e=a.jobInfo)==null?void 0:e.maxTimeoutMs)===void 0?d("WAJobOrchestratorTypes").DEFAULT_JOB_TIMEOUT_MS:void 0)}catch(a){if(a instanceof d("WACustomError").TimeoutError)this.$8.logJobTimeout(f),d("WALogger").LOG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[job-orchestator]: "," exceeding the timeout, release the thread."])),g);else throw a}finally{this.$3++,c.markJobTaskDone(f),this.$3>0&&setTimeout(function(){return b.$14()},0)}};return a}();g.WAConcurrentBucketJobQueue=a}),98);
__d("WAConcurrentPreemptiveJobQueue",["WACustomError","WAJobOrchestratorTypes","WALogger","WAPromiseTimeout","WARandomHex","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;a=function(){function a(){this.$1=!1,this.$2=0,this.$3=0,this.$4={},this.$5=[],this.$6=[]}var b=a.prototype;b.init=function(a,b){if(this.$1)throw c("err")("ConcurrentPreemptiveJobQueue has already initialized");this.$2=a.maxConcurrency;this.$3=a.maxConcurrency;this.$4=(a=a.maxConcurrencyPerJob)!=null?a:{};this.$7=b;this.$1=!0};b.updateConfig=function(a){this.$3+=a.maxConcurrency-this.$2;this.$2=a.maxConcurrency;this.$4=(a=a.maxConcurrencyPerJob)!=null?a:{};d("WALogger").LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[job-orchestator]: updated ConcurrentPreemptiveJobQueue config"])))};b.isInitialized=function(){return this.$1};b.clearQueueByPriority=function(a){if(!this.$1)throw c("err")("ConcurrentPreemptiveJobQueue not initialized");this.$5=this.$5.filter(function(b){return((b=b.jobInfo)==null?void 0:b.priority)!==a})};b.clearQueue=function(){if(!this.$1)throw c("err")("ConcurrentPreemptiveJobQueue not initialized");this.$5=[];this.$6=[]};b.enqueue=function(a,b,e){var f,g=this;if(!this.$1)return Promise.reject(c("err")("ConcurrentPreemptiveJobQueue not initialized"));var h,i,j=new Promise(function(a,b){h=a,i=b}),k=babelHelpers.extends({priority:d("WAJobOrchestratorTypes").DEFAULT_JOB_PRIORITY},e),l=(f=e==null?void 0:e.jobId)!=null?f:d("WARandomHex").randomHex(8).substr(0,64);f=this.$8(a,k,l,async function(){try{g.$7.logJobStarted(l);var a=await g.$9(b(),e==null?void 0:e.maxTimeoutMs);g.$7.logJobCompleted(l);h(a)}catch(a){a instanceof d("WACustomError").TimeoutError?g.$7.logJobTimeout(l):g.$7.logJobError(l),i(a)}});e&&e.priority===d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION&&this.$10(f);this.$11();return j};b.getAvailableThreadsCount=function(){return this.$3};b.getJobMaxConcurrency=function(){return this.$4};b.getSnapshot=function(a){};b.$11=function(){while(this.$3>0){var a=this.$12();if(a==null)break;this.$10(a)}};b.$9=function(a,b){return b!==void 0?d("WAPromiseTimeout").promiseTimeout(a,b):a};b.$10=async function(a){var b=this;this.$3--;this.$13(a);var c=a.run,e=a.jobId,f=a.jobName;try{await this.$9(c(),((c=a.jobInfo)==null?void 0:c.maxTimeoutMs)===void 0?d("WAJobOrchestratorTypes").DEFAULT_JOB_TIMEOUT_MS:void 0)}catch(a){if(a instanceof d("WACustomError").TimeoutError)this.$7.logJobTimeout(e),d("WALogger").LOG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[job-orchestator]: "," exceeding the timeout, release the thread."])),f);else throw a}finally{this.$3++,this.$14(e),setTimeout(function(){return b.$11()},0)}};b.$8=function(a,b,c,d){d={jobId:c,jobInfo:b,jobName:a,run:d};this.$7.logJobCreated({jobId:c,jobName:a,jobPriority:b.priority,pendingJobsCount:this.$5.length});this.$5.push(d);return d};b.$13=function(a){this.$6.includes(function(b){return b.jobId===a.jobId})&&d("WALogger").ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Assertion failed::markJobTaskPending found jobId: "," in pending tasks"])),a.jobId).sendLogs("JobOrchestrator::markJobTaskPending"),this.$6.push(a),this.$5=this.$5.filter(function(b){return b.jobId!==a.jobId})};b.$14=function(a){this.$6=this.$6.filter(function(b){return b.jobId!==a}),this.$5.includes(function(b){return b.jobId===a})&&d("WALogger").ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Assertion failed::markJobTaskDone found jobId: "," in scheduled tasks"])),a).sendLogs("JobOrchestrator::markJobTaskDone")};b.$12=function(){var a=this;if(this.$5.length===0)return null;var b=this.$6.reduce(function(a,b){var c;c=(c=a.get(b.jobName))!=null?c:0;a.set(b.jobName,c+1);return a},new Map()),c=this.$5.filter(function(c){var d;return((d=b.get(c.jobName))!=null?d:0)<((d=a.$4[c.jobName])!=null?d:1)});return c[0]};return a}();g.WAConcurrentPreemptiveJobQueue=a}),98);
__d("WADefaultJobNoQueue",["WAJobOrchestratorTypes","WARandomHex","err"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(){this.$2=!1}var b=a.prototype;b.init=function(a,b){if(this.$2)throw c("err")("DefaultNoQueue has already initialized");this.$1=b;this.$2=!0};b.updateConfig=function(a){};b.isInitialized=function(){return this.$2};b.clearQueue=function(){};b.clearQueueByPriority=function(a){};b.getSnapshot=function(){throw c("err")("getSnapshot is not implemented for DefaultNoQueue")};b.enqueue=async function(a,b,c){var e;e=(e=c==null?void 0:c.jobId)!=null?e:d("WARandomHex").randomHex(8).substr(0,64);this.$1.logJobCreated({jobId:e,jobName:a,jobPriority:(a=c==null?void 0:c.priority)!=null?a:d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW,pendingJobsCount:0});try{this.$1.logJobStarted(e);c=await b();this.$1.logJobCompleted(e);return c}catch(a){this.$1.logJobError(e);throw a}};return a}();g.WADefaultJobNoQueue=a}),98);
__d("WAOrchestratorJobStatsLogger",["WAGlobals","WAPREList","WAPREMetrics"],(function(a,b,c,d,e,f,g){"use strict";var h=function(){function a(a,b,c){this.jobName=a,this.pendingJobsCount=c,this.jobPriority=b}var b=a.prototype;b.logJobAdded=function(){this.webcJobAddedT=Date.now(),this.eventFlow=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.WA_JOBS_ORCHESTRATOR,{string:{name:this.jobName,jobPriority:this.jobPriority,orchestratorVersion:d("WAGlobals").getConfig().orchestratorVersion()},"int":{pendingJobsCount:this.pendingJobsCount,addedAt:this.webcJobAddedT}})};b.logJobStarted=function(){this.webcJobStartedT=Date.now(),this.eventFlow.addPoint("start_job",{"int":{startedAt:this.webcJobStartedT}})};b.logJobCompleted=function(a){this.webcJobCompletedT=Date.now();this.jobResultType=a;var b={"int":{pendingJobsCount:this.pendingJobsCount,completedAt:this.webcJobCompletedT}};a==="completed"?this.eventFlow.endSuccess(b):this.eventFlow.endFail(a,b)};return a}();a=function(){function a(){this.$1=new Map()}var b=a.prototype;b.logJobCreated=function(a){var b=a.jobName,c=a.jobId,d=a.jobPriority;a=a.pendingJobsCount;b=new h(b,d,a);b.logJobAdded();this.$1.set(c,b)};b.logJobStarted=function(a){a=this.$1.get(a);a==null||a.logJobStarted()};b.logJobCompleted=function(a){this.$2(a,"completed")};b.logJobError=function(a){this.$2(a,"error")};b.logJobTimeout=function(a){this.$2(a,"timeout")};b.logJobAborted=function(a){this.$2(a,"aborted")};b.$2=function(a,b){var c=this.$1.get(a);c==null||c.logJobCompleted(b);this.$1["delete"](a)};return a}();g.JobInfoEvent=h;g.JobStatsLogger=a}),98);
__d("WAOrchestrator",["WAConcurrentBucketJobQueue","WAConcurrentPreemptiveJobQueue","WADefaultJobNoQueue","WAGlobals","WAJobOrchestratorTypes","WAOrchestratorJobStatsLogger"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a={maxConcurrency:1},b="default",c={},e=a,f=new(d("WAOrchestratorJobStatsLogger").JobStatsLogger)();return function(g,j){var k;g===void 0&&(g=!1);g=g?b:d("WAGlobals").getConfig().orchestratorVersion();k=(k=i())!=null?k:a;var l;j==null||j.addPoint("get_orchestrator",{string:{orchestrator:g},"int":{maxConcurrency:k.maxConcurrency,highPriorityQuota:(j=(j=k.jobPrioritiesQuota)==null?void 0:j.get(d("WAJobOrchestratorTypes").JOB_PRIORITY.HIGH))!=null?j:0,lowPriorityQuota:(j=(j=k.jobPrioritiesQuota)==null?void 0:j.get(d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW))!=null?j:0}});if(c[g]){h(e,k)&&(e=k,c[g].updateConfig(k));return c[g]}switch(g){case"preemptive":l=new(d("WAConcurrentPreemptiveJobQueue").WAConcurrentPreemptiveJobQueue)();break;case"bucket":l=new(d("WAConcurrentBucketJobQueue").WAConcurrentBucketJobQueue)();break;default:l=new(d("WADefaultJobNoQueue").WADefaultJobNoQueue)();break}l.init(k,f);c[g]=l;e=k;return l}}function h(a,b){var c;if(a.maxConcurrency!==b.maxConcurrency)return!0;if(((c=a.jobPrioritiesQuota)==null?void 0:c.size)!==((c=b.jobPrioritiesQuota)==null?void 0:c.size))return!0;return Object.keys((c=a.maxConcurrencyPerJob)!=null?c:{}).length!==Object.keys((c=b.maxConcurrencyPerJob)!=null?c:{}).length?!0:JSON.stringify(a)!==JSON.stringify(b)}function i(){var a={jobPrioritiesQuota:new Map([[d("WAJobOrchestratorTypes").JOB_PRIORITY.HIGH,5],[d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW,1]]),maxConcurrency:5,maxConcurrencyPerJob:{}};return a}g.getInstanceDelegate=a}),98);
__d("WAPromiseBackoffs",["Promise","err"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){if(a===0)return 0;var c=o(b.algo);for(var d=1;d<a;d++)c();return j(b,c())}function i(a){var b=a.relativeDelay,c=b===void 0?!1:b,d=null,e=o(a.algo);return function(){var b=d;if(b==null){d=c?Date.now():0;return 0}var f=j(a,e());if(c){var g=Date.now();b=g-b;b>0&&(f=Math.max(0,f-b));d=g}return f}}function d(a){var c=i(a);return function(a){return new(h||(h=b("Promise")))(function(b){var d=c();d>0?setTimeout(b,d,a):b(a)})}}function j(a,b){var c=a.max,d=a.min;a=a.jitter;a=a===void 0?.1:a;b=b;c!=null&&b>c&&(b=c);d!=null&&b<d&&(b=d);a!==0&&(b=Math.ceil(b*(1+a*Math.random())));return b}function k(a){var b=a.second-a.first,c=a.first-b;return function(){var a=b+c;c=b;b=a;return a}}function l(a){var b=a.base,c=b===void 0?2:b,d=a.first;return function(){var a=d;d*=c;return a}}function m(a){var b=a.delay;return function(){return b}}function n(a){var b=a.toMs;a=a.backoff;var c=o(a);return function(){return b(c())}}function o(a){switch(a.type){case"fibonacci":return k(a);case"exponential":return l(a);case"constant":return m(a);case"adjust":return n(a);default:a;throw c("err")("makeTimeFunc unrecognized backoff "+a.type)}}g.getDelay=a;g.createTimer=i;g.createPromiseTimer=d}),98);
__d("WAPersistedJobManager",["WAJobRequirement","WALogger","WAPromiseBackoffs","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K=1,L=function(){function a(a){this.feature=a}var b=a.prototype;b.toString=function(){return"RequiresPage: "+this.feature};return a}(),M=function(){function a(a){this.backoffOptions=a}var b=a.prototype;b.toString=function(){return"RetryOnBackoff"};return a}();a=function(a){function b(){return a.apply(this,arguments)||this}babelHelpers.inheritsLoose(b,a);var c=b.prototype;c.toString=function(){return"NonRetryableError"};return b}(babelHelpers.wrapNativeSuper(Error));var N=function(a){this.result=a},O="$unstarted",P="$finished";b=function(){function a(a){var b=this,c=a.isRestartAfterCrash,e=a.accessors,f=a.unfinishedJobEntries,g=new Map();f=f.then(function(a){var f=[],j=[];a.forEach(function(a){a.stepHardStartCountAfterTimeout>=5?f.push(a):j.push(a)});return Promise.all(f.map(function(a){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["",": stuck on the step ",", aborting the job"])),R(a),a.step).devConsole(Q(a)).sendLogs("job-stuck-"+a.type);return e.deletePersistedJob(a.jobId)})).then(function(){j.forEach(function(a){if(g.has(a.jobId))return;d("WALogger").LOG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["",": restarting"])),Q(a));g.set(a.jobId,b.$1(a,c))})})});this.implementationLoaders=new Map();this.implementations=new Map();this.stepBlockers=new WeakMap();this.accessors=e;this.activeJobs=g;this.initialJobsPromise=f;this.listeners=a.listeners;this.deprecatedJobs=a.deprecatedJobs}var b=a.prototype;b.loadAndRunJobFromId=function(a){var b=this.activeJobs.get(a);if(b!=null)return b;b=this.$2(a);this.activeJobs.set(a,b);return b};b.$2=async function(a){var b=this.initialJobsPromise,c=this.accessors;await b;b=await c.readPersistedJob(a);if(!b){d("WALogger").DEV(j||(j=babelHelpers.taggedTemplateLiteralLoose(["No entry for job ",""])),a);d("WALogger").WARN(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Persisted job missing for given ID"])));return null}return this.$1(b,!1)};b.$3=function(a){var b=this.implementations,c=this.implementationLoaders,d=b.get(a);if(d)return d;d=c.get(a);if(!d)return null;c=d();b.set(a,c);return c};b.$4=function(a,b){if(b==null||b.length===0)return Promise.resolve();var c=this.stepBlockers,e=c.get(b);e==null&&(e=d("WAJobRequirement").joinRequirements(b.map(function(a){return a()}),T),c.set(b,e));return e(a)};b.$5=function(a,b,c,e){var f=this;c===void 0&&(c=!1);var g=a.step,h=b.findIndex(function(a){return a.stepName===g}),i=b[h].info(a.current,a.original,U(a,c)),j=i.requirements,k=i.code;i=this.$4(a,j);e&&(i=i.then(e));return i.then(function(){d("WALogger").LOG(l||(l=babelHelpers.taggedTemplateLiteralLoose(["",": running step"])),S(a));return k(a.current,a.original,U(a,c))}).then(function(e){if(e instanceof N){d("WALogger").LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["",": InterruptJob"])),S(a));return e.result}var g=h+1;if(g>=b.length)return e;g=b[g];a.step=g.stepName;a.current=e;a.stepHardStartCountAfterTimeout=0;a.stepFirstStartTime=d("WATimeUtils").unixTime();a.stepUnexpectedErrorCount=0;a.waitUntil=null;a.backedOffCount=0;return f.accessors.updatePersistedJob(a).then(function(){return f.$5(a,b,c)})})};b.$1=async function(a,b){var c=this,e=this.accessors,f=this.activeJobs,g=this.deprecatedJobs,h=this.listeners,i=h.onJobFinished;h=h.onJobStarted;var j=await this.$3(a.type);g=g[a.type];if(!j){if(!g){d("WALogger").ERROR(n||(n=babelHelpers.taggedTemplateLiteralLoose(["No implementation for ",". Maybe it should have been put to the deprecated list?"])),a.type).sendLogs("missing-job-implementation");await e.deletePersistedJob(a.jobId);return null}else if(g==="NOOP"){d("WALogger").WARN(o||(o=babelHelpers.taggedTemplateLiteralLoose(["No implementation for deprecated ",", job deleted"])),a.type);await e.deletePersistedJob(a.jobId);return null}j=await g()}var k=j;g&&d("WALogger").LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Running deprecated job ",""])),a.type);var l=(g=a.stepFirstStartTime)!=null?g:d("WATimeUtils").unixTime();a.stepFirstStartTime=l;a.stepUnexpectedErrorCount=a.stepUnexpectedErrorCount||0;a.backedOffCount=a.backedOffCount||0;if(a.step===P){g=a.waitUntil;var m=d("WATimeUtils").secondsUntil(l);g!=null&&d("WATimeUtils").isInFuture(g)&&m>0&&(d("WALogger").LOG(q||(q=babelHelpers.taggedTemplateLiteralLoose(["",": skew detected, adjusting accordingly"])),Q(a)),g=d("WATimeUtils").castToUnixTime(g-m),d("WATimeUtils").isInFuture(g)&&(a.stepFirstStartTime=d("WATimeUtils").castToUnixTime(l-m),a.waitUntil=g,await this.accessors.updatePersistedJob(a)));(g==null||!d("WATimeUtils").isInFuture(g))&&(d("WALogger").LOG(r||(r=babelHelpers.taggedTemplateLiteralLoose(["",": removing completed, expired job from db"])),Q(a)),await e.deletePersistedJob(a.jobId));f.delete(a.jobId);return a.current}m=a.step!==O?j.find(function(b){return b.stepName===a.step}):j[0];if(!m){d("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["No implementation for ",".",""])),a.type,a.step).sendLogs("missing-job-step");await e.deletePersistedJob(a.jobId);return null}a.step=m.stepName;var E=function(){var e=a.waitUntil,f=Promise.resolve();if(e!=null){var g=d("WATimeUtils").futureUnixTime(d("WATimeUtils").DAY_SECONDS);e>g?(d("WALogger").LOG(t||(t=babelHelpers.taggedTemplateLiteralLoose(["",": trim wait from "," to ",""])),S(a),e,g),a.waitUntil=g,f=c.accessors.updatePersistedJob(a).then(function(){return d("WATimeUtils").delayUntil(g)})):(d("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["",": delaying until ",""])),S(a),e),f=d("WATimeUtils").delayUntil(e))}return f.then(function(){var e=function(){a.waitUntil=null;d("WATimeUtils").happenedWithin(l,d("WATimeUtils").DAY_SECONDS)||a.stepHardStartCountAfterTimeout++;return c.accessors.updatePersistedJob(a)};return c.$5(a,k,b,e).catch(function(b){if(b instanceof L){d("WALogger").LOG(v||(v=babelHelpers.taggedTemplateLiteralLoose(["",": requires page"])),S(a));a.stepHardStartCountAfterTimeout>0&&(--a.stepHardStartCountAfterTimeout,c.accessors.updatePersistedJob(a));return new Promise(function(){})}else if(b instanceof M){d("WALogger").LOG(w||(w=babelHelpers.taggedTemplateLiteralLoose(["",": RetryOnBackoff"])),S(a));var e=d("WAPromiseBackoffs").getDelay(++a.backedOffCount,b.backoffOptions);a.waitUntil=d("WATimeUtils").futureUnixTime(Math.ceil(e/1e3));a.stepHardStartCountAfterTimeout>0&&--a.stepHardStartCountAfterTimeout;return c.accessors.updatePersistedJob(a).then(E)}else if(a.stepUnexpectedErrorCount<K){d("WALogger").WARN(x||(x=babelHelpers.taggedTemplateLiteralLoose(["",": Unhandled exception. Tried "," times"])),S(a),a.stepUnexpectedErrorCount);d("WALogger").WARN(y||(y=babelHelpers.taggedTemplateLiteralLoose(["",": Unhandled exception: ",""])),S(a),b);a.stepUnexpectedErrorCount++;return c.accessors.updatePersistedJob(a).then(E)}throw b})})},F=E();g=F.then(async function(b){d("WALogger").LOG(z||(z=babelHelpers.taggedTemplateLiteralLoose(["",": finished job"])),S(a));var g=null;try{g=i(a.jobId,a.type,a.original,b)}catch(b){d("WALogger").ERROR(A||(A=babelHelpers.taggedTemplateLiteralLoose(["onJobFinished for "," threw exception ",""])),a.type,b).sendLogs("onJobFinished-threw")}g!=null&&g>0?(a.waitUntil=d("WATimeUtils").futureUnixTime(Math.ceil(g/1e3)),a.step=P,a.current=b,a.stepFirstStartTime=d("WATimeUtils").unixTime(),await c.accessors.updatePersistedJob(a)):(await e.deletePersistedJob(a.jobId),f.delete(a.jobId))},async function(c){d("WALogger").ERROR(B||(B=babelHelpers.taggedTemplateLiteralLoose([""," failed with error ",""])),a.type,c).sendLogs("job-threw-exception-"+a.type);c=k.find(function(b){return b.stepName===a.step});if(!c)d("WALogger").ERROR(C||(C=babelHelpers.taggedTemplateLiteralLoose(["",": "," step not found"])),a.type,a.step);else{c=c.info(a.current,a.original,U(a,b));c.stopRetryIf!=null&&await c.stopRetryIf.onStopRetry(a.current,a.original,U(a,b))}await e.deletePersistedJob(a.jobId);f.delete(a.jobId)});try{h(a.jobId,a.type,a.original)}catch(b){d("WALogger").ERROR(D||(D=babelHelpers.taggedTemplateLiteralLoose(["onJobStarted for "," threw exception ",""])),a.type,b).sendLogs("onJobStarted-threw")}return g.then(function(){return F})};b.addPersistedJobImplementation=function(a,b){var c=this.implementationLoaders,e=this.deprecatedJobs;if(c.has(a)){d("WALogger").ERROR(E||(E=babelHelpers.taggedTemplateLiteralLoose(["addPersistedJobImplementation called twice for ",""])),a).sendLogs("repeat-job-loader");return}e&&e[a]&&d("WALogger").DEV(F||(F=babelHelpers.taggedTemplateLiteralLoose([""," has been loaded and is marked as deprecated"])),a);c.set(a,b)};b.fireAndForget=function(a){var b=this;this.accessors.maybeCreateJob(a).then(function(a){a=a.id;return b.loadAndRunJobFromId(a)})};b.waitUntilPersisted=function(a){var b=this;return this.accessors.maybeCreateJob(a).then(function(a){a=a.id;b.loadAndRunJobFromId(a)})};b.waitUntilCompleted=function(a){var b=this;return this.accessors.maybeCreateJob(a).then(function(a){a=a.id;return b.loadAndRunJobFromId(a)})};b.fireAndForgetNonPersisted=function(a){d("WALogger").LOG(G||(G=babelHelpers.taggedTemplateLiteralLoose(["fireAndForgetNonPersisted not implemented in PersistedJobManager"])))};b.waitUntilCompletedNonPersisted=function(a){return Promise.resolve(function(){return d("WALogger").LOG(H||(H=babelHelpers.taggedTemplateLiteralLoose(["waitUntilCompletedNonPersisted not implemented in PersistedJobManager"])))})};return a}();function Q(a){return"Job["+a.jobId+"] ("+a.type+")"}function R(a){return"[Job "+a.type+"] "}function S(a){return"Job["+a.jobId+"] ("+a.type+"."+a.step+")"}function T(a,b,c){a==="unsatisfiable"?d("WALogger").LOG(I||(I=babelHelpers.taggedTemplateLiteralLoose([""," halting because of ",""])),S(c),b):a==="unsatisfied"?d("WALogger").LOG(J||(J=babelHelpers.taggedTemplateLiteralLoose([""," waiting on ",""])),S(c),b):a}function U(a,b){b===void 0&&(b=!1);return{jobStartTime:a.startTime,afterCrash:b,interruptJob:V}}function V(a){return new N(a)}g.RequiresPage=L;g.RetryOnBackoff=M;g.NonRetryableError=a;g.InterruptJob=N;g.UNSTARTED_JOB=O;g.FINISHED_JOB=P;g.PersistedJobManager=b}),98);
__d("WaJobInMemoryAccessors",["Promise","WARandomHex","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){var a=-1,c=new Map();return{deletePersistedJob:function(a){return(h||(h=b("Promise"))).resolve(c["delete"](a))},loadAllJobs:function(){return(h||(h=b("Promise"))).resolve(Array.from(c.values()))},maybeCreateJob:function(e){var f,g=JSON.stringify([e.type,(f=e.uniqKey)!=null?f:d("WARandomHex").randomHex(32)]),i={backedOffCount:0,current:e.args,original:e.args,startTime:d("WATimeUtils").unixTime(),step:"$unstarted",stepFirstStartTime:null,stepHardStartCountAfterTimeout:0,stepUnexpectedErrorCount:0,type:e.type,uniqKey:g,version:e.version,waitUntil:null,scheduleConfig:e.scheduleConfig};f=function(){var d=a--,e=babelHelpers["extends"]({},i,{jobId:d});c.set(d,e);return(h||(h=b("Promise"))).resolve({id:d,newlyCreated:!0})};if(e.uniqKey!=null){e=Array.from(c.values()).filter(function(a){return a.uniqKey===g});if(e.length===0)return f();var j=null;e.forEach(function(a){a.step!=="$finished"?j=a:c["delete"](a.jobId)});return j!=null?(h||(h=b("Promise"))).resolve({id:j.jobId,newlyCreated:!1}):f()}return f()},readPersistedJob:function(a){a=c.get(a);return(h||(h=b("Promise"))).resolve(a&&babelHelpers["extends"]({},a))},updatePersistedJob:function(a){return(h||(h=b("Promise"))).resolve(c.set(a.jobId,babelHelpers["extends"]({},a)))}}}g.getJobInMemoryAccessors=a}),98);
__d("WAPersistedJobManagerV2",["WAGlobals","WAJids","WAJobOrchestratorTypes","WAJobRequirement","WALogger","WAOrchestrator","WAPREList","WAPREMetrics","WAPersistedJobManager","WAPromiseBackoffs","WAResolvable","WATimeUtils","WaJobInMemoryAccessors","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M=1;function N(a){var b=a.code,c=a.annotations;c=c===void 0?{}:c;a=a.eventFlow;var d=a===void 0?O(c):a;return b(d).then(function(a){d.endSuccess();return a}).catch(function(a){d.endFail("error",{string:{error:""+a}});throw a})}function O(a){a===void 0&&(a={});return d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.WA_JOB_MANAGER,babelHelpers.extends({},a,{string:babelHelpers.extends({},(a=(a=a)==null?void 0:a.string)!=null?a:{},{userHash:d("WAGlobals").getDependencies().isEmployee()&&d("WAGlobals").getDependencies().isUseridAnnotationEnabled()?d("WAJids").extractUserId(d("WAGlobals").getMyUserJid()).slice(-5):null})}))}a=function(){function a(a){var b=this;this.$1=[];var c=a.isRestartAfterCrash,e=a.accessors,f=a.unfinishedJobEntries,g=a.ignoreForceNonPersistedJobList;this.getOrchestratorDelegate=d("WAOrchestrator").getInstanceDelegate();this.activeJobs=new Map();this.implementationLoaders=new Map();this.implementations=new Map();this.stepBlockers=new WeakMap();this.accessors=e;this.isRestartAfterCrash=c||!1;this.listeners=a.listeners;this.deprecatedJobs=a.deprecatedJobs;this.inMemoryAccessors=d("WaJobInMemoryAccessors").getJobInMemoryAccessors();this.offlineQueueMode=!0;this.$1=g;a.offlineQueueCompletePromise!=null?a.offlineQueueCompletePromise.finally(function(){b.offlineQueueMode=!1}):this.offlineQueueMode=!1;this.initialJobsPromise=f.then(function(a){var c=[],e=[];a.forEach(function(a){a.stepHardStartCountAfterTimeout>=5?c.push(a):e.push(a)});return Promise.all(c.map(function(a){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["",": stuck on the step ",", aborting the job"])),Q(a),a.step).devConsole(P(a)).sendLogs("job-stuck-"+a.type);return b.accessors.deletePersistedJob(a.jobId)})).then(function(){e.forEach(function(a){var c=b.$2(a.jobId);if(c.alreadyActive===!0){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[JOB MANAGER] Restarting job with the same id"])));return}c.deferred.resolve(N({code:function(c){return b.$3(a,b.accessors,{eventFlow:c})},annotations:{string:{name:a.type},bool:{offlineQueueMode:b.offlineQueueMode}}}))})})})}var b=a.prototype;b.$4=async function(a,b,e){var f;e===void 0&&(e={});var g=this.$2(a);(f=e.eventFlow)==null||f.addPoint("start_load_and_run",{bool:{skipped:g.alreadyActive}});if(g.alreadyActive===!0)return g.deferred;f=await b.readPersistedJob(a);if(f==null){d("WALogger").ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Persisted job missing for given ID"]))).sendLogs("missing-job-entry");throw c("err")("Persisted job missing for given ID "+a)}g.deferred.resolve(this.$3(f,b,e));return g.deferred.promise};b.$3=function(a,b,c){var e;c===void 0&&(c={});(e=c.eventFlow)==null||e.addPoint("enqueueing_job",{string:{name:a.type}});return this.getOrchestratorDelegate(((e=a.scheduleConfig)==null?void 0:e.priority)===d("WAJobOrchestratorTypes").JOB_PRIORITY.SKIP,c.eventFlow).enqueue(a.type,this.$5(a,b,c),a.scheduleConfig,c.eventFlow)};b.$6=function(a,b,c){var d=this;c===void 0&&(c={});return b.maybeCreateJob(a).then(function(a){var e;a=a.id;(e=c.eventFlow)==null||e.addPoint("job_persisted",{int:{jobId:a},bool:{nonPersisted:b===d.inMemoryAccessors}});return a})};b.$2=function(a){var b=this.activeJobs.get(a);if(b!=null)return{alreadyActive:!0,deferred:b};b=new(d("WAResolvable").Resolvable)();this.activeJobs.set(a,b.promise);return{alreadyActive:!1,deferred:b}};b.$5=function(a,b,c){var d=this;return function(){return d.$7(a,b,c)}};b.$8=function(a){var b=this.implementations,c=this.implementationLoaders,d=b.get(a);if(d)return d;d=c.get(a);if(!d)return null;c=d();b.set(a,c);return c};b.$9=function(a,b){if(b==null||b.length===0)return Promise.resolve();var c=this.stepBlockers,e=c.get(b);e==null&&(e=d("WAJobRequirement").joinRequirements(b.map(function(a){return a()}),S),c.set(b,e));return e(a)};b.$10=function(a,b,c,e,f){var g,h=this;f===void 0&&(f={});var i=a.step;(g=f.eventFlow)==null||g.addPoint("start_step");var j=b.findIndex(function(a){return a.stepName===i});g=b[j].info(a.current,a.original,T(a,this.isRestartAfterCrash));var m=g.requirements,n=g.code;g=this.$9(a,m);e&&(g=g.then(e));return g.then(function(){var b;d("WALogger").LOG(k||(k=babelHelpers.taggedTemplateLiteralLoose(["",": running step"])),R(a));(b=f.eventFlow)==null||b.addPoint("run_step");return n(a.current,a.original,T(a,h.isRestartAfterCrash,f.eventFlow))}).then(function(e){var g;(g=f.eventFlow)==null||g.addPoint("step_is_complete");if(e instanceof d("WAPersistedJobManager").InterruptJob){d("WALogger").LOG(l||(l=babelHelpers.taggedTemplateLiteralLoose(["",": InterruptJob"])),R(a));return e.result}g=j+1;if(g>=b.length)return e;g=b[g];a.step=g.stepName;a.current=e;a.stepHardStartCountAfterTimeout=0;a.stepFirstStartTime=d("WATimeUtils").unixTime();a.stepUnexpectedErrorCount=0;a.waitUntil=null;a.backedOffCount=0;return c.updatePersistedJob(a).then(function(){return h.$10(a,b,c,void 0,f)})})};b.$7=async function(a,b,c){var e,f=this;c===void 0&&(c={});var g=this.activeJobs,h=this.deprecatedJobs,i=this.listeners,j=i.onJobFinished;i=i.onJobStarted;(e=c.eventFlow)==null||e.addPoint("run_job");e=await this.$8(a.type);h=h[a.type];if(!e){if(!h){d("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["No implementation for ",". Maybe it should have been put to the deprecated list?"])),a.type).sendLogs("missing-job-implementation");await b.deletePersistedJob(a.jobId);return null}else if(h==="NOOP"){d("WALogger").WARN(n||(n=babelHelpers.taggedTemplateLiteralLoose(["No implementation for deprecated ",", job deleted"])),a.type);await b.deletePersistedJob(a.jobId);return null}e=await h()}var k=e;h&&d("WALogger").LOG(o||(o=babelHelpers.taggedTemplateLiteralLoose(["Running deprecated job ",""])),a.type);var l=(h=a.stepFirstStartTime)!=null?h:d("WATimeUtils").unixTime();a.stepFirstStartTime=l;a.stepUnexpectedErrorCount=a.stepUnexpectedErrorCount||0;a.backedOffCount=a.backedOffCount||0;if(a.step===d("WAPersistedJobManager").FINISHED_JOB){h=a.waitUntil;var C=d("WATimeUtils").secondsUntil(l);h!=null&&d("WATimeUtils").isInFuture(h)&&C>0&&(d("WALogger").LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["",": skew detected, adjusting accordingly"])),P(a)),h=d("WATimeUtils").castToUnixTime(h-C),d("WATimeUtils").isInFuture(h)&&(a.stepFirstStartTime=d("WATimeUtils").castToUnixTime(l-C),a.waitUntil=h,await b.updatePersistedJob(a)));(h==null||!d("WATimeUtils").isInFuture(h))&&(d("WALogger").LOG(q||(q=babelHelpers.taggedTemplateLiteralLoose(["",": removing completed, expired job from db"])),P(a)),await b.deletePersistedJob(a.jobId));g.delete(a.jobId);return a.current}C=a.step!==d("WAPersistedJobManager").UNSTARTED_JOB?e.find(function(b){return b.stepName===a.step}):e[0];if(!C){d("WALogger").ERROR(r||(r=babelHelpers.taggedTemplateLiteralLoose(["No implementation for ",".",""])),a.type,a.step).sendLogs("missing-job-step");await b.deletePersistedJob(a.jobId);return null}a.step=C.stepName;var D=function(){var e=a.waitUntil,g=Promise.resolve();if(e!=null){var h=d("WATimeUtils").futureUnixTime(d("WATimeUtils").DAY_SECONDS);e>h?(d("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["",": trim wait from "," to ",""])),R(a),e,h),a.waitUntil=h,g=b.updatePersistedJob(a).then(function(){return d("WATimeUtils").delayUntil(h)})):(d("WALogger").LOG(t||(t=babelHelpers.taggedTemplateLiteralLoose(["",": delaying until ",""])),R(a),e),g=d("WATimeUtils").delayUntil(e))}return g.then(function(){var e=function(){a.waitUntil=null;d("WATimeUtils").happenedWithin(l,d("WATimeUtils").DAY_SECONDS)||a.stepHardStartCountAfterTimeout++;return b.updatePersistedJob(a)};return f.$10(a,k,b,e,c).catch(function(e){if(e instanceof d("WAPersistedJobManager").RetryOnBackoff){var f;d("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["",": RetryOnBackoff"])),R(a));(f=c.eventFlow)==null||f.addPoint("retry_on_backoff");f=d("WAPromiseBackoffs").getDelay(++a.backedOffCount,e.backoffOptions);a.waitUntil=d("WATimeUtils").futureUnixTime(Math.ceil(f/1e3));a.stepHardStartCountAfterTimeout>0&&--a.stepHardStartCountAfterTimeout;return b.updatePersistedJob(a).then(D)}else{if(!(e instanceof d("WAPersistedJobManager").NonRetryableError)&&a.stepUnexpectedErrorCount<M){(f=c.eventFlow)==null||f.addPoint("retry_on_unexpected_error");d("WALogger").WARN(v||(v=babelHelpers.taggedTemplateLiteralLoose(["",": Unhandled exception. Tried "," times"])),R(a),a.stepUnexpectedErrorCount);d("WALogger").WARN(w||(w=babelHelpers.taggedTemplateLiteralLoose(["",": Unhandled exception: ",""])),R(a),e);a.stepUnexpectedErrorCount++;return b.updatePersistedJob(a).then(D)}throw e}})})},E=D();h=E.then(async function(c){d("WALogger").LOG(x||(x=babelHelpers.taggedTemplateLiteralLoose(["",": finished job"])),R(a));var e=null;try{e=j(a.jobId,a.type,a.original,c)}catch(b){d("WALogger").ERROR(y||(y=babelHelpers.taggedTemplateLiteralLoose(["onJobFinished for "," threw exception ",""])),a.type,b).sendLogs("onJobFinished-threw")}e!=null&&e>0?(a.waitUntil=d("WATimeUtils").futureUnixTime(Math.ceil(e/1e3)),a.step=d("WAPersistedJobManager").FINISHED_JOB,a.current=c,a.stepFirstStartTime=d("WATimeUtils").unixTime(),await b.updatePersistedJob(a)):(await b.deletePersistedJob(a.jobId),g.delete(a.jobId))},async function(c){d("WALogger").ERROR(z||(z=babelHelpers.taggedTemplateLiteralLoose([""," failed with error ",""])),a.type,c).sendLogs("job-threw-exception-"+a.type);c=k.find(function(b){return b.stepName===a.step});if(!c)d("WALogger").ERROR(A||(A=babelHelpers.taggedTemplateLiteralLoose(["",": "," step not found"])),a.type,a.step);else{c=c.info(a.current,a.original,T(a,f.isRestartAfterCrash));c.stopRetryIf!=null&&await c.stopRetryIf.onStopRetry(a.current,a.original,T(a,f.isRestartAfterCrash))}await b.deletePersistedJob(a.jobId);g.delete(a.jobId)});try{i(a.jobId,a.type,a.original)}catch(b){d("WALogger").ERROR(B||(B=babelHelpers.taggedTemplateLiteralLoose(["onJobStarted for "," threw exception ",""])),a.type,b).sendLogs("onJobStarted-threw")}return h.then(function(){return E})};b.addPersistedJobImplementation=function(a,b){var c=this.implementationLoaders,e=this.deprecatedJobs;if(c.has(a)){d("WALogger").ERROR(C||(C=babelHelpers.taggedTemplateLiteralLoose(["addPersistedJobImplementation called twice for ",""])),a).sendLogs("repeat-job-loader");return}e&&e[a]&&d("WALogger").DEV(D||(D=babelHelpers.taggedTemplateLiteralLoose([""," has been loaded and is marked as deprecated"])),a);c.set(a,b)};b.fireAndForget=function(a){var b=this;if(this.$1.indexOf(a.type)===-1){d("WALogger").LOG(E||(E=babelHelpers.taggedTemplateLiteralLoose(["",": running in forced non-persisted mode"])),a.type);this.fireAndForgetNonPersisted(a);return}d("WALogger").LOG(F||(F=babelHelpers.taggedTemplateLiteralLoose(["",": running in persisted mode"])),a.type);N({code:async function(c){var d={eventFlow:c};await b.initialJobsPromise;c.addPoint("initial_jobs_promise_fulfilled");return b.$6(a,b.accessors,d).then(function(a){return b.$4(a,b.accessors,d)})},annotations:{string:{name:a.type},bool:{offlineQueueMode:this.offlineQueueMode}}})};b.waitUntilPersisted=async function(a){var b=this;if(this.$1.indexOf(a.type)===-1){d("WALogger").LOG(G||(G=babelHelpers.taggedTemplateLiteralLoose(["",": running in forced non-persisted mode"])),a.type);this.fireAndForgetNonPersisted(a);return Promise.resolve()}d("WALogger").LOG(H||(H=babelHelpers.taggedTemplateLiteralLoose(["",": running in persisted mode"])),a.type);var c=O({string:{name:a.type},bool:{offlineQueueMode:this.offlineQueueMode}});await this.initialJobsPromise;c.addPoint("initial_jobs_promise_fulfilled");return this.$6(a,this.accessors,{eventFlow:c}).then(function(a){N({code:function(c){c={eventFlow:c};return b.$4(a,b.accessors,c)},eventFlow:c})}).catch(function(a){c.endFail("error",{string:{error:""+a}});throw a})};b.waitUntilCompleted=function(a){var b=this;if(this.$1.indexOf(a.type)===-1){d("WALogger").LOG(I||(I=babelHelpers.taggedTemplateLiteralLoose(["",": running in forced non-persisted mode"])),a.type);return this.waitUntilCompletedNonPersisted(a)}d("WALogger").LOG(J||(J=babelHelpers.taggedTemplateLiteralLoose(["",": running in persisted mode"])),a.type);return N({code:async function(c){var d={eventFlow:c};await b.initialJobsPromise;c.addPoint("initial_jobs_promise_fulfilled");return b.$6(a,b.accessors,d).then(function(a){return b.$4(a,b.accessors,d)})},annotations:{string:{name:a.type},bool:{offlineQueueMode:this.offlineQueueMode}}})};b.fireAndForgetNonPersisted=function(a){var b=this;N({code:async function(c){var d={eventFlow:c};await b.initialJobsPromise;c.addPoint("initial_jobs_promise_fulfilled");return b.$6(a,b.inMemoryAccessors,d).then(function(a){return b.$4(a,b.inMemoryAccessors,d)})},annotations:{string:{name:a.type},bool:{offlineQueueMode:this.offlineQueueMode}}})};b.waitUntilCompletedNonPersisted=function(a){var b=this;return N({code:async function(c){var d={eventFlow:c};await b.initialJobsPromise;c.addPoint("initial_jobs_promise_fulfilled");return b.$6(a,b.inMemoryAccessors,d).then(function(a){return b.$4(a,b.inMemoryAccessors,d)})},annotations:{string:{name:a.type},bool:{offlineQueueMode:this.offlineQueueMode}}})};return a}();function P(a){return"Job["+a.jobId+"] ("+a.type+")"}function Q(a){return"[Job "+a.type+"] "}function R(a){return"Job["+a.jobId+"] ("+a.type+"."+a.step+")"}function S(a,b,c){a==="unsatisfiable"?d("WALogger").LOG(K||(K=babelHelpers.taggedTemplateLiteralLoose([""," halting because of ",""])),R(c),b):a==="unsatisfied"?d("WALogger").LOG(L||(L=babelHelpers.taggedTemplateLiteralLoose([""," waiting on ",""])),R(c),b):a}function T(a,b,c){b===void 0&&(b=!1);return{jobStartTime:a.startTime,afterCrash:b,interruptJob:U,eventFlow:c}}function U(a){return new(d("WAPersistedJobManager").InterruptJob)(a)}g.PersistedJobManager=a}),98);
__d("WAWaitForComms",["WACommsConnectionState","WAResolvable"],(function(a,b,c,d,e,f,g){"use strict";var h=new(d("WAResolvable").Resolvable)();function a(){return h.promise}function b(){d("WACommsConnectionState").WACommsConnectionState.set(!1),h.isSettled&&(h=new(d("WAResolvable").Resolvable)())}function c(){d("WACommsConnectionState").WACommsConnectionState.set(!0),h.resolve()}function e(){return!h.resolveWasCalled()}function f(a){return h.reject(a)}g.waitForComms=a;g.commsConnectionLost=b;g.unblockComms=c;g.isStillWaitingForComms=e;g.failComms=f}),98);
__d("MAWJobManager",["MAWBridge","MAWDefinePersistedJob","MAWJobPersistenceAccessorsApi","WAPersistedJobManagerV2","WAWaitForComms","WAWaitForUserUnblocked","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h=new(d("WAPersistedJobManagerV2").PersistedJobManager)({accessors:d("MAWJobPersistenceAccessorsApi").getJobPersistenceAccessors(),deprecatedJobs:{removeCurrentDevice:"NOOP"},ignoreForceNonPersistedJobList:["sendMsg","sendBumpMsg","sendReactionMsg","sendMediaMsg","sendWrittenMsg","downloadAndHandleMedia"],isRestartAfterCrash:!1,listeners:{onJobFinished:function(a,b,c,e){d("MAWBridge").getBridge().fireAndForget("event","onJobFinished",{id:a,originalArgs:c,result:e,type:b},!0);return null},onJobStarted:c("emptyFunction")},offlineQueueCompletePromise:d("WAWaitForUserUnblocked").waitForUserUnblocked(),unfinishedJobEntries:d("WAWaitForComms").waitForComms().then(function(){return d("MAWJobPersistenceAccessorsApi").getJobPersistenceAccessors().loadAllJobs()})});function a(){return d("MAWDefinePersistedJob").persistedJobsApi}function b(){return h}g.getPersistedJobsApi=a;g.getJobManager=b}),98);
__d("WAJobBuilder",["Promise","WAPersistedJobManager","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h,i=function(){function a(a){this.steps=a}var b=a.prototype;b.step=function(a,b){return this.$1(a,typeof b==="function"?{code:b}:b)};b.$1=function(b,c){var e=c.stopRetryIf,f=c.requirements;c=c.code;f=k(f,c,e);if(e){var g=e.timePassedSeconds;c=e.appCrashed;var h=e.onStopRetry;h=k(null,l(h),e);g!=null&&(f=j(function(a,b,c){a=c.jobStartTime;return d("WATimeUtils").happenedWithin(a,g)},f,h));c&&(f=j(function(a,b,c){a=c.afterCrash;return!a},f,h))}return new a([].concat(this.steps,[{stepName:b,info:f}]))};b.finalStep=function(a,b){var c=this.step(a,b);return{end:function(){return c.steps}}};return a}();function a(){return new i([])}function j(a,b,c){return function(d,e,f){return a(d,e,f)?b(d,e,f):c(d,e,f)}}function k(a,b,c){var d={requirements:a,code:b,stopRetryIf:c};return function(){return d}}function l(a){return function(c,e,f){return(h||(h=b("Promise"))).resolve(a(c,e,f)).then(function(a){return a instanceof d("WAPersistedJobManager").InterruptJob?a:new(d("WAPersistedJobManager").InterruptJob)(a)})}}g.JobBuilder=i;g.definePersistedJob=a}),98);
__d("MAWDefinePersistedJob",["MAWJobManager","Promise","WAJobBuilder"],(function(a,b,c,d,e,f,g){"use strict";var h;e={definePersistedJob:function(){return d("WAJobBuilder").definePersistedJob()}};function a(a){var c=d("MAWJobManager").getJobManager();Object.keys(a).forEach(function(d){var e=a[d];c.addPersistedJobImplementation(d,function(){return(h||(h=b("Promise"))).resolve(e)})})}function c(a){var b=d("MAWJobManager").getJobManager();Object.keys(a).forEach(function(c){var d=a[c];b.addPersistedJobImplementation(c,d)})}g.persistedJobsApi=e;g.setMsgrJobImplementations=a;g.setMsgrDeferredJobImplementations=c}),98);
__d("MAWMediaDownloadStatusForUI",["MAWBridge","MAWLoggerUtils","MAWMediaDownloadStatus","MWFBLogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i=d("MWFBLogger").MWMediaLogger.tags([d("MAWLoggerUtils").Tag.MediaDownload,d("MAWLoggerUtils").Tag.MessageReceive]);function a(a){var b=a.details,c=a.hash,d=a.status,e=a.type;a=a.validationResult;j({details:b,hash:c,status:d,type:e,validationResult:a})}function j(a){var b=a.details,c=a.hash,e=a.status,f=a.type;a=a.validationResult;d("MAWBridge").getBridge().fireAndForget("event","updateMediaStatus",{details:b,key:c,status:e,type:f,validationResult:a})}function b(a){switch(a){case"disconnected":case"backoff":case"body-network-error":case"no-host":case"download-throttled":case"max-attempts-exceeded":case"runtime-error":case"access-expired":case"http-fetch-exception":case"http-fetch-aborted":case"unspecified-http-error":case"server-timeout":return c("MAWMediaDownloadStatus").MANUAL_RETRYABLE_FAILURE;case"request-error":case"media-not-found":case"media-entry-invalid":case"media-entry-invalid-direct-path":case"media-entry-invalid-file-enc-sha256":case"media-entry-invalid-file-sha256":case"media-entry-invalid-media-key":case"media-entry-invalid-server-media-type":case"decryption-error":case"enc-hash-mismatch":case"hash-mismatch":case"ciphertext-hash-mismatch":case"signature-expired":return c("MAWMediaDownloadStatus").NOT_MANUAL_RETRYABLE_FAILURE;default:a;i.MUSTFIX(h||(h=babelHelpers.taggedTemplateLiteralLoose(["getStatusTypeFromWAAPIDownloadMediaError: Unknown error type ",""])),String(a));return c("MAWMediaDownloadStatus").MANUAL_RETRYABLE_FAILURE}}g.sendMediaDownloadStatusToUI=a;g.getStatusFromWAAPIDownloadMediaError=b}),98);
__d("MAWMediaRetryInfo",[],(function(a,b,c,d,e,f){"use strict";var g=new Map();function a(a,b){g.set(a,b)}function b(a){return g.get(a)}function c(a){g.has(a)&&g["delete"](a)}f.setRetriedMediaInfo=a;f.getRetriedMediaInfo=b;f.clearRetriedMediaInfo=c}),66);
__d("WAAPI",["cr:21048"],(function(a,b,c,d,e,f,g){"use strict";g["default"]=b("cr:21048")}),98);
__d("WAGetAgeBucketForMediaKeyTimestamp",["WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){if(a==null)return"Missing";if(d("WATimeUtils").isInFuture(a))switch(!0){case d("WATimeUtils").happenedWithin(a,1*d("WATimeUtils").DAY_SECONDS):return"< 1 day in future";case d("WATimeUtils").happenedWithin(a,7*d("WATimeUtils").DAY_SECONDS):return"1-7 days in future";default:return"> 7 days in future"}switch(!0){case d("WATimeUtils").happenedWithin(a,1*d("WATimeUtils").DAY_SECONDS):return"< 1 day";case d("WATimeUtils").happenedWithin(a,7*d("WATimeUtils").DAY_SECONDS):return"1-7 days";case d("WATimeUtils").happenedWithin(a,14*d("WATimeUtils").DAY_SECONDS):return"7-14 days";case d("WATimeUtils").happenedWithin(a,21*d("WATimeUtils").DAY_SECONDS):return"14-21 days";case d("WATimeUtils").happenedWithin(a,30*d("WATimeUtils").DAY_SECONDS):return"21-30 days";case d("WATimeUtils").happenedWithin(a,40*d("WATimeUtils").DAY_SECONDS):return"30-40 days";case d("WATimeUtils").happenedWithin(a,50*d("WATimeUtils").DAY_SECONDS):return"40-50 days";case d("WATimeUtils").happenedWithin(a,60*d("WATimeUtils").DAY_SECONDS):return"50-60 days";default:return"> 60 days"}}g.getAgeBucketForMediaKeyTimestamp=a}),98);
__d("WAIsMediaExpiredError",[],(function(a,b,c,d,e,f){"use strict";a=function(a){switch(a){case"signature-expired":return!0;case"hash-mismatch":case"ciphertext-hash-mismatch":case"enc-hash-mismatch":case"decryption-error":case"max-attempts-exceeded":case"request-error":case"download-throttled":case"media-not-found":case"media-entry-invalid":case"media-entry-invalid-direct-path":case"media-entry-invalid-file-enc-sha256":case"media-entry-invalid-file-sha256":case"media-entry-invalid-media-key":case"media-entry-invalid-server-media-type":case"no-host":case"backoff":case"body-network-error":case"disconnected":case"runtime-error":case"access-expired":case"http-fetch-exception":case"http-fetch-aborted":case"unspecified-http-error":case"server-timeout":case"missing-expected-hmacs":case"hmac-chiphertext-array-mismatch":return!1;default:a;return!0}};f.isMediaExpiredError=a}),66);
__d("WAStartMediaDownloadQplFlow",["WAGetPlatformFromStanzaId","WAGetStorageQplAnnotations","WAJids","WAMediaUtils","WAPREList","WAPREMetrics"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.downloadEntry,c=a.msgType,e=a.triggerUIView,f=a.protocolMsgId,g=a.isPreview;a=a.xmaMediaType;var h=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.MEDIA_DOWNLOAD,{bool:{isTransformStreamSupported:d("WAMediaUtils").isTransformStreamSupported()},string:{chat_type:f==null?null:d("WAJids").switchOnMsgrChatJidType(f.chat,{group:function(){return"group"},user:function(){return"user"}}),downloadEntry:g===!0?b+"-preview":b,e2eePlatform:f==null?null:d("WAGetPlatformFromStanzaId").getPlatformFromStanzaId(f.externalId),msgType:c,trigger_ui_view:e,xmaMediaType:a!=null?a:void 0}},void 0,d("WAPREMetrics").QPL_MEDIA_DOWNLOAD_TIMEOUT_IN_MS);void d("WAGetStorageQplAnnotations").getStorageQplAnnotations().then(function(a){h.addAnnotations(a)});return babelHelpers["extends"]({},h,{downloadEntry:b,triggerUIView:e})}g.startMediaDownloadQplFlow=a}),98);
__d("MAWHandleEchoMediaMsgsRestoreV2",["EBLogger","EchoMessage","EchoMessageMediaFieldUtils","LSMEBTaskCreationSource","MAWAsConsumerApplication","MAWBridge","MAWBridgeTypesCreators","MAWCastToMsgrServerMediaType","MAWConfig","MAWDbChunkTxns","MAWDbMediaTxns","MAWDbMsg","MAWDbMsgTxns","MAWFrontendMediaUtils","MAWGetMsgForProtocolMsgIdTxn","MAWHandleMediaDownloadApi","MAWIndexedDb","MAWJids","MAWJobDefinitions","MAWJobManager","MAWMediaDownloadStatus","MAWMediaDownloadStatusForUI","MAWMediaManagementTxns","MAWMediaRetryInfo","MAWMediaUtils","MAWSupportedDocumentTypes","MAWTransactionMode","WAAPI","WAArmadilloXMA.pb","WABase64","WAGetAgeBucketForMediaKeyTimestamp","WAGetStorageQplAnnotations","WAHashUtils","WAIsMediaExpiredError","WAJids","WAJobOrchestratorTypes","WAMediaUtils","WAStartMediaDownloadQplFlow","WATimeUtils","cr:10071","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O=d("EBLogger").EBLogger.tags(["restore"]);function P(a){var b=S(a);return b.then(function(b){var c=new Map();a.forEach(function(a){var d=b.get(a);d=d==null?void 0:d.blobData;c.set(a,d)});return Promise.resolve(c)})}function Q(a){switch(a){case d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.IMAGE_JPEG:return"image/jpeg";case d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.IMAGE_PNG:return"image/png";case d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.STICKER:return"image/webp";case d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.GIF:return"image/gif";case d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.AUDIO_MP4:return"audio/mp4";case d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.AUDIO_WAV:return"audio/wav";case d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.XMA:return"xma"}}async function a(a,b,e){if(a.length===0)return Promise.resolve();var f=[],g=[],v=new Map(),w=new Map();a.map(function(a){var b=a.mediaData,c=a.messageTimestamp,e=U(b.plaintextHash),r=b.attachmentObjectId,s=b.attachmentType,t=b.backupEntFbid,u=b.directPath,x=b.filename,y=b.height,z=b.mediaContentType,A=b.mediaKeyTimestamp,B=b.mediaPlayableDuration,C=b.previewContentHeight,D=b.previewContentType,E=b.previewContentWidth,F=b.size;b=b.width;var G=d("WAHashUtils").stringToPlaintextHash(e),H=d("MAWMediaUtils").genHMACPlaintextHash(G);g.push(H);z=z!=null?d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(z,a.isXMA):D!=null?d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(Q(D)):null;if(z==null){O.DEBUG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Cannot download media - media content type null, msg id: ",""])),a.externalId);O.MUSTFIX(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Cannot download media - media content type null"])));return Promise.resolve()}if(s===d("EchoMessageMediaFieldUtils").AttachmentType.DOCUMENT&&!d("MAWSupportedDocumentTypes").isAllowedType(x)){O.DEBUG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Cannot download media - document extension is disallowed, msg id: ",""])),a.externalId);return Promise.resolve()}D=a.mediaData.encryptedHash;if(D==null){O.DEBUG(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Encrypted hash cannot be null, msg id: ",""])),a.externalId);O.MUSTFIX(l||(l=babelHelpers.taggedTemplateLiteralLoose(["Encrypted hash cannot be null"])));return Promise.resolve()}s=a.mediaData.mediaKey;if(s==null){O.DEBUG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Media key cannot be null, msg id: ",""])),a.externalId);O.MUSTFIX(n||(n=babelHelpers.taggedTemplateLiteralLoose(["Media key cannot be null"])));return Promise.resolve()}var I=z.mediaType;z=z.serverMediaType;r=d("WAMediaUtils").stringToDeliveryObjectId(r);t=t!=null?d("WAMediaUtils").stringToBackupEntFbid(t):void 0;var J=a.threadJId,K=V({filename:x,height:y,mediaPlayableDuration:B,mediaType:I,previewContentHeight:C,previewContentWidth:E,width:b});w.set(r,{filename:x,height:y,mediaPlayableDuration:B,mediaType:I,messageTimestamp:c,plaintextHash:G,previewContentHeight:C,previewContentWidth:E,serverMediaType:z,threadJId:J,width:b});y=null;if(a.previewMediaData!=null)try{y=X(a.previewMediaData),y!=null&&y.objectId==null&&O.MUSTFIX(o||(o=babelHelpers.taggedTemplateLiteralLoose(["downloadableThumbnail was created without metadata, source: echo"])))}catch(b){O.catching(b).DEBUG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Unable to construct downloadableThumbnail from previewMediaData, msg id: ",""])),a.externalId),O.catching(b).MUSTFIX(q||(q=babelHelpers.taggedTemplateLiteralLoose(["Unable to construct downloadableThumbnail from previewMediaData"])))}if(D!=null){B=W(e,D,s,u,A,z,x,t,r,y,F);f.push({entry:B,fbId:t,hashedPlaintextHash:H,isXMAShare:a.isXMA,mediaInfo:K,mediaType:I,msgId:a.msgId,objectId:r,plaintextHash:G,size:F!=null?F:0})}C=(c=v.get(H))!=null?c:[];C.push(a);v.set(H,C)});a=e!==c("LSMEBTaskCreationSource").MEDIA_GALLERY_RESTORE;var x=await R(f,b,a);a=await P(g);var y=[];a.forEach(function(a,g){var h=v.get(g);h==null||h.forEach(function(h){if(h==null)return;if(a!=null){O.DEBUG(r||(r=babelHelpers.taggedTemplateLiteralLoose(["media for message: "," is already downloaded on the device"])),h.externalId);var i=x.find(function(a){return a.plaintextHash===h.mediaData.plaintextHash});if(i==null){O.DEBUG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Cannot find the media entry for message with mediaKey ",""])),h.mediaData.mediaKey);return}return T(i.msgIds).then(function(a){a=a.filter(function(a){return d("MAWDbMsg").isMediaMsg(a)});if(a.length>0){var c=d("MAWMediaUtils").createHdTypesForBridgeMedia(a);c=d("MAWBridgeTypesCreators").createBridgeMedia({chatJid:h.threadJId,filteredMsgIds:d("MAWBridgeTypesCreators").getMsgIdsFilteredByJid(a,b),hasMediaForUI:!0,hdTypes:c,media:i,transportKey:"EncryptedBackups"});c=d("MAWMediaUtils").annotateBridgeMediaForDisplay(c,a);d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"NewMedia",value:c}]})}})}var j=w.get(d("WAMediaUtils").stringToDeliveryObjectId(h.mediaData.attachmentObjectId));if(h==null||j==null)return;var k=j.filename,l=j.height,m=j.mediaPlayableDuration,n=j.mediaType,o=j.messageTimestamp,p=j.plaintextHash,q=j.previewContentHeight,v=j.previewContentWidth,z=j.serverMediaType,A=j.threadJId;j=j.width;var B=d("WAJids").extractUserId(d("MAWJids").toUserJid(h.threadJId));z=d("MAWCastToMsgrServerMediaType").castToMsgrServerMediaType(z,h.isXMA);if(z!=null){z={attachmentObjectId:d("WAMediaUtils").stringToDeliveryObjectId(h.mediaData.attachmentObjectId),mediaType:z,messageId:h.externalId,messageTimeStamp:h.messageTimestamp,msgId:h.msgId,plaintextHash:p,productType:d("MAWConfig").getConfig().productTypeForEBAttachments,threadId:B,threadJid:A};B=f.find(function(a){return a.hashedPlaintextHash===g});B=B==null?void 0:B.entry;if(B==null){O.DEBUG(t||(t=babelHelpers.taggedTemplateLiteralLoose(["Cannot find the media entry for message, plaintextHash: ",", msg id: ",""])),d("WAHashUtils").sanitisePlaintextHash(d("WAHashUtils").stringToPlaintextHash(h.mediaData.plaintextHash)),h.externalId);O.MUSTFIX(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Cannot find the media entry for message"])));return}if(e===c("LSMEBTaskCreationSource").MEDIA_GALLERY_RESTORE)return;var C=d("WAStartMediaDownloadQplFlow").startMediaDownloadQplFlow({downloadEntry:"handleEchoMediaMsgsRestore",msgType:null,protocolMsgId:{author:h.author,chat:h.threadJId,externalId:h.externalId},triggerUIView:null});y.push(Y({author:h.author,directPath:h.mediaData.directPath,echoMsg:h.echoMsg,externalId:h.externalId,filename:k,hashedPlaintextHash:g,height:l,isXMA:h.isXMA,mediaPlayableDuration:m,mediaType:n,messageTimestamp:o,plaintextHash:p,previewContentHeight:q,previewContentWidth:v,threadJId:A,width:j},void 0,z,void 0,d("WAMediaUtils").decodeMediaEntryData(B),C))}})});await Promise.all(y)}var R=(e=d("MAWIndexedDb")).makeMsgrTransactor({media:(f=d("MAWTransactionMode")).READWRITE,mediaBackup:f.READWRITE,messages:f.READWRITE},"restoreLinkMedias",function(a){return function(b,c,e){return d("MAWMediaManagementTxns").bulkLinkMedia(a,b,c,"EncryptedBackups",e)}}),S=e.makeMsgrTransactor({chunk:f.READONLY},"getChunksByHash",function(a){return function(b){return d("MAWDbChunkTxns").maybeBulkGetChunksFromHash(a,b)}}),T=e.makeMsgrTransactor({messages:f.READONLY},"getMessagesForMsgIds",function(a){return function(b){return a.messages.where("msgId").anyOf(b).toArray()}});function U(a){if(a.endsWith("=")){var b="";for(var c=0;c<a.length;c++){var d=a.charAt(c);if(d==="=")return b;b+=d}}return a}function V(a){var b=a.height,c=a.mediaType,e=a.width,f=a.previewContentHeight,g=a.previewContentWidth,h=a.mediaPlayableDuration;a=a.filename;return{validatedAudioInfo:c==="Ptt"&&h!=null?{duration:ba(h),mimetype:d("MAWAsConsumerApplication").AUDIO_WAV_MIME_TYPE,played:!1}:null,validatedDocumentFileInfo:c==="DocumentFile"?{filename:a,mimetype:d("MAWAsConsumerApplication").FILE_MIME_TYPE}:null,validatedImageInfo:c==="Image"?{height:b,jpegThumbnailHeight:f,jpegThumbnailWidth:g,width:e}:c==="Gif"||c==="Sticker"?{height:b,jpegThumbnailHeight:b,jpegThumbnailWidth:e,width:e}:null,validatedVideoInfo:c==="Video"?{duration:h,height:b,jpegThumbnailHeight:f,jpegThumbnailWidth:g,mimetype:d("MAWAsConsumerApplication").VIDEO_MIME_TYPE,width:e}:null}}function W(a,b,c,e,f,g,h,i,j,k,l){a=d("WABase64").decodeB64UrlSafe(a,!0);b=d("WABase64").decodeB64UrlSafe(b,!0);c=d("WABase64").decodeB64UrlSafe(c,!0);return d("WAMediaUtils").rawDataToMediaEntry({directPath:e,downloadableThumbnail:k!=null?k:void 0,fbid:i!=null?i:void 0,fileEncSha256:b,filename:h,fileSha256:a,mediaKey:c,mediaKeyTimestamp:f!=null?d("WATimeUtils").castToUnixTime(f):void 0,objectId:j!=null?j:void 0,serverMediaType:g,size:l!=null?l:void 0})}function X(a){var b=a.attachmentObjectId,c=a.directPath,e=a.encryptedHash,f=a.mediaKey,g=a.mediaKeyTimestamp;a=a.plaintextHash;if(e==null){O.MUSTFIX(v||(v=babelHelpers.taggedTemplateLiteralLoose(["Encrypted hash is null - unable to download thumbnail"])));return}else{g=g!=null?d("WATimeUtils").castToUnixTime(g):void 0;f=f!=null?d("WAMediaUtils").castToMediaKey(d("WABase64").decodeB64UrlSafe(f,!0)):void 0;a=d("WABase64").decodeB64UrlSafe(a,!0);e=d("WABase64").decodeB64UrlSafe(e,!0);return{directPath:c,fileEncSha256:e,fileSha256:a,mediaKey:f,mediaKeyTimestamp:g,objectId:b}}}var Y=async function(a,b,e,f,g,h){var i;O.DEBUG(w||(w=babelHelpers.taggedTemplateLiteralLoose(["start media download from whatsapp infra. traceId: ",""])),b);var j=a.author,k=a.externalId,l=a.filename,m=a.hashedPlaintextHash,n=a.height,o=a.mediaPlayableDuration,p=a.mediaType,q=a.messageTimestamp,r=a.plaintextHash,s=a.previewContentHeight,t=a.previewContentWidth,u=a.threadJId,v=a.width;j={author:j,chat:u,externalId:k};var E=h!=null?h:d("WAStartMediaDownloadQplFlow").startMediaDownloadQplFlow({downloadEntry:"handleEchoMediaMsgsRestore",msgType:null,protocolMsgId:j,triggerUIView:null});d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({details:"handle_echo_media_msgs_restore",hash:r,status:c("MAWMediaDownloadStatus").DOWNLOADING,type:"main"});h=((h=(u=d("MAWMediaRetryInfo").getRetriedMediaInfo(k))==null?void 0:u.isXMA)!=null?h:!1)||((u=a==null?void 0:a.isXMA)!=null?u:!1);u=((u=d("MAWMediaRetryInfo").getRetriedMediaInfo(k))==null||(u=u.echoMsg)==null?void 0:u.serializationOrigin)||(a==null||(i=a.echoMsg)==null?void 0:i.serializationOrigin)||d("EchoMessage").EchoSerializationOriginType.UNKNOWN;var F=c("gkx")("23960");E.addPoint("download_media_start",{bool:{isEBDownloadEnforced:e==null&&F,isRetryFromMI:e==null,isXMA:h,pathMismatch:f!==g.directPath},int:{mediaEntrySize:g.size},string:{oldDirectPath:(h=a==null?void 0:a.oldDirectPath)!=null?h:"",origin:u,restorationCdnUrl:f!=null?f:""}});void d("WAGetStorageQplAnnotations").getStorageQplAnnotations().then(function(a){E.addAnnotations(a)});if(e!=null&&F){O.DEBUG(x||(x=babelHelpers.taggedTemplateLiteralLoose(["downloading media from MI directly. externalId ","."])),j.externalId);return $({decodedMediaEntry:g,isEBDownloadEnforced:F,mediaDownloadRequest:a,protocolMsgId:j,retryPayload:e})}h=d("WAMediaUtils").validateDecodedMediaEntryForDownload(g);if(!h.success){O.DEBUG(y||(y=babelHelpers.taggedTemplateLiteralLoose(["media entry validation failed. externalId ",". traceId: ",". error: ","."])),j.externalId,b,h.error);O.MUSTFIX(z||(z=babelHelpers.taggedTemplateLiteralLoose(["media entry validation failed. error: ","."])),h.error);E.endFail("download_media_fail",{string:{failReason:h.error}});return}u=await c("WAAPI").cachedDownloadFullMediaOnly({downloadMediaMetric:E,hash:r,mediaEntry:h.value});if(u.success){E.addPoint("download_media_end");F=u.value;h=F.mimeType;F=F.plaintext;await d("MAWHandleMediaDownloadApi").handleMediaDownload(r,h,F,j);d("MAWMediaRetryInfo").clearRetriedMediaInfo(k);h=V({filename:l,height:n,mediaPlayableDuration:o,mediaType:p,previewContentHeight:s,previewContentWidth:t,width:v});await aa(m,h);O.DEBUG(A||(A=babelHelpers.taggedTemplateLiteralLoose(["media download complete. externalId ",". traceId: ",""])),j.externalId,b);E.endSuccess();d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({details:"handle_echo_media_msgs_restore_success",hash:r,status:c("MAWMediaDownloadStatus").SUCCESS,type:"main"})}else{F=u.error;if(d("WAIsMediaExpiredError").isMediaExpiredError(F)&&e)E.addPoint("eb_resign_requested"),E.endSuccess(),O.WARN(B||(B=babelHelpers.taggedTemplateLiteralLoose(["Retry download media as signature has expired and should be renewed. externalId ",". traceId: ",""])),j.externalId,b),await $({decodedMediaEntry:g,isEBDownloadEnforced:!1,mediaDownloadRequest:a,protocolMsgId:j,retryPayload:e});else{O.DEBUG(C||(C=babelHelpers.taggedTemplateLiteralLoose(["media download failed with error: "," "," when downloading. Message timestamp: ",". traceId: ",""])),k,F,q,b);O.MUSTFIX(D||(D=babelHelpers.taggedTemplateLiteralLoose(["media download failed with error: ",""])),F);l={string:{directPath:g.directPath,error:"media_download_failure",restorationCdnUrl:f!=null?f:""}};E.endFail(F,l);d("MAWMediaRetryInfo").clearRetriedMediaInfo(k);d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({details:F,hash:r,status:d("MAWMediaDownloadStatusForUI").getStatusFromWAAPIDownloadMediaError(F),type:"main"})}}},Z=e.makeMsgrTransactor({media:f.READONLY,mediaBackup:f.READONLY,messages:f.READONLY},"invokeRestoreAccessCheckSprocToDownloadAttachment",function(a){return function(b,c,e){return d("MAWDbMediaTxns").maybeGetMediaFromPlaintextHash(a,c.plaintextHash).then(function(f){if(f){O.DEBUG(E||(E=babelHelpers.taggedTemplateLiteralLoose(["start resign cdn url through sproc"])));var g=da(f,c.attachmentObjectId);return d("MAWDbMsgTxns").getMsgsByMsgIds(a,g).then(function(a){var g,h=a.find(function(a){return a.externalId===b});e.addPoint("resign_cdn_url_bridge_call",{bool:{isForwarded:(g=h==null?void 0:h.isForwarded)!=null?g:!1},int:{duplicateMsgsCount:a.length,msgXMAType:h==null?void 0:h.xmaMessageType,totalMediaEntries:f.mediaEntries.size},int_array:{duplicateXMATypes:a.map(function(a){return(a=a.xmaMessageType)!=null?a:0})},string:{msgType:h==null?void 0:h.type},string_array:{duplicateMsgs:a.map(function(a){return a.externalId}),duplicateMsgTypes:a.map(function(a){return a.type})}});d("MAWIndexedDb").afterTransaction({tag:"ResignAttachmentCDNUrl",value:{deliveryObjectId:c.attachmentObjectId,mediaType:c.mediaType,messageId:b,msgId:c.msgId,plaintextHash:c.plaintextHash,productType:d("MAWConfig").getConfig().productTypeForEBAttachments,sortOrder:c.messageTimeStamp,threadId:c.threadId,threadJid:c.threadJid,traceId:e.getFlowDetails().instanceKey}})})}else O.DEBUG(F||(F=babelHelpers.taggedTemplateLiteralLoose(["media entry is missing from index db. It is required to retry download by resigning cdn url: externalId: ",". traceId: ",""])),b,e.getFlowDetails().instanceKey),O.MUSTFIX(G||(G=babelHelpers.taggedTemplateLiteralLoose(["media entry is missing from index db. It is required to retry download by resigning cdn url: externalId: ","."])),b),e.endFail("missing-media")})}}),aa=e.makeMsgrTransactor({media:f.READWRITE,messages:f.READWRITE},"updateMediaWithDownloadedChunkBlob",function(a){return function(b,c){return d("MAWMediaManagementTxns").updateMediaEntryWithValidatedMediaInfo(a,b,c)}});function ba(a){var b=Math.floor(a/1e3);if(b>0)return b;else return a}function ca(a){return a==null?!1:a===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_REPLY||a===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_MENTION}async function $(a){var c=a.decodedMediaEntry,e=a.isEBDownloadEnforced,f=a.mediaDownloadRequest,g=a.protocolMsgId,h=a.retryPayload;a=await d("MAWGetMsgForProtocolMsgIdTxn").getMsgForProtocolMsgIdTxn(g);if(a.success===!0&&ca(a.value.xmaMessageType)){O.DEBUG(H||(H=babelHelpers.taggedTemplateLiteralLoose(["Skipping media restore for expirable XMA. externalId ",". xmamessageType: ",""])),g.externalId,a.value.xmaMessageType);return Promise.resolve()}var i=g.externalId;d("MAWMediaRetryInfo").setRetriedMediaInfo(g.externalId,f);f=((a=c.mediaKeyTimestamp)!=null?a:0)>1725105600;a={bool:{is_after_S441705_fix:f,isEBDownloadEnforced:e},int:{mediaKeyTimestamp:c.mediaKeyTimestamp},string:{externalId:i,mediaKeyAge:d("WAGetAgeBucketForMediaKeyTimestamp").getAgeBucketForMediaKeyTimestamp(c.mediaKeyTimestamp),mediaType:h.mediaType,objectId:h.attachmentObjectId,restoreEntry:"EB",restoreMethod:b("cr:10071")==null?"sproc":"gql"}};var j=d("WAStartMediaDownloadQplFlow").startMediaDownloadQplFlow({downloadEntry:"handleEchoMediaMsgsRestore",msgType:null,protocolMsgId:g,triggerUIView:null});j.addAnnotations(a);O.DEBUG(I||(I=babelHelpers.taggedTemplateLiteralLoose(["start restore media from backup. hash: ",". msgId: ",". traceId: ",""])),d("WAHashUtils").sanitisePlaintextHash(h.plaintextHash),i,j.getFlowDetails().instanceKey);if(b("cr:10071")!=null){O.DEBUG(J||(J=babelHelpers.taggedTemplateLiteralLoose(["resign cdn url start [gql]. hash: ",". msgId: ",". traceId: ",""])),d("WAHashUtils").sanitisePlaintextHash(h.plaintextHash),i,j.getFlowDetails().instanceKey);return b("cr:10071").eblsResignCdnUrlWithGraphQL({chatJid:g.chat,deliveryObjectId:h.attachmentObjectId,externalId:i,mediaType:h.mediaType,sortOrderMs:h.messageTimeStamp}).then(function(a){if(a.success===!1){O.DEBUG(K||(K=babelHelpers.taggedTemplateLiteralLoose(["resign cdn url gql failed: ",". hash: ",". externalId ",""])),a.error,d("WAHashUtils").sanitisePlaintextHash(h.plaintextHash),i);j.endFail(a.error);return}O.DEBUG(L||(L=babelHelpers.taggedTemplateLiteralLoose(["resign cdn url gql success. hash: ",". externalId ",""])),d("WAHashUtils").sanitisePlaintextHash(h.plaintextHash),i);a=d("MAWJobDefinitions").createStartJobInfo("downloadAndRestoreMedia",{deliveryObjectId:h.attachmentObjectId,msgId:h.msgId,plaintextHash:h.plaintextHash,restorationCdnUrl:a.value,scheduleConfig:{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW},traceId:j.getFlowDetails().instanceKey});return d("MAWJobManager").getJobManager().fireAndForget(a)}).catch(function(a){O.catching(a).MUSTFIX(M||(M=babelHelpers.taggedTemplateLiteralLoose(["resign cdn url gql error"]))),j.endFail("runtime-error",{string:{restoreError:a.toString()}})})}O.DEBUG(N||(N=babelHelpers.taggedTemplateLiteralLoose(["resign cdn url start [sproc]. hash: ",". msgId: ",". traceId: ",""])),d("WAHashUtils").sanitisePlaintextHash(h.plaintextHash),i,j.getFlowDetails().instanceKey);return Z(i,h,j)}function da(a,b){var c=[];(a=a.mediaEntries)==null||a.forEach(function(a,e){a=d("WAMediaUtils").decodeMediaEntryData(a);a.objectId===b&&c.push(e)});return c}g.downloadMediaAndWriteToMediaStore=a;g.getBase64WithoutPadding=U;g.getMediaInfo=V;g.constructMediaEntry=W;g.constructRawDownloadableThumbnail=X;g.handleDownloadMedia=Y;g.invokeRestoreAccessCheckSprocToDownloadAttachment=Z}),98);
__d("MAWHandleEchoReactionsRestore",["MAWAckLevel","MAWAuthor","MAWBulkWriteReactionsTxns","MAWHandleEchoMsgsRestoreApiUtils","MAWIndexedDb","MAWTransactionMode","Promise","WAJids","WALogger","WAStanzaUtils","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o;function a(a,c,d){d==null||d.addPoint("reactions_restore_start");var e=a.echoMsgMap,f=a.restoredMsgsData,g=0;if(f){a=f.existingMsgs;var h=f.newlyAddedMsgs;h=h.concat(a);var i=f.threadJid;a=h.filter(function(a){var b=e.get(a.externalId);return q(e,a)&&b!=null&&r(b)});if(a.length===0)return(o||(o=b("Promise"))).resolve();var j=a.flatMap(function(a){var b=e.get(a.externalId);a=u(f.threadJid,c,a.externalId,a.msgId,a.author,b);return a.map(function(a){return{chatJid:i,unstoredReaction:a}})});return j.length===0?(o||(o=b("Promise"))).resolve():p(j).then(function(a){g+=j.length,d==null||d.addPoint("reactions_restore_end",{"int":{reactions:g}})})}return(o||(o=b("Promise"))).resolve()}var p=d("MAWIndexedDb").makeMsgrTransactor({groupInfo:(c=d("MAWTransactionMode")).READWRITE,messages:c.READWRITE,reactions:c.READWRITE,threads:c.READWRITE},"restoreWriteReactionsToDb",function(a){return function(b){return d("MAWBulkWriteReactionsTxns").prepareReactionsData(a,b).then(function(b){return d("MAWBulkWriteReactionsTxns").bulkWriteReactions(a,b)})}});function q(a,b){a=a.get(b.externalId);if(a==null){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] echo document is absent for a restored msg"])));return!1}if(d("WAJids").isAuthorSystem(b.author)){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Cannot have reactions for system author"])));return!1}if(d("MAWAuthor").getAuthorUserJid(b.author)==null){d("WALogger").ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Cannot have reactions empty author"])));return!1}return!0}function r(a){return a.reactions!=null&&a.reactions.length!==0&&a.reactionXOfflineThreadingIds!=null&&a.reactionXOfflineThreadingIds.length!==0&&a.reactionAuthoritativeTimestampMs!=null&&a.reactionAuthoritativeTimestampMs.length!==0}function s(a,b,c){if((a==null?void 0:a.length)===0){d("WALogger").ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] reaction string is not a single character"])));return!1}if(b==null){d("WALogger").ERROR(l||(l=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] reaction external id missing"])));return!1}if(c==null){d("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] reactToAuthor field is null"])));return!1}return!0}function t(a,b,c){return(a||[]).map(function(a,e){if(c==null||b==null||(c==null?void 0:c.length)<=e||(b==null?void 0:b.length)<=e){d("WALogger").WARN(n||(n=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] reaction fields in backup data uneven in length"])));return[]}return[a,b[e],c[e]]})}function u(a,b,c,e,f,g){var h=d("MAWAuthor").getAuthorUserJid(f);if(g==null||h==null)return[];var i=g.reactionAuthoritativeTimestampMs;i=i===void 0?[]:i;var j=g.reactionXOfflineThreadingIds;j=j===void 0?[]:j;g=g.reactions;return t(g,j,i).filter(function(a){var b=a[0];a=a[1];return a!=null&&s(b.displayName,a.displayName,d("MAWAuthor").getAuthorUserJid(f))}).map(function(f){var g=f[0],i=f[1];f=f[2];var j=g.displayName;g=d("MAWHandleEchoMsgsRestoreApiUtils").resolveAuthorFromEchoAddress(g,b);g={ack:g===d("WAJids").AUTHOR_ME?d("MAWAckLevel").ACK.sent:d("MAWAckLevel").ACK.received,author:g,externalId:d("WAStanzaUtils").toStanzaId(i.displayName||""),groupingKey:j,reaction:j,reactToAuthor:h,reactToExternalId:c,senderTimestampMs:null,threadJid:a,ts:d("WATimeUtils").castToUnixTime(Number(f.displayName)/1e3)};return e!=null?babelHelpers["extends"]({},g,{reactToMsgId:e}):g})}g.writeEchoReactionsToReactionsStore=a;g.getReactionsForReactionStore=u}),98);
__d("MAWBridgeXMA",["MAWBridgeXMAUtils","MAWDbMedia","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){if(a==null)return void 0;switch(a){case"Image":case"Sticker":return"image/png";case"Gif":return"image/gif";case"Video":return"video/mp4";case"Ptt":return"audio/wav"}}function a(a,b,c){var e,f,g,j,k=b.author,l=b.contentRef,m=b.ctas,n=b.defaultCTA,o=b.defaultPreviewMediaId,p=b.defaultPreviewMediaPlaintextHash,q=b.faviconMediaId,r=b.faviconPlaintextHash,s=b.headerMediaId,t=b.headerMediaPlaintextHash,u=b.headerTitle,v=b.maxSubtitleNumOfLines,w=b.maxTitleNumOfLines,x=b.msgId,y=b.offlineAttachmentId,z=b.overlayIconGlyph,A=b.overlayTitle,B=b.subtitleText,C=b.targetId,D=b.targetType,E=b.targetUsername,F=b.threadJid,G=b.titleText,H=b.xmaDataclass,I=b.xmaId;b=b.xmaLayoutType;a!=null&&a.mediaType!==d("MAWDbMedia").IMAGE&&d("WALogger").WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["MAWBridge - createBridgeXMA received unexpected media type - ",""])),a.mediaType);C!=null&&d("MAWBridgeXMAUtils").maybeBridgeToLSTargetId(C,D);var J=c.hasMedia,K=c.hasXmaFaviconMedia;c=c.hasXmaHeaderMedia;return{author:k,contentRef:l,ctas:m==null?void 0:m.filter(function(a){return a.ctaType!=null}),defaultCTA:n,defaultPreviewMediaId:o,defaultPreviewMediaPlaintextHash:p,duration:null,faviconMediaId:q,faviconPlaintextHash:r,filesize:a==null?void 0:a.size,hasMedia:J,hasXmaFaviconMedia:K,hasXmaHeaderMedia:c,headerMediaId:s,headerMediaPlaintextHash:t,headerTitle:u,maxSubtitleNumOfLines:v,maxTitleNumOfLines:w,mediaType:a==null?void 0:a.mediaType,msgId:x,offlineAttachmentId:y,overlayIconGlyph:z,overlayTitle:A,playableUrlMimeType:i(a==null?void 0:a.mediaType),previewHeight:a==null||(e=a.validatedImageInfo)==null?void 0:e.jpegThumbnailHeight,previewHeightLarge:a==null||(f=a.validatedImageInfo)==null?void 0:f.height,previewUrlMimeType:i(a==null?void 0:a.mediaType),previewWidth:a==null||(g=a.validatedImageInfo)==null?void 0:g.jpegThumbnailWidth,previewWidthLarge:a==null||(j=a.validatedImageInfo)==null?void 0:j.width,subtitleText:B,targetId:C,targetType:D,targetUsername:E,threadJid:F,titleText:G,ts:a==null?void 0:a.ts,xmaDataclass:H,xmaId:I,xmaLayoutType:b}}function b(a,b){var c=a.msgId;a=a.threadJid;return{msgId:c,threadJid:a,xmaId:b}}function c(a,b){var c=a.msgId;a=a.threadJid;return{msgId:c,threadJid:a,xmaId:b}}g.createBridgeXMA=a;g.createBridgeXMAShareExpired=b;g.createBridgeXMAShareTombstoned=c}),98);
__d("MAWHandleXmaTransactionUtil",["MAWBridgeXMA","MAWDbChunkTxns","MAWDexieCastToPromise","MAWDexieTable","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";async function a(a,b){var c=!1;a!=null&&b.defaultPreviewMediaId===a.mediaId&&(c=await k(a));return d("MAWBridgeXMA").createBridgeXMA(a,b,{hasMedia:c,hasXmaFaviconMedia:!1,hasXmaHeaderMedia:!1})}function b(a,b,c){return h(a,b,c).then(function(a){return d("MAWIndexedDb").afterTransaction({tag:"NewXMA",value:a})})}function h(a,b,c){a=c==null?d("MAWDexieTable").dexieResolve(!1):d("MAWDbChunkTxns").hasMediaChunk(a,c.hashedPlaintextHash);return a.then(function(a){return d("MAWBridgeXMA").createBridgeXMA(c,b,{hasMedia:a,hasXmaFaviconMedia:!1,hasXmaHeaderMedia:!1})})}function c(a,b,c,e,f){return i(a,b,c,e,f).then(function(a){return d("MAWIndexedDb").afterTransaction({tag:"NewXMA",value:a})})}function i(a,b,c,e,f){e=j(c,e,f,a);return e.then(function(a){var e=a.hasMedia,f=a.hasXmaFaviconMedia;a=a.hasXmaHeaderMedia;return d("MAWBridgeXMA").createBridgeXMA(c,b,{hasMedia:e,hasXmaFaviconMedia:f,hasXmaHeaderMedia:a})})}function j(a,b,c,e){if(a!=null||b!=null||c!=null){var f=[a,b,c].filter(Boolean).map(function(a){return a.hashedPlaintextHash});return d("MAWDbChunkTxns").hasMediaChunks(e,f).then(function(d){return{hasMedia:a!=null&&d.get(a.hashedPlaintextHash)===!0,hasXmaFaviconMedia:b!=null&&d.get(b.hashedPlaintextHash)===!0,hasXmaHeaderMedia:c!=null&&d.get(c.hashedPlaintextHash)===!0}})}else return d("MAWDexieTable").dexieResolve({hasMedia:!1,hasXmaFaviconMedia:!1,hasXmaHeaderMedia:!1})}function e(a,b,c,e,f){return d("MAWDexieCastToPromise").dexieCastToPromise_I_KNOW_WHAT_I_AM_DOING(j(a,b,c,f).then(function(b){var c=b.hasMedia,f=b.hasXmaFaviconMedia;b=b.hasXmaHeaderMedia;return d("MAWBridgeXMA").createBridgeXMA(a,e,{hasMedia:c,hasXmaFaviconMedia:f,hasXmaHeaderMedia:b})}))}var k=d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READONLY},"MAWHandleXmaTransactionUtil.hasMediaChunkTransaction",function(a){return function(b){return d("MAWDbChunkTxns").hasMediaChunk(a,b.hashedPlaintextHash)}});g.checkMediaChunkTransactionAndCreatedBridgeXma=a;g.checkMediaChunkAndHandleXmaAfterTransaction=b;g.checkMediaChunkAndCreatedBridgeXma=h;g.checkAllMediaChunksAndHandleXmaAfterTransaction=c;g.checkAllMediaChunksAndCreateBridgeXma=i;g.verifyAllMediaChunksForXMA=j;g.checkAllMediaChunksAndCreateBridgeXma_DEPRECATED=e}),98);
__d("MAWHandleEchoXMARestoreV2",["EchoMessage","LSDataTraceCheckPoint","LSIntEnum","MAWBridge","MAWConvertXMAGatingTypeToExtendedContentOverlayIconGlyph","MAWConvertXMALayoutTypeToExtendedContentXMLLayoutType","MAWConvertXMATargetTypeToExtendedContentTargetType","MAWDbMediaTxns","MAWDbMsg","MAWHandleEchoMediaMsgsRestoreV2","MAWHandleXmaTransactionUtil","MAWIndexedDb","MAWODSProxy","MAWParseXMAProtocol","MAWTraceUtils","MAWTransactionMode","WAArmadilloXMA.pb","WAHashUtils","WALogger","WAMediaUtils","WAOdsEnums","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q,r;a=function(a,b,e,f){b==null||b.addPoint("xma_restore_start");d("MAWTraceUtils").recordCheckpointForTrace(e,(r||(r=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_WEB_XMA_RESTORE_STARTED),[],!1);var g=a.restoredMsgsData;if(g){var h=g.newlyAddedMsgs;h=h.concat(g.existingMsgs);var i=[];h.map(function(b){var c=b.externalId;c=a.echoMsgMap.get(c);c!=null&&(c.contentType===d("EchoMessage").EchoMessageContentType.XMA&&i.push(b))});return i.length===0?Promise.resolve():s(i,a.echoMsgMap,e,f).then(function(a){b==null||b.addPoint("xma_restore_end",{int:{xma:a.length}});d("MAWTraceUtils").recordCheckpointForTrace(e,(r||(r=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_WEB_XMA_RESTORE_ENDED),[],!1);return Promise.resolve()})}b==null||b.addPoint("xma_restore_end",{int:{xma:0}});return Promise.resolve()};function s(a,b,e,f){var g=new Map(),j=new Map();a.forEach(function(a){var c,e,f=b.get(a.externalId),h=f==null||(c=f.mediaData)==null?void 0:c.attachmentObjectId;h!=null&&g.set(d("WAMediaUtils").stringToDeliveryObjectId(h),a);h=f==null||(e=f.mediaData)==null?void 0:e.plaintextHash;if(h!=null){f=d("WAHashUtils").stringToPlaintextHash(d("MAWHandleEchoMediaMsgsRestoreV2").getBase64WithoutPadding(h));h=j.get(f);j.set(f,h!=null?[].concat(h,[a.msgId]):[a.msgId])}});var k=Array.from(g.keys()),l=new Map();return t(j).then(function(j){var m=[];k.forEach(function(a){var b;b=(b=g.get(a))==null?void 0:b.externalId;b!=null&&l.set(b,a)});a.filter(function(a){return d("MAWDbMsg").isXMAMsg(a)}).forEach(function(a){var f=b.get(a.externalId);if(f){var g=l.get(a.externalId),k;if(g!=null){g=j.get(g);g!=null&&(k=g.mediaId)}g=f.serializationOrigin;g==null&&(g=d("EchoMessage").EchoSerializationOriginType.UNKNOWN);f=v(a,f,k,g);f==null?(d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] dbXMA is null. EchoMessage origin ",""])),g),d("MAWTraceUtils").recordCheckpointForTrace(e,(r||(r=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_WEB_XMA_RESTORE_DBXMA_NULL),[],!1)):(f.targetType===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_EXTERNAL_LINK_SHARE&&a.msgContent==null&&(d("WALogger").WARN(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] msgContent is null for external link share XMA on Restore. Echo message origin ",""])),g),d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.EB_RESTORE,key:"missing_msg_content_external_link_xma"})),m.push(f))}});return u(m).then(function(a){if(a.length>0){a.map(async function(a){var b=l.get(a.externalId);if(f!==!0){var c;b!=null&&(c=j.get(b));b=await d("MAWHandleXmaTransactionUtil").checkMediaChunkTransactionAndCreatedBridgeXma(c,a);d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"NewXMA",value:b}]})}});return a}return a})})}var t=d("MAWIndexedDb").makeMsgrTransactor({media:d("MAWTransactionMode").READONLY,mediaBackup:d("MAWTransactionMode").READONLY},"restoreGetMediaForXMAByObjectIds",function(a){return function(b){var c=Array.from(b.keys());return d("MAWDbMediaTxns").maybeBulkGetMediaFromPlaintextHash(a,c).then(function(a){var c=new Map();a.forEach(function(a){var e=b.get(a.plaintextHash);e==null||e.forEach(function(b){b=a==null?void 0:a.mediaEntries.get(b);if(a!=null&&b!=null){b=d("WAMediaUtils").decodeMediaEntryData(b);b.objectId!=null&&c.set(d("WAMediaUtils").stringToDeliveryObjectId(b.objectId),a)}else d("WALogger").ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][getMediaForXMAByObjectIds] mediaEntry is null for media restore"])))})});return c})}}),u=d("MAWIndexedDb").makeMsgrTransactor({xma:d("MAWTransactionMode").READWRITE},"restoreWriteXMAsToDb",function(a){return function(b){return a.xma.bulkAdd(b,{allKeys:!0}).then(function(a){return a.map(function(a,c){return babelHelpers.extends({},b[c],{xmaId:a})})})}});function v(a,b,c,e){var f,g,h,i,j,r,s,t,u;if(b.xmaData==null){d("WALogger").ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] xmaData is missing in the echo doc. Echo message origin ",""])),e);return null}var v;if(b.xmaData.xmaDefaultCTA!=null){var x;v=w((x=b.xmaData)==null?void 0:x.xmaDefaultCTA)}else d("WALogger").WARN(l||(l=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] xmaDefaultCTA field is not present in the echo doc. Echo message origin ",""])),e);if(((x=b.xmaData)==null?void 0:x.xmaTargetType)!=null)x=d("MAWConvertXMATargetTypeToExtendedContentTargetType").convertXMATargetTypeToExtendedContentTargetType(b.xmaData.xmaTargetType);else{d("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] xmaTargetType field is not present in the echo doc. Echo message origin ",""])),e);return null}var y;((f=b.xmaData)==null?void 0:f.xmaGatingType)!=null?y=d("MAWConvertXMAGatingTypeToExtendedContentOverlayIconGlyph").convertXMAGatingTypeToExtendedContentOverlayIconGlyph(b.xmaData.xmaGatingType):d("WALogger").WARN(n||(n=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] xmaGatingType field is not present in the echo doc. Echo message origin ",""])),e);var z;((f=b.xmaData)==null?void 0:f.xmaLayoutType)!=null?z=d("MAWConvertXMALayoutTypeToExtendedContentXMLLayoutType").convertXMALayoutTypeToExtendedContentXMLLayoutType(b.xmaData.xmaLayoutType):d("WALogger").WARN(o||(o=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] xmaLayoutType field is not present in the echo doc. Echo message origin ",""])),e);if(a.threadJid!=null)f=a.threadJid;else{d("WALogger").ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] threadJid field is not present in the restoredMsg. Echo message origin ",""])),e);return null}if(v!=null&&!d("MAWParseXMAProtocol").isValidCTA(v,x,!0)){d("WALogger").ERROR(q||(q=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] invalid CTA observed while restoring XMA. Echo message origin ",""])),e);return null}var A;((e=b.xmaData)==null?void 0:e.xmaContentRef)!=null&&(A=b.xmaData.xmaContentRef);return{author:a.author,contentRef:A,ctas:[],defaultCTA:v,defaultPreviewMediaId:c!=null?c:void 0,externalId:a.externalId,headerTitle:b==null||(g=b.xmaData)==null?void 0:g.xmaHeaderTitle,isTombstoned:b==null||(h=b.xmaData)==null?void 0:h.xmaIsTombstoned,maxSubtitleNumOfLines:b==null||(i=b.xmaData)==null?void 0:i.xmaMaxSubtitleNumLines,maxTitleNumOfLines:b==null||(j=b.xmaData)==null?void 0:j.xmaMaxTitleNumLines,msgId:a.msgId,overlayIconGlyph:y,overlayTitle:b==null||(r=b.xmaData)==null?void 0:r.xmaHeaderSubtitle,previewMediaIds:c!=null?[c]:[],subtitleText:b==null||(s=b.xmaData)==null?void 0:s.xmaSubtitleText,targetExpiringAtSec:((e=b.xmaData)==null?void 0:e.xmaTargetExpiry)!=null?d("WATimeUtils").castToUnixTime(Number((a=b.xmaData)==null?void 0:a.xmaTargetExpiry)):void 0,targetId:b==null||(t=b.xmaData)==null?void 0:t.xmaTargetId,targetType:x,targetUsername:b==null||(u=b.xmaData)==null?void 0:u.xmaTargetUsername,threadJid:f,titleText:(c=b.xmaData)==null?void 0:c.xmaTitleText,xmaDataclass:(e=b.xmaData)==null?void 0:e.xmaDataclass,xmaLayoutType:z}}function w(a){return{actionUrl:a,buttonType:d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_CTA_BUTTON_TYPE.OPEN_NATIVE,nativeUrl:a}}g.writeXMAToXMAStore=a;g.getMediaForXMAByObjectIds=t;g.writeXMAsToDb=u;g.getDefaultCTA=w}),98);
__d("MAWLegacyDownloadManager",[],(function(a,b,c,d,e,f){"use strict";var g=1e4;a=function(){function a(){this.$1=[],this.$2=new Map()}var b=a.prototype;b.setToDownloadManager=function(a,b){this.$3(),this.$2.set(a,b),this.$1.push(a)};b.getFromDownloadManager=function(a){return this.$2.get(a)};b.removeFromMediaDownloadManager=function(a){this.$2["delete"](a);var b=this.$1.filter(function(b){return b!==a});this.setDownloadManagerQueue(b)};b.setDownloadManagerQueue=function(a){this.$1=a};b.$3=function(){if(this.$1.length>=g){var a=this.$1.shift();this.$2["delete"](a)}};return a}();f.LegacyDownloadManager=a}),66);
__d("MAWLegacyMediaDownloadManager",["MAWLegacyDownloadManager"],(function(a,b,c,d,e,f,g){"use strict";var h=new(d("MAWLegacyDownloadManager").LegacyDownloadManager)(),i=new(d("MAWLegacyDownloadManager").LegacyDownloadManager)();function a(a,b){h.setToDownloadManager(a,b)}function b(a){return h.getFromDownloadManager(a)}function c(a){h.removeFromMediaDownloadManager(a)}function e(a,b){i.setToDownloadManager(a,b)}function f(a){return i.getFromDownloadManager(a)}function j(a){i.removeFromMediaDownloadManager(a)}g.setToMediaDownloadManager=a;g.getFromMediaDownloadManager=b;g.removeFromMediaDownloadManager=c;g.setToMediaPlaintextDownloadManager=e;g.getFromMediaPlaintextDownloadManager=f;g.removeFromMediaPlaintextDownloadManager=j}),98);
__d("MAWVideoAudioValidationUtils",[],(function(a,b,c,d,e,f){"use strict";function a(a){return{audioAvgBitsPerSecond:a.audioAvgBitsPerSecond!=null?Math.round(a.audioAvgBitsPerSecond):null,audioNumberOfChannels:a.audioNumberOfChannels!=null?Math.round(a.audioNumberOfChannels):null,audioSamplingRate:a.audioSamplingRate!=null?Math.round(a.audioSamplingRate):null,audioStreamType:a.audioStreamType,validatedMimeType:a.validatedMimeType,videoAvgBitsPerSecond:a.videoAvgBitsPerSecond!=null?Math.round(a.videoAvgBitsPerSecond):null,videoCalculatedFps:a.videoCalculatedFps!=null?Math.round(a.videoCalculatedFps):null,videoDuration:a.videoDuration!=null?Math.round(a.videoDuration):null,videoHeight:a.videoHeight!=null?Math.round(a.videoHeight):null,videoNominalFps:a.videoNominalFps!=null?Math.round(a.videoNominalFps):null,videoStreamType:a.videoStreamType,videoWidth:a.videoWidth!=null?Math.round(a.videoWidth):null}}f.normalizeValidationResult=a}),66);
__d("MAWHandleMediaDownloadApi",["MAWBridgeMsg","MAWBridgeTypesCreators","MAWDbChunkTxns","MAWDbMedia","MAWDbMediaTxns","MAWDbMsgTxns","MAWDbXMATxns","MAWDexieTable","MAWGetMsgQuoteTxn","MAWHandleXmaTransactionUtil","MAWIndexedDb","MAWLegacyMediaDownloadManager","MAWLoadReplyMediaTxns","MAWLoggerUtils","MAWMediaAfterTxns","MAWMediaUtils","MAWMsgType","MAWTransactionMode","MAWVideoAudioValidationUtils","MAWXMAUtils","MWFBLogger","Promise","WAArmadilloXMA.pb","WAResultOrError","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=d("MWFBLogger").MWMediaLogger.tags([d("MAWLoggerUtils").Tag.MediaDownload,d("MAWLoggerUtils").Tag.MessageReceive]);e=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READWRITE,media:a.READWRITE,messages:a.READONLY,receiverFetchInfo:a.READONLY,threads:a.READONLY,xma:a.READONLY},"handleMediaDownload",function(a){return function(e,f,g,o,p){l.DEBUG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["start persisting media blob"])));var q=d("MAWMediaUtils").genHMACPlaintextHash(e);return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,o),a.media.where("hashedPlaintextHash").equals(q).first(),d("MAWDbChunkTxns").getOrCreateMediaChunkWithPlaintextHash(a,e,g,f)]).then(function(h){var o=h[0],q=h[1];h[2];if(q==null){l.MUSTFIX(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Media is null when storing downloaded blob"])));return d("WAResultOrError").makeError("missing-media-on-save")}var r;h=!1;r=d("MAWLegacyMediaDownloadManager").getFromMediaPlaintextDownloadManager(e);r==null&&!c("gkx")("6417")&&(r=d("MAWLegacyMediaDownloadManager").getFromMediaDownloadManager(q.mediaId),h=!0);r!=null&&(l.DEBUG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["resolve MediaPlaintextDownloadManager promise"]))),r((k||(k=b("Promise"))).resolve(new Blob([g],{type:f}))),d("MAWLegacyMediaDownloadManager").removeFromMediaPlaintextDownloadManager(e),h&&d("MAWLegacyMediaDownloadManager").removeFromMediaDownloadManager(q.mediaId));return m(a,o).then(function(b){if(!b)return a.messages.where("msgId").anyOf(q.msgIds).toArray().then(function(b){return a.threads.where("jid").anyOf(b.map(function(a){return a.threadJid})).toArray().then(function(c){return d("MAWDexieTable").dexieAll(c.map(function(c){var e=d("MAWMediaUtils").createHdTypesForBridgeMedia(b);c=d("MAWBridgeTypesCreators").createBridgeMedia({chatJid:c.jid,filteredMsgIds:d("MAWBridgeTypesCreators").getMsgIdsFilteredByJid(b,c.jid),hasMediaForUI:!0,hdTypes:e,media:q,sortOrderMs:o==null?void 0:o.sortOrderMs});return d("MAWMediaAfterTxns").handleNewMediaAfterTxnWithBridgeMedia(a,c,b)}))}).then(function(){return b})}).then(function(b){return n(a,b)});else return c("gkx")("9695")?a.messages.where("msgId").anyOf(q.msgIds).toArray().then(function(b){return d("MAWDbXMATxns").getXMAFromMsgs(a,b).then(function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){if(d("MAWXMAUtils").isXMAStoryReply(b.targetType))return;if(b.defaultPreviewMediaId!==q.mediaId)return;return d("MAWHandleXmaTransactionUtil").checkMediaChunkAndHandleXmaAfterTransaction(a,b,q)}))}).then(function(){return b})}).then(function(b){return n(a,b)}):a.messages.where("msgId").anyOf(q.msgIds).toArray().then(function(b){a.threads.where("jid").anyOf(b.map(function(a){return a.threadJid})).toArray().then(function(c){c.forEach(function(c){if(c!=null)return d("MAWDbXMATxns").getXMAFromMsgs(a,b).then(function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){if(d("MAWXMAUtils").isXMAStoryReply(b.targetType))return;if(b.defaultPreviewMediaId!==q.mediaId)return;return d("MAWHandleXmaTransactionUtil").checkMediaChunkAndHandleXmaAfterTransaction(a,b,q)}))})})});return b}).then(function(b){return n(a,b)})}).then(function(){var b,e,f,h,i,j,k,l,m,n,o,r=q.mediaType===d("MAWDbMedia").MEDIA_TYPE.VIDEO?d("MAWVideoAudioValidationUtils").normalizeValidationResult({audioAvgBitsPerSecond:p==null||(b=p.audioStreamReport)==null?void 0:b.avgBitsPerSecond,audioNumberOfChannels:p==null||(e=p.audioStreamReport)==null?void 0:e.numberOfChannels,audioSamplingRate:p==null||(f=p.audioStreamReport)==null?void 0:f.samplingRate,audioStreamType:p==null||(h=p.audioStreamReport)==null?void 0:h.streamType,validatedMimeType:p==null?void 0:p.mimeType,videoAvgBitsPerSecond:p==null||(i=p.videoStreamReport)==null?void 0:i.avgBitsPerSecond,videoCalculatedFps:p==null||(j=p.videoStreamReport)==null?void 0:j.calculatedFps,videoDuration:p==null||(k=p.videoStreamReport)==null?void 0:k.duration,videoHeight:p==null||(l=p.videoStreamReport)==null?void 0:l.videoHeight,videoNominalFps:p==null||(m=p.videoStreamReport)==null?void 0:m.nominalFps,videoStreamType:p==null||(n=p.videoStreamReport)==null?void 0:n.streamType,videoWidth:p==null||(o=p.videoStreamReport)==null?void 0:o.videoWidth}):void 0;r=d("MAWDbMediaTxns").updateMedia(a,q,{size:g.byteLength,validatedResult:r});if(c("gkx")("9695"))return r}).then(function(){return d("WAResultOrError").makeResult()})})}});function m(a,b){var c;if(b==null)return d("MAWDexieTable").dexieResolve(!1);if(b.type===d("MAWMsgType").MSG_TYPE.XMA)return d("MAWDexieTable").dexieResolve(!0);return((c=b.quote)==null?void 0:c.content.xmaMessageType)===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_REPLY?d("MAWDexieTable").dexieResolve(b.type===d("MAWMsgType").MSG_TYPE.TEXT):d("MAWDbXMATxns").maybeGetXMAFromAssociatedMsgId(a,b.msgId).then(function(a){return a!=null})}function n(a,b){return d("MAWGetMsgQuoteTxn").maybeBatchGetMsgsByQuoteExternalId(a,b.map(function(a){return a.externalId})).then(function(b){return b.map(function(b){b.source="eb_restore";return d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,b).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(b,a)})})})})}g.handleMediaDownload=e}),98);
__d("MAWRepliesRestoreUtils",["FBLogger","MAWBridgeMsg","MAWDexieTable","MAWGetMsgQuoteTxn","MAWHandleEchoMsgsRestoreApiUtils","MAWIndexedDb","MAWLoadReplyMediaTxns","MAWMsgType","MAWTransactionMode","MAWUpdateQuotedMsgTxns","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h=["msgId","originalTs","rowId","threadJid","unsendMsgContentDeleteTs"],i;function a(a,b){if(b==null||!d("MAWMsgType").isQuotedMsgType(b.type))return a;else{b={author:b.author,externalId:b.externalId,ts:b.ts,type:b.type};b={content:b,remoteJid:null};return babelHelpers["extends"]({},a,{quote:b})}}function b(a,b){if(a.quoteData!=null&&a.quoteData.quoteMessageId!=null&&a.quoteData.quoteMessageSender!=null){b={author:d("MAWHandleEchoMsgsRestoreApiUtils").resolveAuthorFromEchoAddress(a.quoteData.quoteMessageSender,b),externalId:(b=a.quoteData)==null?void 0:b.quoteMessageId,ts:a.displayTimestampMs,type:d("MAWMsgType").MSG_TYPE.TEXT};return{content:b,remoteJid:null}}else d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Quote data is missing for message: ",""])),a.messageId);return null}f=d("MAWIndexedDb").makeMsgrTransactor({chunk:(e=d("MAWTransactionMode")).READONLY,media:e.READONLY,messages:e.READWRITE,threads:e.READWRITE,xma:e.READONLY},"updateQuoteDataForReplyMessages",function(a){return function(b,c,e){c==null||c.addPoint("replies_restore_start");b=b.restoredMsgsData;if(b){var f=b.existingMsgs;b=b.newlyAddedMsgs;b=b.concat(f);return d("MAWDexieTable").dexieAll(b.map(function(b){return d("MAWUpdateQuotedMsgTxns").associateQuotedMessage(a,b.threadJid,b).then(function(a){var c=[];b.quoteExternalId!=null&&c.push(b);a!=null&&c.push.apply(c,a);return c})})).then(function(b){b=b.flat();return j(a,b,e)}).then(function(a){c==null||c.addPoint("replies_restore_end",{"int":{replies:a}});return a})}return d("MAWDexieTable").dexieResolve(0)}});function j(a,b,e){return d("MAWDexieTable").dexieAll(b.map(function(b){var e=k(b);if(b.threadJid!=null)return d("MAWGetMsgQuoteTxn").enhanceMsgWithQuoteInfo(a,e,b.threadJid).then(function(a){return babelHelpers["extends"]({},a,{msgId:b.msgId,originalTs:b.originalTs,protocolMsgId:b.protocolMsgId,rowId:b.rowId,threadJid:b.threadJid,unsendMsgContentDeleteTs:b.unsendMsgContentDeleteTs})});else c("FBLogger")("labyrinth_web","thread_id_absent").mustfix("Reply restore: threadId cannot be null for a restored msg")})).then(function(a){return a.filter(Boolean).filter(function(a){return a.quote!=null})}).then(function(a){return a.map(function(a){a.source="eb_restore";return a})}).then(function(b){return a.messages.bulkPut(b).then(function(c){return b.map(function(b){return d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,b).then(function(a){if(e===!0)return;d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(b,a)})})})}).then(function(a){return(a=b==null?void 0:b.length)!=null?a:0})})}function k(a){a.msgId;a.originalTs;a.rowId;a.threadJid;a.unsendMsgContentDeleteTs;a=babelHelpers.objectWithoutPropertiesLoose(a,h);return a}g.addQuoteDataToReplyMessage=a;g.getQuoteDataFromEchoMessage=b;g.updateQuoteDataForReplyMessages=f;g.enhanceAndPersistReplyMessagesWithQuoteData=j}),98);/*FB_PKG_DELIM*/
__d("Cache",["TimeSlice"],(function(a,b,c,d,e,f,g){"use strict";var h=6e4;a=function(){function a(){this.$1=new Map()}var b=a.prototype;b.has=function(a){return this.$1.has(a)};b.get=function(a,b){a=this.__getRaw(a);return!a?b:a.$2};b.getAll=function(a,b){var c=this,d=new Map();a.forEach(function(a){return d.set(a,c.get(a,b))});return d};b["delete"]=function(a){var b=this.__getRaw(a);b&&b.$3&&clearTimeout(b.$3);return this.$1["delete"](a)};b.clear=function(){this.$1.forEach(function(a){a&&a.$3&&clearTimeout(a.$3)}),this.$1.clear()};b.set=function(a,b,d,e){if(!this.shouldUpdate(a,d))return!1;var f=this.__getRaw(a);f||(f=this.__getNewRawObject());delete f.$2;delete f.$4;f.$3&&clearTimeout(f.$3);delete f.$3;f.$2=b;d!=null&&(f.$4=d);e!=null&&e>=0&&(f.$3=setTimeout(c("TimeSlice").guard(this["delete"].bind(this,a),"Cache expiration timeout"),e*h));this.__setRaw(a,f);return!0};b.shouldUpdate=function(a,b){a=this.__getRaw(a);return a==null||a.$4==null||b==null||b>a.$4};b.size=function(){return this.$1.size};b.__getRaw=function(a){return this.$1.get(a)};b.__setRaw=function(a,b){this.$1.set(a,b)};b.__getNewRawObject=function(){return{$2:null,$3:null,$4:null,$5:null,$6:null}};b.__keys=function(){return this.$1.keys()};return a}();g["default"]=a}),98);
__d("EncryptedBackupsUtils",["FBLogger","WAJids","WAStanzaUtils","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";f=function(a){return Date.now()-a>d("WATimeUtils").DAY_MILLISECONDS*30};var h=function(a){return Date.now()-a>d("WATimeUtils").DAY_MILLISECONDS*30};function a(a,b,c,d,e){d={frankingTag:d==null?void 0:d.frankingTag,reportingTag:d==null?void 0:d.reportingTag};d={frankingMetadata:d,messageId:b,senderId:a,timestampMs:c};return{encryptedTransportMessage:e,metadata:d}}function b(a){return JSON.stringify([a.author,a.chat,a.externalId])}function e(a){a=JSON.parse(a);if(!Array.isArray(a))throw c("FBLogger")("labyrinth_web").mustfixThrow("Unable to parse msg id string as proper json");if(a.length!==3)throw c("FBLogger")("labyrinth_web").mustfixThrow("Parsed array should have 3 components");var b=d("WAJids").unsafeCoerceToUserJid(a[0]),e=d("WAJids").unsafeCoerceToChatJid(a[1]);a=d("WAStanzaUtils").toStanzaId(a[2]);return{author:b,chat:e,externalId:a}}g.entryOlderThan30Days=f;g.timestampOlderThan30Days=h;g.asBackupMessage=a;g.convertWAMsgIdToStringId=b;g.convertStringIdToWAMsgId=e}),98);
__d("LFUCache",["Cache","ExecutionEnvironment"],(function(a,b,c,d,e,f,g){"use strict";var h,i=15,j=1,k=6e4;a=function(a){function b(b,d){var e;e=a.call(this)||this;e.$LFUCache2=b&&b>0?b:i;e.$LFUCache3=d&&d>0?d:j;((h||(h=c("ExecutionEnvironment"))).canUseDOM||(h||(h=c("ExecutionEnvironment"))).isInWorker)&&e.$LFUCache4();return e}babelHelpers.inheritsLoose(b,a);var d=b.prototype;d.$LFUCache4=function(){clearTimeout(this.$LFUCache1),this.$LFUCache1=setTimeout(this.purge.bind(this),this.$LFUCache2*k)};d.destroy=function(){clearTimeout(this.$LFUCache1)};d.get=function(b,c){this.has(b)&&this.$LFUCache5(b);return a.prototype.get.call(this,b,c)};d.set=function(b,c,d,e){var f=this.has(b);c=a.prototype.set.call(this,b,c,d,e);c&&(f?this.$LFUCache5(b):this.$LFUCache6(b,this.$LFUCache3));return c};d.purge=function(){var a=this,b=Array.from(this.__keys());b.forEach(function(b){a.$LFUCache7(b)<a.$LFUCache3?a["delete"](b):a.$LFUCache6(b,0)});this.$LFUCache4()};d.$LFUCache5=function(a){var b=this.$LFUCache7(a)+1;this.$LFUCache6(a,b);return b};d.$LFUCache7=function(a){a=this.__getRaw(a);return a&&a.$LFUCache8?a.$LFUCache8:0};d.$LFUCache6=function(a,b){var c=this.__getRaw(a);c||(c=this.__getNewRawObject());c.$LFUCache8=b;this.__setRaw(a,c);return!0};return b}(c("Cache"));g["default"]=a}),98);
__d("LSDecryptMessageV2",["LSArrayGetObjectAt","LSCreateDerivedKeys.nop","LSGetBlobFromString.nop","LSLogMebClientEvent.nop","LSSymmetricEncryptionCreateDecryptedString.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][decryptMessageV2] Beginning execution."),d[1]=c.i64.of_float(Date.now()),d[8]=a[2]==null?c.i64.cast([0,0]):a[2],d[2]=c.i64.of_int32(a[3].length),c.i64.eq(d[2],c.i64.cast([0,1]))?c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[3],c.i64.cast([0,0])).then(function(a){return a=a,d[12]=a[0],d[13]=a[1],a})},function(e){return d[14]=d[12].get("epoch_anon_id"),d[15]=d[12].get("epoch_root_key"),d[16]=c.createArray(),d[26]=(d[16].push(c.i64.cast([0,32])),d[16]),c.i64.ge(d[8],c.i64.cast([0,3]))?c.resolve(d[17]=void 0):c.sequence([function(e){return c.nativeOperation(b("LSGetBlobFromString.nop"),a[1]).then(function(a){return a=a,d[26]=a[0],a})},function(a){return d[17]=d[26]}])},function(e){return c.i64.ge(d[8],c.i64.cast([0,4]))?(d[26]="_",d[18]=["message_key_in_epoch",d[26],c.blobs.to_string(d[14]),d[26],"cipher_version",d[26],c.i64.to_string(d[8]),d[26],"thread",d[26],a[1]==null?"":a[1]].join("")):(c.i64.ge(d[8],c.i64.cast([0,3]))?(d[27]="_",d[26]=["message_key_in_epoch",d[27],c.blobs.to_string(d[14]),d[27],"cipher_version",d[27],c.i64.to_string(d[8]),d[27],"thread",d[27],a[1]==null?"":a[1]].join("")):(c.i64.ge(d[8],c.i64.cast([0,2]))?(d[28]="_",d[27]=["message_key_in_epoch",d[28],c.blobs.to_string(d[14]),d[28],"cipher_version",d[28],c.i64.to_string(d[8])].join("")):d[27]=["message_key_in_epoch","_",c.blobs.to_string(d[14])].join(""),d[26]=d[27]),d[18]=d[26]),c.nativeOperation(b("LSGetBlobFromString.nop"),d[18]).then(function(a){return a=a,d[19]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[19],d[17],d[15],d[16]).then(function(a){return a=a,d[20]=a[0],a})},function(a){return d[20]?d[21]=!1:d[21]=!0,d[21]?c.resolve(d[22]=void 0):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[20],c.i64.cast([0,0])).then(function(a){return a=a,d[26]=a[0],d[27]=a[1],a})},function(a){return d[22]=d[26]}])},function(e){return c.blobs.neq(d[22],void 0)?c.sequence([function(e){return c.nativeOperation(b("LSSymmetricEncryptionCreateDecryptedString.nop"),d[22],c.blobs.of_string(["message_thread","_",a[1]].join("")),a[0]).then(function(a){return a=a,d[26]=a[0],a})},function(a){return d[26]!==void 0?c.resolve(d[27]=d[26]):c.sequence([function(a){return d[28]=["Failed to decrypt message. Epoch Anon ID: ",c.blobs.to_string(d[14]),", Encryption Version: ",c.i64.to_string(d[8])].join(""),function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsDecryptMessageV2StoredProcedure] ","",d[28]].join("")),d[29]=c.createArray(),void 0!==void 0?d[30]=(d[29].push(void 0),d[29]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDecryptMessageV2StoredProcedure",[d[28]].join(""),d[29],c.i64.cast([0,3]))},function(a){return d[27]=void 0}])},function(a){return d[23]=d[27]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsDecryptMessageV2StoredProcedure] Decryption message key is null"),d[26]=c.createArray(),void 0!==void 0?d[27]=(d[26].push(void 0),d[26]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDecryptMessageV2StoredProcedure","Decryption message key is null",d[26],c.i64.cast([0,3]))},function(a){return d[23]=void 0}])},function(a){return d[23]!==void 0?(a=[d[23],void 0],d[24]=a[0],d[25]=a[1],a):(d[26]=new c.Map(),d[26].set("error_code",c.i64.cast([0,101])),d[26].set("stored_procedure","LSEncryptedBackupsDecryptMessageV2StoredProcedure"),d[26].set("error_message",""),a=[void 0,d[26]],d[24]=a[0],d[25]=a[1]),a=[d[24],d[25]],d[3]=a[0],d[4]=a[1]}]):c.resolve((d[12]=c.i64.of_int32(a[3].length),c.i64.eq(d[12],c.i64.cast([0,0]))?(d[15]=new c.Map(),d[15].set("error_code",c.i64.cast([0,102])),d[15].set("stored_procedure","LSEncryptedBackupsDecryptMessageV2StoredProcedure"),d[15].set("error_message",""),e=[void 0,d[15]],d[13]=e[0],d[14]=e[1]):(d[15]=new c.Map(),d[15].set("error_code",c.i64.cast([0,103])),d[15].set("stored_procedure","LSEncryptedBackupsDecryptMessageV2StoredProcedure"),d[15].set("error_message",""),e=[void 0,d[15]],d[13]=e[0],d[14]=e[1]),e=[d[13],d[14]],d[3]=e[0],d[4]=e[1]))},function(a){return d[5]=c.i64.of_float(Date.now()),d[6]=c.i64.random(),d[9]="Finishing execution. Execution time: ",d[10]=c.i64.to_string(c.i64.sub(d[5],d[0])),d[11]=" ms",d[7]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][decryptMessageV2] ",d[7],d[9],d[7],d[10],d[7],d[11]].join("")),c.i64.eq(c.i64.mod_(d[6],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[12]=",",d[13]=c.createArray(),void 0!==void 0?d[14]=(d[13].push(void 0),d[13]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"decryptMessageV2",[d[9],d[12],d[10],d[12],d[11]].join(""),d[13],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[3],d[4]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsDecryptMessageV2StoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSDecryptMessages",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSDecryptMessageV2","LSIsEncryptionVersionSecure","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][decryptMessages] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[15]=new c.Map(),d[15].set("error_msg","Expected a nonempty query result"),d[15].set("code",c.i64.cast([0,3])),d[15].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[16]=c.createArray(),d[17]=(d[16].push(d[15]),d[16]),e=[void 0,d[16]],d[2]=e[0],d[3]=e[1]):(b=a.item,d[15]=new c.Map(),d[15].set("backup_id",b.backupId),d[15].set("device_public_key_blob",b.devicePublicKeyBlob),d[15].set("device_private_key_blob",b.devicePrivateKeyBlob),d[15].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[15].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[15].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[15].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[15].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[15].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[15].set("orf_client_state_v2_blob",void 0),d[15].set("orf_v2_authority_level",void 0),d[15].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[15].set("device_id",b.deviceId),d[15].set("backup_tenancy",b.backupTenancy),d[15].set("encryption_version",b.encryptionVersion),d[15].set("revision_version",b.revisionVersion),d[15].set("initialize_restore_result",void 0),d[15].set("device_creation_timestamp_sec",void 0),d[15].set("authority_level",b.authorityLevel),e=[d[15],void 0],d[2]=e[0],d[3]=e[1])})},function(e){return d[5]=new c.Map(),d[5].set("value",d[2]),d[5].set("errors",d[3]),d[6]=d[5].get("value"),d[6]!==void 0?c.sequence([function(e){return d[15]=d[6].get("backup_id"),d[16]=d[6].get("device_public_key_blob"),d[17]=d[6].get("device_private_key_blob"),d[18]=d[6].get("epoch_storage_public_key_blob"),d[19]=d[6].get("epoch_storage_private_key_blob"),d[20]=d[6].get("epoch_auth_public_key_blob"),d[21]=d[6].get("epoch_auth_private_key_blob"),d[22]=d[6].get("mailbox_root_key_blob"),d[23]=d[6].get("ocmf_client_state_blob"),d[24]=d[6].get("orf_client_state_v2_blob"),d[25]=d[6].get("orf_v2_authority_level"),d[26]=d[6].get("oblivious_validation_token_blob"),d[27]=d[6].get("device_id"),d[28]=d[6].get("backup_tenancy"),d[29]=d[6].get("encryption_version"),d[30]=d[6].get("revision_version"),d[31]=d[6].get("initialize_restore_result"),d[32]=d[6].get("device_creation_timestamp_sec"),d[33]=d[6].get("authority_level"),c.i64.neq(d[27],void 0)?c.sequence([function(a){return d[36]=void 0,c.i64.neq(d[36],void 0)?c.resolve(d[37]=d[36]):c.sequence([function(a){return d[47]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[48]=a[0],a})},function(a){return d[48]?d[57]=(d[47].push(c.i64.cast([0,0])),d[47]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[49]=a[0],a})},function(a){return d[49]?d[57]=(d[47].push(c.i64.cast([0,2])),d[47]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[50]=a[0],a})},function(a){return d[50]?d[57]=(d[47].push(c.i64.cast([0,3])),d[47]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[51]=a[0],a})},function(a){return d[51]?d[57]=(d[47].push(c.i64.cast([0,4])),d[47]):0,d[52]=c.createArray(),d[53]=c.i64.of_int32(d[47].length),c.i64.gt(d[53],c.i64.cast([0,0]))?c.loopAsync(d[53],function(a){return d[57]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[47],d[57]).then(function(a){return a=a,d[58]=a[0],d[59]=a[1],a})},function(a){return d[60]=(d[52].push(d[58]),d[52])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[57]=c.createArray(),d[58]=c.i64.of_int32(d[52].length),c.i64.gt(d[58],c.i64.cast([0,0]))?c.loopAsync(d[58],function(a){return d[60]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[52],d[60]).then(function(a){return a=a,d[61]=a[0],d[62]=a[1],a})},function(a){return d[63]=(d[57].push(c.i64.to_string(d[61])),d[57])}])}):c.resolve()},function(a){return d[59]=d[57].join(","),d[54]=d[59]}])},function(a){return d[52].some(function(a){return c.i64.eq(d[29],a)})?d[55]=d[29]:d[55]=void 0,c.i64.neq(d[55],void 0)?d[56]=d[55]:d[56]=void 0,d[37]=d[56]}])},function(e){return c.i64.neq(d[37],void 0)?d[38]=d[37]:d[38]=c.i64.cast([0,0]),c.i64.neq(d[28],void 0)?d[39]=d[28]:d[39]=c.i64.cast([0,1]),d[40]=c.createArray(),d[41]=c.createArray(),d[42]=new c.Map(),d[43]=c.i64.of_int32(a[0].length),c.i64.gt(d[43],c.i64.cast([0,0]))?c.loopAsync(d[43],function(e){return d[47]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[0],d[47]).then(function(a){return a=a,d[48]=a[0],d[49]=a[1],a})},function(a){return d[50]=d[48].get("epoch_anon_id"),d[51]=d[42].get(c.blobs.to_string(d[50])),d[51]!==void 0?c.resolve(d[52]=d[51]):c.sequence([function(a){return d[57]=d[48].get("epoch_anon_id"),d[58]=d[48].get("epoch_id"),c.i64.neq(d[58],void 0)?c.sequence([function(a){return d[61]=c.createArray(),c.count(c.db.table(169).fetch([[[d[58]]]])).then(function(a){return d[62]=a})},function(a){return c.i64.le(d[62],c.i64.cast([0,1]))?c.sequence([function(a){return c.db.table(169).fetch([[[d[58]]]]).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[72]=new c.Map(),d[72].set("error_msg","Expected a nonempty query result"),d[72].set("code",c.i64.cast([0,3])),d[72].set("src_line","MEBEpochClientUtils.php:313 MEBEpochClientUtils::requireEpochReturnShapeFromPersistentEpochsTableDirectly()"),d[73]=c.createArray(),d[74]=(d[73].push(d[72]),d[73]),e=[void 0,d[73]],d[68]=e[0],d[69]=e[1]):(b=a.item,d[72]=new c.Map(),d[72].set("epoch_id",b.epochId),d[72].set("backup_id",b.backupId),d[72].set("epoch_anon_id_blob",b.epochAnonIdBlob),d[72].set("epoch_root_key_blob",b.epochRootKeyBlob),d[72].set("epoch_status",b.epochStatus),d[72].set("epoch_head",b.epochHead),d[72].set("authority_level",b.authorityLevel),e=[d[72],void 0],d[68]=e[0],d[69]=e[1])})},function(a){return d[71]=new c.Map(),d[71].set("value",d[68]),d[71].set("errors",d[69]),d[63]=d[71]}]):c.resolve((d[68]=new c.Map(),d[68].set("error_msg","Expected at most one result"),d[68].set("code",c.i64.cast([0,4])),d[68].set("src_line","MEBEpochClientUtils.php:313 MEBEpochClientUtils::requireEpochReturnShapeFromPersistentEpochsTableDirectly()"),d[69]=c.createArray(),d[71]=(d[69].push(d[68]),d[69]),d[70]=new c.Map(),d[70].set("value",void 0),d[70].set("errors",d[69]),d[63]=d[70]))},function(a){return d[64]=d[63].get("value"),d[64]!==void 0?(d[68]=d[64].get("epoch_id"),d[69]=d[64].get("backup_id"),d[70]=d[64].get("epoch_anon_id_blob"),d[71]=d[64].get("epoch_root_key_blob"),d[72]=d[64].get("epoch_status"),d[73]=d[64].get("epoch_head"),d[74]=d[64].get("authority_level"),c.i64.eq(d[74],c.i64.cast([0,80]))?d[75]=d[63]:(d[76]=new c.Map(),d[76].set("error_msg","NONE"),d[76].set("code",c.i64.cast([0,0])),d[76].set("src_line","MEBEpochClientUtils.php:315 Closure$MEBEpochClientUtils::requireEpochReturnShapeFromPersistentEpochsTableDirectly#2()"),d[77]=c.createArray(),d[79]=(d[77].push(d[76]),d[77]),d[78]=new c.Map(),d[78].set("value",void 0),d[78].set("errors",d[77]),d[75]=d[78]),d[65]=d[75]):(d[68]=d[63].get("errors"),d[69]=d[63].get("errors"),d[70]=new c.Map(),d[70].set("value",void 0),d[70].set("errors",d[68]),d[65]=d[70]),d[66]=d[65].get("value"),d[66]!==void 0?(d[68]=d[66].get("epoch_id"),d[69]=d[66].get("backup_id"),d[70]=d[66].get("epoch_anon_id_blob"),d[71]=d[66].get("epoch_root_key_blob"),d[72]=d[66].get("epoch_status"),d[73]=d[66].get("epoch_head"),d[74]=d[66].get("authority_level"),c.i64.eq(d[69],d[15])&&c.i64.eq(d[74],c.i64.cast([0,80]))?(d[75]=new c.Map(),d[75].set("epoch_root_key",d[71]),d[75].set("epoch_anon_id",d[70]),d[76]=(d[61].push(d[75]),d[61])):0,d[67]=!0):(d[68]=d[65].get("errors"),d[69]=d[65].get("errors"),d[67]=!1),d[59]=d[61]}]):c.sequence([function(a){return d[61]=c.createArray(),c.filter(c.db.table(169).fetch(),function(a){return c.blobs.eq(a.epochAnonIdBlob,d[57])}).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[68]=new c.Map(),d[68].set("error_msg","Expected a nonempty query result"),d[68].set("code",c.i64.cast([0,3])),d[68].set("src_line","MEBEpochClientUtils.php:556 MEBEpochClientUtils::maybeEpochWithAnonIDFromPersistentEpochsTableDirectly()"),d[69]=c.createArray(),d[70]=(d[69].push(d[68]),d[69]),e=[void 0,d[69]],d[62]=e[0],d[63]=e[1]):(b=a.item,d[68]=new c.Map(),d[68].set("epoch_id",b.epochId),d[68].set("backup_id",b.backupId),d[68].set("epoch_anon_id_blob",b.epochAnonIdBlob),d[68].set("epoch_root_key_blob",b.epochRootKeyBlob),d[68].set("epoch_status",b.epochStatus),d[68].set("epoch_head",b.epochHead),d[68].set("authority_level",b.authorityLevel),e=[d[68],void 0],d[62]=e[0],d[63]=e[1])})},function(a){return d[65]=new c.Map(),d[65].set("value",d[62]),d[65].set("errors",d[63]),d[66]=d[65].get("value"),d[66]!==void 0?(d[68]=d[66].get("epoch_id"),d[69]=d[66].get("backup_id"),d[70]=d[66].get("epoch_anon_id_blob"),d[71]=d[66].get("epoch_root_key_blob"),d[72]=d[66].get("epoch_status"),d[73]=d[66].get("epoch_head"),d[74]=d[66].get("authority_level"),c.i64.eq(d[69],d[15])&&c.i64.eq(d[74],c.i64.cast([0,80]))?(d[75]=new c.Map(),d[75].set("epoch_root_key",d[71]),d[75].set("epoch_anon_id",d[70]),d[76]=(d[61].push(d[75]),d[61])):0,d[67]=!0):(d[68]=d[65].get("errors"),d[69]=d[65].get("errors"),d[67]=!1),d[59]=d[61]}])},function(a){return d[60]=c.i64.of_int32(d[59].length),c.i64.gt(d[60],c.i64.cast([0,0]))?(d[61]=d[48].get("epoch_anon_id"),d[42].set(c.blobs.to_string(d[61]),d[59])):0,d[52]=d[59]}])},function(e){return d[53]=d[48].get("value"),d[54]=d[48].get("encryption_version"),c.storedProcedure(b("LSDecryptMessageV2"),d[53],a[1],d[54],d[52]).then(function(a){return a=a,d[55]=a[0],d[56]=a[1],a})},function(a){return d[55]!==void 0?c.resolve((d[57]=d[48].get("otid"),d[58]=d[48].get("message_tags"),d[59]=new c.Map(),d[59].set("value",d[55]),d[59].set("otid",d[57]),d[59].set("message_tags",d[58]),d[60]=(d[40].push(d[59]),d[40]))):c.sequence([function(a){return d[56]!==void 0?c.sequence([function(a){return d[57]=c.i64.of_int32(d[52].length),c.i64.gt(d[57],c.i64.cast([0,0]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[52],c.i64.cast([0,0])).then(function(a){return a=a,d[67]=a[0],d[68]=a[1],a})},function(a){return d[69]=d[67].get("epoch_root_key"),d[70]=c.createArray(),d[75]=(d[70].push(c.i64.cast([0,18])),d[70]),c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,d[69],d[70]).then(function(a){return a=a,d[71]=a[0],a})},function(a){return d[71]!==void 0?c.sequence([function(a){return d[75]=c.i64.of_int32(d[71].length),c.i64.ge(d[75],c.i64.cast([0,1]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[71],c.i64.cast([0,0])).then(function(a){return a=a,d[77]=a[0],d[78]=a[1],a})},function(a){return d[76]=d[77]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[78]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBFingerprint] ","",d[78]].join("")),d[77]=c.createArray(),void 0!==void 0?d[79]=(d[77].push(void 0),d[77]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint",d[78],d[77],c.i64.cast([0,3]))},function(a){return d[76]=void 0}])},function(a){return d[72]=d[76]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[76]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBFingerprint] ","",d[76]].join("")),d[75]=c.createArray(),void 0!==void 0?d[77]=(d[75].push(void 0),d[75]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint",d[76],d[75],c.i64.cast([0,3]))},function(a){return d[72]=void 0}])},function(a){return c.blobs.neq(d[72],void 0)?d[73]=!0:d[73]=!1,d[73]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),c.blobs.neq(d[72],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[72]).then(function(a){return a=a,d[75]=a[0],a})},function(a){return d[74]=d[75]==null?"[encodingFailed]":d[75]}]):c.resolve(d[74]="[null]")},function(a){return d[58]=d[74]}]):c.resolve(d[58]="[noEpochs]")},function(a){return d[59]=d[48].get("otid"),d[60]=d[48].get("epoch_anon_id"),d[61]=d[48].get("encryption_version"),c.i64.neq(d[61],void 0)?d[62]=c.i64.to_string(d[61]):d[62]="null",d[63]=c.i64.of_int32(d[52].length),d[64]=d[48].get("epoch_fingerprint"),c.blobs.neq(d[64],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[64]).then(function(a){return a=a,d[67]=a[0],a})},function(a){return d[65]=d[67]==null?"[encodingFailed]":d[67]}]):c.resolve(d[65]="[null]")},function(a){return d[66]="",d[56].set("error_message",["Decryption failed for message with otid:",d[66],d[59],d[66]," epoch:",d[66],c.blobs.to_string(d[60]),d[66]," version:",d[66],d[62],d[66]," epoch_key_count:",d[66],c.i64.to_string(d[63]),d[66]," vsr_fingerprint:",d[66],d[65],d[66]," local_fingerprint:",d[66],d[58],d[66]," local_backup_id:",d[66],c.i64.to_string(d[15]),d[66]," local_device_id:",d[66],c.i64.to_string(d[27])].join(""))}]):c.resolve()},function(a){return d[57]=(d[41].push(d[56]),d[41])}])}])}):c.resolve()},function(a){return d[44]=c.i64.of_int32(d[41].length),c.i64.gt(d[44],c.i64.cast([0,0]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[41],c.i64.cast([0,0])).then(function(a){return a=a,d[47]=a[0],d[48]=a[1],a})},function(a){return a=[void 0,d[47]],d[45]=a[0],d[46]=a[1],a}]):c.resolve((a=[d[40],void 0],d[45]=a[0],d[46]=a[1],a))},function(a){return a=[d[45],d[46]],d[34]=a[0],d[35]=a[1],a}]):c.resolve((d[36]=new c.Map(),d[36].set("error_code",c.i64.cast([0,24])),d[36].set("stored_procedure","LSEncryptedBackupsDecryptMessagesStoredProcedure"),d[36].set("error_message",""),e=[void 0,d[36]],d[34]=e[0],d[35]=e[1]))},function(a){return a=[d[34],d[35]],d[7]=a[0],d[8]=a[1],a}]):c.resolve((d[15]=d[5].get("errors"),d[16]=d[5].get("errors"),d[17]=new c.Map(),d[17].set("error_code",c.i64.cast([0,1])),d[17].set("stored_procedure","LSEncryptedBackupsDecryptMessagesStoredProcedure"),d[17].set("error_message",""),e=[void 0,d[17]],d[7]=e[0],d[8]=e[1]))},function(a){return d[9]=c.i64.of_float(Date.now()),d[10]=c.i64.random(),d[12]="Finishing execution. Execution time: ",d[13]=c.i64.to_string(c.i64.sub(d[9],d[0])),d[14]=" ms",d[11]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][decryptMessages] ",d[11],d[12],d[11],d[13],d[11],d[14]].join("")),c.i64.eq(c.i64.mod_(d[10],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[15]=",",d[16]=c.createArray(),void 0!==void 0?d[17]=(d[16].push(void 0),d[16]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"decryptMessages",[d[12],d[15],d[13],d[15],d[14]].join(""),d[16],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[7],d[8]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsDecryptMessagesStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state","secure_encrypted_backups_epochs"];e.exports=a}),null);
__d("LSRecordEpochSyncStatus",["LSArrayGetObjectAt","LSBase64Encode.nop","LSIssueNewEbTaskAndGetTaskIDV2"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsRecordEpochSyncStatusStoredProcedure] Issue record epoch sync task"),d[0]=c.createArray(),d[1]=c.i64.of_int32(a[6].length),c.i64.gt(d[1],c.i64.cast([0,0]))?c.loopAsync(d[1],function(e){return d[5]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[6],d[5]).then(function(a){return a=a,d[6]=a[0],d[7]=a[1],a})},function(a){return d[8]=d[6].get("from"),d[9]=d[6].get("to"),d[10]=d[8].get("epoch_anon_id"),c.nativeOperation(b("LSBase64Encode.nop"),d[10]).then(function(a){return a=a,d[11]=a[0],a})},function(a){return d[11]!==void 0?d[12]=d[11]:d[12]="",d[13]=d[8].get("epoch_id"),d[14]=new c.Map(),d[14].set("anon_id",d[12]),d[14].set("epoch_id",d[13]),d[15]=d[9].get("epoch_anon_id"),c.nativeOperation(b("LSBase64Encode.nop"),d[15]).then(function(a){return a=a,d[16]=a[0],a})},function(a){return d[16]!==void 0?d[17]=d[16]:d[17]="",d[18]=d[9].get("epoch_id"),d[19]=new c.Map(),d[19].set("anon_id",d[17]),d[19].set("epoch_id",d[18]),d[20]=d[6].get("has_forward_edge"),d[21]=d[6].get("has_backward_edge"),d[22]=d[6].get("result_code"),d[23]=d[6].get("error_message"),d[24]=new c.Map(),d[24].set("from",d[14]),d[24].set("to",d[19]),d[24].set("has_forward_edge",d[20]),d[24].set("has_backward_edge",d[21]),d[24].set("result_code",d[22]),d[24].set("error_message",d[23]),d[25]=(d[0].push(d[24]),d[0])}])}):c.resolve()},function(e){return d[2]=new c.Map(),d[2].set("local_device_id",a[0]),d[2].set("decryption_device_id",a[1]),d[2].set("target_device_id",a[2]),d[2].set("epoch_sync_reason",a[3]),d[2].set("start_ms",a[4]),d[2].set("end_ms",a[5]),d[2].set("results",d[0]),d[3]=c.toJSON(d[2]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"meb_record_epoch_sync",c.i64.cast([0,50039]),d[3],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[4]=a[0],a})}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsRecordEpochSyncStatusStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSDeriveAndStoreEpochs",["LSArrayGetObjectAt","LSBase64Decode.nop","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSGetBlobFromString.nop","LSGetNextEpochAnonId.nop","LSIsEncryptionVersionSecure","LSLogMebClientEvent.nop","LSPublicEncryptionCreateDecryptedData.nop","LSQplAnnotateBool.nop","LSQplStartTrace.nop","LSRecordEpochSyncStatus","LSStoreEpoch","LSSymmetricEncryptionCreateDecryptedString.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure] Beginning execution."),d[1]=c.i64.of_int32(a[0].length),c.i64.gt(d[1],c.i64.cast([0,0]))?c.sequence([function(a){return d[8]=c.i64.random(),d[9]=c.i64.to_string(d[8]),d[9]!==void 0?c.nativeOperation(b("LSQplStartTrace.nop"),c.i64.cast([0,1021648929]),d[9],!1,void 0):c.resolve()},function(a){return d[9]!==void 0?c.nativeOperation(b("LSQplAnnotateBool.nop"),c.i64.cast([0,1021648929]),d[9],"is_eb_db_split_execution_enabled",!1):c.resolve()},function(a){return d[10]=c.i64.of_float(Date.now()),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[26]=new c.Map(),d[26].set("error_msg","Expected a nonempty query result"),d[26].set("code",c.i64.cast([0,3])),d[26].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[27]=c.createArray(),d[28]=(d[27].push(d[26]),d[27]),e=[void 0,d[27]],d[11]=e[0],d[12]=e[1]):(b=a.item,d[26]=new c.Map(),d[26].set("backup_id",b.backupId),d[26].set("device_public_key_blob",b.devicePublicKeyBlob),d[26].set("device_private_key_blob",b.devicePrivateKeyBlob),d[26].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[26].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[26].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[26].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[26].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[26].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[26].set("orf_client_state_v2_blob",void 0),d[26].set("orf_v2_authority_level",void 0),d[26].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[26].set("device_id",b.deviceId),d[26].set("backup_tenancy",b.backupTenancy),d[26].set("encryption_version",b.encryptionVersion),d[26].set("revision_version",b.revisionVersion),d[26].set("initialize_restore_result",void 0),d[26].set("device_creation_timestamp_sec",void 0),d[26].set("authority_level",b.authorityLevel),e=[d[26],void 0],d[11]=e[0],d[12]=e[1])})},function(e){return d[14]=new c.Map(),d[14].set("value",d[11]),d[14].set("errors",d[12]),d[15]=d[14].get("value"),d[15]!==void 0?c.sequence([function(e){return d[26]=d[15].get("backup_id"),d[27]=d[15].get("device_public_key_blob"),d[28]=d[15].get("device_private_key_blob"),d[29]=d[15].get("epoch_storage_public_key_blob"),d[30]=d[15].get("epoch_storage_private_key_blob"),d[31]=d[15].get("epoch_auth_public_key_blob"),d[32]=d[15].get("epoch_auth_private_key_blob"),d[33]=d[15].get("mailbox_root_key_blob"),d[34]=d[15].get("ocmf_client_state_blob"),d[35]=d[15].get("orf_client_state_v2_blob"),d[36]=d[15].get("orf_v2_authority_level"),d[37]=d[15].get("oblivious_validation_token_blob"),d[38]=d[15].get("device_id"),d[39]=d[15].get("backup_tenancy"),d[40]=d[15].get("encryption_version"),d[41]=d[15].get("revision_version"),d[42]=d[15].get("initialize_restore_result"),d[43]=d[15].get("device_creation_timestamp_sec"),d[44]=d[15].get("authority_level"),c.i64.neq(d[38],void 0)?c.sequence([function(a){return d[54]=void 0,c.i64.neq(d[54],void 0)?c.resolve(d[55]=d[54]):c.sequence([function(a){return d[68]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[69]=a[0],a})},function(a){return d[69]?d[78]=(d[68].push(c.i64.cast([0,0])),d[68]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[70]=a[0],a})},function(a){return d[70]?d[78]=(d[68].push(c.i64.cast([0,2])),d[68]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[71]=a[0],a})},function(a){return d[71]?d[78]=(d[68].push(c.i64.cast([0,3])),d[68]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[72]=a[0],a})},function(a){return d[72]?d[78]=(d[68].push(c.i64.cast([0,4])),d[68]):0,d[73]=c.createArray(),d[74]=c.i64.of_int32(d[68].length),c.i64.gt(d[74],c.i64.cast([0,0]))?c.loopAsync(d[74],function(a){return d[78]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[68],d[78]).then(function(a){return a=a,d[79]=a[0],d[80]=a[1],a})},function(a){return d[81]=(d[73].push(d[79]),d[73])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[78]=c.createArray(),d[79]=c.i64.of_int32(d[73].length),c.i64.gt(d[79],c.i64.cast([0,0]))?c.loopAsync(d[79],function(a){return d[81]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[73],d[81]).then(function(a){return a=a,d[82]=a[0],d[83]=a[1],a})},function(a){return d[84]=(d[78].push(c.i64.to_string(d[82])),d[78])}])}):c.resolve()},function(a){return d[80]=d[78].join(","),d[75]=d[80]}])},function(a){return d[73].some(function(a){return c.i64.eq(d[40],a)})?d[76]=d[40]:d[76]=void 0,c.i64.neq(d[76],void 0)?d[77]=d[76]:d[77]=void 0,d[55]=d[77]}])},function(a){return c.i64.neq(d[55],void 0)?d[56]=d[55]:d[56]=c.i64.cast([0,0]),c.i64.neq(d[39],void 0)?d[57]=d[39]:d[57]=c.i64.cast([0,1]),c.resolve()},function(e){return c.i64.neq(a[1],void 0)?c.sequence([function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[74]=new c.Map(),d[74].set("error_msg","Expected a nonempty query result"),d[74].set("code",c.i64.cast([0,3])),d[74].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[75]=c.createArray(),d[76]=(d[75].push(d[74]),d[75]),e=[void 0,d[75]],d[68]=e[0],d[69]=e[1]):(b=a.item,d[74]=new c.Map(),d[74].set("backup_id",b.backupId),d[74].set("device_public_key_blob",b.devicePublicKeyBlob),d[74].set("device_private_key_blob",b.devicePrivateKeyBlob),d[74].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[74].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[74].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[74].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[74].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[74].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[74].set("orf_client_state_v2_blob",void 0),d[74].set("orf_v2_authority_level",void 0),d[74].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[74].set("device_id",b.deviceId),d[74].set("backup_tenancy",b.backupTenancy),d[74].set("encryption_version",b.encryptionVersion),d[74].set("revision_version",b.revisionVersion),d[74].set("initialize_restore_result",void 0),d[74].set("device_creation_timestamp_sec",void 0),d[74].set("authority_level",b.authorityLevel),e=[d[74],void 0],d[68]=e[0],d[69]=e[1])})},function(e){return d[71]=new c.Map(),d[71].set("value",d[68]),d[71].set("errors",d[69]),d[72]=d[71].get("value"),d[72]!==void 0?c.sequence([function(e){return d[74]=d[72].get("backup_id"),d[75]=d[72].get("device_public_key_blob"),d[76]=d[72].get("device_private_key_blob"),d[77]=d[72].get("epoch_storage_public_key_blob"),d[78]=d[72].get("epoch_storage_private_key_blob"),d[79]=d[72].get("epoch_auth_public_key_blob"),d[80]=d[72].get("epoch_auth_private_key_blob"),d[81]=d[72].get("mailbox_root_key_blob"),d[82]=d[72].get("ocmf_client_state_blob"),d[83]=d[72].get("orf_client_state_v2_blob"),d[84]=d[72].get("orf_v2_authority_level"),d[85]=d[72].get("oblivious_validation_token_blob"),d[86]=d[72].get("device_id"),d[87]=d[72].get("backup_tenancy"),d[88]=d[72].get("encryption_version"),d[89]=d[72].get("revision_version"),d[90]=d[72].get("initialize_restore_result"),d[91]=d[72].get("device_creation_timestamp_sec"),d[92]=d[72].get("authority_level"),c.i64.neq(d[86],void 0)?c.sequence([function(a){return d[94]=void 0,c.i64.neq(d[94],void 0)?c.resolve(d[95]=d[94]):c.sequence([function(a){return d[98]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[99]=a[0],a})},function(a){return d[99]?d[108]=(d[98].push(c.i64.cast([0,0])),d[98]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[100]=a[0],a})},function(a){return d[100]?d[108]=(d[98].push(c.i64.cast([0,2])),d[98]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[101]=a[0],a})},function(a){return d[101]?d[108]=(d[98].push(c.i64.cast([0,3])),d[98]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[102]=a[0],a})},function(a){return d[102]?d[108]=(d[98].push(c.i64.cast([0,4])),d[98]):0,d[103]=c.createArray(),d[104]=c.i64.of_int32(d[98].length),c.i64.gt(d[104],c.i64.cast([0,0]))?c.loopAsync(d[104],function(a){return d[108]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[98],d[108]).then(function(a){return a=a,d[109]=a[0],d[110]=a[1],a})},function(a){return d[111]=(d[103].push(d[109]),d[103])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[108]=c.createArray(),d[109]=c.i64.of_int32(d[103].length),c.i64.gt(d[109],c.i64.cast([0,0]))?c.loopAsync(d[109],function(a){return d[111]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[103],d[111]).then(function(a){return a=a,d[112]=a[0],d[113]=a[1],a})},function(a){return d[114]=(d[108].push(c.i64.to_string(d[112])),d[108])}])}):c.resolve()},function(a){return d[110]=d[108].join(","),d[105]=d[110]}])},function(a){return d[103].some(function(a){return c.i64.eq(d[88],a)})?d[106]=d[88]:d[106]=void 0,c.i64.neq(d[106],void 0)?d[107]=d[106]:d[107]=void 0,d[95]=d[107]}])},function(b){return c.i64.neq(d[95],void 0)?d[96]=d[95]:d[96]=c.i64.cast([0,0]),c.i64.neq(d[87],void 0)?d[97]=d[87]:d[97]=c.i64.cast([0,1]),d[93]=c.i64.neq(d[86],a[1])}]):c.resolve(d[93]=!1)},function(a){return d[73]=d[93]}]):c.resolve((d[74]=d[71].get("errors"),d[75]=d[71].get("errors"),d[73]=!1))},function(a){return d[58]=d[73]}]):c.resolve(d[58]=!1)},function(e){return d[58]?c.sequence([function(e){return d[68]=c.createArray(),d[69]=c.i64.of_int32(a[0].length),c.i64.gt(d[69],c.i64.cast([0,0]))?c.loopAsync(d[69],function(e){return d[70]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[0],d[70]).then(function(a){return a=a,d[71]=a[0],d[72]=a[1],a})},function(a){return d[73]=d[71].get("from_epoch"),d[74]=d[73].get("epoch_anon_id"),d[75]=d[71].get("from_epoch"),d[76]=d[75].get("epoch_id"),d[77]=new c.Map(),d[77].set("epoch_anon_id",d[74]),d[77].set("epoch_id",d[76]),d[78]=d[71].get("to_epoch"),d[79]=d[78].get("epoch_anon_id"),d[80]=d[71].get("to_epoch"),d[81]=d[80].get("epoch_id"),d[82]=new c.Map(),d[82].set("epoch_anon_id",d[79]),d[82].set("epoch_id",d[81]),d[83]=d[71].get("forward_edge"),d[83]?d[84]=!1:d[84]=!0,d[84]?d[85]=!1:d[85]=!0,d[86]=d[71].get("backward_edge"),c.blobs.neq(d[86],void 0)?d[87]=!0:d[87]=!1,d[88]=new c.Map(),d[88].set("from",d[77]),d[88].set("to",d[82]),d[88].set("has_forward_edge",d[85]),d[88].set("has_backward_edge",d[87]),d[88].set("result_code",c.i64.cast([0,8])),d[88].set("error_message",void 0),d[89]=(d[68].push(d[88]),d[68])}])}):c.resolve()},function(b){return b=[d[38],d[38],a[1],a[2],c.i64.cast([0,0]),c.i64.cast([0,0]),d[68],!1,void 0],d[59]=b[0],d[60]=b[1],d[61]=b[2],d[62]=b[3],d[63]=b[4],d[64]=b[5],d[65]=b[6],d[66]=b[7],d[67]=b[8],b}]):c.sequence([function(e){return d[68]=c.createArray(),d[69]=c.i64.of_int32(a[0].length),c.i64.gt(d[69],c.i64.cast([0,0]))?c.loopAsync(d[69],function(e){return d[70]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[0],d[70]).then(function(a){return a=a,d[71]=a[0],d[72]=a[1],a})},function(a){return d[73]=d[71].get("from_epoch"),d[74]=d[73].get("epoch_id"),c.count(c.db.table(169).fetch([[[d[74]]]])).then(function(a){return d[75]=a})},function(a){return c.i64.le(d[75],c.i64.cast([0,1]))?c.sequence([function(a){return c.db.table(169).fetch([[[d[74]]]]).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[103]=new c.Map(),d[103].set("error_msg","Expected a nonempty query result"),d[103].set("code",c.i64.cast([0,3])),d[103].set("src_line","MEBEpochClientUtils.php:313 MEBEpochClientUtils::requireEpochReturnShapeFromPersistentEpochsTableDirectly()"),d[104]=c.createArray(),d[105]=(d[104].push(d[103]),d[104]),e=[void 0,d[104]],d[99]=e[0],d[100]=e[1]):(b=a.item,d[103]=new c.Map(),d[103].set("epoch_id",b.epochId),d[103].set("backup_id",b.backupId),d[103].set("epoch_anon_id_blob",b.epochAnonIdBlob),d[103].set("epoch_root_key_blob",b.epochRootKeyBlob),d[103].set("epoch_status",b.epochStatus),d[103].set("epoch_head",b.epochHead),d[103].set("authority_level",b.authorityLevel),e=[d[103],void 0],d[99]=e[0],d[100]=e[1])})},function(a){return d[102]=new c.Map(),d[102].set("value",d[99]),d[102].set("errors",d[100]),d[76]=d[102]}]):c.resolve((d[99]=new c.Map(),d[99].set("error_msg","Expected at most one result"),d[99].set("code",c.i64.cast([0,4])),d[99].set("src_line","MEBEpochClientUtils.php:313 MEBEpochClientUtils::requireEpochReturnShapeFromPersistentEpochsTableDirectly()"),d[100]=c.createArray(),d[102]=(d[100].push(d[99]),d[100]),d[101]=new c.Map(),d[101].set("value",void 0),d[101].set("errors",d[100]),d[76]=d[101]))},function(a){return d[77]=d[76].get("value"),d[77]!==void 0?(d[99]=d[77].get("epoch_id"),d[100]=d[77].get("backup_id"),d[101]=d[77].get("epoch_anon_id_blob"),d[102]=d[77].get("epoch_root_key_blob"),d[103]=d[77].get("epoch_status"),d[104]=d[77].get("epoch_head"),d[105]=d[77].get("authority_level"),d[106]=d[76],d[78]=d[106]):(d[99]=d[76].get("errors"),d[100]=d[76].get("errors"),d[101]=new c.Map(),d[101].set("value",void 0),d[101].set("errors",d[99]),d[78]=d[101]),d[79]=d[78].get("value"),d[79]!==void 0?(d[99]=d[79].get("epoch_id"),d[100]=d[79].get("backup_id"),d[101]=d[79].get("epoch_anon_id_blob"),d[102]=d[79].get("epoch_root_key_blob"),d[103]=d[79].get("epoch_status"),d[104]=d[79].get("epoch_head"),d[105]=d[79].get("authority_level"),d[80]=d[78]):(d[99]=d[78].get("errors"),d[100]=d[78].get("errors"),d[101]=new c.Map(),d[101].set("error_msg","EB_EPOCH_SRC_EPOCH_MISSING"),d[101].set("code",c.i64.cast([0,10003])),d[101].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:342 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processEdge()"),d[103]=(d[99].push(d[101]),d[99]),d[102]=new c.Map(),d[102].set("value",void 0),d[102].set("errors",d[99]),d[80]=d[102]),d[81]=d[80].get("value"),d[81]!==void 0?(d[99]=d[81].get("epoch_id"),d[100]=d[81].get("backup_id"),d[101]=d[81].get("epoch_anon_id_blob"),d[102]=d[81].get("epoch_root_key_blob"),d[103]=d[81].get("epoch_status"),d[104]=d[81].get("epoch_head"),d[105]=d[81].get("authority_level"),d[106]=d[71].get("from_epoch"),d[107]=d[106].get("epoch_anon_id"),c.blobs.eq(d[107],d[101])?d[108]=d[80]:(d[109]=new c.Map(),d[109].set("error_msg","EB_EPOCH_DERIVATION_SRC_ANON_ID_MISMATCH"),d[109].set("code",c.i64.cast([0,10007])),d[109].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:347 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processEdge#2()"),d[110]=c.createArray(),d[112]=(d[110].push(d[109]),d[110]),d[111]=new c.Map(),d[111].set("value",void 0),d[111].set("errors",d[110]),d[108]=d[111]),d[82]=d[108]):(d[99]=d[80].get("errors"),d[100]=d[80].get("errors"),d[101]=new c.Map(),d[101].set("value",void 0),d[101].set("errors",d[99]),d[82]=d[101]),d[83]=d[82].get("value"),d[83]!==void 0?c.sequence([function(a){return d[99]=d[83].get("epoch_id"),d[100]=d[83].get("backup_id"),d[101]=d[83].get("epoch_anon_id_blob"),d[102]=d[83].get("epoch_root_key_blob"),d[103]=d[83].get("epoch_status"),d[104]=d[83].get("epoch_head"),d[105]=d[83].get("authority_level"),d[106]=d[71].get("from_epoch_fingerprint"),d[107]=c.createArray(),d[112]=(d[107].push(c.i64.cast([0,18])),d[107]),c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,d[102],d[107]).then(function(a){return a=a,d[108]=a[0],a})},function(a){return d[108]!==void 0?c.sequence([function(a){return d[112]=c.i64.of_int32(d[108].length),c.i64.ge(d[112],c.i64.cast([0,1]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[108],c.i64.cast([0,0])).then(function(a){return a=a,d[114]=a[0],d[115]=a[1],a})},function(a){return d[113]=d[114]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[115]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBFingerprint] ","",d[115]].join("")),d[114]=c.createArray(),void 0!==void 0?d[116]=(d[114].push(void 0),d[114]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint",d[115],d[114],c.i64.cast([0,3]))},function(a){return d[113]=void 0}])},function(a){return d[109]=d[113]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[113]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBFingerprint] ","",d[113]].join("")),d[112]=c.createArray(),void 0!==void 0?d[114]=(d[112].push(void 0),d[112]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint",d[113],d[112],c.i64.cast([0,3]))},function(a){return d[109]=void 0}])},function(a){return c.blobs.neq(d[109],void 0)?d[110]=!0:d[110]=!1,d[110]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),c.blobs.eq(d[106],void 0)||c.blobs.eq(d[106],d[109])?d[111]=d[82]:(d[112]=new c.Map(),d[112].set("error_msg","EB_EPOCH_DERIVATION_SRC_FINGERPRINT_MISMATCH"),d[112].set("code",c.i64.cast([0,10002])),d[112].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:356 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processEdge#4()"),d[113]=c.createArray(),d[115]=(d[113].push(d[112]),d[113]),d[114]=new c.Map(),d[114].set("value",void 0),d[114].set("errors",d[113]),d[111]=d[114]),d[84]=d[111]}]):c.resolve((d[99]=d[82].get("errors"),d[100]=d[82].get("errors"),d[101]=new c.Map(),d[101].set("value",void 0),d[101].set("errors",d[99]),d[84]=d[101]))},function(a){return d[85]=d[71].get("forward_edge"),d[85]!==void 0?c.sequence([function(a){return d[99]=d[84].get("value"),d[99]!==void 0?c.sequence([function(a){return d[113]=d[99].get("epoch_id"),d[114]=d[99].get("backup_id"),d[115]=d[99].get("epoch_anon_id_blob"),d[116]=d[99].get("epoch_root_key_blob"),d[117]=d[99].get("epoch_status"),d[118]=d[99].get("epoch_head"),d[119]=d[99].get("authority_level"),c.nativeOperation(b("LSGetNextEpochAnonId.nop"),d[115]).then(function(a){return a=a,d[120]=a[0],a})},function(a){return d[121]=d[71].get("to_epoch"),d[122]=d[121].get("epoch_anon_id"),c.blobs.eq(d[120],d[122])?d[123]=d[84]:(d[124]=new c.Map(),d[124].set("error_msg","EB_EPOCH_FORWARD_EDGE_NOT_CONSECUTIVE"),d[124].set("code",c.i64.cast([0,10009])),d[124].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:114 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processForwardEdge()"),d[125]=c.createArray(),d[127]=(d[125].push(d[124]),d[125]),d[126]=new c.Map(),d[126].set("value",void 0),d[126].set("errors",d[125]),d[123]=d[126]),d[100]=d[123]}]):c.resolve((d[113]=d[84].get("errors"),d[114]=d[84].get("errors"),d[115]=new c.Map(),d[115].set("value",void 0),d[115].set("errors",d[113]),d[100]=d[115]))},function(a){return d[101]=d[100].get("value"),d[101]!==void 0?c.sequence([function(a){return d[113]=d[101].get("epoch_id"),d[114]=d[101].get("backup_id"),d[115]=d[101].get("epoch_anon_id_blob"),d[116]=d[101].get("epoch_root_key_blob"),d[117]=d[101].get("epoch_status"),d[118]=d[101].get("epoch_head"),d[119]=d[101].get("authority_level"),d[120]=d[71].get("from_epoch"),d[121]=d[120].get("epoch_anon_id"),d[122]=d[71].get("from_epoch"),d[123]=d[122].get("epoch_id"),d[124]=c.createArray(),d[133]=(d[124].push(c.i64.cast([0,32])),d[124]),d[133]=(d[124].push(c.i64.cast([0,32])),d[124]),d[125]="_",c.nativeOperation(b("LSGetBlobFromString.nop"),["epoch_chaining",d[125],c.blobs.to_string(d[121]),d[125],c.i64.to_string(d[123])].join("")).then(function(a){return a=a,d[126]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[126],void 0,d[116],d[124]).then(function(a){return a=a,d[127]=a[0],a})},function(a){return d[127]?d[128]=!1:d[128]=!0,d[128]?c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] Failed to generate epoch_chaining_key and epoch_distribution_pre_shared_key."),d[134]="Failed to generate epoch_chaining_key and epoch_distribution_pre_shared_key.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoEpochUtils] ","",d[134]].join("")),d[133]=c.createArray(),void 0!==void 0?d[137]=(d[133].push(void 0),d[133]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",d[134],d[133],c.i64.cast([0,3]))},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,d[135]=a[0],a})},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,d[136]=a[0],a})},function(a){return a=[d[135],d[136]],d[129]=a[0],d[130]=a[1],a}]):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[127],c.i64.cast([0,0])).then(function(a){return a=a,d[133]=a[0],d[134]=a[1],a})},function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[127],c.i64.cast([0,1])).then(function(a){return a=a,d[135]=a[0],d[136]=a[1],a})},function(a){return a=[d[133],d[135]],d[129]=a[0],d[130]=a[1],a}])},function(a){return d[131]=new c.Map(),d[131].set("epoch_chaining_key",d[129]),d[131].set("epoch_distribution_pre_shared_key",d[130]),d[132]=new c.Map(),d[132].set("value",d[131]),d[132].set("errors",void 0),d[102]=d[132]}]):c.resolve((d[113]=d[100].get("errors"),d[114]=d[100].get("errors"),d[115]=new c.Map(),d[115].set("value",void 0),d[115].set("errors",d[113]),d[102]=d[115]))},function(a){return d[103]=d[102].get("value"),d[103]!==void 0?c.sequence([function(a){return d[113]=d[103].get("epoch_chaining_key"),d[114]=d[103].get("epoch_distribution_pre_shared_key"),d[115]=d[85].get("psk_fingerprint"),d[116]=c.createArray(),d[121]=(d[116].push(c.i64.cast([0,18])),d[116]),c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkNyeXB0b1ByZVNoYXJlZEtleQ=="),void 0,d[114],d[116]).then(function(a){return a=a,d[117]=a[0],a})},function(a){return d[117]!==void 0?c.sequence([function(a){return d[121]=c.i64.of_int32(d[117].length),c.i64.ge(d[121],c.i64.cast([0,1]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[117],c.i64.cast([0,0])).then(function(a){return a=a,d[123]=a[0],d[124]=a[1],a})},function(a){return d[122]=d[123]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[124]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBFingerprint] ","",d[124]].join("")),d[123]=c.createArray(),void 0!==void 0?d[125]=(d[123].push(void 0),d[123]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint",d[124],d[123],c.i64.cast([0,3]))},function(a){return d[122]=void 0}])},function(a){return d[118]=d[122]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[122]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBFingerprint] ","",d[122]].join("")),d[121]=c.createArray(),void 0!==void 0?d[123]=(d[121].push(void 0),d[121]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint",d[122],d[121],c.i64.cast([0,3]))},function(a){return d[118]=void 0}])},function(a){return c.blobs.neq(d[118],void 0)?d[119]=!0:d[119]=!1,d[119]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),c.blobs.eq(d[115],void 0)||c.blobs.eq(d[115],d[118])?d[120]=d[102]:(d[121]=new c.Map(),d[121].set("error_msg","EB_EPOCH_DERIVATION_PSK_FINGERPRINT_MISMATCH"),d[121].set("code",c.i64.cast([0,10005])),d[121].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:140 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processForwardEdge#4()"),d[122]=c.createArray(),d[124]=(d[122].push(d[121]),d[122]),d[123]=new c.Map(),d[123].set("value",void 0),d[123].set("errors",d[122]),d[120]=d[123]),d[104]=d[120]}]):c.resolve((d[113]=d[102].get("errors"),d[114]=d[102].get("errors"),d[115]=new c.Map(),d[115].set("value",void 0),d[115].set("errors",d[113]),d[104]=d[115]))},function(a){return d[105]=d[104].get("value"),d[105]!==void 0?(d[113]=d[105].get("epoch_chaining_key"),d[114]=d[105].get("epoch_distribution_pre_shared_key"),d[115]=d[85].get("epoch_storage_public_key"),c.blobs.eq(d[115],void 0)||c.blobs.eq(d[115],d[29])?d[116]=d[104]:(d[117]=new c.Map(),d[117].set("error_msg","EB_EPOCH_DERIVATION_STORAGE_KEY_MISMATCH"),d[117].set("code",c.i64.cast([0,10006])),d[117].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:154 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processForwardEdge#7()"),d[118]=c.createArray(),d[120]=(d[118].push(d[117]),d[118]),d[119]=new c.Map(),d[119].set("value",void 0),d[119].set("errors",d[118]),d[116]=d[119]),d[106]=d[116]):(d[113]=d[104].get("errors"),d[114]=d[104].get("errors"),d[115]=new c.Map(),d[115].set("value",void 0),d[115].set("errors",d[113]),d[106]=d[115]),d[107]=d[106].get("value"),d[107]!==void 0?c.sequence([function(a){return d[113]=d[107].get("epoch_chaining_key"),d[114]=d[107].get("epoch_distribution_pre_shared_key"),d[115]=d[85].get("auth_public_key"),d[116]=d[71].get("to_epoch"),d[117]=d[116].get("epoch_anon_id"),d[118]=d[85].get("encrypted_entropy"),c.nativeOperation(b("LSPublicEncryptionCreateDecryptedData.nop"),d[29],d[30],d[115],d[114],c.blobs.of_string(["epoch_","_",c.blobs.to_string(d[117])].join("")),d[118]).then(function(a){return a=a,d[119]=a[0],a})},function(a){return c.blobs.neq(d[119],void 0)?c.resolve(d[120]=d[119]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] Couldn't decrypt epoch key. Returning null entropy"),d[127]="Couldn't decrypt epoch key. Returning null entropy",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoEpochUtils] ","",d[127]].join("")),d[126]=c.createArray(),void 0!==void 0?d[128]=(d[126].push(void 0),d[126]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",d[127],d[126],c.i64.cast([0,3]))},function(a){return d[120]=void 0}])},function(a){return c.blobs.neq(d[120],void 0)?(d[126]=new c.Map(),d[126].set("entropy",d[120]),d[127]=new c.Map(),d[127].set("value",d[126]),d[127].set("errors",void 0),d[128]=d[127].get("value"),d[129]=d[127].get("errors"),a=[d[128],d[129]],d[121]=a[0],d[122]=a[1]):(d[126]=c.createArray(),c.blobs.eq(d[120],void 0)?d[133]=(d[126].push("entropy"),d[126]):0,d[127]=d[126].join(", "),d[128]=new c.Map(),d[128].set("error_msg",["The following required nullables are null: ","",d[127]].join("")),d[128].set("code",c.i64.cast([0,2])),d[128].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:179 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processForwardEdge#11()"),d[129]=c.createArray(),d[133]=(d[129].push(d[128]),d[129]),d[130]=new c.Map(),d[130].set("value",void 0),d[130].set("errors",d[129]),d[131]=d[130].get("value"),d[132]=d[130].get("errors"),a=[d[131],d[132]],d[121]=a[0],d[122]=a[1]),d[123]=new c.Map(),d[123].set("value",d[121]),d[123].set("errors",d[122]),d[124]=d[123].get("value"),d[124]!==void 0?(d[126]=d[124].get("entropy"),d[125]=d[123]):(d[126]=d[123].get("errors"),d[127]=d[123].get("errors"),d[128]=new c.Map(),d[128].set("error_msg","EB_EPOCH_FORWARD_DECRYPTION_FAILED"),d[128].set("code",c.i64.cast([0,10004])),d[128].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:181 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processForwardEdge#10()"),d[130]=(d[126].push(d[128]),d[126]),d[129]=new c.Map(),d[129].set("value",void 0),d[129].set("errors",d[126]),d[125]=d[129]),d[108]=d[125]}]):c.resolve((d[113]=d[106].get("errors"),d[114]=d[106].get("errors"),d[115]=new c.Map(),d[115].set("value",void 0),d[115].set("errors",d[113]),d[108]=d[115]))},function(a){return d[109]=d[106].get("value"),d[109]!==void 0?c.sequence([function(a){return d[113]=d[109].get("epoch_chaining_key"),d[114]=d[109].get("epoch_distribution_pre_shared_key"),d[115]=d[108].get("value"),d[115]!==void 0?c.sequence([function(a){return d[117]=d[115].get("entropy"),d[118]=c.createArray(),d[125]=(d[118].push(c.i64.cast([0,32])),d[118]),c.nativeOperation(b("LSGetBlobFromString.nop"),"epoch_root_key").then(function(a){return a=a,d[119]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[119],d[113],d[117],d[118]).then(function(a){return a=a,d[120]=a[0],a})},function(a){return d[120]?d[121]=!1:d[121]=!0,d[121]?c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] Unable to generate epoch root key."),d[126]="Unable to generate epoch root key.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoEpochUtils] ","",d[126]].join("")),d[125]=c.createArray(),void 0!==void 0?d[128]=(d[125].push(void 0),d[125]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",d[126],d[125],c.i64.cast([0,3]))},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,d[127]=a[0],a})},function(a){return d[122]=d[127]}]):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[120],c.i64.cast([0,0])).then(function(a){return a=a,d[125]=a[0],d[126]=a[1],a})},function(a){return d[122]=d[125]}])},function(a){return d[123]=new c.Map(),d[123].set("root_key",d[122]),d[124]=new c.Map(),d[124].set("value",d[123]),d[124].set("errors",void 0),d[116]=d[124]}]):c.resolve((d[117]=d[108].get("errors"),d[118]=d[108].get("errors"),d[119]=new c.Map(),d[119].set("value",void 0),d[119].set("errors",d[117]),d[116]=d[119]))},function(a){return d[110]=d[116]}]):c.resolve((d[113]=d[106].get("errors"),d[114]=d[106].get("errors"),d[115]=new c.Map(),d[115].set("value",void 0),d[115].set("errors",d[113]),d[110]=d[115]))},function(a){return d[111]=d[110].get("value"),d[112]=d[110].get("errors"),a=[d[111],d[112]],d[86]=a[0],d[87]=a[1]}]):c.sequence([function(a){return d[99]=d[71].get("backward_edge"),c.blobs.neq(d[99],void 0)?c.sequence([function(a){return d[105]=d[84].get("value"),d[105]!==void 0?c.sequence([function(a){return d[113]=d[105].get("epoch_id"),d[114]=d[105].get("backup_id"),d[115]=d[105].get("epoch_anon_id_blob"),d[116]=d[105].get("epoch_root_key_blob"),d[117]=d[105].get("epoch_status"),d[118]=d[105].get("epoch_head"),d[119]=d[105].get("authority_level"),d[120]=d[71].get("to_epoch"),d[121]=d[120].get("epoch_anon_id"),c.nativeOperation(b("LSGetNextEpochAnonId.nop"),d[121]).then(function(a){return a=a,d[122]=a[0],a})},function(a){return c.blobs.eq(d[122],d[115])?d[123]=d[84]:(d[124]=new c.Map(),d[124].set("error_msg","EB_EPOCH_BACKWARD_EDGE_NOT_CONSECUTIVE"),d[124].set("code",c.i64.cast([0,10010])),d[124].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:208 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processBackwardEdge()"),d[125]=c.createArray(),d[127]=(d[125].push(d[124]),d[125]),d[126]=new c.Map(),d[126].set("value",void 0),d[126].set("errors",d[125]),d[123]=d[126]),d[106]=d[123]}]):c.resolve((d[113]=d[84].get("errors"),d[114]=d[84].get("errors"),d[115]=new c.Map(),d[115].set("value",void 0),d[115].set("errors",d[113]),d[106]=d[115]))},function(a){return d[107]=d[106].get("value"),d[107]!==void 0?c.sequence([function(a){return d[113]=d[107].get("epoch_id"),d[114]=d[107].get("backup_id"),d[115]=d[107].get("epoch_anon_id_blob"),d[116]=d[107].get("epoch_root_key_blob"),d[117]=d[107].get("epoch_status"),d[118]=d[107].get("epoch_head"),d[119]=d[107].get("authority_level"),d[120]=c.createArray(),d[125]=(d[120].push(c.i64.cast([0,32])),d[120]),c.nativeOperation(b("LSBase64Encode.nop"),d[115]).then(function(a){return a=a,d[121]=a[0],a})},function(a){return d[121]!==void 0?c.sequence([function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blobs.of_string(["epoch_data_storage","_",d[121]].join("")),void 0,d[116],d[120]).then(function(a){return a=a,d[125]=a[0],a})},function(a){return d[125]?d[126]=!1:d[126]=!0,d[126]?c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish"),d[129]="THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoEpochUtils] ","",d[129]].join("")),d[128]=c.createArray(),void 0!==void 0?d[131]=(d[128].push(void 0),d[128]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",d[129],d[128],c.i64.cast([0,3]))},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,d[130]=a[0],a})},function(a){return d[127]=d[130]}]):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[125],c.i64.cast([0,0])).then(function(a){return a=a,d[128]=a[0],d[129]=a[1],a})},function(a){return d[127]=d[128]}])},function(a){return d[122]=d[127]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish"),d[126]="THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoEpochUtils] ","",d[126]].join("")),d[125]=c.createArray(),void 0!==void 0?d[128]=(d[125].push(void 0),d[125]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",d[126],d[125],c.i64.cast([0,3]))},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,d[127]=a[0],a})},function(a){return d[122]=d[127]}])},function(a){return d[123]=new c.Map(),d[123].set("epoch_data_storage_key",d[122]),d[124]=new c.Map(),d[124].set("value",d[123]),d[124].set("errors",void 0),d[108]=d[124]}]):c.resolve((d[113]=d[106].get("errors"),d[114]=d[106].get("errors"),d[115]=new c.Map(),d[115].set("value",void 0),d[115].set("errors",d[113]),d[108]=d[115]))},function(a){return d[109]=d[108].get("value"),d[109]!==void 0?c.sequence([function(a){return d[113]=d[109].get("epoch_data_storage_key"),c.nativeOperation(b("LSBase64Encode.nop"),d[99]).then(function(a){return a=a,d[114]=a[0],a})},function(a){return d[121]=d[114],d[121]!==void 0?c.sequence([function(a){return c.nativeOperation(b("LSSymmetricEncryptionCreateDecryptedString.nop"),d[113],c.blob("ZXBvY2hfZGF0YV9tZXRhZGF0YQ=="),d[121]).then(function(a){return a=a,d[122]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Decode.nop"),d[122]).then(function(a){return a=a,d[123]=a[0],a})},function(a){return d[115]=d[123]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] Unable to base64 encode backward edge."),d[123]="Unable to base64 encode backward edge.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoEpochUtils] ","",d[123]].join("")),d[122]=c.createArray(),void 0!==void 0?d[124]=(d[122].push(void 0),d[122]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",d[123],d[122],c.i64.cast([0,3]))},function(a){return d[115]=void 0}])},function(a){return c.blobs.neq(d[115],void 0)?(d[122]=new c.Map(),d[122].set("root_key",d[115]),d[123]=new c.Map(),d[123].set("value",d[122]),d[123].set("errors",void 0),d[124]=d[123].get("value"),d[125]=d[123].get("errors"),a=[d[124],d[125]],d[116]=a[0],d[117]=a[1]):(d[122]=c.createArray(),c.blobs.eq(d[115],void 0)?d[129]=(d[122].push("root_key"),d[122]):0,d[123]=d[122].join(", "),d[124]=new c.Map(),d[124].set("error_msg",["The following required nullables are null: ","",d[123]].join("")),d[124].set("code",c.i64.cast([0,2])),d[124].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:237 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processBackwardEdge#5()"),d[125]=c.createArray(),d[129]=(d[125].push(d[124]),d[125]),d[126]=new c.Map(),d[126].set("value",void 0),d[126].set("errors",d[125]),d[127]=d[126].get("value"),d[128]=d[126].get("errors"),a=[d[127],d[128]],d[116]=a[0],d[117]=a[1]),d[118]=new c.Map(),d[118].set("value",d[116]),d[118].set("errors",d[117]),d[119]=d[118].get("value"),d[119]!==void 0?(d[122]=d[119].get("root_key"),d[120]=d[118]):(d[122]=d[118].get("errors"),d[123]=d[118].get("errors"),d[124]=new c.Map(),d[124].set("error_msg","EB_EPOCH_BACKWARD_DECRYPTION_FAILED"),d[124].set("code",c.i64.cast([0,10013])),d[124].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:239 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processBackwardEdge#4()"),d[126]=(d[122].push(d[124]),d[122]),d[125]=new c.Map(),d[125].set("value",void 0),d[125].set("errors",d[122]),d[120]=d[125]),d[110]=d[120]}]):c.resolve((d[113]=d[108].get("errors"),d[114]=d[108].get("errors"),d[115]=new c.Map(),d[115].set("value",void 0),d[115].set("errors",d[113]),d[110]=d[115]))},function(a){return d[111]=d[110].get("value"),d[112]=d[110].get("errors"),a=[d[111],d[112]],d[100]=a[0],d[101]=a[1]}]):c.resolve((d[105]=new c.Map(),d[105].set("error_msg","EB_EPOCH_EDGE_NEITHER_FORWARD_NOR_BACKWARD"),d[105].set("code",c.i64.cast([0,10008])),d[105].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:381 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processEdge#9()"),d[106]=c.createArray(),d[110]=(d[106].push(d[105]),d[106]),d[107]=new c.Map(),d[107].set("value",void 0),d[107].set("errors",d[106]),d[108]=d[107].get("value"),d[109]=d[107].get("errors"),a=[d[108],d[109]],d[100]=a[0],d[101]=a[1]))},function(a){return d[102]=new c.Map(),d[102].set("value",d[100]),d[102].set("errors",d[101]),d[103]=d[102].get("value"),d[104]=d[102].get("errors"),a=[d[103],d[104]],d[86]=a[0],d[87]=a[1]}])},function(a){return d[88]=new c.Map(),d[88].set("value",d[86]),d[88].set("errors",d[87]),d[89]=d[88].get("value"),d[89]!==void 0?c.sequence([function(a){return d[99]=d[89].get("root_key"),d[100]=d[71].get("to_epoch_fingerprint"),d[101]=c.createArray(),d[106]=(d[101].push(c.i64.cast([0,18])),d[101]),c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,d[99],d[101]).then(function(a){return a=a,d[102]=a[0],a})},function(a){return d[102]!==void 0?c.sequence([function(a){return d[106]=c.i64.of_int32(d[102].length),c.i64.ge(d[106],c.i64.cast([0,1]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[102],c.i64.cast([0,0])).then(function(a){return a=a,d[108]=a[0],d[109]=a[1],a})},function(a){return d[107]=d[108]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[109]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBFingerprint] ","",d[109]].join("")),d[108]=c.createArray(),void 0!==void 0?d[110]=(d[108].push(void 0),d[108]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint",d[109],d[108],c.i64.cast([0,3]))},function(a){return d[107]=void 0}])},function(a){return d[103]=d[107]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[107]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBFingerprint] ","",d[107]].join("")),d[106]=c.createArray(),void 0!==void 0?d[108]=(d[106].push(void 0),d[106]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint",d[107],d[106],c.i64.cast([0,3]))},function(a){return d[103]=void 0}])},function(a){return c.blobs.neq(d[103],void 0)?d[104]=!0:d[104]=!1,d[104]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),c.blobs.eq(d[100],void 0)||c.blobs.eq(d[100],d[103])?d[105]=d[88]:(d[106]=new c.Map(),d[106].set("error_msg","EB_EPOCH_DERIVATION_DEST_FINGERPRINT_MISMATCH"),d[106].set("code",c.i64.cast([0,10001])),d[106].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:385 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processEdge#11()"),d[107]=c.createArray(),d[109]=(d[107].push(d[106]),d[107]),d[108]=new c.Map(),d[108].set("value",void 0),d[108].set("errors",d[107]),d[105]=d[108]),d[90]=d[105]}]):c.resolve((d[99]=d[88].get("errors"),d[100]=d[88].get("errors"),d[101]=new c.Map(),d[101].set("value",void 0),d[101].set("errors",d[99]),d[90]=d[101]))},function(a){return d[91]=d[90].get("value"),d[91]!==void 0?c.sequence([function(a){return d[99]=d[91].get("root_key"),d[100]=d[71].get("to_minos_epoch"),d[100]!==void 0?(d[121]=d[100].get("epoch_head"),d[101]=d[121]):d[101]=void 0,d[102]=d[71].get("to_epoch"),d[103]=d[102].get("epoch_id"),d[104]=d[71].get("to_epoch"),d[105]=d[104].get("epoch_anon_id"),c.storedProcedure(b("LSStoreEpoch"),d[103],d[26],d[105],d[99],c.i64.cast([0,2]),c.i64.cast([0,80]),!1,d[101])},function(a){return d[106]=d[71].get("from_epoch"),d[107]=d[106].get("epoch_anon_id"),d[108]=d[71].get("from_epoch"),d[109]=d[108].get("epoch_id"),d[110]=new c.Map(),d[110].set("epoch_anon_id",d[107]),d[110].set("epoch_id",d[109]),d[111]=d[71].get("to_epoch"),d[112]=d[111].get("epoch_anon_id"),d[113]=d[71].get("to_epoch"),d[114]=d[113].get("epoch_id"),d[115]=new c.Map(),d[115].set("epoch_anon_id",d[112]),d[115].set("epoch_id",d[114]),d[116]=d[71].get("forward_edge"),d[116]?d[117]=!1:d[117]=!0,d[117]?d[118]=!1:d[118]=!0,d[119]=d[71].get("backward_edge"),c.blobs.neq(d[119],void 0)?d[120]=!0:d[120]=!1,a=[d[110],d[115],d[118],d[120],void 0,c.i64.cast([0,0])],d[92]=a[0],d[93]=a[1],d[94]=a[2],d[95]=a[3],d[96]=a[4],d[97]=a[5]}]):c.sequence([function(a){return d[99]=d[90].get("errors"),d[100]=d[90].get("errors"),d[101]=c.i64.of_int32(d[99].length),c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[99],c.i64.sub(d[101],c.i64.cast([0,1]))).then(function(a){return a=a,d[102]=a[0],d[103]=a[1],a})},function(a){return d[104]=d[102].get("code"),d[105]=d[102].get("src_line"),d[106]=d[102].get("error_msg"),c.i64.eq(d[104],c.i64.cast([0,10004]))?d[107]=c.i64.cast([0,3]):(c.i64.eq(d[104],c.i64.cast([0,10003]))?d[125]=c.i64.cast([0,13]):(c.i64.eq(d[104],c.i64.cast([0,10002]))?d[126]=c.i64.cast([0,9]):(c.i64.eq(d[104],c.i64.cast([0,10001]))?d[127]=c.i64.cast([0,10]):(c.i64.eq(d[104],c.i64.cast([0,10005]))?d[128]=c.i64.cast([0,12]):(c.i64.eq(d[104],c.i64.cast([0,10006]))?d[129]=c.i64.cast([0,11]):(c.i64.eq(d[104],c.i64.cast([0,10008]))?d[130]=c.i64.cast([0,2]):(c.i64.eq(d[104],c.i64.cast([0,10009]))?d[131]=c.i64.cast([0,14]):(c.i64.eq(d[104],c.i64.cast([0,10010]))?d[132]=c.i64.cast([0,15]):(c.i64.eq(d[104],c.i64.cast([0,10011]))?d[133]=c.i64.cast([0,16]):(c.i64.eq(d[104],c.i64.cast([0,10012]))?d[134]=c.i64.cast([0,17]):(c.i64.eq(d[104],c.i64.cast([0,10013]))?d[135]=c.i64.cast([0,6]):d[135]=c.i64.cast([0,1]),d[134]=d[135]),d[133]=d[134]),d[132]=d[133]),d[131]=d[132]),d[130]=d[131]),d[129]=d[130]),d[128]=d[129]),d[127]=d[128]),d[126]=d[127]),d[125]=d[126]),d[107]=d[125]),d[108]="",d[109]=c.i64.of_int32(d[99].length),c.i64.gt(d[109],c.i64.cast([0,0]))?c.loopAsync(d[109],function(a){return d[125]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[99],d[125]).then(function(a){return a=a,d[126]=a[0],d[127]=a[1],a})},function(a){return d[128]=d[126].get("code"),d[129]=d[126].get("src_line"),d[130]=d[126].get("error_msg"),d[131]=d[126].get("code"),d[132]=d[126].get("src_line"),d[133]=d[126].get("error_msg"),d[134]=d[126].get("code"),d[135]=d[126].get("src_line"),d[136]=d[126].get("error_msg"),d[108]=[d[108],["at ",d[129],": ","error code ",c.i64.to_string(d[131]),": ",d[136]].join(""),"\n"].join("")}])}):c.resolve()},function(a){return d[110]=d[71].get("from_epoch"),d[111]=d[110].get("epoch_anon_id"),d[112]=d[71].get("from_epoch"),d[113]=d[112].get("epoch_id"),d[114]=new c.Map(),d[114].set("epoch_anon_id",d[111]),d[114].set("epoch_id",d[113]),d[115]=d[71].get("to_epoch"),d[116]=d[115].get("epoch_anon_id"),d[117]=d[71].get("to_epoch"),d[118]=d[117].get("epoch_id"),d[119]=new c.Map(),d[119].set("epoch_anon_id",d[116]),d[119].set("epoch_id",d[118]),d[120]=d[71].get("forward_edge"),d[120]?d[121]=!1:d[121]=!0,d[121]?d[122]=!1:d[122]=!0,d[123]=d[71].get("backward_edge"),c.blobs.neq(d[123],void 0)?d[124]=!0:d[124]=!1,a=[d[114],d[119],d[122],d[124],d[108],d[107]],d[92]=a[0],d[93]=a[1],d[94]=a[2],d[95]=a[3],d[96]=a[4],d[97]=a[5]}])},function(a){return d[98]=new c.Map(),d[98].set("from",d[92]),d[98].set("to",d[93]),d[98].set("has_forward_edge",d[94]),d[98].set("has_backward_edge",d[95]),d[98].set("error_message",d[96]),d[98].set("result_code",d[97]),d[99]=(d[68].push(d[98]),d[68])}])}):c.resolve()},function(b){return b=[d[38],d[38],a[1],a[2],c.i64.cast([0,0]),c.i64.cast([0,0]),d[68],!1,void 0],d[59]=b[0],d[60]=b[1],d[61]=b[2],d[62]=b[3],d[63]=b[4],d[64]=b[5],d[65]=b[6],d[66]=b[7],d[67]=b[8],b}])},function(a){return a=[d[59],d[60],d[61],d[62],d[63],d[64],d[65],d[66],d[67]],d[45]=a[0],d[46]=a[1],d[47]=a[2],d[48]=a[3],d[49]=a[4],d[50]=a[5],d[51]=a[6],d[52]=a[7],d[53]=a[8],a}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure] Unable to load client state: 24"),d[55]="Unable to load client state: 24",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure] ","",d[55]].join("")),d[54]=c.createArray(),void 0!==void 0?d[58]=(d[54].push(void 0),d[54]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure",d[55],d[54],c.i64.cast([0,3]))},function(e){return d[56]=c.createArray(),d[57]=c.i64.of_int32(a[0].length),c.i64.gt(d[57],c.i64.cast([0,0]))?c.loopAsync(d[57],function(e){return d[58]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[0],d[58]).then(function(a){return a=a,d[59]=a[0],d[60]=a[1],a})},function(a){return d[61]=d[59].get("from_epoch"),d[62]=d[61].get("epoch_anon_id"),d[63]=d[59].get("from_epoch"),d[64]=d[63].get("epoch_id"),d[65]=new c.Map(),d[65].set("epoch_anon_id",d[62]),d[65].set("epoch_id",d[64]),d[66]=d[59].get("to_epoch"),d[67]=d[66].get("epoch_anon_id"),d[68]=d[59].get("to_epoch"),d[69]=d[68].get("epoch_id"),d[70]=new c.Map(),d[70].set("epoch_anon_id",d[67]),d[70].set("epoch_id",d[69]),d[71]=d[59].get("forward_edge"),d[71]?d[72]=!1:d[72]=!0,d[72]?d[73]=!1:d[73]=!0,d[74]=d[59].get("backward_edge"),c.blobs.neq(d[74],void 0)?d[75]=!0:d[75]=!1,d[76]=new c.Map(),d[76].set("from",d[65]),d[76].set("to",d[70]),d[76].set("has_forward_edge",d[73]),d[76].set("has_backward_edge",d[75]),d[76].set("result_code",c.i64.cast([0,7])),d[76].set("error_message",void 0),d[77]=(d[56].push(d[76]),d[56])}])}):c.resolve()},function(b){return b=[void 0,void 0,void 0,a[2],c.i64.cast([0,0]),c.i64.cast([0,0]),d[56],!1,void 0],d[45]=b[0],d[46]=b[1],d[47]=b[2],d[48]=b[3],d[49]=b[4],d[50]=b[5],d[51]=b[6],d[52]=b[7],d[53]=b[8],b}])},function(a){return a=[d[45],d[46],d[47],d[48],d[49],d[50],d[51],d[52],d[53]],d[16]=a[0],d[17]=a[1],d[18]=a[2],d[19]=a[3],d[20]=a[4],d[21]=a[5],d[22]=a[6],d[23]=a[7],d[24]=a[8],a}]):c.sequence([function(a){return d[26]=d[14].get("errors"),d[27]=d[14].get("errors"),function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure] Unable to load client state: 1"),d[29]="Unable to load client state: 1",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure] ","",d[29]].join("")),d[28]=c.createArray(),void 0!==void 0?d[32]=(d[28].push(void 0),d[28]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure",d[29],d[28],c.i64.cast([0,3]))},function(e){return d[30]=c.createArray(),d[31]=c.i64.of_int32(a[0].length),c.i64.gt(d[31],c.i64.cast([0,0]))?c.loopAsync(d[31],function(e){return d[32]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[0],d[32]).then(function(a){return a=a,d[33]=a[0],d[34]=a[1],a})},function(a){return d[35]=d[33].get("from_epoch"),d[36]=d[35].get("epoch_anon_id"),d[37]=d[33].get("from_epoch"),d[38]=d[37].get("epoch_id"),d[39]=new c.Map(),d[39].set("epoch_anon_id",d[36]),d[39].set("epoch_id",d[38]),d[40]=d[33].get("to_epoch"),d[41]=d[40].get("epoch_anon_id"),d[42]=d[33].get("to_epoch"),d[43]=d[42].get("epoch_id"),d[44]=new c.Map(),d[44].set("epoch_anon_id",d[41]),d[44].set("epoch_id",d[43]),d[45]=d[33].get("forward_edge"),d[45]?d[46]=!1:d[46]=!0,d[46]?d[47]=!1:d[47]=!0,d[48]=d[33].get("backward_edge"),c.blobs.neq(d[48],void 0)?d[49]=!0:d[49]=!1,d[50]=new c.Map(),d[50].set("from",d[39]),d[50].set("to",d[44]),d[50].set("has_forward_edge",d[47]),d[50].set("has_backward_edge",d[49]),d[50].set("result_code",c.i64.cast([0,7])),d[50].set("error_message",void 0),d[51]=(d[30].push(d[50]),d[30])}])}):c.resolve()},function(b){return b=[void 0,void 0,void 0,a[2],c.i64.cast([0,0]),c.i64.cast([0,0]),d[30],!1,void 0],d[16]=b[0],d[17]=b[1],d[18]=b[2],d[19]=b[3],d[20]=b[4],d[21]=b[5],d[22]=b[6],d[23]=b[7],d[24]=b[8],b}])},function(a){return d[25]=c.i64.of_float(Date.now()),c.storedProcedure(b("LSRecordEpochSyncStatus"),d[16],d[17],d[18],d[19],d[10],d[25],d[22],d[23])}]):c.resolve()},function(a){return d[2]=c.i64.of_float(Date.now()),d[3]=c.i64.random(),d[5]="Finishing execution. Execution time: ",d[6]=c.i64.to_string(c.i64.sub(d[2],d[0])),d[7]=" ms",d[4]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure] ",d[4],d[5],d[4],d[6],d[4],d[7]].join("")),c.i64.eq(c.i64.mod_(d[3],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[8]=",",d[9]=c.createArray(),void 0!==void 0?d[10]=(d[9].push(void 0),d[9]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure",[d[5],d[8],d[6],d[8],d[7]].join(""),d[9],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state","secure_encrypted_backups_epochs"];e.exports=a}),null);
__d("MAWAdminMsgTypesGrouped",["MAWLocalizationType"],(function(a,b,c,d,e,f,g){"use strict";b=[(a=d("MAWLocalizationType")).LOCALIZATION_TYPE.CUTOVER_IGD_THREAD_ADMIN_MESSAGE,a.LOCALIZATION_TYPE.CUTOVER_THREAD_ADMIN_MESSAGE,a.LOCALIZATION_TYPE.DUAL_THREAD_CUTOVER_ADMIN_MESSAGE];c=[a.LOCALIZATION_TYPE.CURRENT_USER_ADDED_DEVICE,a.LOCALIZATION_TYPE.CURRENT_USER_REMOVED_DEVICE,a.LOCALIZATION_TYPE.CURRENT_USER_UPDATED_DEVICE,a.LOCALIZATION_TYPE.PARTICIPANT_ADDED_DEVICE,a.LOCALIZATION_TYPE.PARTICIPANT_REMOVED_DEVICE,a.LOCALIZATION_TYPE.PARTICIPANT_UPDATED_DEVICE];e=[a.LOCALIZATION_TYPE.CURRENT_USER_ADDED_MORE_THAN_TWO_PARTICIPANTS,a.LOCALIZATION_TYPE.CURRENT_USER_ADDED_ONE_PARTICIPANT,a.LOCALIZATION_TYPE.CURRENT_USER_ADDED_TWO_PARTICIPANTS,a.LOCALIZATION_TYPE.CURRENT_USER_REMOVED_MORE_THAN_TWO_PARTICIPANTS,a.LOCALIZATION_TYPE.CURRENT_USER_REMOVED_ONE_PARTICIPANT,a.LOCALIZATION_TYPE.CURRENT_USER_REMOVED_TWO_PARTICIPANTS];f=[a.LOCALIZATION_TYPE.PARTICIPANT_ADDED_MORE_THAN_TWO_USER,a.LOCALIZATION_TYPE.PARTICIPANT_ADDED_ONE_USER,a.LOCALIZATION_TYPE.PARTICIPANT_ADDED_TWO_USER,a.LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU,a.LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_MORE_THAN_ONE_USERS,a.LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_ONE_USER,a.LOCALIZATION_TYPE.PARTICIPANT_REMOVED_MORE_THAN_TWO_USER,a.LOCALIZATION_TYPE.PARTICIPANT_REMOVED_ONE_USER,a.LOCALIZATION_TYPE.PARTICIPANT_REMOVED_TWO_USER,a.LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU,a.LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_MORE_THAN_ONE_USERS,a.LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_ONE_USER,a.LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_MORE_THAN_TWO_USER,a.LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_ONE_USER,a.LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_TWO_USER,a.LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU,a.LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU_AND_MORE_THAN_ONE_USER,a.LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU_AND_ONE_USER,a.LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_MORE_THAN_TWO_USER,a.LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_ONE_USER,a.LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_TWO_USER,a.LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_YOU,a.LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_YOU_AND_MORE_THAN_ONE_USER,a.LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_YOU_AND_ONE_USER];d=[a.LOCALIZATION_TYPE.CURRENT_USER_DEMOTED_PARTICIPANT,a.LOCALIZATION_TYPE.CURRENT_USER_PROMOTED_PARTICIPANT,a.LOCALIZATION_TYPE.PARTICIPANT_DEMOTED_PARTICIPANT,a.LOCALIZATION_TYPE.PARTICIPANT_PROMOTED_PARTICIPANT,a.LOCALIZATION_TYPE.CURRENT_USER_GOT_DEMOTED,a.LOCALIZATION_TYPE.CURRENT_USER_GOT_PROMOTED,a.LOCALIZATION_TYPE.CURRENT_USER_SELF_DEMOTED,a.LOCALIZATION_TYPE.PARTICIPANT_GOT_DEMOTED,a.LOCALIZATION_TYPE.PARTICIPANT_GOT_PROMOTED,a.LOCALIZATION_TYPE.PARTICIPANT_PROMOTED_YOU,a.LOCALIZATION_TYPE.PARTICIPANT_DEMOTED_YOU,a.LOCALIZATION_TYPE.PARTICIPANT_SELF_DEMOTED,a.LOCALIZATION_TYPE.CURRENT_USER_SET_ADD_MODE_ADMIN_ONLY,a.LOCALIZATION_TYPE.CURRENT_USER_SET_ADD_MODE_ALL_MEMBERS,a.LOCALIZATION_TYPE.PARTICIPANT_SET_ADD_MODE_ADMIN_ONLY,a.LOCALIZATION_TYPE.PARTICIPANT_SET_ADD_MODE_ALL_MEMBERS,a.LOCALIZATION_TYPE.SERVER_SET_ADD_MODE_ADMIN_ONLY,a.LOCALIZATION_TYPE.SERVER_SET_ADD_MODE_ALL_MEMBERS];var h=[a.LOCALIZATION_TYPE.CURRENT_USER_LEFT_GROUP,a.LOCALIZATION_TYPE.PARTICIPANT_LEFT_GROUP],i=[a.LOCALIZATION_TYPE.CURRENT_USER_NAMED_GROUP,a.LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_HOTLIKE,a.LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_NICKNAME,a.LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_PHOTO,a.LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_THEME,a.LOCALIZATION_TYPE.CURRENT_USER_CLEAR_OWN_NICKNAME,a.LOCALIZATION_TYPE.CURRENT_USER_CLEAR_PARTICIPANT_NICKNAME,a.LOCALIZATION_TYPE.CURRENT_USER_SET_OWN_NICKNAME,a.LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_AI_THEME],j=[a.LOCALIZATION_TYPE.PARTICIPANT_NAMED_GROUP,a.LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_CURRENT_USER_NICKNAME,a.LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_HOTLIKE,a.LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_PARTICIPANT_NICKNAME,a.LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_PHOTO,a.LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_THEME,a.LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_AI_THEME,a.LOCALIZATION_TYPE.UNKNOWN_USER_NAMED_GROUP,a.LOCALIZATION_TYPE.PARTICIPANT_CLEAR_CURRENT_USER_NICKNAME,a.LOCALIZATION_TYPE.PARTICIPANT_CLEAR_OWN_NICKNAME,a.LOCALIZATION_TYPE.PARTICIPANT_CLEAR_PARTICIPANT_NICKNAME,a.LOCALIZATION_TYPE.PARTICIPANT_SET_OWN_NICKNAME],k=[a.LOCALIZATION_TYPE.CURRENT_USER_PINNED_MESSAGE,a.LOCALIZATION_TYPE.CURRENT_USER_UNPINNED_MESSAGE,a.LOCALIZATION_TYPE.PARTICIPANT_PINNED_MESSAGE,a.LOCALIZATION_TYPE.PARTICIPANT_UNPINNED_MESSAGE],l=[a.LOCALIZATION_TYPE.CURRENT_USER_LIMIT_SHARING_ENABLED,a.LOCALIZATION_TYPE.CURRENT_USER_LIMIT_SHARING_DISABLED,a.LOCALIZATION_TYPE.PARTICIPANT_LIMIT_SHARING_ENABLED,a.LOCALIZATION_TYPE.PARTICIPANT_LIMIT_SHARING_DISABLED],m=[a.LOCALIZATION_TYPE.TWO_USERS_CONNECTED,a.LOCALIZATION_TYPE.TWO_USERS_CONNECTED_ONE_MSPLIT],n=[a.LOCALIZATION_TYPE.CURRENT_USER_SEND_UNRENDERABLE_MESSAGE_FALLBACK,a.LOCALIZATION_TYPE.CURRENT_USER_SEND_LIVE_LOCATION_FALLBACK,a.LOCALIZATION_TYPE.CURRENT_USER_SEND_LOCATION_FALLBACK,a.LOCALIZATION_TYPE.CURRENT_USER_SEND_POLL_CREATION_FALLBACK,a.LOCALIZATION_TYPE.CURRENT_USER_SEND_CONTACT_SHARE_FALLBACK,a.LOCALIZATION_TYPE.CURRENT_USER_SEND_STORY_MENTION_FALLBACK,a.LOCALIZATION_TYPE.CURRENT_USER_SEND_BUMP_MESSAGE_FALLBACK,a.LOCALIZATION_TYPE.CURRENT_USER_SEND_STICKER_RECEIVER_FETCH_MESSAGE_FALLBACK],o=[a.LOCALIZATION_TYPE.PARTICIPANT_SEND_UNRENDERABLE_MESSAGE_FALLBACK,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_LIVE_LOCATION_FALLBACK,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_LOCATION_FALLBACK,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_POLL_CREATION_FALLBACK,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_CONTACT_SHARE_FALLBACK,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_STORY_MENTION_FALLBACK,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_BUMP_MESSAGE,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_STICKER_RECEIVER_FETCH_MESSAGE_FALLBACK,a.LOCALIZATION_TYPE.MESSENGER_MEMORY_ENCRYPTED_MESSAGE_FALLBACK,a.LOCALIZATION_TYPE.META_AI_SEND_MESSAGE_FALLBACK,a.LOCALIZATION_TYPE.USER_SEND_UNAVAILABLE_MESSAGE_FALLBACK,a.LOCALIZATION_TYPE.USER_SEND_ENCRYPTED_MESSAGE_FALLBACK,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_BUMP_MESSAGE_ORIGINAL_UNAVAILABLE_FALLBACK,a.LOCALIZATION_TYPE.RTC_XMA_FALLBACK],p=[a.LOCALIZATION_TYPE.CURRENT_USER_BUMPED_MESSAGE,a.LOCALIZATION_TYPE.CURRENT_USER_BUMPED_OWN_MESSAGE],q=[a.LOCALIZATION_TYPE.PARTICIPANT_BUMPED_CURRENT_USER_MESSAGE,a.LOCALIZATION_TYPE.PARTICIPANT_BUMPED_OWN_MESSAGE,a.LOCALIZATION_TYPE.PARTICIPANT_BUMPED_PARTICIPANT_MESSAGE],r=[a.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_DAYS,a.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_HOURS,a.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_MINUTES,a.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_SECONDS,a.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_OFF,a.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_DAYS,a.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_HOURS,a.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_MINUTES,a.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_SECONDS,a.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_DAYS,a.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_HOURS,a.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_MINUTES,a.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_SECONDS,a.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_OFF,a.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_DAYS,a.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_HOURS,a.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_MINUTES,a.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_SECONDS,a.LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_DAYS,a.LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_HOURS,a.LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_MINUTES,a.LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_SECONDS,a.LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_OFF,a.LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_DAYS,a.LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_HOURS,a.LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_MINUTES,a.LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_SECONDS,a.LOCALIZATION_TYPE.EPHEMERAL_SETTINGS_AUTO_RESET],s=[a.LOCALIZATION_TYPE.YOUR_DEVICE_ICDC_ALERT_ADMIN_MESSAGE,a.LOCALIZATION_TYPE.ICDC_ALERT_ADMIN_MESSAGE],t=[a.LOCALIZATION_TYPE.CURRENT_USER_MISSED_AUDIO_CALL,a.LOCALIZATION_TYPE.CURRENT_USER_MISSED_VIDEO_CALL,a.LOCALIZATION_TYPE.PARTICIPANT_STARTED_GROUP_AUDIO_CALL,a.LOCALIZATION_TYPE.PARTICIPANT_STARTED_GROUP_VIDEO_CALL],u=[a.LOCALIZATION_TYPE.CURRENT_USER_AUDIO_CALLED,a.LOCALIZATION_TYPE.CURRENT_USER_STARTED_GROUP_AUDIO_CALL,a.LOCALIZATION_TYPE.CURRENT_USER_STARTED_GROUP_VIDEO_CALL,a.LOCALIZATION_TYPE.CURRENT_USER_VIDEO_CALLED,a.LOCALIZATION_TYPE.PARTICIPANT_MISSED_AUDIO_CALL,a.LOCALIZATION_TYPE.PARTICIPANT_MISSED_VIDEO_CALL,a.LOCALIZATION_TYPE.PARTICIPANT_AUDIO_CALLED,a.LOCALIZATION_TYPE.PARTICIPANT_VIDEO_CALLED],v=[a.LOCALIZATION_TYPE.CURRENT_USER_CREATED_GROUP,a.LOCALIZATION_TYPE.CURRENT_USER_MENTIONED_STORY_IG,a.LOCALIZATION_TYPE.CURRENT_USER_SENT_EVENT,a.LOCALIZATION_TYPE.CURRENT_USER_SENT_POST,a.LOCALIZATION_TYPE.CURRENT_USER_SENT_REEL,a.LOCALIZATION_TYPE.CURRENT_USER_SENT_STORY,a.LOCALIZATION_TYPE.CURRENT_USER_SENT_STORY_HIGHLIGHT,a.LOCALIZATION_TYPE.CURRENT_USER_RECEIVED_STORY_MENTION_IG,a.LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET,a.LOCALIZATION_TYPE.YOU_EPHEMERAL_RECORD_SCREEN,a.LOCALIZATION_TYPE.YOU_EPHEMERAL_TAKE_SCREENSHOT,a.LOCALIZATION_TYPE.CURRENT_USER_UNSENT_MESSAGE],w=[a.LOCALIZATION_TYPE.PARTICIPANT_CREATED_GROUP,a.LOCALIZATION_TYPE.UNKNOWN_USER_CREATED_GROUP,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_ATTACHMENT,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_AUDIO,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_GIF,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_IMAGE,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_STICKER,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_TEXT,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_TEXT_IN_GROUP,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_VIDEO,a.LOCALIZATION_TYPE.PARTICIPANT_SENT_EVENT,a.LOCALIZATION_TYPE.PARTICIPANT_SENT_POST,a.LOCALIZATION_TYPE.PARTICIPANT_SENT_REEL,a.LOCALIZATION_TYPE.PARTICIPANT_SENT_STORY,a.LOCALIZATION_TYPE.PARTICIPANT_SENT_STORY_HIGHLIGHT,a.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_RECORD_SCREEN,a.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_TAKE_SCREENSHOT,a.LOCALIZATION_TYPE.PARTICIPANT_REACT_MESSAGE,a.LOCALIZATION_TYPE.PARTICIPANT_REACT_MESSAGE_IN_GROUP,a.LOCALIZATION_TYPE.PARTICIPANT_UNSENT_MESSAGE,a.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_RECORD_SCREEN,a.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_TAKE_SCREENSHOT];a=[a.LOCALIZATION_TYPE.EMPTY_SNIPPET];g.cutoverAdminMsgs=b;g.deviceChanges=c;g.currentUserAddRemoveParticipant=e;g.otherUserAddRemoveParticipant=f;g.groupPermissionsChanged=d;g.participantLeftGroup=h;g.chatCustomizedByCurrentUser=i;g.chatCustomizedByOtherUser=j;g.pinnedMessageUpdate=k;g.limitSharingUpdate=l;g.twoUsersConnected=m;g.fallbackMsgFromCurrentUser=n;g.fallbackMsgFromOtherUser=o;g.currentUserBumpsMessage=p;g.otherUserBumpsMessage=q;g.ephemeralSettingChanges=r;g.icdcAlerts=s;g.callActionToNotifyAbout=t;g.callActionNotToNotifyAbout=u;g.otherNonAdminMsgToBeBumped=v;g.otherNonAdminMsgToBeMarkedAsUnread=w;g.otherNonAdminMsgToNotTriggerUpdate=a}),98);
__d("MAWArmadilloAppDataTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};c={};e={};f={};var h={},i={},j={},k={},l={},m={},n={},o={},p={},q={},r={},s={};a.name="ProtocolMsgId";a.internalSpec={externalId:[1,(d=d("WAProtoConst")).TYPES.STRING],author:[2,d.TYPES.STRING],chat:[3,d.TYPES.STRING]};b.name="MetaSyncMessageKeyProto";b.internalSpec={fromMe:[1,d.TYPES.BOOL],id:[2,d.TYPES.STRING]};c.name="MetaSyncMessageProto";c.internalSpec={key:[1,d.TYPES.MESSAGE,b],ts:[2,d.TYPES.INT64]};e.name="MetaSyncMessageRangeProto";e.internalSpec={lastMessageTimestamp:[1,d.TYPES.INT64],lastSystemMessageTimestamp:[2,d.TYPES.INT64],messages:[3,d.FLAGS.REPEATED|d.TYPES.MESSAGE,c]};f.name="MetaSyncChatActionProto";f.internalSpec={type:[1,d.TYPES.STRING],chatJid:[2,d.TYPES.STRING],archived:[3,d.TYPES.BOOL],ts:[4,d.TYPES.INT64],messageRange:[5,d.TYPES.MESSAGE,e],read:[6,d.TYPES.BOOL]};h.name="MetaSyncMessageActionProto";h.internalSpec={type:[1,d.TYPES.STRING],protocolMsgId:[2,d.TYPES.MESSAGE,a]};i.name="MetaSyncActionProto";i.internalSpec={chatAction:[1,d.TYPES.MESSAGE,f],messageAction:[2,d.TYPES.MESSAGE,h],__oneofs__:{action:["chatAction","messageAction"]}};j.name="MetaSyncAppDataProto";j.internalSpec={actions:[1,d.FLAGS.REPEATED|d.TYPES.MESSAGE,i]};k.name="EncryptedBackupsSecretsEpochProto";k.internalSpec={id:[1,d.TYPES.UINT64],anonId:[2,d.TYPES.BYTES],rootKey:[3,d.TYPES.BYTES],status:[4,d.TYPES.INT32]};l.name="EncryptedBackupsSecretsProto";l.internalSpec={backupId:[1,d.TYPES.UINT64],serverDataId:[2,d.TYPES.UINT64],epoch:[3,d.FLAGS.REPEATED|d.TYPES.MESSAGE,k],tempOcmfClientState:[4,d.TYPES.BYTES],mailboxRootKey:[5,d.TYPES.BYTES],obliviousValidationToken:[6,d.TYPES.BYTES]};m.name="FingerprintProto";m.internalSpec={currentIndex:[1,d.TYPES.UINT32],deviceIndexes:[2,d.FLAGS.REPEATED|d.TYPES.UINT32],rawId:[3,d.TYPES.UINT32]};n.name="SyncKeyDataProto";n.internalSpec={keyId:[1,d.TYPES.BYTES],keyData:[2,d.TYPES.BYTES],keyEpoch:[3,d.TYPES.UINT32],timestamp:[4,d.TYPES.INT64],fingerprint:[5,d.TYPES.MESSAGE,m]};o.name="SyncKeyShareProto";o.internalSpec={keys:[1,d.FLAGS.REPEATED|d.TYPES.MESSAGE,n],orphanKeys:[2,d.FLAGS.REPEATED|d.TYPES.BYTES]};p.name="SyncKeyRequestProto";p.internalSpec={keyIds:[1,d.FLAGS.REPEATED|d.TYPES.BYTES]};q.name="AppDataProto";q.internalSpec={type:[1,d.TYPES.STRING],actions:[2,d.FLAGS.REPEATED|d.TYPES.MESSAGE,i],encryptedBackupsSecrets:[3,d.TYPES.MESSAGE,l],syncKeyShare:[4,d.TYPES.MESSAGE,o],syncKeyRequest:[5,d.TYPES.MESSAGE,p]};r.name="IdentitiesPerDeviceProto";r.internalSpec={deviceJid:[1,d.TYPES.STRING],serializedPubKey:[2,d.TYPES.BYTES],baseKey:[3,d.TYPES.BYTES]};s.name="AppDataTableSchemaProto";s.internalSpec={externalId:[1,d.TYPES.STRING],ts:[2,d.TYPES.INT64],contents:[3,d.TYPES.MESSAGE,q],permittedIdentitiesPerDevice:[4,d.FLAGS.REPEATED|d.TYPES.MESSAGE,r],ack:[5,d.TYPES.INT32],appDataId:[6,d.TYPES.INT32],recipientDevices:[7,d.FLAGS.REPEATED|d.TYPES.STRING],sendPartial:[8,d.TYPES.BOOL]};g.ProtocolMsgIdSpec=a;g.MetaSyncMessageKeyProtoSpec=b;g.MetaSyncMessageProtoSpec=c;g.MetaSyncMessageRangeProtoSpec=e;g.MetaSyncChatActionProtoSpec=f;g.MetaSyncMessageActionProtoSpec=h;g.MetaSyncActionProtoSpec=i;g.MetaSyncAppDataProtoSpec=j;g.EncryptedBackupsSecretsEpochProtoSpec=k;g.EncryptedBackupsSecretsProtoSpec=l;g.FingerprintProtoSpec=m;g.SyncKeyDataProtoSpec=n;g.SyncKeyShareProtoSpec=o;g.SyncKeyRequestProtoSpec=p;g.AppDataProtoSpec=q;g.IdentitiesPerDeviceProtoSpec=r;g.AppDataTableSchemaProtoSpec=s}),98);
__d("MAWArmadilloAppMetaTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};a.name="DbAppMetaValuesProto";a.internalSpec={msgTypeVersion:[1,(c=d("WAProtoConst")).TYPES.INT32],hmacKey:[2,c.TYPES.BYTES],allowSecurityAlert:[3,c.TYPES.BOOL],hotlikeSticker:[4,c.TYPES.BYTES],isBackfilledForOccamadillo:[5,c.TYPES.BOOL],allowSecurityAlertForSelf:[11,c.TYPES.BOOL],hasMigratedFromDexie:[12,c.TYPES.BOOL],restoreMigrationAttempts:[13,c.TYPES.INT32],deviceJid:[14,c.TYPES.STRING],restoreToDexieMigrationComplete:[15,c.TYPES.BOOL],dbMigrationVersion:[16,c.TYPES.INT32]};b.name="AppMetaTableSchemaProto";b.internalSpec={key:[1,c.TYPES.STRING],value:[2,c.TYPES.MESSAGE,a]};g.DbAppMetaValuesProtoSpec=a;g.AppMetaTableSchemaProtoSpec=b}),98);
__d("MAWArmadilloCollectionVersionsTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="CollectionVersionsTableSchemaProto";a.internalSpec={collection:[1,(b=d("WAProtoConst")).TYPES.STRING],version:[2,b.TYPES.INT32],state:[3,b.TYPES.STRING],finiteFailureStartTime:[4,b.TYPES.INT64],ltHash:[5,b.TYPES.BYTES],isCollectionInMacMismatchFatal:[6,b.TYPES.BOOL],isCollectionLthashInconsistent:[7,b.TYPES.BOOL]};g.CollectionVersionsTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloContactsTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};a.name="EphemeralSettingProto";a.internalSpec={ephemeralExpirationInSec:[1,(c=d("WAProtoConst")).TYPES.UINT32],ephemeralLastUpdatedOrSetTimestamp:[2,c.TYPES.INT64]};b.name="EphemeralSyncResponseBackoffInfo";b.internalSpec={syncResponseRetries:[1,c.TYPES.INT32],syncResponseSentTs:[2,c.TYPES.INT64]};g.EphemeralSettingProtoSpec=a;g.EphemeralSyncResponseBackoffInfoSpec=b}),98);
__d("MAWArmadilloDeletedMessagesTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="DeletedMessagesTableSchemaProto";a.internalSpec={author:[1,(b=d("WAProtoConst")).TYPES.STRING],chat:[2,b.TYPES.STRING],externalId:[3,b.TYPES.STRING],reason:[4,b.TYPES.STRING]};g.DeletedMessagesTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloDeviceChangeAlertsTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="DeviceChangeAlertsTableSchemaProto";a.internalSpec={action:[1,(b=d("WAProtoConst")).TYPES.STRING],isArchived:[2,b.TYPES.BOOL],deviceChangeAlertsId:[3,b.TYPES.INT64],location:[4,b.TYPES.STRING],model:[5,b.TYPES.STRING],ts:[6,b.TYPES.INT64],loggedOut:[7,b.TYPES.BOOL],deviceJid:[8,b.TYPES.STRING],identity:[9,b.TYPES.BYTES],platform:[10,b.TYPES.STRING],latitude:[11,b.TYPES.STRING],longitude:[12,b.TYPES.STRING],isConfirmed:[13,b.TYPES.BOOL],isNotified:[14,b.TYPES.BOOL]};g.DeviceChangeAlertsTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloDyiBatchTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={BACKUP_RESTORE:0,E2E_DYI:1};b={};b.name="DyiBatchTableSchemaProto";b.internalSpec={batchId:[1,(c=d("WAProtoConst")).TYPES.INT32],numMessages:[2,c.TYPES.INT32],oldestTs:[3,c.TYPES.INT64],threadId:[4,c.TYPES.STRING],isThread:[5,c.TYPES.BOOL],numMessagesRestored:[6,c.TYPES.INT32],qplInstanceKeyForThread:[7,c.TYPES.INT64],qplFlowDescriptor:[8,c.TYPES.ENUM,a],qplInstanceKeyE2E:[9,c.TYPES.INT64],numThreadsRestored:[10,c.TYPES.INT64]};g.DYI_BATCH_TABLE_SCHEMA_PROTO_QPL_FLOW_DESCRIPTOR=a;g.DyiBatchTableSchemaProtoSpec=b}),98);
__d("MAWArmadilloEBMsgRangesTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="EBMsgRangesTableSchemaProto";a.internalSpec={rangeId:[1,(b=d("WAProtoConst")).TYPES.UINT32],threadJid:[2,b.TYPES.STRING],minMsgExternalId:[3,b.TYPES.STRING],maxMsgExternalId:[4,b.TYPES.STRING],minMsgSortOrderMs:[5,b.TYPES.UINT64],maxMsgSortOrderMs:[6,b.TYPES.UINT64],creationTime:[7,b.TYPES.INT64]};g.EBMsgRangesTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloMessagesTableSchema.pb",["MAWArmadilloContactsTableSchema.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){var h;a={};b={};c={};e={};f={};var i={},j={},k={},l={},m={},n={};a.name="MsgContentProto";a.internalSpec={content:[1,(h=d("WAProtoConst")).TYPES.STRING],adminMsgContent:[2,h.FLAGS.REPEATED|h.TYPES.STRING],adminType:[3,h.TYPES.STRING],obsoleteExpiration:[4,h.TYPES.INT32],obsoleteTs:[5,h.TYPES.INT64],subtype:[6,h.TYPES.STRING],protobuf:[7,h.TYPES.BYTES],screenshotActionType:[8,h.TYPES.INT32],authorName:[9,h.TYPES.STRING],version:[10,h.TYPES.INT32],mentionedJids:[11,h.FLAGS.REPEATED|h.TYPES.STRING],commands:[12,h.FLAGS.REPEATED|h.TYPES.MESSAGE,b]};b.name="MsgContentCommandProto";b.internalSpec={commandType:[1,h.TYPES.INT32],offset:[2,h.TYPES.INT32],length:[3,h.TYPES.INT32],validationToken:[4,h.TYPES.STRING]};c.name="ReportingMetaProto";c.internalSpec={frankingTag:[1,h.TYPES.BYTES],frankingVersion:[2,h.TYPES.INT32],reportingContent:[3,h.TYPES.BYTES],reportingTag:[4,h.TYPES.BYTES],frankingKey:[5,h.TYPES.BYTES]};e.name="DbQuotedMsgProto";e.internalSpec={remoteJid:[1,h.TYPES.STRING],content:[2,h.TYPES.MESSAGE,m]};f.name="VideoMsgContentProto";f.internalSpec={duration:[1,h.TYPES.INT32],width:[2,h.TYPES.INT32],height:[3,h.TYPES.INT32],mimetype:[4,h.TYPES.STRING],jpegThumbnail:[5,h.TYPES.BYTES],jpegThumbnailHeight:[6,h.TYPES.INT32],jpegThumbnailWidth:[7,h.TYPES.INT32]};i.name="ImageMsgContentProto";i.internalSpec={width:[1,h.TYPES.UINT32],height:[2,h.TYPES.UINT32],jpegThumbnail:[3,h.TYPES.BYTES],jpegThumbnailHeight:[4,h.TYPES.INT32],jpegThumbnailWidth:[5,h.TYPES.INT32]};j.name="AudioMsgContentProto";j.internalSpec={duration:[1,h.TYPES.INT32],mimetype:[2,h.TYPES.STRING],played:[3,h.TYPES.BOOL]};k.name="DocumentFileMsgContentProto";k.internalSpec={filename:[1,h.TYPES.STRING],mimetype:[2,h.TYPES.STRING]};l.name="QuotedDbMediaProto";l.internalSpec={mediaType:[1,h.TYPES.STRING],plaintextHash:[2,h.TYPES.STRING],size:[3,h.TYPES.INT32],ts:[4,h.TYPES.INT64],mediaEntry:[5,h.TYPES.BYTES],validatedVideoInfo:[6,h.TYPES.MESSAGE,f],validatedImageInfo:[7,h.TYPES.MESSAGE,i],validatedAudioInfo:[8,h.TYPES.MESSAGE,j],validatedDocumentFileInfo:[9,h.TYPES.MESSAGE,k]};m.name="DbQuotedMsgContentProto";m.internalSpec={type:[1,h.TYPES.STRING],ts:[2,h.TYPES.INT64],externalId:[3,h.TYPES.STRING],author:[4,h.TYPES.STRING],msgContent:[5,h.TYPES.MESSAGE,a],obsoleteMedia:[6,h.TYPES.MESSAGE,l],msgId:[7,h.TYPES.STRING],mediaId:[8,h.TYPES.INT32],sourceId:[9,h.TYPES.STRING],xmaMessageType:[10,h.TYPES.INT32],specialTextSize:[11,h.TYPES.INT32],plaintextHash:[12,h.TYPES.STRING],expirationTs:[13,h.TYPES.INT64]};n.name="MessagesTableSchemaProto";n.internalSpec={type:[1,h.TYPES.STRING],ts:[2,h.TYPES.INT64],externalId:[3,h.TYPES.STRING],msgId:[4,h.TYPES.STRING],author:[5,h.TYPES.STRING],ack:[6,h.TYPES.INT32],resendCount:[7,h.TYPES.INT32],msgContent:[8,h.TYPES.MESSAGE,a],altIndex:[9,h.TYPES.STRING],forwardingScore:[10,h.TYPES.INT32],quote:[11,h.TYPES.MESSAGE,e],messageExpirationTs:[12,h.TYPES.INT64],ephemeralSetting:[13,h.TYPES.MESSAGE,d("MAWArmadilloContactsTableSchema.pb").EphemeralSettingProtoSpec],revokedExternalId:[14,h.TYPES.STRING],isForwarded:[15,h.TYPES.BOOL],originalTs:[17,h.TYPES.INT64],sortOrderMs:[18,h.TYPES.INT64],reportingMeta:[19,h.TYPES.MESSAGE,c],messageDeleteTs:[20,h.TYPES.INT64],ephemeralCounterStarted:[21,h.TYPES.BOOL],quoteExternalId:[22,h.TYPES.STRING],unsendMsgContentDeleteTs:[23,h.TYPES.INT64],rowId:[24,h.TYPES.INT32],thread:[25,h.TYPES.INT32],mediaId:[26,h.TYPES.INT32],ephemeralMsgDisappeared:[27,h.TYPES.BOOL],threadJid:[28,h.TYPES.STRING],xmaId:[29,h.TYPES.INT32],specialTextSize:[30,h.TYPES.INT32],xmaMessageType:[31,h.TYPES.INT32],isExpiredXmaMsg:[32,h.TYPES.BOOL],ravenEphemeralType:[33,h.TYPES.INT32],ravenEphemeralMediaState:[34,h.TYPES.INT32],editCount:[35,h.TYPES.INT32],groupId:[36,h.TYPES.STRING],groupIndex:[37,h.TYPES.INT64],groupSize:[38,h.TYPES.INT64],receiverFetchId:[39,h.TYPES.STRING],source:[40,h.TYPES.STRING],quoteExpirationTs:[41,h.TYPES.INT64],applicationErrorCode:[42,h.TYPES.INT32],hdType:[43,h.TYPES.INT32],pollStanzaId:[44,h.TYPES.STRING],collapsibleId:[45,h.TYPES.STRING],isCollapsed:[46,h.TYPES.BOOL]};g.MsgContentProtoSpec=a;g.MsgContentCommandProtoSpec=b;g.ReportingMetaProtoSpec=c;g.DbQuotedMsgProtoSpec=e;g.VideoMsgContentProtoSpec=f;g.ImageMsgContentProtoSpec=i;g.AudioMsgContentProtoSpec=j;g.DocumentFileMsgContentProtoSpec=k;g.QuotedDbMediaProtoSpec=l;g.DbQuotedMsgContentProtoSpec=m;g.MessagesTableSchemaProtoSpec=n}),98);
__d("MAWArmadilloEditMsgHistoryTableSchema.pb",["MAWArmadilloMessagesTableSchema.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="EditMsgHistoryTableSchemaProto";a.internalSpec={author:[1,(b=d("WAProtoConst")).TYPES.STRING],editMsgHistoryId:[2,b.TYPES.INT32],editTs:[3,b.TYPES.INT64],msgContent:[4,b.TYPES.MESSAGE,d("MAWArmadilloMessagesTableSchema.pb").MsgContentProtoSpec],originalMsgExternalId:[5,b.TYPES.STRING],specialTextSize:[6,b.TYPES.INT32],threadJid:[7,b.TYPES.STRING],editExternalId:[8,b.TYPES.STRING],sendStatus:[9,b.TYPES.INT32]};g.EditMsgHistoryTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloGroupInfoTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="GroupInfoSchemaProto";a.internalSpec={groupJid:[1,(b=d("WAProtoConst")).TYPES.STRING],threadId:[2,b.TYPES.INT32],creator:[3,b.TYPES.STRING],creationTs:[4,b.TYPES.INT64],name:[5,b.TYPES.STRING],nameOwner:[6,b.TYPES.STRING],nameTs:[7,b.TYPES.INT64],msgExpiration:[8,b.TYPES.INT32],participantVersion:[9,b.TYPES.STRING],inviter:[10,b.TYPES.STRING],memberAddMode:[11,b.TYPES.STRING]};g.GroupInfoSchemaProtoSpec=a}),98);
__d("MAWArmadilloGroupInvitesTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="GroupInvitesTableSchemaProto";a.internalSpec={inviterJid:[1,(b=d("WAProtoConst")).TYPES.STRING],invitedParticipantId:[2,b.TYPES.STRING],inviteCode:[3,b.TYPES.STRING],inviteExpirationTs:[4,b.TYPES.INT64],caption:[5,b.TYPES.STRING]};g.GroupInvitesTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloMediaTablesSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={NONE:0,LQ_4K:1,HQ_4K:2};b={};c={};e={};f={};var h={},i={},j={},k={},l={};b.name="ChunkTableSchemaProto";b.internalSpec={plaintextHash:[1,(d=d("WAProtoConst")).TYPES.STRING],blobData:[2,d.TYPES.BYTES],mimetype:[3,d.TYPES.STRING],hashedPlaintextHash:[4,d.TYPES.STRING],chunkId:[5,d.TYPES.INT32]};c.name="MediaBackupSchemaProto";c.internalSpec={mediaBackupId:[1,d.TYPES.INT32],mediaId:[2,d.TYPES.INT32],objectId:[3,d.TYPES.STRING],msgId:[4,d.TYPES.STRING],fbid:[5,d.TYPES.STRING]};e.name="MediaEntriesProto";e.internalSpec={msgId:[1,d.TYPES.STRING],mediaEntryData:[2,d.TYPES.BYTES]};f.name="VideoMsgContentProto";f.internalSpec={duration:[1,d.TYPES.UINT32],width:[2,d.TYPES.UINT32],height:[3,d.TYPES.UINT32],mimetype:[4,d.TYPES.STRING],jpegThumbnail:[5,d.TYPES.BYTES],jpegThumbnailHeight:[6,d.TYPES.UINT32],jpegThumbnailWidth:[7,d.TYPES.UINT32],thumbnailPlaintextHash:[8,d.TYPES.STRING]};h.name="ImageMsgContentProto";h.internalSpec={width:[1,d.TYPES.UINT32],height:[2,d.TYPES.UINT32],jpegThumbnail:[3,d.TYPES.BYTES],jpegThumbnailHeight:[4,d.TYPES.UINT32],jpegThumbnailWidth:[5,d.TYPES.UINT32],thumbnailPlaintextHash:[6,d.TYPES.STRING],hdType:[7,d.TYPES.ENUM,a]};i.name="AudioMsgContentProto";i.internalSpec={duration:[1,d.TYPES.UINT32],mimetype:[2,d.TYPES.STRING],played:[3,d.TYPES.BOOL]};j.name="DocumentFileMsgContentProto";j.internalSpec={filename:[1,d.TYPES.STRING],mimetype:[2,d.TYPES.STRING]};k.name="ValidatedResult";k.internalSpec={validatedMimeType:[1,d.TYPES.STRING],videoStreamType:[2,d.TYPES.STRING],videoCalculatedFps:[3,d.TYPES.UINT32],videoNominalFps:[4,d.TYPES.UINT32],videoWidth:[5,d.TYPES.UINT32],videoHeight:[6,d.TYPES.UINT32],videoDuration:[7,d.TYPES.UINT32],videoAvgBitsPerSecond:[8,d.TYPES.UINT32],audioStreamType:[9,d.TYPES.STRING],audioSamplingRate:[10,d.TYPES.UINT32],audioNumberOfChannels:[11,d.TYPES.UINT32],audioAvgBitsPerSecond:[12,d.TYPES.UINT32]};l.name="MediaTableSchemaProto";l.internalSpec={mediaType:[1,d.TYPES.STRING],plaintextHash:[2,d.TYPES.STRING],size:[3,d.TYPES.UINT64],mediaEntries:[4,d.FLAGS.REPEATED|d.TYPES.MESSAGE,e],ts:[5,d.TYPES.INT64],validatedVideoInfo:[6,d.TYPES.MESSAGE,f],validatedImageInfo:[7,d.TYPES.MESSAGE,h],validatedAudioInfo:[8,d.TYPES.MESSAGE,i],hashedPlaintextHash:[9,d.TYPES.STRING],mediaId:[10,d.TYPES.INT32],msgIds:[11,d.FLAGS.REPEATED|d.TYPES.STRING],objectId:[12,d.TYPES.STRING],fbid:[13,d.TYPES.STRING],validatedDocumentFileInfo:[14,d.TYPES.MESSAGE,j],validatedResult:[15,d.TYPES.MESSAGE,k],accessibilitySummaryText:[16,d.TYPES.STRING]};g.HD_TYPE=a;g.ChunkTableSchemaProtoSpec=b;g.MediaBackupSchemaProtoSpec=c;g.MediaEntriesProtoSpec=e;g.VideoMsgContentProtoSpec=f;g.ImageMsgContentProtoSpec=h;g.AudioMsgContentProtoSpec=i;g.DocumentFileMsgContentProtoSpec=j;g.ValidatedResultSpec=k;g.MediaTableSchemaProtoSpec=l}),98);
__d("MAWArmadilloMissingKeysTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};a.name="DeviceResponse";a.internalSpec={deviceId:[1,(c=d("WAProtoConst")).TYPES.INT32],deviceResponse:[2,c.TYPES.BOOL]};b.name="MissingKeysTableSchemaProto";b.internalSpec={keyHex:[1,c.TYPES.STRING],keyId:[2,c.TYPES.BYTES],timestamp:[3,c.TYPES.INT64],deviceResponses:[4,c.FLAGS.REPEATED|c.TYPES.MESSAGE,a]};g.DeviceResponseSpec=a;g.MissingKeysTableSchemaProtoSpec=b}),98);
__d("MAWArmadilloParticipantsTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="ParticipantsTableSchemaProto";a.internalSpec={id:[1,(b=d("WAProtoConst")).TYPES.STRING],userJid:[2,b.TYPES.STRING],deliveredWatermarkTs:[3,b.TYPES.INT64],lastReadWatermarkTs:[4,b.TYPES.INT64],type:[5,b.TYPES.STRING],addressable:[6,b.TYPES.BOOL],lastReadActionTs:[7,b.TYPES.INT64],threadId:[9,b.TYPES.INT32],threadJid:[10,b.TYPES.STRING]};g.ParticipantsTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloPendingMutationsTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={SET:0,REMOVE:1};b={};b.name="PendingMutationsTableSchemaProto";b.internalSpec={id:[1,(c=d("WAProtoConst")).TYPES.INT32],collection:[2,c.TYPES.STRING],index:[3,c.TYPES.STRING],binarySyncAction:[4,c.TYPES.BYTES],version:[5,c.TYPES.INT32],operation:[6,c.TYPES.ENUM,a],timestamp:[7,c.TYPES.INT64],action:[8,c.TYPES.STRING]};g.SYNCD_MUTATION_SYNCD_OPERATION=a;g.PendingMutationsTableSchemaProtoSpec=b}),98);
__d("MAWArmadilloPersonalSenderKeyStatusTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="PersonalSenderKeyStatusTableSchemaProto";a.internalSpec={groupJid:[1,(b=d("WAProtoConst")).TYPES.STRING],senderKeyId:[2,b.TYPES.INT32],rotateSenderKey:[4,b.TYPES.BOOL],senderKeyTs:[5,b.TYPES.INT64],hasSenderKey:[6,b.FLAGS.REPEATED|b.TYPES.STRING]};g.PersonalSenderKeyStatusTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloPollTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={OPEN:0,FROZEN:1};b={};c={};e={};f={};b.name="PollOptionProto";b.internalSpec={optionText:[1,(d=d("WAProtoConst")).TYPES.STRING],voteAuthors:[2,d.FLAGS.REPEATED|d.TYPES.STRING]};c.name="PollOptionsProto";c.internalSpec={pollOptionHash:[1,d.TYPES.STRING],pollOption:[2,d.TYPES.MESSAGE,b]};e.name="LatestSenderTimestampsMsProto";e.internalSpec={author:[1,d.TYPES.STRING],latestSenderTimestampMs:[2,d.TYPES.INT64]};f.name="PollTableSchemaProto";f.internalSpec={chatJid:[1,d.TYPES.STRING],encKey:[2,d.TYPES.BYTES],pollAuthor:[3,d.TYPES.STRING],pollStanzaId:[4,d.TYPES.STRING],pollOptions:[5,d.FLAGS.REPEATED|d.TYPES.MESSAGE,c],pollParticipantCount:[6,d.TYPES.UINT32],pollState:[7,d.TYPES.ENUM,a],selectableOptionsCount:[8,d.TYPES.UINT32],title:[9,d.TYPES.STRING],latestSenderTimestampsMs:[10,d.FLAGS.REPEATED|d.TYPES.MESSAGE,e]};g.POLL_STATE=a;g.PollOptionProtoSpec=b;g.PollOptionsProtoSpec=c;g.LatestSenderTimestampsMsProtoSpec=e;g.PollTableSchemaProtoSpec=f}),98);
__d("MAWArmadilloReactionsTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="ReactionsTableSchemaProto";a.internalSpec={ack:[1,(b=d("WAProtoConst")).TYPES.INT32],author:[2,b.TYPES.STRING],externalId:[3,b.TYPES.STRING],reactionId:[4,b.TYPES.STRING],reactToExternalId:[5,b.TYPES.STRING],reactToAuthor:[6,b.TYPES.STRING],reactToMsgId:[7,b.TYPES.STRING],threadJid:[8,b.TYPES.STRING],reaction:[9,b.TYPES.STRING],groupingKey:[10,b.TYPES.STRING],ts:[11,b.TYPES.INT64],rowId:[12,b.TYPES.INT32],senderTimestampMs:[13,b.TYPES.INT64]};g.ReactionsTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloReceiptTablesSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};c={};e={};f={};var h={},i={};a.name="DbUserStatusTsProto";a.internalSpec={deliveredTs:[1,(d=d("WAProtoConst")).TYPES.INT64],readTs:[2,d.TYPES.INT64]};b.name="StatusTsPerUserProto";b.internalSpec={userJid:[1,d.TYPES.STRING],dbUserStatusTs:[2,d.TYPES.MESSAGE,a]};c.name="IdentitiesPerDeviceProto";c.internalSpec={deviceJid:[1,d.TYPES.STRING],serializedPubKey:[2,d.TYPES.BYTES],baseKey:[3,d.TYPES.BYTES]};e.name="RetryCountPerDeviceProto";e.internalSpec={deviceJid:[1,d.TYPES.STRING],count:[2,d.TYPES.INT32]};f.name="ReceiptsTableSchemaProto";f.internalSpec={msgId:[1,d.TYPES.STRING],statusTsPerUser:[2,d.FLAGS.REPEATED|d.TYPES.MESSAGE,b],permittedIdentitiesPerDevice:[3,d.FLAGS.REPEATED|d.TYPES.MESSAGE,c],recipientDevices:[4,d.FLAGS.REPEATED|d.TYPES.STRING],retryCountsPerDevice:[5,d.FLAGS.REPEATED|d.TYPES.MESSAGE,e],waMsgId:[6,d.TYPES.STRING]};h.name="Receipts";h.internalSpec={device:[1,d.TYPES.STRING],ts:[2,d.TYPES.INT64]};i.name="PendingReceiptsTableSchemaProto";i.internalSpec={pendingReceiptId:[1,d.TYPES.STRING],thread:[2,d.TYPES.STRING],externalId:[3,d.TYPES.STRING],author:[4,d.TYPES.STRING],deliveryReceipts:[5,d.FLAGS.REPEATED|d.TYPES.MESSAGE,h],readReceipts:[6,d.FLAGS.REPEATED|d.TYPES.MESSAGE,h]};g.DbUserStatusTsProtoSpec=a;g.StatusTsPerUserProtoSpec=b;g.IdentitiesPerDeviceProtoSpec=c;g.RetryCountPerDeviceProtoSpec=e;g.ReceiptsTableSchemaProtoSpec=f;g.ReceiptsSpec=h;g.PendingReceiptsTableSchemaProtoSpec=i}),98);
__d("MAWArmadilloReceiverFetchInfoTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="ReceiverFetchInfoTableSchemaProto";a.internalSpec={mimetype:[1,(b=d("WAProtoConst")).TYPES.STRING],previewHeight:[2,b.TYPES.UINT32],previewWidth:[3,b.TYPES.UINT32],receiverFetchId:[4,b.TYPES.STRING],type:[5,b.TYPES.STRING],previewUrl:[6,b.TYPES.STRING],previewUrlExpirationTimestampMs:[7,b.TYPES.UINT64],accessibilitySummaryText:[8,b.TYPES.STRING]};g.ReceiverFetchInfoTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloSyncActionsTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="SyncActionsTableSchemaProto";a.internalSpec={index:[1,(b=d("WAProtoConst")).TYPES.STRING],binarySyncData:[2,b.TYPES.BYTES],actionState:[3,b.TYPES.STRING],version:[4,b.TYPES.INT32],keyId:[5,b.TYPES.BYTES],modelId:[6,b.TYPES.STRING],modelType:[7,b.TYPES.STRING],indexMac:[8,b.TYPES.BYTES],valueMac:[9,b.TYPES.BYTES],collection:[10,b.TYPES.STRING],timestamp:[11,b.TYPES.INT64],action:[12,b.TYPES.STRING]};g.SyncActionsTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloSyncKeysTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};a.name="SyncKeyFingerprint";a.internalSpec={currentIndex:[1,(c=d("WAProtoConst")).TYPES.INT32],deviceIndexes:[2,c.FLAGS.REPEATED|c.TYPES.INT32],rawId:[3,c.TYPES.INT64]};b.name="SyncKeysTableSchemaProto";b.internalSpec={id:[1,c.TYPES.BYTES],keyId:[2,c.TYPES.BYTES],keyData:[3,c.TYPES.BYTES],keyEpoch:[4,c.TYPES.INT64],timestamp:[5,c.TYPES.INT64],fingerprint:[6,c.TYPES.MESSAGE,a]};g.SyncKeyFingerprintSpec=a;g.SyncKeysTableSchemaProtoSpec=b}),98);
__d("MAWArmadilloTasksTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="TasksTableSchemaProto";a.internalSpec={taskName:[1,d("WAProtoConst").TYPES.STRING],scheduledTime:[2,d("WAProtoConst").TYPES.INT64]};g.TasksTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloThreadsTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="ThreadsTableSchemaProto";a.internalSpec={jid:[1,(b=d("WAProtoConst")).TYPES.STRING],threadOrder:[2,b.TYPES.STRING],folder:[4,b.TYPES.INT32],newestMsg:[5,b.TYPES.STRING],oldestMsg:[6,b.TYPES.STRING],lastReadMsg:[7,b.TYPES.STRING],lastReadMsgReceiptSent:[8,b.TYPES.STRING],lastReadMsgTs:[9,b.TYPES.INT64],newestMsgTs:[10,b.TYPES.INT64],muteExpireTimeMs:[11,b.TYPES.INT64],muteCallsExpireTimeMs:[12,b.TYPES.INT64],archived:[13,b.TYPES.BOOL],cannotReplyReason:[14,b.TYPES.STRING],chatId:[15,b.TYPES.INT32],optimisticThreadKey:[16,b.TYPES.STRING],isMigratedLocally:[17,b.TYPES.BOOL],snippetMsg:[18,b.TYPES.STRING],deduplicationKey:[19,b.TYPES.STRING],authoritativeThreadKey:[20,b.TYPES.STRING],snippetMsgTs:[21,b.TYPES.INT64],didInsertDualThreadCutoverAdminMsg:[22,b.TYPES.BOOL],unbumpFromTs:[23,b.TYPES.INT64],unbumpToTs:[24,b.TYPES.INT64]};g.ThreadsTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloUnrenderedMessagesTableSchema.pb",["MAWArmadilloContactsTableSchema.pb","MAWArmadilloMessagesTableSchema.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="UnrenderedMessagesTableSchemaProto";a.internalSpec={type:[1,(b=d("WAProtoConst")).TYPES.STRING],ts:[2,b.TYPES.INT64],externalId:[3,b.TYPES.STRING],msgId:[4,b.TYPES.STRING],author:[5,b.TYPES.STRING],ack:[6,b.TYPES.INT32],resendCount:[7,b.TYPES.INT32],ephemeralSetting:[8,b.TYPES.MESSAGE,d("MAWArmadilloContactsTableSchema.pb").EphemeralSettingProtoSpec],messageDeleteForMeTs:[9,b.TYPES.INT64],rowId:[10,b.TYPES.INT32],thread:[11,b.TYPES.INT32],mediaId:[12,b.TYPES.INT32],msgContent:[13,b.TYPES.STRING],threadJid:[14,b.TYPES.STRING],reportingMeta:[15,b.TYPES.MESSAGE,d("MAWArmadilloMessagesTableSchema.pb").ReportingMetaProtoSpec],invitedParticipantUserJid:[16,b.TYPES.STRING],groupName:[17,b.TYPES.STRING],quote:[18,b.TYPES.MESSAGE,d("MAWArmadilloMessagesTableSchema.pb").DbQuotedMsgProtoSpec],xmaMessageType:[19,b.TYPES.INT32],sortOrderMs:[20,b.TYPES.INT64]};g.UnrenderedMessagesTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloXMATableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};a.name="XMATableSchemaProto";a.internalSpec={associatedMessageId:[1,(c=d("WAProtoConst")).TYPES.STRING],author:[2,c.TYPES.STRING],ctas:[3,c.FLAGS.REPEATED|c.TYPES.MESSAGE,b],defaultCTA:[4,c.TYPES.MESSAGE,b],defaultPreviewMediaId:[5,c.TYPES.INT32],externalId:[6,c.TYPES.STRING],faviconMediaId:[7,c.TYPES.INT32],headerMediaId:[8,c.TYPES.INT32],headerTitle:[9,c.TYPES.STRING],isTombstoned:[10,c.TYPES.BOOL],maxSubtitleNumOfLines:[11,c.TYPES.INT32],maxTitleNumOfLines:[12,c.TYPES.INT32],msgId:[13,c.TYPES.STRING],overlayDescription:[14,c.TYPES.STRING],overlayIconGlyph:[15,c.TYPES.INT32],overlayTitle:[16,c.TYPES.STRING],previewMediaIds:[17,c.FLAGS.REPEATED|c.TYPES.INT32],subtitleText:[18,c.TYPES.STRING],targetExpiringAtSec:[19,c.TYPES.INT64],targetId:[20,c.TYPES.STRING],targetType:[21,c.TYPES.INT32],targetUsername:[22,c.TYPES.STRING],threadJid:[23,c.TYPES.STRING],titleText:[24,c.TYPES.STRING],xmaId:[25,c.TYPES.INT32],xmaLayoutType:[26,c.TYPES.INT32],defaultPreviewMediaPlaintextHash:[27,c.TYPES.STRING],faviconPlaintextHash:[28,c.TYPES.STRING],headerMediaPlaintextHash:[29,c.TYPES.STRING]};b.name="CTAProto";b.internalSpec={buttonType:[1,c.TYPES.INT32],title:[2,c.TYPES.STRING],actionUrl:[3,c.TYPES.STRING],nativeUrl:[4,c.TYPES.STRING],ctaType:[5,c.TYPES.STRING]};g.XMATableSchemaProtoSpec=a;g.CTAProtoSpec=b}),98);
__d("MAWAuthor",["MAWUserJidWrapper","WAJids","isStringNullOrEmpty"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){if(a==null||a===d("WAJids").AUTHOR_SYSTEM)return null;if(d("WAJids").isAuthorMe(a))return d("MAWUserJidWrapper").getMyUserJid();var b=d("WAJids").authorAsUserJid(a);if(b==null||c("isStringNullOrEmpty")(d("WAJids").userIdFromJid(b)))return null;else return d("WAJids").authorAsUserJid(a)};g.getAuthorUserJid=a}),98);
__d("MAWAuthoritativeThreadsCache",[],(function(a,b,c,d,e,f){"use strict";a=new Set();f.AuthoritativeThreadsCache=a}),66);
__d("MAWBridgeReceiverFetchInfo",["WALogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c,d,e){var f=e.accessibilitySummaryText,g=e.mimetype,h=e.previewHeight,k=e.previewUrl,l=e.previewUrlExpirationTimestampMs,m=e.previewWidth,n=e.receiverFetchId;e=e.type;return{accessibilitySummaryText:f,mimetype:g,msgId:b,previewHeight:h,previewUrl:k,previewUrlExpirationTimestampMs:j(l),previewWidth:m,receiverFetchId:n,sortOrderMs:i(c,d),threadJid:a,type:e}}function b(a,b,c,d,e){var f=e.mimetype,g=e.previewHeight,h=e.previewWidth,j=e.receiverFetchId;e=e.type;return{mimetype:f,msgId:b,previewHeight:g,previewWidth:h,receiverFetchId:j,sortOrderMs:i(c,d),threadJid:a,type:e}}function i(a,b){return d("WATimeUtils").castToMillisTime(a!=null?a:b*1e3)}function j(a){if(a==null)return void 0;try{return d("WATimeUtils").castLongIntToMillisTime(a)}catch(a){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Failed to cast previewUrlExpirationTimestampMs to millis time: ",""])),a);return void 0}}g.createBridgeReceiverFetchInfoPayloadFromDbInfo=a;g.createBridgeReceiverFetchInfoPayloadFromUnstoredInfo=b}),98);
__d("MAWBridgeTypesCreators",["FBLogger","MAWDbMsg","MAWImageUtils","MAWMsgType","MAWUserJidWrapper","WAJids","WAMediaUtils","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return{threadJid:a}}function h(a){var b,c=a.ts;switch(a.type){case d("MAWMsgType").MSG_TYPE.REVOKED:c=(b=a.originalTs)!=null?b:a.ts;break;default:c=d("MAWDbMsg").getCanonicalTsFromMsg(a)}return{msgId:a.msgId,ts:c}}function b(a,b){b=b.map(h);return{messages:b,threadJid:a}}function e(a){return{ravenMsgId:a.msgId,threadJid:a.threadJid}}function f(a,b){return a.filter(function(a){return b===a.threadJid}).map(function(a){return a.msgId})}function i(a){var b,e=a.chatJid,f=a.filteredMsgIds,g=a.hasMediaForUI,h=a.hdTypes,i=a.media,j=a.offlineAttachmentId,k=a.ravenSettings,l=a.sortOrderMs;a=a.transportKey;switch(i.mediaType){case"Image":return{duration:null,ephemeralMediaState:k==null?void 0:k.ephemeralMediaState,ephemeralMediaViewMode:k==null?void 0:k.ephemeralMediaViewMode,filesize:i.size,hasMedia:g,hasPreviewMedia:((b=i.validatedImageInfo)==null?void 0:b.jpegThumbnail)!=null,hdTypes:h,mediaId:i.mediaId,mediaType:i.mediaType,msgIds:f,offlineAttachmentId:j,plaintextHash:i.plaintextHash,previewHeight:(b=i.validatedImageInfo)==null?void 0:b.jpegThumbnailHeight,previewHeightLarge:(h=i.validatedImageInfo)==null?void 0:h.height,previewWidth:(b=i.validatedImageInfo)==null?void 0:b.jpegThumbnailWidth,previewWidthLarge:(h=i.validatedImageInfo)==null?void 0:h.width,sortOrderMs:d("WATimeUtils").castToMillisTime(l!=null?l:i.ts*1e3),threadJid:e,transportKey:a,ts:d("WATimeUtils").castToUnixTime(l!=null?l/1e3:i.ts)};case"Video":return{duration:((b=i.validatedVideoInfo)==null?void 0:b.duration)!=null?((h=i.validatedVideoInfo)==null?void 0:h.duration)*1e3:0,ephemeralMediaState:k==null?void 0:k.ephemeralMediaState,ephemeralMediaViewMode:k==null?void 0:k.ephemeralMediaViewMode,filesize:i.size,hasMedia:g,hasPreviewMedia:((b=i.validatedVideoInfo)==null?void 0:b.jpegThumbnail)!=null,mediaId:i.mediaId,mediaType:i.mediaType,msgIds:f,offlineAttachmentId:j,plaintextHash:i.plaintextHash,previewHeight:(h=i.validatedVideoInfo)==null?void 0:h.jpegThumbnailHeight,previewHeightLarge:(k=i.validatedVideoInfo)==null?void 0:k.height,previewWidth:(b=i.validatedVideoInfo)==null?void 0:b.jpegThumbnailWidth,previewWidthLarge:(h=i.validatedVideoInfo)==null?void 0:h.width,sortOrderMs:d("WATimeUtils").castToMillisTime(l!=null?l:i.ts*1e3),threadJid:e,transportKey:a,ts:d("WATimeUtils").castToUnixTime(l!=null?l/1e3:i.ts)};case"Ptt":return{duration:(k=i.validatedAudioInfo)!=null&&k.duration?i.validatedAudioInfo.duration*1e3:null,filesize:i.size,hasMedia:g,mediaId:i.mediaId,mediaType:i.mediaType,msgIds:f,offlineAttachmentId:j,plaintextHash:i.plaintextHash,previewHeight:null,previewHeightLarge:null,previewWidth:null,previewWidthLarge:null,sortOrderMs:d("WATimeUtils").castToMillisTime(l!=null?l:i.ts*1e3),threadJid:e,transportKey:a,ts:d("WATimeUtils").castToUnixTime(l!=null?l/1e3:i.ts)};case"Gif":return{accessibilitySummaryText:(b=i.accessibilitySummaryText)!=null?b:void 0,duration:null,filesize:i.size,hasMedia:g,mediaId:i.mediaId,mediaType:i.mediaType,msgIds:i.msgIds,offlineAttachmentId:j,plaintextHash:i.plaintextHash,previewHeight:(h=i.validatedImageInfo)==null?void 0:h.jpegThumbnailHeight,previewHeightLarge:(k=i.validatedImageInfo)==null?void 0:k.height,previewWidth:(b=i.validatedImageInfo)==null?void 0:b.jpegThumbnailWidth,previewWidthLarge:(h=i.validatedImageInfo)==null?void 0:h.width,sortOrderMs:d("WATimeUtils").castToMillisTime(l!=null?l:i.ts*1e3),threadJid:e,transportKey:a,ts:d("WATimeUtils").castToUnixTime(l!=null?l/1e3:i.ts)};case"Sticker":h=d("MAWImageUtils").boundHeightWidth((k=i.validatedImageInfo)==null?void 0:k.jpegThumbnailHeight,(b=i.validatedImageInfo)==null?void 0:b.jpegThumbnailWidth,d("MAWImageUtils").STICKER_THUMBNAIL_MAX_SIZE);k=h.height;b=h.width;return{accessibilitySummaryText:(h=i.accessibilitySummaryText)!=null?h:void 0,duration:null,filesize:i.size,hasMedia:g,mediaId:i.mediaId,mediaType:i.mediaType,msgIds:i.msgIds,offlineAttachmentId:j,plaintextHash:i.plaintextHash,previewHeight:k,previewHeightLarge:k,previewWidth:b,previewWidthLarge:b,sortOrderMs:d("WATimeUtils").castToMillisTime(l!=null?l:i.ts*1e3),threadJid:e,transportKey:a,ts:d("WATimeUtils").castToUnixTime(l!=null?l/1e3:i.ts)};case"DocumentFile":h={};for(k of i.mediaEntries){b=k[0];var m=k[1];m=d("WAMediaUtils").mediaEntryDataToRawData(i.plaintextHash,m);m=m.filename;m!=null&&(h[b]=m)}return{defaultFilename:(b=i.validatedDocumentFileInfo)==null?void 0:b.filename,duration:null,filenames:h,filesize:i.size,hasMedia:g,mediaId:i.mediaId,mediaType:i.mediaType,msgIds:f,offlineAttachmentId:j,plaintextHash:i.plaintextHash,previewHeight:null,previewHeightLarge:null,previewWidth:null,previewWidthLarge:null,sortOrderMs:d("WATimeUtils").castToMillisTime(l!=null?l:i.ts*1e3),threadJid:e,transportKey:a,ts:d("WATimeUtils").castToUnixTime(l!=null?l/1e3:i.ts)};default:i.mediaType;throw c("FBLogger")("messenger_web").mustfixThrow("[createBridgeMedia] Unsupported media type: "+i.mediaType)}}function j(a,b,c){return{chatJid:a,deliveredWatermarkTs:c!=null?c:d("WATimeUtils").castToUnixTime(0),fbid:b,lastReadActionTs:d("WATimeUtils").castToUnixTime(0),lastReadWatermarkTs:d("WATimeUtils").castToUnixTime(0)}}function k(a){var b=a.cannotReplyReason,c=a.folder,d=a.snippetParams,e=a.snippetSenderContactId,f=a.snippetType;a=a.threadJid;return{cannotReplyReason:b,folder:c,snippetContactIDs:d==null?void 0:d.contactIDs,snippetMentionJIDs:d==null?void 0:d.mentionJIDs,snippetParams:d==null?void 0:d.strings,snippetSenderContactId:e,snippetType:f,threadJid:a}}function l(a){return{chatJid:a.groupJid,memberAddMode:a.memberAddMode,threadName:a.name}}var m={snippetContactIDs:[],snippetMentionJIDs:[],snippetParams:[],snippetSenderContactId:null,snippetType:null};function n(a){var b,c=a.bumpTimestampMs,d=a.description,e=a.isMessageAuthorMe,f=a.isUnbump,g=a.skipBumpTimestampValidation,h=a.skipServerThreadBump,i=a.snippetData;a=a.threadJid;b=i==null?m:{snippetContactIDs:i.params.contactIDs,snippetMentionJIDs:(b=i.params.mentionJIDs)!=null?b:[],snippetParams:i.params.strings,snippetSenderContactId:i.senderContactId,snippetType:i.type};return babelHelpers["extends"]({},b,{bumpTimestampMs:c,description:d,isMessageAuthorMe:e,isUnbump:f,skipBumpTimestampValidation:g!=null?g:!1,skipServerThreadBump:h!=null?h:!1,threadJid:a})}function o(a){var b=a.author,c=a.chatJid,e=a.reaction,f=a.reactToMsgId;a=a.ts;return{actorId:d("WAJids").authorToUserId(b,d("WAJids").extractUserId(d("MAWUserJidWrapper").getMyUserJid())),chatJid:c,messageId:f,reaction:e,ts:a}}function p(a){var b=d("WAJids").extractUserId(d("MAWUserJidWrapper").getMyUserJid()),c=a.author,e=a.chatJid;a=a.reactToMsgId;return{actorId:d("WAJids").authorToUserId(c,b),chatJid:e,messageId:a}}function q(a){return{creationTs:a.creationTs,creator:a.creator,groupJid:a.groupJid,msgExpiration:a.msgExpiration,name:a.name,nameOwner:a.nameOwner,nameTs:a.nameTs,participantVersion:a.participantVersion}}function r(a){var b=a.threadJid,c=a.inviteeJid;return{caption:a.caption,inviteCode:a.inviteCode,inviteeId:c,inviteExpireTs:a.inviteExpirationTs,inviterId:d("WAJids").extractUserId(a.inviterJid),threadJid:b}}function s(a){return{threadJid:a}}function t(a,b,c){return{senderId:d("WAJids").extractUserId(b),state:c,threadJid:a}}g.createBridgeUpdateE2EEMetadataParticipants=a;g.createBridgeDeletedMessage=h;g.createBridgeDeleteMessages=b;g.createBridgeRavenAction=e;g.getMsgIdsFilteredByJid=f;g.createBridgeMedia=i;g.createBridgeReceivedReceipt=j;g.createBridgeUpdatedThread=k;g.createBridgeUpdatedGroupInfo=l;g.createBridgeBumpedThreadV2=n;g.createBridgeUpsertReaction=o;g.createBridgeDeleteReaction=p;g.createBridgeGroupInfo=q;g.createBridgeGroupInvite=r;g.createBridgeDeleteGroupInvite=s;g.createBridgeReceivedChatState=t}),98);
__d("MAWCacheServiceBase",["MAWCacheServiceDB"],(function(a,b,c,d,e,f,g){"use strict";var h=["id"];a=function(){function a(a){this.$1=new Map(),this.namespace=a}var b=a.prototype;b.$2=function(a){return(a=this.$1.get(a))!=null?a:null};b.updateInMemoryCache=function(a,b){this.$1.set(a,b)};b.updateInMemoryCacheBulk=function(a){var b=this;a.forEach(function(a){var c=a[0];a=a[1];b.updateInMemoryCache(c,a)})};b.getValueFromCache=async function(a){var b=this,c=this.$2(a);if(c!=null)return c;c=await d("MAWCacheServiceDB").getOrSetupMAWCacheDB();c=await c.runInTransaction([this.namespace],"readonly",function(c){return c.stores[b.namespace].getByIndex("key",[a])},"read_from_persisted_"+this.namespace);if(c==null)return null;c.id;c=babelHelpers.objectWithoutPropertiesLoose(c,h);this.updateInMemoryCache(a,c);return c};return a}();g.default=a}),98);
__d("MAWDbParticipant",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return a+"_"+b}f.craftParticipantId=a}),66);
__d("MAWDbThread",["MAWHexUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWHexUtils").orderPreservingHex(a)+"_"+b}g.craftThreadOrder=a}),98);
__d("MAWDexie",["cr:10766"],(function(a,b,c,d,e,f,g){"use strict";f.exports=b("cr:10766")}),34);
__d("MAWDexieTable",["MAWDexie","justknobx"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return Promise.resolve(a)}function a(a){return a.reduce(function(a,b,c){return a.then(function(a){return b(c).then(function(b){a.push(b);return a})})},l([]))}function b(a){return c("MAWDexie").Promise.all(a)}function e(a){return c("MAWDexie").Promise.allSettled(a)}function f(a){return c("MAWDexie").Promise.PSD[a]}function i(a,b){c("MAWDexie").Promise.PSD[a]=b}function j(a){c("MAWDexie").Promise.PSD[a]=void 0}var k=function(){function a(a,b,d,e){d===void 0&&(d=!0);e=new(c("MAWDexie"))(a,babelHelpers.extends({},e,{chromeTransactionDurability:"relaxed",modifyChunkSize:c("justknobx")._("3166")}));b(e);this.name=a;this.stores=e;d&&this.open()}var b=a.prototype;b.open=function(){this.stores.open()};b.close=function(){this.stores.close()};b.transact=function(a,b,c){var d=this;return h(this.stores.transaction(a,b.map(function(a){return d.stores[a]}),async function(){var a=await c();return a}))};return babelHelpers.createClass(a,[{key:"tables",get:function(){return this.stores.tables}}])}();function l(a){return c("MAWDexie").Promise.resolve(a)}g.DEXIE_MIN_KEY=d("MAWDexie").Dexie.minKey;g.DEXIE_MAX_KEY=d("MAWDexie").Dexie.maxKey;g.undexify=h;g.dexieSequentialAll=a;g.dexieAll=b;g.dexieAllSettled=e;g.getDexiePSDItem=f;g.setDexiePSDItem=i;g.clearDexiePSDItem=j;g.DexieTable=k;g.dexieResolve=l}),98);
__d("MAWDbSchema.dexie",["FBLogger","MAWDbMsg","MAWDbParticipant","MAWDbThread","MAWDbVersionList","MAWDexie","MAWDexieTable","MAWFolderTypes","MAWLocalizationType","MAWODSProxy","MAWTimeUtils","WAJids","WALogger","WAMsg","WAMsgType","WAOdsEnums","WAStanzaUtils","WATimeUtils","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h,i;a=function(a){var b=function(a){var b;b=(b=a.quote)==null?void 0:b.content;return a.quoteExternalId!=null&&(b==null?void 0:b.media)!=null};return a.messages.where("quoteExternalId").between(d("WAStanzaUtils").toStanzaId("0"),d("WAStanzaUtils").toStanzaId("["),!0,!0).filter(b).toArray()["catch"](function(){return a.messages.filter(b).toArray()}).then(function(b){var c=new Set(b.map(function(a){var b;a=(a=a.quote)==null?void 0:a.content;return a==null||(b=a.media)==null?void 0:b.plaintextHash}).filter(Boolean)),d=b.map(function(a){a=a.msgId;return a});return a.media.filter(function(a){a=a.plaintextHash;return c.has(a)}).toArray().then(function(b){var c=new Map(b.map(function(a){var b=a.mediaId;a=a.plaintextHash;return[a,b]}));return a.messages.where("msgId").anyOf(d).modify(function(a){var b;b=(b=a.quote)==null?void 0:b.content;a.quote.content.mediaId=c.get(b.media.plaintextHash);delete a.quote.content.media})})})};b=function(a){return a.groupInfo.toCollection().modify(function(a){typeof a.inviter==="number"&&delete a.inviter})};e=function(){return d("MAWDexieTable").dexieResolve()};f=function(a){return a.threads.filter(function(a){return d("WAJids").switchOnMsgrChatJidType(a.jid,{group:function(){return!1},user:function(){return a.oldestMsg!=null}})}).toArray().then(function(b){var c=[];b.forEach(function(a){c.push(a.oldestMsg),c.push(d("MAWDbMsg").toMsgId__UNSAFE_DO_NOT_USE(a.newestMsg))});return a.messages.where("msgId").anyOf(c.filter(Boolean)).toArray().then(function(c){var e=new Map(),f=[],g=[];c.forEach(function(a){e.set(a.msgId,a)});b.forEach(function(b){var c=e.get(b.oldestMsg),h=e.get(b.newestMsg);(c==null?void 0:c.type)==="Admin"&&(h==null?void 0:h.type)==="Admin"&&(c.msgId===h.msgId?g.push(b.chatId):f.push(b));return d("MAWDexieTable").dexieAll(f.map(function(b){return a.messages.where("thread").equals(b.chatId).toArray()})).then(function(b){b.forEach(function(a){if(a.length===0)return;var b=a[0].thread;a=a.filter(function(a){return a.type!=="Admin"});if(a.length>0)return;g.push(b)});return d("MAWDexieTable").dexieAll([a.threads.bulkDelete(g),a.messages.where("thread").anyOf(g)["delete"]()])})})})})};var j=function(a){return a.unrenderedMessages.toCollection().modify(function(a){if(a.type===d("WAMsgType").MSG_TYPE.DELETE_FOR_ME){var b=a.messageDeleteForMeTs;a.messageDeleteForMeTs=b}})},k=function(a){var b=0,e=0,f=c("MAWDexie").currentTransaction;if(f==null)throw c("FBLogger")("maw_db").mustfixThrow("transaction does not exist");f.on("complete",function(){b>0&&d("MAWODSProxy").odsBumpEntityKey({amount:b,entity:d("WAOdsEnums").Entity.MESSAGE_MISSING_THREAD_JID,key:"fail"}),e>0&&d("MAWODSProxy").odsBumpEntityKey({amount:e,entity:d("WAOdsEnums").Entity.MESSAGE_MISSING,key:"fail"})});return a.threads.toArray().then(function(c){var f=c.reduce(function(a,b){b!=null&&a.set(b.chatId,b);return a},new Map());return d("MAWDexieTable").dexieAll([a.messages.toCollection().modify(function(a){if(a!=null){var c=f.get(a.thread);c!=null?a.threadJid=c.jid:b+=1}else e+=1}),a.unrenderedMessages.toCollection().modify(function(a){if(a!=null){var c=f.get(a.thread);c!=null?a.threadJid=c.jid:b+=1}else e+=1})])})},l=function(a){return a.isDualSend.toCollection().modify(function(a){a.version==null&&(a.version=1)})},m=function(a){return a.messages.toCollection().modify(function(a){a.type===d("WAMsgType").MSG_TYPE.ADMIN&&a.msgContent.adminType===d("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_DESCRIPTION&&(a.altIndex=d("MAWDbMsg").craftE2eeAdminMsgAltIndex(a.thread))})},n=function(a){return a.messages.toCollection().modify(function(a){a.sortOrderMs=d("MAWDbMsg").getSortOrderWithFallback(a)})},o=function(a){return a.threads.toCollection().modify(function(a){a.folder==null&&(a.folder=d("MAWFolderTypes").FOLDER_ID.INBOX)})},p=function(a){return a.messages.toCollection().modify(function(a){a.sortOrderMs=d("MAWDbMsg").getSortOrderWithFallback(a)})},q=function(a){return a.personalSenderKeyStatuses.toCollection().modify(function(a){a.rotateSenderKey=!0,a.hasSenderKey=new Set()})},r=function(a){return a.messages.toCollection().modify(function(a){a.type===d("WAMsgType").MSG_TYPE.ADMIN&&a.msgContent.adminType===d("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_THREAD_ADMIN_MESSAGE&&a.sortOrderMs!=null&&a.sortOrderMs>0&&(a.sortOrderMs=0)})},s=function(a){return a.messages.toCollection().modify(function(a){!(a.type===d("WAMsgType").MSG_TYPE.ADMIN&&(a.msgContent.adminType===d("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_THREAD_ADMIN_MESSAGE||a.msgContent.adminType===d("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_DESCRIPTION))&&a.sortOrderMs!=null&&a.sortOrderMs<1661204086&&(a.sortOrderMs=d("MAWDbMsg").getCanonicalTsFromMsg(a)*1e3)})},t=function(a){return a.threads.filter(function(a){return a.isMigratedLocally===!0&&a.newestMsg!=null}).toArray().then(function(b){var c=b.map(function(a){return a.chatId}),e=new Map();return d("MAWDexieTable").dexieAll(b.map(function(b){return a.messages.where(["thread","sortOrderMs"]).between([b.chatId,0],[b.chatId,Number.MAX_VALUE]).last().then(function(a){a!=null&&e.set(a.thread,a.msgId)})})).then(function(){return a.threads.where("chatId").anyOf(c)})})},u=function(){return d("MAWDexieTable").dexieResolve()},v=function(a){return a.threads.toCollection().modify(function(a){a.lastReadMsgTs!=null&&a.lastReadMsgTs<d("WATimeUtils").MAX_INT&&(a.lastReadMsgTs=d("MAWTimeUtils").ensureValidMillisTime(a.lastReadMsgTs));if(a.newestMsgTs!=null&&a.newestMsgTs<d("WATimeUtils").MAX_INT){var b=d("MAWTimeUtils").ensureValidMillisTime(a.newestMsgTs);a.newestMsgTs=b;b!=null&&(a.threadOrder=d("MAWDbThread").craftThreadOrder(b,a.jid))}})},w=function(a){return a.messages.toCollection().modify(function(a){a.type===d("WAMsgType").MSG_TYPE.ADMIN&&a.msgContent.adminType===d("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_THREAD_ADMIN_MESSAGE&&(a.altIndex=d("MAWDbMsg").craftCutoverAdminMsgAltIndex(a.thread))})},x=function(){return d("MAWDexieTable").dexieResolve()},y=function(){return d("MAWDexieTable").dexieResolve()},z=function(){return d("MAWDexieTable").dexieResolve()},A=function(a){return a.participants.toCollection().modify(function(a){var b;if(a==null||((b=a.userJid)==null?void 0:b.indexOf("@msgr@msgr"))===!1)return;a.id=a.id.replace("@msgr@msgr","@msgr");a.userJid=a.userJid.replace("@msgr@msgr","@msgr")}).then(c("emptyFunction"))},B=function(a){var b=a.threads.filter(function(a){return a.snippetMsg!=null&&a.snippetMsgTs==null});return b.toArray().then(function(c){var e=c.reduce(function(a,b){b!=null&&b.snippetMsg!=null&&a.set(b.jid,b.snippetMsg);return a},new Map());c=Array.from(e.values());return a.messages.where("msgId").anyOf(c).toArray().then(function(a){var c=a.reduce(function(a,b){b!=null&&b.serverTs!=null&&a.set(b.msgId,b.serverTs);return a},new Map());b.modify(function(a){var b=e.get(a.jid);if(b!=null){b=c.get(b);b!=null&&(a.snippetMsgTs=d("WATimeUtils").castUnixTimeToMillisTime(b))}})})})},C=function(a){return a.threads.toArray().then(function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){return a.participants.where("threadId").equals(b.chatId).modify(function(a){a.threadJid=(a=a.threadJid)!=null?a:b.jid})}))})},D=C,E=function(a){var b=[];return a.groupInvites.toArray().then(function(c){var d=c.map(function(a){return a.invitedParticipantId});return a.participants.bulkGet(d).then(function(d){d.forEach(function(a,d){if(a==null){a=c[d];b.push(a)}});var e=d.filter(Boolean);return a.groupInvites.bulkPut(c.map(function(a){var c=e.find(function(b){return b.id===a.invitedParticipantId});if(c!=null){a.inviteeJid=c.userJid;a.threadJid=c.threadJid;return babelHelpers["extends"]({},a,{inviteeJid:c.userJid,threadJid:c.threadJid})}else{b.push(a);return a}}))})}).then(function(){return a.groupInvites.bulkDelete(b.map(function(a){return[a.invitedParticipantId,a.inviterJid]}))})},F=function(a){var b=new Map();return a.receipts.toArray().then(function(e){return d("MAWDexieTable").dexieAll(e.map(function(e){return a.messages.get({msgId:e.msgId}).then(function(f){if(f==null)return a.receipts["delete"](e.msgId).then(c("emptyFunction"));else{var g=d("WAMsg").craftWAMsgIdString({author:f.author,chat:f.threadJid,externalId:f.externalId});if(b.has(g)){var i;i=(i=b.get(g))!=null?i:1;b.set(g,i);d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Duplicate waMsgId found for receipt, number of duplicates: ",""])),i);return a.receipts["delete"](e.msgId).then(c("emptyFunction"))}else{b.set(g,1);return a.receipts.where("msgId").equals(f.msgId).modify(function(a){a.waMsgId=g}).then(c("emptyFunction"))}}})}))})},G=function(){return d("MAWDexieTable").dexieResolve()},H=function(a){return a.participants.toArray().then(function(b){var c=b.map(function(a){return babelHelpers["extends"]({},a,{id:d("MAWDbParticipant").craftParticipantId(a.threadJid,a.userJid)})});b=b.map(function(a){return a.id});return a.participants.bulkDelete(b).then(function(){a.participants.bulkPut(c)})})},I=function(a){return a.reactions.toCollection().modify(function(a){a.ts=a.ts})};a=new Map([[(i=d("MAWDbVersionList")).VERSION.V26,a],[i.VERSION.V27,b],[i.VERSION.V28,e],[i.VERSION.V29,f],[i.VERSION.V30,j],[i.VERSION.V31,k],[i.VERSION.V43,l],[i.VERSION.V44,m],[i.VERSION.V45,n],[i.VERSION.V46,o],[i.VERSION.V47,p],[i.VERSION.V53,q],[i.VERSION.V54,r],[i.VERSION.V55,s],[i.VERSION.V56,t],[i.VERSION.V57,u],[i.VERSION.V58,v],[i.VERSION.V60,w],[i.VERSION.V66,x],[i.VERSION.V68,y],[i.VERSION.V71,z],[i.VERSION.V72,A],[i.VERSION.V82,B],[i.VERSION.V85,C],[i.VERSION.V87,D],[i.VERSION.V90,E],[i.VERSION.V91,F],[i.VERSION.V101,G],[i.VERSION.V104,H],[i.VERSION.V116,I]]);g.dbUpgrades=a}),98);
__d("MAWDbSchemaReStoreDexieUtils",["FBLogger","MAWDbSchema","MAWDbSchema.dexie","sortBy"],(function(a,b,c,d,e,f,g){"use strict";var h=c("sortBy")(Array.from(new Set([].concat(Array.from(d("MAWDbSchema").dbSchema.keys()),Array.from(d("MAWDbSchema.dexie").dbUpgrades.keys())))).map(function(a){return{schema:d("MAWDbSchema").dbSchema.get(a),upgrade:d("MAWDbSchema.dexie").dbUpgrades.get(a),version:a}}),function(a){a=a.version;return a}),i=function(a,b){return Array.from(a.filter(function(a){return a.version<=b&&a.schema!=null}).reduce(function(a,b){(b=b.schema)==null||b.forEach(function(b){a.set(b.name,b)});return a},new Map()).values())},j=function(a,b){return i(a,b).reduce(function(a,b){var d=b.autoIncrement,e=b.dexieOnly_primaryKeyUnique,f=b.name,g=b.primaryKey,h=b.removed;f=f.replace(/^e2ee_/,"");if(h===!0){a[f]=null;return a}if(d&&e===!0)throw c("FBLogger")("messenger_web").mustfixThrow("Invalid schema, cannot have both autoincremnet and unique constraints "+JSON.stringify(b));h=d?"++":"";d=e===!0?"&":"";e=""+(g.length>1?"[":"")+g.join("+")+(g.length>1?"]":"");g=Object.values(b.indexes).map(function(a){var b=a.columns,c=!(a.unique===!1),d=b.length>1;a=a.multiEntry_DO_NOT_USE===!0;c=c&&!a?"&":"";a=a?"*":"";c=""+c+a;return""+c+(d?"[":"")+b.join("+")+(d?"]":"")}).join(",");a[f]=[""+h+d+e,g].filter(Boolean).join(",");return a},{})};a=function(a){return j(h,a)};g.MAW_DB_VERSION_CHANGES=h;g.getDexieSchemaForVersion=j;g.getCompleteDexieSchemaForVersion=a}),98);
__d("MAWDbVersion",["MAWCurrentUser","MAWDbSchemaReStoreDexieUtils","MAWDbVersionList","MAWGetDbVersion","MAWIndexedDbMetadata","MAWODSProxy","MWFBLogger","Promise","WAOdsEnums"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q,r=d("MWFBLogger").MWLogger.tags(["db","getDexieDbVersion"]);e=d("MAWGetDbVersion").getArmadilloDbVersion();f=d("MAWDbSchemaReStoreDexieUtils").getCompleteDexieSchemaForVersion(Math.min(d("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES[d("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES.length-1].version,e>0?e:Infinity));function s(a,b){var c=b.schema,d=b.upgrade;b=b.version;c!=null&&d!=null?a.version(b).stores(c).upgrade(d):c!=null?a.version(b).stores(c):d!=null?a.version(b).upgrade(d):a.version(b);return b}function t(a){return new(q||(q=b("Promise")))(function(b){if(!indexedDB){b();return}var c=indexedDB.open(a);c.onupgradeneeded=function(c){c.target.transaction.abort();c=c.target.result;r.DEBUG(h||(h=babelHelpers.taggedTemplateLiteralLoose([""," onupgradeneeded - closing db"])),a);c==null||c.close();b()};c.onsuccess=function(c){c=c.target.result;var e=c==null?void 0:c.version;r.DEBUG(i||(i=babelHelpers.taggedTemplateLiteralLoose([""," version: ",""])),a,e!=null?e:"null");c==null||c.close();e!=null?(e%10>=1&&d("MAWODSProxy").odsBumpEntityKey({amount:1,entity:d("WAOdsEnums").Entity.MAW_DB_UNEXPECTED_VERSION,key:"fail_"+e%10}),b(d("MAWDbVersionList").toVersion(e/10))):b()};c.onerror=function(c){var d;r.DEBUG(j||(j=babelHelpers.taggedTemplateLiteralLoose([""," error ",""])),a,c==null||(d=c.target)==null||(d=d.error)==null?void 0:d.message);b()};c.onblocked=function(b){b=b.target.result;var c=b==null?void 0:b.version;r.DEBUG(k||(k=babelHelpers.taggedTemplateLiteralLoose([""," blocked, version: ",""])),a,c!=null?c:"null");b==null||b.close()}})}function a(){var a=d("MAWCurrentUser").getID();return t(d("MAWIndexedDbMetadata").dbName(a))}function u(a,b){if(a.upgrade!=null||b.upgrade!=null)return!0;a=Object.keys((a==null?void 0:a.schema)||{});b=Object.keys((b==null?void 0:b.schema)||{});a=[].concat(a,b);b=new Set(a);return b.size!==a.length}function v(a){return a.reduce(function(a,b,c){if(c===0)return[babelHelpers["extends"]({},b,{schema:d("MAWDbSchemaReStoreDexieUtils").getCompleteDexieSchemaForVersion(b.version)})];c=a[a.length-1];b=babelHelpers["extends"]({},b,{schema:b.schema!=null?d("MAWDbSchemaReStoreDexieUtils").getDexieSchemaForVersion([b],b.version):null});if(u(c,b)){a.push(b);return a}a.splice(a.length-1,1,babelHelpers["extends"]({},c,b,{schema:babelHelpers["extends"]({},c==null?void 0:c.schema,b==null?void 0:b.schema)}));return a},[])}function c(a,b,c,e){var f=e!=null?e:d("MAWGetDbVersion").getArmadilloDbVersion==null?void 0:d("MAWGetDbVersion").getArmadilloDbVersion();r.DEBUG(l||(l=babelHelpers.taggedTemplateLiteralLoose(["current db version: ",", target db version: ",""])),c,f);f==null&&r.WARN(m||(m=babelHelpers.taggedTemplateLiteralLoose(["version is not set in QE"])));c!=null&&c>f&&(r.WARN(n||(n=babelHelpers.taggedTemplateLiteralLoose(["current db version is greater than target db version"]))),f=c);e=d("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES.filter(function(a){a=a.version;return c==null||a>c}).filter(function(a){a=a.version;return f==null||f>=a});var g=d("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES.filter(function(a){a=a.version;return f==null||f>=a});if(e.length===0||e.length===g.length){r.DEBUG(o||(o=babelHelpers.taggedTemplateLiteralLoose(["Skipping db upgrade and just applying latest schema"])));b.addAnnotations({bool:{isUpgradeNeeded:!1}});g=d("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES[d("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES.length-1].version;g=Math.min(f!=null&&f>0?f:g,g);a.version(g).stores(d("MAWDbSchemaReStoreDexieUtils").getCompleteDexieSchemaForVersion(g));return g}g=v(e);r.DEBUG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Applying "," updates between "," and ",""])),g.length,e[0].version,e[e.length-1].version);e=g.filter(function(a){return!!a.upgrade}).map(function(a){return a.version.toString()});var h=g.filter(function(a){return!!a.schema}).map(function(a){return a.version.toString()});e.length&&b.addAnnotations({string_array:{dataMigrationVersions:e}});h.length&&b.addAnnotations({string_array:{schemaUpgradeVersions:h}});b.addAnnotations({bool:{isUpgradeNeeded:!0}});var i=0;g.forEach(function(b){i=Math.max((b=s(a,b))!=null?b:0,i!=null?i:0)});return i}g.CURRENT_MAW_STORES=f;g.getDexieDbVersion=t;g.getDBVersion=a;g.updateDB=c}),98);
__d("MAWDexieError",[],(function(a,b,c,d,e,f){"use strict";a="ModifyError";b="BulkError";c="OpenFailedError";d="VersionChangeError";e="SchemaError";var g="UpgradeError",h="InvalidTableError",i="MissingAPIError",j="NoSuchDatabaseError",k="InvalidArgumentError",l="SubTransactionError",m="UnsupportedError",n="InternalError",o="DatabaseClosedError",p="PrematureCommitError",q="ForeignAwaitError",r="UnknownError",s="ConstraintError",t="DataError",u="TransactionInactiveError",v="ReadOnlyError",w="VersionError",x="NotFoundError",y="InvalidStateError",z="InvalidAccessError",A="AbortError",B="TimeoutError",C="QuotaExceededError",D="SyntaxError",E="DataCloneError";A={AbortError:A,BulkError:b,ConstraintError:s,DatabaseClosedError:o,DataCloneError:E,DataError:t,ForeignAwaitError:q,InternalError:n,InvalidAccessError:z,InvalidArgumentError:k,InvalidStateError:y,InvalidTableError:h,MissingAPIError:i,ModifyError:a,NoSuchDatabaseError:j,NotFoundError:x,OpenFailedError:c,PrematureCommitError:p,QuotaExceededError:C,ReadOnlyError:v,SchemaError:e,SubTransactionError:l,SyntaxError:D,TimeoutError:B,TransactionInactiveError:u,UnknownError:r,UnsupportedError:m,UpgradeError:g,VersionChangeError:d,VersionError:w};f.DEXIE_ERROR=A}),66);
__d("MAWIDbSetupQplEventListener",["MAWDexieError","MAWQplProxy","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i=null;function j(a){var b=new Set(Object.keys(d("MAWDexieError").DEXIE_ERROR));b.has(a.reason)&&h!=null&&(h.endFail(a.reason),d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25310776,"6155"),"database_setup_failed"),i!=null&&(i(),i=null))}b=function(b,c){h=b;i=c;a.addEventListener("unhandledrejection",j);return function(){return a.removeEventListener("unhandledrejection",j)}};g.trackDbSetupFailure=b}),98);
__d("MAWLowLevelApiTypes",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a={EXISTING_GROUP_INVITE:"existing_group_invite",MISSING_GROUP:"missing_group"};c={EXPIRED_GROUP_INVITE:"expired_group_invite",MISSING_GROUP:"missing_group",MISSING_GROUP_INVITE:"missing_group_invite"};d=b("$InternalEnum")({Initializing:"initializing",Open:"open",Closed:"closed",Error:"error",Upgrading:"upgrading"});f.WRITE_GROUP_INVITE_ERROR=a;f.GET_GROUP_INVITE_ERROR=c;f.DatabaseState=d}),66);
__d("MAWDbFactory",["ClientConsistencyEventEmitter","Deferred","MAWCurrentUser","MAWDbVersion","MAWDexieTable","MAWGetDbVersion","MAWIDbSetupQplEventListener","MAWIndexedDBDeletion","MAWIndexedDbMetadata","MAWLowLevelApiTypes","MAWQplProxy","MAWReliabilityMonitor","MWFBLogger","gkx","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q=["backendInitPromise","middleware","onDbPopulate"];function a(a,b){var e=null,f=d("MWFBLogger").MWLogger.tags(["db",a,b]),g=new(c("Deferred"))(),r=!1,s=!1,t,u=!1,v=null,w=b!=="worker"?null:d("MAWReliabilityMonitor").MAWReliabilityMonitorSingleton.startMonitoring("DB_"+a+"_"+b,function(){return{extra:{isMakingDB:String(r),willBeSetup:String(s)},reason:String(v),state:function(){if(v==null)return d("MAWReliabilityMonitor").HealthReportState.UNKNOWN;switch(v){case d("MAWLowLevelApiTypes").DatabaseState.Initializing:case d("MAWLowLevelApiTypes").DatabaseState.Upgrading:return d("MAWReliabilityMonitor").HealthReportState.PENDING;case d("MAWLowLevelApiTypes").DatabaseState.Open:return d("MAWReliabilityMonitor").HealthReportState.OK;case d("MAWLowLevelApiTypes").DatabaseState.Closed:case d("MAWLowLevelApiTypes").DatabaseState.Error:return d("MAWReliabilityMonitor").HealthReportState.ERROR}}()}});function x(){g=new(c("Deferred"))(),t==null||t(),r=!1,s=!1}function y(){return s}function z(){return g.getPromise().then(function(){return u})}async function A(y,z,A){var B=z.backendInitPromise,C=z.middleware,D=z.onDbPopulate;z=babelHelpers.objectWithoutPropertiesLoose(z,q);var E=d("MAWCurrentUser").getID();E=d("MAWIndexedDbMetadata").dbName(E);var F=c("qpl")._(25310776,"6155");function G(a){v=a,w==null||w.updateState()}if(e!=null){f.DEBUG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["DB exists"])));d("MAWQplProxy").sendQplPointThroughBridge(F,"database_"+a+"_exsists");return}var H=d("MAWQplProxy").startQplUserFlow(c("qpl")._(1056836116,"905"),{string:{db:a,name:E}});s=!0;if(r){d("MAWQplProxy").sendQplPointThroughBridge(F,"database_"+a+"_make_in_progress");return g.getPromise()}f.DEBUG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Starting DB Setup"])));r=!0;d("MAWQplProxy").sendQplPointThroughBridge(F,"database_"+a+"_make_started");t=d("MAWIDbSetupQplEventListener").trackDbSetupFailure(H,function(){G(d("MAWLowLevelApiTypes").DatabaseState.Error),g.reject("DB setup failed"),d("MAWQplProxy").sendQplPointThroughBridge(F,"database_"+a+"_setup_failed"),x()});G(d("MAWLowLevelApiTypes").DatabaseState.Initializing);var I=await d("MAWDbVersion").getDexieDbVersion(E);I==null&&(u=!0);H.addAnnotations({int:{currentVersion:I}});var J=A!=null?A:d("MAWGetDbVersion").getArmadilloDbVersion();H.addAnnotations({int:{targetVersion:J}});if(B&&(I||0)<J){H.addPoint("separate_read_waiting_on_worker_upgrade");f.DEBUG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Waiting for worker to upgrade schema..."])));try{await B}catch(a){throw f.catching(a).mustfixThrow("Worker startup promise rejected, schema upgrade failed.")}var K=await d("MAWDbVersion").getDexieDbVersion(E);if(K!==J)throw f.mustfixThrow("Main thread waiting on worker schema upgrade from %s to %s, upgrade failed with version %s",I,J,K);I=K}else b==="worker"&&(d("MAWQplProxy").sendQPLIntAnnotationThroughBridge(c("qpl")._(1056839232,"112"),"dbVersion",I!=null?I:0),d("MAWQplProxy").sendQPLIntAnnotationThroughBridge(c("qpl")._(1056839232,"112"),"useSentBytesCache",c("gkx")("33008")?1:0));var L=function(e){e=d("MAWDbVersion").updateDB(e,H,I,A);!B&&b==="worker"&&d("MAWQplProxy").sendQPLBoolAnnotationThroughBridge(c("qpl")._(1056839232,"112"),"dbUpgradeNeeded",I!==e);f.DEBUG(k||(k=babelHelpers.taggedTemplateLiteralLoose(["latest pushed version: ",", current: ",", requested: ",""])),e,I,A!=null?A:"<latest>");b==="worker"&&(I!==e?d("MAWQplProxy").sendQplPointThroughBridge(F,"database_"+a+"_version_upgraded"):d("MAWQplProxy").sendQplPointThroughBridge(F,"database_"+a+"_version_upgrade_not_required"));return e};e=new(d("MAWDexieTable").DexieTable)(E,function(e){C.forEach(function(a){e.use(a(y))});var h=L(e);e.on("populate",function(b){if(!b){G(d("MAWLowLevelApiTypes").DatabaseState.Error);g.reject("Missing DB for populate event");H.endFail("on_populata-missing_txn");d("MAWQplProxy").sendQplPointThroughBridge(F,"database_"+a+"_on_populate_missing_txn");return}f.info("MAWDB populated. HasPopulateEvent: %s",Boolean(D));D==null||D(b)});e.on("blocked",function(){f.MUSTFIX(l||(l=babelHelpers.taggedTemplateLiteralLoose(["DB Open blocked"]))),G(d("MAWLowLevelApiTypes").DatabaseState.Error),g.reject("DB Open blocked"),H.endFail("db_blocked"),d("MAWQplProxy").sendQplPointThroughBridge(F,"database_"+a+"_blocked"),x()});e.on("ready",function(b){f.DEBUG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["MAW DB setup complete"])));r=!1;if(b==null){G(d("MAWLowLevelApiTypes").DatabaseState.Error);f.MUSTFIX(n||(n=babelHelpers.taggedTemplateLiteralLoose(["DB is null"])));g.reject("DB is null");H.endFail("db_null");d("MAWQplProxy").sendQplPointThroughBridge(F,"database_"+a+"_null");x();return}G(d("MAWLowLevelApiTypes").DatabaseState.Open);t==null||t();g.resolve();H.endSuccess({int:{dbVersion:h}});d("MAWQplProxy").sendQplPointThroughBridge(F,"database_"+a+"_ready")});e.on("close",function(){G(d("MAWLowLevelApiTypes").DatabaseState.Closed),f.WARN(o||(o=babelHelpers.taggedTemplateLiteralLoose(["DB forcibly closed"]))),d("MAWQplProxy").sendQplPointThroughBridge(F,"database_"+a+"_forcibly_closed")});e.on("versionchange",function(e){f.WARN(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Versionchange detected: ("," -> "," (event version: ",", highestUsed: (","), name: ",""])),e==null?void 0:e.oldVersion,e==null?void 0:e.newVersion,String(e==null?void 0:e.version),h,e==null?void 0:e.name),G(d("MAWLowLevelApiTypes").DatabaseState.Upgrading),b!=="worker"&&c("ClientConsistencyEventEmitter").emit("softRefresh","mawdb_versionchange"),d("MAWQplProxy").sendQplPointThroughBridge(F,"database_"+a+"_versionchange")})},void 0,z);d("MAWQplProxy").sendQplPointThroughBridge(F,"database_"+a+"_make_requested");return g.getPromise()}function B(a){if(e==null)throw f.mustfixThrow('IndexDB has not been initialized before executing "'+(a!=null?a:"unnamed")+'"');return e}function C(a){if(e!=null&&!r)return Promise.resolve(e);g=g||new(c("Deferred"))();return g.getPromise().then(function(){return B(a)})}async function D(){var a=await C();a!=null&&(a.close(),e=null);x()}function E(){e=null,x()}function F(a){c("promiseDone")(D());a=d("MAWIndexedDbMetadata").dbName(a!=null?a:d("MAWCurrentUser").getID());c("promiseDone")(d("MAWIndexedDBDeletion").deleteDB(a,"maw"));w==null||w.stopMonitoring()}return{closeDB:D,deleteDb:F,getDB:C,getDBExn:B,isNewDb:z,makeDB:A,reset_singleton_INTERNAL_ONLY:E,setupPromise:function(){return g.getPromise()},willSetupDB:y}}g.makeIDBFactory=a}),98);
__d("MAWIndexedDbUI",["ExecutionEnvironment","MAWDbFactory","MAWDbMutationMiddleware","MAWDbProtocolMsgIdMiddleware","MAWDexieTable","MAWIndexedDb","MAWTransactor","Promise","cr:3527","gkx","performance"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(){var a=d("MAWDbFactory").makeIDBFactory("ui_idb","main");return{closeDB:a.closeDB,deleteDb:a.deleteDb,getDB:a.getDB,makeDB:function(e,f,g){var h=[d("MAWDbMutationMiddleware").getMAWDbMutationMiddleware];c("gkx")("1760")&&h.push(d("MAWDbProtocolMsgIdMiddleware").MAWDbProtocolMsgIdMiddleware);b("cr:3527")!=null&&h.push(b("cr:3527"));e=a.makeDB(e,{autoOpen:c("gkx")("6817"),backendInitPromise:f.backendInitPromise,cache:"disabled",middleware:h,onDbPopulate:f.onDbPopulate},g);return e},reset_singleton_INTERNAL_ONLY:a.reset_singleton_INTERNAL_ONLY}}e=a();f=e.makeDB;var k=e.closeDB,l=e.getDB,m=e.deleteDb;e=e.reset_singleton_INTERNAL_ONLY;var n=(i||(i=c("ExecutionEnvironment"))).isInBrowser?l("MawDbInUISingleton_INTERNAL_ONLY").then(function(a){return{openReadonlyTransaction:function(b,e,f){return a.stores.transaction("r",e,function(){d("MAWDexieTable").setDexiePSDItem("transactorName",b);d("MAWDexieTable").setDexiePSDItem("transactionRequested",(j||(j=c("performance"))).now()+j.timeOrigin);return f(a.stores)})},openReadWriteTransaction:function(b,e,f){return a.stores.transaction("rw",e,function(){d("MAWDexieTable").setDexiePSDItem("transactorName",b);d("MAWDexieTable").setDexiePSDItem("transactionRequested",(j||(j=c("performance"))).now()+j.timeOrigin);return f(a.stores)})}}}):new(h||(h=b("Promise")))(function(){});g.makeMsgrTransactor=d("MAWTransactor").makeMsgrUITransactor_IMPORT_FROM_MAWIndexedDbUI_INSTEAD;g.afterTransaction=d("MAWIndexedDb").afterTransaction;g.makeMAWIndexedDBFactory=a;g.makeDB=f;g.closeDB=k;g.getDB=l;g.deleteDb=m;g.reset_singleton_INTERNAL_ONLY=e;g.MawDbInUISingleton=n}),98);
__d("MAWWorkerCacheServiceRegistry",["MAWSnippetsCacheService"],(function(a,b,c,d,e,f,g){"use strict";var h={snippets:d("MAWSnippetsCacheService").getMAWSnippetsCacheService()};function a(){return h}g.getWorkerRegistry=a}),98);
__d("WorkerSchedulerPriority",[],(function(a,b,c,d,e,f){"use strict";a=2;b=1;c=0;f.BACKGROUND_PRIORITY=a;f.REGULAR_PRIORITY=b;f.BLOCKING_PRIORITY=c}),66);
__d("WorkerScheduler",["$InternalEnum","Promise","QPLFlow","QuickPerformanceLogger","WAGetSafeQPLError","WAResolvable","WAShiftTimer","WATagsLogger","WATimeUtils","WorkerSchedulerPriority","err","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v=d("WATagsLogger").TAGS(["WorkerScheduler"]),w=0,x=100,y=3e4,z=10,A=6e4,B=b("$InternalEnum")({CREATED:0,SCHEDULED:1,RUNNING:2,COMPLETED:3,CANCELLED:-3,FAILED:-2,STUCK:-1}),C=function(){function a(a,b){var c;this.$3=!1;this.$4=new Map();this.$5=new Map();this.$6=new Map();this.$7=[new Set(),new Set(),new Set()];this.$8=[new((c=d("WAResolvable")).Resolvable)(),new c.Resolvable(),new c.Resolvable()];this.$9=new c.Resolvable();this.$1=a;this.config=b;this.$2=v.TAGS([a])}var e=a.prototype;e.waitUntilEndReached=function(){return this.$9.promise};e.waitUntilBlockingEnded=function(){return this.$8[d("WorkerSchedulerPriority").BLOCKING_PRIORITY].promise};e.waitUntilRegularEnded=function(){return this.$8[d("WorkerSchedulerPriority").REGULAR_PRIORITY].promise};e.waitUntilBackgroundEnded=function(){return this.$8[d("WorkerSchedulerPriority").BACKGROUND_PRIORITY].promise};e.getDebugState=function(){var a=this,b=Date.now();return{activeTasks:Array.from(this.$6.entries()).map(function(c){var d=c[0];c=c[1];d=a.$5.get(d);return!d||d.startTime==null?null:{executionTimeMs:b-d.startTime,priority:c,task:d.name,waitTimeMs:b-d.scheduledTime}}).filter(Boolean),pendingTasksByPriority:this.$7.map(function(c){var d=[];c.forEach(function(c){c=a.$5.get(c);if(!c)return;d.push({task:c.name,waitTimeMs:b-c.scheduledTime})});return d})}};e.$10=function(){if(this.$6.size<this.config.maxConcurrency){var a=this.pendingTasksTick({increaseCounter:!1,lowestTier:this.$3?d("WorkerSchedulerPriority").BACKGROUND_PRIORITY:d("WorkerSchedulerPriority").BLOCKING_PRIORITY,tasksToPick:1,tickDelta:0});a=a.candidates;var b=E.getHighestActivePriority();a.length>0&&this.maybeStartTask(a[0].id,b)}};e.runTask=function(a){return this.task(a).run()};e.task=function(a){var b,c=this.$1+":"+a.name+":"+w++;b=(b=a.priority)!=null?b:d("WorkerSchedulerPriority").REGULAR_PRIORITY;a=this.$11(c,{annotations:a.annotations,customFlags:a.customFlags,eventSamplingRate:a.eventSamplingRate,fn:a.fn,name:a.name,priority:b});this.$4.set(c,a);return a.publicApi};e.$12=function(a){var d=this.$4.get(a);if(d==null)return(u||(u=b("Promise"))).reject(c("err")("Cannot run task from Scheduler:"+this.$1+" Task was already cancelled"));d.publicApi.status=B.SCHEDULED;this.$5.set(a,d);this.$7[d.priority].add(a);this.$13(d.priority);d.metric.addPoint("schedule_start");E.scheduleTimerIfNeeded();this.$10();return d.resolvable.promise};e.$11=function(a,b){var c,e=this,f=new(d("WAResolvable").Resolvable)();c=d("QPLFlow").startQplFlowWithCoinflip(F,b.eventSamplingRate!=null?b.eventSamplingRate:this.config.defaultSamplingRate,{annotations:{bool:babelHelpers["extends"]({},(c=b.annotations)==null?void 0:c.bool,b.customFlags),"int":babelHelpers["extends"]({},(c=b.annotations)==null?void 0:c["int"],{originalPriority:b.priority}),string:babelHelpers["extends"]({},(c=b.annotations)==null?void 0:c.string,{name:b.name,scheduler:this.$1,workerID:self!=null&&"worker_id"in self?self.worker_id:void 0})}});var g={fn:b.fn,id:a,loggingParams:{},maxTickDelta:0,metric:c,name:b.name,priority:b.priority,publicApi:{cancel:function(){if(g.publicApi.status!==B.CREATED&&g.publicApi.status!==B.SCHEDULED)return!1;e.$14(a,B.CANCELLED);return e.$4["delete"](a)},id:a,name:b.name,promise:f.promise,promote:function(a){e.$2.DEV(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Promoting "," from "," to ",""])),g.id,g.priority,a);if((g.publicApi.status===B.CREATED||g.publicApi.status===B.SCHEDULED)&&g.priority>a){e.$15(g,a);return!0}return!1},run:function(){return e.$12(a)},status:B.CREATED},resolvable:f,scheduledTime:Date.now(),startTime:null,tickCounter:0,waitCounter:0};return g};e.$14=function(a,b){var c=this.$5.get(a),e=c==null?void 0:c.publicApi.status;if(c==null||e===B.COMPLETED||e===B.FAILED||e===B.STUCK)return;this.$5["delete"](a);this.$6["delete"](a);c.publicApi.status=b;var f=[this.$7[d("WorkerSchedulerPriority").BLOCKING_PRIORITY].size===0,this.$7[d("WorkerSchedulerPriority").REGULAR_PRIORITY].size===0,this.$7[d("WorkerSchedulerPriority").BACKGROUND_PRIORITY].size===0];this.$6.forEach(function(a){f[a]=!1});f[d("WorkerSchedulerPriority").BLOCKING_PRIORITY]&&f[d("WorkerSchedulerPriority").REGULAR_PRIORITY]&&f[d("WorkerSchedulerPriority").BACKGROUND_PRIORITY]&&this.$9.resolve();for(e=d("WorkerSchedulerPriority").BLOCKING_PRIORITY;e<=d("WorkerSchedulerPriority").BACKGROUND_PRIORITY;e++)f[e]&&this.$8[e].resolve()};e.maybeStartTask=function(a,b){var c=this.$5.get(a);if(c==null){this.$2.ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Safeguard: Task without corresponding record: Task: ",", Scheduler: ",""])),a,this.$1);return}if(b==null||this.$3===!0)return this.$16(c);if(b<c.priority)return;return this.$16(c)};e.$16=function(a){var c=this;this.$7[a.priority]["delete"](a.id);this.$6.set(a.id,a.priority);this.$2.TAGS([a.name]).LOG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Started: ",""])),a.id);a.startTime=Date.now();a.publicApi.status=B.RUNNING;a.metric.addPoint("schedule_end",{"int":{priorityTier:a.priority,waitTicks:a.waitCounter}});a.metric.addPoint("run_start",{"int":{startPriority:a.priority}});var e;try{e=a.fn({metric:a.metric})}catch(a){e=(u||(u=b("Promise"))).reject(a)}e.then(function(b){a.resolvable.resolve(b),c.$2.TAGS([a.name]).LOG(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Completed: ",""])),a.id),a.metric.addPoint("run_end",{"int":{executionTicks:a.tickCounter}}),c.$14(a.id,B.COMPLETED),a.metric.endSuccess({"int":{maxTickDeltaMs:a.maxTickDelta}}),c.$10()})["catch"](function(b){a.resolvable.reject(b),c.$2.TAGS([a.name]).WARN(l||(l=babelHelpers.taggedTemplateLiteralLoose(["Failed: ",""])),a.id),a.metric.addPoint("run_fail"),c.$2.TAGS([a.name]).ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Debug params: "," failed: ",""])),a.loggingParams,b),c.$14(a.id,B.FAILED),a.metric.endFail("runtime",{"int":{maxTickDeltaMs:a.maxTickDelta},string:{jsError:d("WAGetSafeQPLError").getSafeQPLErrorMessage(b)}}),c.$10()})};e.$13=function(a){for(var b=d("WorkerSchedulerPriority").BLOCKING_PRIORITY;b<=a;b++)this.$8[b].resolveWasCalled()&&(this.$8[b]=new(d("WAResolvable").Resolvable)());this.$9.resolveWasCalled()&&(this.$9=new(d("WAResolvable").Resolvable)())};e.getHighestActivePriority=function(){var a=this,b=null;this.$6.forEach(function(c,d){c=a.$5.get(d);if(c==null){v.ERROR(n||(n=babelHelpers.taggedTemplateLiteralLoose(["Safeguard: Active task without corresponding record: Task: ",", Scheduler: ",""])),d,a.$1);a.$6["delete"](d);return}(b==null||b>c.priority)&&(b=c.priority)});return b};e.activeTasksTick=function(a){var b=this,d=null;this.$6.forEach(function(e,f){e=b.$5.get(f);if(e==null){v.ERROR(o||(o=babelHelpers.taggedTemplateLiteralLoose(["Safeguard: Active task without corresponding record: Task: ",", Scheduler: ",""])),f,b.$1);b.$6["delete"](f);return}e.tickCounter++;e.maxTickDelta=Math.max(a,e.maxTickDelta);(d==null||d>e.priority)&&(d=e.priority);e.tickCounter>b.config.ticksToStuck&&e.publicApi.status===B.RUNNING&&(v.WARN(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Possibly stuck: ",""])),e.name),b.$14(e.id,B.STUCK),e.resolvable.reject(c("err")("Stuck")),e.metric.endFail("stuck",{"int":{maxTickDeltaMs:e.maxTickDelta}}))});return d};e.$15=function(a,b){function c(){switch(e){case d("WorkerSchedulerPriority").BACKGROUND_PRIORITY:return d("WorkerSchedulerPriority").REGULAR_PRIORITY;case d("WorkerSchedulerPriority").REGULAR_PRIORITY:return d("WorkerSchedulerPriority").BLOCKING_PRIORITY;default:return d("WorkerSchedulerPriority").BLOCKING_PRIORITY}}var e=a.priority;b=b!=null?b:c();if(b===e)return;a.metric.addPoint("promote_to_"+b);this.$7[e]["delete"](a.id);a.priority=b;this.$7[b].add(a.id)};e.pendingTasksTick=function(a){var b=this,c=a.increaseCounter,e=a.lowestTier,f=a.tasksToPick,g=a.tickDelta,h=[],i=!0;a=function(a){i&&(i=b.$7[a].size===0),b.$7[a].forEach(function(e){var i=b.$5.get(e);if(i==null){v.ERROR(q||(q=babelHelpers.taggedTemplateLiteralLoose(["Safeguard: Pending task without corresponding record: Task: ",", Scheduler: ",""])),e,b.$1);b.$7[a]["delete"](e);return}c&&(i.waitCounter++,i.maxTickDelta=Math.max(g,i.maxTickDelta),i.priority>d("WorkerSchedulerPriority").REGULAR_PRIORITY&&i.waitCounter>=b.config.throttleTicks&&b.$15(i),i.priority===d("WorkerSchedulerPriority").REGULAR_PRIORITY&&i.waitCounter>=E.maxWaitTicksMultiplierForFinalPromotion*b.config.throttleTicks&&(v.LOG(r||(r=babelHelpers.taggedTemplateLiteralLoose(["Promoting task ",":"," to blocking priority"])),b.$1,i.name),b.$15(i)));if(h.length>=f)return;if(b.$6.size+h.length>=b.config.maxConcurrency)return;h.push(i)})};for(var j=d("WorkerSchedulerPriority").BLOCKING_PRIORITY;j<=e;j++)a(j);return{candidates:h.map(function(a){return{id:a.id,priority:a.priority}}),isEmpty:i}};e.TEST_ONLY_ignore_delays=function(){this.$3=!0};return a}(),D=function(){function a(){var a=this;this.$1=new Map();this.tickFrequencyMs=x;this.maxThrottleMs=A;this.maxWaitTicksMultiplierForFinalPromotion=z;this.$2=null;this.$3=new(d("WAShiftTimer").ShiftTimer)(function(){var b=!1;try{var c,e=d("WATimeUtils").performanceAbsoluteNow();b=a.$4(e-((c=a.$2)!=null?c:e))}catch(a){v.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Scheduler fatal: ",""])),a)}finally{b===!1?(a.$2=d("WATimeUtils").performanceAbsoluteNow(),a.$3.onOrBefore(a.tickFrequencyMs)):a.$2=null}});this.$5=new Map()}var b=a.prototype;b.getHighestActivePriority=function(){var a=null;this.$5.forEach(function(b){b=b.getHighestActivePriority();a!=null&&b!=null&&a<b&&(a=b);a==null&&b!=null&&(a=b)});return a};b.$4=function(a){var b,c=!0,e=null;this.$5.forEach(function(b){b=b.activeTasksTick(a);e!=null&&b!=null&&e<b&&(e=b);e==null&&b!=null&&(e=b)});var f=[[],[],[]];this.$5.forEach(function(b){var e=b.pendingTasksTick({increaseCounter:!0,lowestTier:d("WorkerSchedulerPriority").BACKGROUND_PRIORITY,tasksToPick:b.config.concurrency,tickDelta:a}),g=e.candidates;e=e.isEmpty;c&&(c=e);g.forEach(function(a){f[a.priority].push({id:a.id,scheduler:b})})});b=(b=f.find(function(a){return a.length>0}))!=null?b:[];for(b of b){var g=b.id,h=b.scheduler;h.maybeStartTask(g,e)}return c};b.scheduleTimerIfNeeded=function(){this.$3.onOrBefore(this.tickFrequencyMs)};b.newScheduler=function(a,b){var c=this.$5.get(a);if(c)return c;c=new C(a,b);this.$5.set(a,c);return c};b.TEST_ONLY_reset=function(){this.$5=new Map(),this.$1=new Map()};return a}(),E=new D(),F=c("qpl")._(1056838280,"1566");function a(a,b){return E.newScheduler(a,{concurrency:(a=b.concurrency)!=null?a:1,defaultSamplingRate:(a=b.defaultSamplingRate)!=null?a:1e4,maxConcurrency:b.maxConcurrency,throttleTicks:Math.round(((a=b.maxThrottleMs)!=null?a:E.maxThrottleMs)/E.tickFrequencyMs),ticksToStuck:Math.round(((a=b.timeToStuckMs)!=null?a:y)/E.tickFrequencyMs)})}function e(a){a.tickFrequencyMs!=null&&(E.tickFrequencyMs=a.tickFrequencyMs),a.maxThrottleMs!=null&&(E.maxThrottleMs=a.maxThrottleMs),a.maxWaitTicksMultiplierForFinalPromotion!=null&&(E.maxWaitTicksMultiplierForFinalPromotion=a.maxWaitTicksMultiplierForFinalPromotion),a.qplEventType!=null&&(F=a.qplEventType),(t||(t=c("QuickPerformanceLogger"))).setAlwaysOnSampleRate(F,1)}function f(){E.TEST_ONLY_reset()}g.BACKGROUND_PRIORITY=d("WorkerSchedulerPriority").BACKGROUND_PRIORITY;g.BLOCKING_PRIORITY=d("WorkerSchedulerPriority").BLOCKING_PRIORITY;g.REGULAR_PRIORITY=d("WorkerSchedulerPriority").REGULAR_PRIORITY;g.SchedulerExecutionState=B;g.makeScheduler=a;g.configWorkerScheduler=e;g.TEST_ONLY_reset=f}),98);
__d("MAWWorkerCacheServices",["FBLogger","MAWBridge","MAWCacheServiceDB","MAWCacheServiceQPL","MAWCacheServiceUtils","MAWLoggerUtils","MAWWorkerCacheServiceRegistry","WorkerScheduler","cr:2354"],(function(a,b,c,d,e,f,g){"use strict";var h=function(){function a(){this.$1=d("MAWCacheServiceUtils").getMAWCacheServiceBroadcastChannel();var a=d("MAWWorkerCacheServiceRegistry").getWorkerRegistry();this.registry=a;this.schedulerRegistry=Object.keys(a).reduce(function(a,b){return babelHelpers.extends({},a,(a={},a[b]=d("WorkerScheduler").makeScheduler(d("MAWCacheServiceUtils").getSchedulerName(b),d("MAWCacheServiceUtils").SCHEDULER_CONFIG),a))},{})}var e=a.prototype;e.$2=function(a,b,c,e){b={cache:b,instanceKey:e,namespace:a,source:c};this.$1==null?d("MAWBridge").getBridge().fireAndForget("event","broadcastChannelFallback",{event:{data:b},namespace:d("MAWCacheServiceUtils").MAW_CACHE_SERVICE_BROADCAST_CHANNEL}):this.$1.postMessage(b)};e.$3=async function(a,e,f,g){var h=d("MAWCacheServiceUtils").findDuplicates(e,function(a){var b=a[0];a[1];return b});h.length>0&&(c("FBLogger")("MAWCacheService").mustfix("Found duplicate keys in cache: %s. Original keys: %s, Namespace: %s, Source: %s",h.map(function(a){var b=a[0];a[1];return b}).join(", "),e.map(function(a){var b=a[0];a[1];return b}).join(", "),a,f),g!=null&&c("MAWCacheServiceQPL").addAnnotationsQPL(g,{bool:{hasDuplicateKeys:!0},string_array:{duplicateKeys:c("MAWCacheServiceQPL").redactKeysForNonEmployee(h.map(function(a){var b=a[0];a[1];return b}))}}));if(e.length===0){g!=null&&(c("MAWCacheServiceQPL").addPointQPL(g,"nothing_to_update_in_cache",f),c("MAWCacheServiceQPL").endSuccessQPL(g));return}g!=null&&c("MAWCacheServiceQPL").addPointQPL(g,"updating_cache_in_persisted_start",f);h=this.registry[a];h.updateInMemoryCacheBulk(e);try{var i=d("MAWCacheServiceDB").convertCacheValueToDBRawValue(e);h=await d("MAWCacheServiceDB").getOrSetupMAWCacheDB();await h.runInTransaction([a],"readwrite",function(b){var c=i.map(function(a){return{item:a,selector:[a.key]}});return b.stores[a].bulkUpsert("key",c)},"update_cache_"+a);f==="realtime-update"&&(b("cr:2354")==null||b("cr:2354").notifyCacheWrite(i.map(function(a){a=a.key;return a})));g!=null&&c("MAWCacheServiceQPL").addPointQPL(g,"updating_cache_in_persisted_end",f)}catch(a){g!=null&&(c("MAWCacheServiceQPL").addAnnotationsQPL(g,{string:{error:a.message}}),c("MAWCacheServiceQPL").addPointQPL(g,"updating_cache_in_persisted_failed",f)),c("FBLogger")("MAWCacheService").catching(a).mustfix("Failed to update persisted cache")}g!=null&&c("MAWCacheServiceQPL").addPointQPL(g,"broadcasting_to_ui_start",f);this.$2(a,e,f,g)};e.calculateDelta=function(a){var b=this,e=Object.values(this.registry).map(function(e){var f=e.shouldDropDelta(a);return f.then(function(f){if(f)return;f=b.schedulerRegistry[e.namespace];return f.runTask({fn:function(){return e.calculateDelta(a).then(function(a){var f=a.map(function(a){var b=a[0];a[1];return b}),g=d("MAWLoggerUtils").getInstanceKey();a.length!==0&&(c("MAWCacheServiceQPL").startQPL(g,e.namespace),c("MAWCacheServiceQPL").addAnnotationsQPL(g,{bool:{isRealtimeUpdate:!0},int:{instanceKey:g},string_array:{realtimeUpdatedKeys:f}}));return b.$3(e.namespace,a,"realtime-update",g)}).catch(function(a){c("FBLogger")("MAWCacheService").catching(a).warn("Failed to calculate delta for: %s",e.namespace)})},name:"maw_calculate_delta",priority:d("WorkerScheduler").REGULAR_PRIORITY})})});Promise.all([].concat(e)).catch(function(a){c("FBLogger")("MAWCacheService").catching(a).mustfix("Failed to calculate delta for all services")})};e.computeCachePayloadFromScratch=function(a,b,e,f){var g=this;f!=null&&c("MAWCacheServiceQPL").registerInstanceKeyInWorker(f);c("MAWCacheServiceQPL").addPointQPL(f,"compute_from_scratch_start",e);c("MAWCacheServiceQPL").addAnnotationsQPL(f,{string_array:{keysReceivedInWorker:c("MAWCacheServiceQPL").redactKeysForNonEmployee(b)}});var h=this.registry[a],i=this.schedulerRegistry[h.namespace];if(h==null)throw c("FBLogger")("messenger_web").mustfixThrow("No service found for namespace: "+a);return i.runTask({fn:function(){return h.computeCachePayloadFromScratch(b).then(function(b){c("MAWCacheServiceQPL").addPointQPL(f,"compute_from_scratch_end",e);return g.$3(a,b,e,f)}).catch(function(a){c("MAWCacheServiceQPL").endFailureQPL(f,"compute_from_scratch_failed",e),c("FBLogger")("MAWCacheService").catching(a).warn("Failed to compute cache payload from scratch")})},name:"maw_compute_cache_payload_from_scratch",priority:d("WorkerScheduler").REGULAR_PRIORITY})};return a}(),i=null;a=function(){i==null&&(i=new h());return i};g.getMAWWorkerCacheServices=a}),98);
__d("MAWDbMsgOrReaction",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return a.reactToExternalId!=null?b.forReaction(a):b.forMessage(a)}function b(a,b){return a==null?b.forNull():a.reactToExternalId!=null?b.forReaction(a):b.forMessage(a)}function c(a,b){return a.reactToExternalId!=null?b.forReaction(a):b.forMessage(a)}function d(a,b){return a==null?b.forNull():a.reactToExternalId!=null?b.forReaction(a):b.forMessage(a)}f.switchOnMsgOrReaction=a;f.switchOnMsgOrReactionNullish=b;f.switchOnMsgOrReactionMaybeUnstored=c;f.switchOnMsgOrReactionMaybeUnstoredNullish=d}),66);
__d("MAWExtractMsFromExternalId",["I64","MAWExternalId","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=2199023255551;function a(a){try{a=(i||(i=d("I64"))).of_string_opt(a);if(a!=null){return(a=k(a))!=null?a:0}}catch(a){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Failed to convert externalId to number: ",""])),a)}return 0}function k(a){a=Number((i||(i=d("I64"))).to_string(i.and_(i.lsr_(a,22),i.of_float(j))));return d("MAWExternalId").getThreeMostSignificantDigitsForSortOrderTimestamp(a)}g.extractMsFromStanzaId=a;g.extractMsFromExternalId=k}),98);
__d("MAWGetBumpTimestampMs",["I64","MAWAckLevel","MAWDbMsgOrReaction","MAWExtractMsFromExternalId","MAWTimeUtils","WALongInt","WATimeUtils","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b){b=b==null?null:d("MAWExtractMsFromExternalId").extractMsFromExternalId(b);return(h||(h=d("I64"))).add(d("MAWTimeUtils").millisTimeToTimestamp(a),h.of_int32(b!=null?b:0))}function j(a){var b=a.msg;a=a.throwIfNoServerTs;a=a?c("nullthrows")(b.serverTs):b.serverTs;return i(d("WATimeUtils").castUnixTimeToMillisTime(a!=null?a:b.ts),(h||(h=d("I64"))).of_string(b.externalId))}function k(a){return a.senderTimestampMs!=null?(h||(h=d("I64"))).of_string(d("WALongInt").longIntToDecimalString(a.senderTimestampMs)):i(d("WATimeUtils").castUnixTimeToMillisTime(a.ts),(h||(h=d("I64"))).of_string(a.externalId))}function a(a){return d("MAWDbMsgOrReaction").switchOnMsgOrReactionMaybeUnstoredNullish(a,{forMessage:function(a){return d("MAWAckLevel").isMsgAuthoritative(a.ack)&&a.sortOrderMs!=null?(h||(h=d("I64"))).of_float(a.sortOrderMs):j({msg:a,throwIfNoServerTs:!1})},forNull:function(){return(h||(h=d("I64"))).zero},forReaction:k})}g.calculateBumpTimestampMs=i;g.getBumpTimestampMs=a}),98);
__d("MAWSnippetsCacheServiceUtils",["I64","MAWDbMsgOrReaction","MAWGetBumpTimestampMs"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return d("MAWDbMsgOrReaction").switchOnMsgOrReactionNullish(a,{forMessage:function(a){return{msgAckLevel:a.ack,msgId:a.msgId,reactionId:void 0,timestamp:a.sortOrderMs!=null?a.sortOrderMs:(h||(h=d("I64"))).to_float(d("MAWGetBumpTimestampMs").getBumpTimestampMs(a))}},forNull:function(){return{msgAckLevel:void 0,msgId:void 0,reactionId:void 0,timestamp:Number.MIN_SAFE_INTEGER}},forReaction:function(a){return{msgAckLevel:void 0,msgId:void 0,reactionId:a.reactionId,timestamp:(h||(h=d("I64"))).to_float(d("MAWGetBumpTimestampMs").getBumpTimestampMs(a))}}})}g.getMsgOrReactionIdAndTimestamp=a}),98);
__d("MAWUpdateThreadListItemUtils",["MAWAckLevel","MAWDbMsg","MAWDbMsgOrReaction","MAWMsgType","MAWXMAUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("MAWDbMsgOrReaction").switchOnMsgOrReactionMaybeUnstored(a,{forMessage:function(a){return a.altIndex===d("MAWDbMsg").SPAM_ALT_INDEX||a.altIndex===d("MAWDbMsg").FUTUREPROOF_SPAM_ALT_INDEX},forReaction:function(){return!1}})}function b(a){return d("MAWDbMsgOrReaction").switchOnMsgOrReactionMaybeUnstored(a,{forMessage:function(a){return a.ack===d("MAWAckLevel").ACK.clock},forReaction:function(){return!1}})}function c(a){return a.msgId!=null&&a.type===d("MAWMsgType").MSG_TYPE.XMA&&((a=a.msgContent)==null?void 0:a.content)===""}function e(a){return a.type===d("MAWMsgType").MSG_TYPE.XMA&&d("MAWXMAUtils").isRtcXMA(a==null?void 0:a.xmaMessageType)}g.isSpamMessage=a;g.isOptimisticMessage=b;g.isXMAThreadSnippet=c;g.isRTCXMAMessage=e}),98);
__d("MAWSnippetsCacheCalculateDelta",["FBLogger","MAWDbMsgOrReaction","MAWGetThreadUpdateType","MAWSnippetsCacheServiceUtils","MAWUpdateThreadListItemUtils"],(function(a,b,c,d,e,f,g){"use strict";var h="[SnippetsCacheService][Worker]";function a(a){var b=new Set(a.map(function(a){var b;b=(b=a.decryptedValues)!=null?b:[];a=(a=a.deletedValues)!=null?a:[];return[].concat(b,a)}).flat().map(function(a){return d("MAWUpdateThreadListItemUtils").isOptimisticMessage(a)?null:a.msgId}).filter(Boolean));return a.reduce(function(a,c){var d=c.type==="delete"?c.deletedValues:c.decryptedValues;d=l(d);d=m(b,d);if(d.length===0)return a;d.forEach(function(b){var d=b.threadJid,e=a.get(d);b=k({type:c.type,value:b},e);a.set(d,b)});return a},new Map())}function b(a){return a.some(function(a){a.chatJid;a.lastComputedCacheValue;a=a.mutateReq;return!i(a)||j(a.value)})}function i(a){return a.type==="delete"||a.type==="deleteRange"||d("MAWUpdateThreadListItemUtils").isXMAThreadSnippet(a.value)||p(a.value)||q(a.value)?!1:!0}function j(a){return d("MAWDbMsgOrReaction").switchOnMsgOrReaction(a,{forMessage:function(a){return!1},forReaction:function(a){return a.reaction!=null&&d("MAWGetThreadUpdateType").canReactionAffectBump(a)}})}function k(a,b){if(b==null)return a;var c=d("MAWSnippetsCacheServiceUtils").getMsgOrReactionIdAndTimestamp(a.value);c=c.timestamp;var e=a.value.externalId,f=d("MAWSnippetsCacheServiceUtils").getMsgOrReactionIdAndTimestamp(b.value);f=f.timestamp;var g=b.value.externalId;if(c===f){if(a.type==="delete"||a.type==="deleteRange")return a;else if(b.type==="delete"||b.type==="deleteRange")return b;return e.localeCompare(g)>0?a:b}if(c==null)return b;return f==null?a:c>f?a:b}function l(a){return a==null||a.length===0?[]:a.filter(function(a){return n(a)})}function m(a,b){return b.reduce(function(b,c){var e=d("MAWSnippetsCacheServiceUtils").getMsgOrReactionIdAndTimestamp(c);e=e.msgId;return e!=null&&d("MAWUpdateThreadListItemUtils").isOptimisticMessage(c)&&a.has(e)?b:[].concat(b,[c])},[])}function n(a){var b=o(a)&&!d("MAWUpdateThreadListItemUtils").isSpamMessage(a);b||r(a);return b}function o(a){return d("MAWDbMsgOrReaction").switchOnMsgOrReaction(a,{forMessage:function(b){return d("MAWGetThreadUpdateType").isThreadUpdateTypeEligibleForSnippet(a)},forReaction:function(b){return d("MAWGetThreadUpdateType").canReactionAffectBump(b)&&p(b)||d("MAWGetThreadUpdateType").isThreadUpdateTypeEligibleForSnippet(a)}})}function p(a){return d("MAWDbMsgOrReaction").switchOnMsgOrReaction(a,{forMessage:function(a){return!1},forReaction:function(a){return a.reaction==null}})}function q(a){return d("MAWDbMsgOrReaction").switchOnMsgOrReaction(a,{forMessage:function(a){return a.ephemeralMsgDisappeared===!0},forReaction:function(a){return!1}})}function r(a){a=d("MAWSnippetsCacheServiceUtils").getMsgOrReactionIdAndTimestamp(a);var b=a.msgId;a=a.reactionId;c("FBLogger")("MAWCacheService").info(h+" msg or reaction is not eligible for snippet update, msgId: %s, reactionId: %s",b,a)}g.parseAndGetMostRecentSnippetUpdateMutateRequestForChatJids=a;g.isDbTransactionRequiredForSnippetUpdate=b;g.canCalculateSnippetUpdateFromDelta=i;g.isNeededToCheckMessageExistence=j}),98);
__d("MAWSnippetsCacheService",["FBLogger","MAWAckLevel","MAWCacheServiceBase","MAWDbMsgOrReaction","MAWDbMsgTxns","MAWDexieTable","MAWGetThreadUpdateType","MAWIndexedDb","MAWMessagesCompare","MAWSnippetsCacheCalculateDelta","MAWSnippetsCacheServiceUtils","MAWThreadNewestMsgOrReactionUtils","MAWThreadSnippetBuildTxns","MAWThreadSnippetUtils","MAWTransactionMode","MAWUpdateThreadListItemUtils","MAWVault","MWThreadListConsts","WAJids","qex"],(function(a,b,c,d,e,f,g){"use strict";var h=["messages","reactions"],i="[SnippetsCacheService][Worker]";a=function(a){function b(){return a.call(this,"snippets")||this}babelHelpers.inheritsLoose(b,a);var e=b.prototype;e.$MAWSnippetsCacheService$p_1=function(a){var b=this;a=a.filter(function(a){a=a[0];return h.includes(a)});a=d("MAWSnippetsCacheCalculateDelta").parseAndGetMostRecentSnippetUpdateMutateRequestForChatJids(a.map(function(a){a[0];a=a[1];return a}));return Promise.all(Array.from(a.entries()).map(async function(a){var c=a[0];a=a[1];var d=await b.getValueFromCache(c);return{chatJid:c,lastComputedCacheValue:d,mutateReq:a}}))};e.calculateDelta=function(a){var b=this;return this.$MAWSnippetsCacheService$p_1(a).then(function(a){if(a.length===0)return Promise.resolve([]);if(d("MAWSnippetsCacheCalculateDelta").isDbTransactionRequiredForSnippetUpdate(a))return d("MAWIndexedDb").makeMsgrTransactor({messages:d("MAWTransactionMode").READONLY,reactions:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY},"MAWSnippetsCacheService:calculateDelta",function(a){return function(c){return b.$MAWSnippetsCacheService$p_2(a,c)}})(a);else return b.$MAWSnippetsCacheService$p_3(a)})};e.computeCachePayloadFromScratch=function(a){var b=this;return d("MAWIndexedDb").makeMsgrTransactor({messages:d("MAWTransactionMode").READONLY,reactions:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY},"MAWSnippetsCacheService:computeCachePayloadFromScratch",function(a){return function(c){return d("MAWDexieTable").dexieAll(c.map(function(c){c=d("WAJids").unsafeCoerceToChatJid(c);return b.$MAWSnippetsCacheService$p_4(a,c,"from-scratch")})).then(function(a){return a.filter(Boolean)})}})(a)};e.$MAWSnippetsCacheService$p_5=function(a,b){if(b==null)return"no-value-calculated-from-scratch";if(d("MAWUpdateThreadListItemUtils").isOptimisticMessage(a.value))return null;a=d("MAWSnippetsCacheServiceUtils").getMsgOrReactionIdAndTimestamp(a.value);var c=a.msgAckLevel,e=a.msgId,f=a.reactionId;a=a.timestamp;if(a==null)return"missing-timestamp";if(e!=null&&e===b.value.snippetMsgId)return null;if(f!=null&&f===b.value.snippetReactionId)return null;return e!=null&&c!==d("MAWAckLevel").ACK.received&&b.value.snippetMsgAckLevel===d("MAWAckLevel").ACK.clock?"optimistic-snippet-in-cache":a<b.timestamp?"older-than-last-snippet-value":null};e.$MAWSnippetsCacheService$p_6=function(a,b){var e;if(a.type!=="add")return!1;e=(e=c("qex")._("1213"))!=null?e:!1;return!e?!1:d("MAWDbMsgOrReaction").switchOnMsgOrReaction(a.value,{forMessage:function(a){var c;if(a.sortOrderMs==null||!d("MAWThreadNewestMsgOrReactionUtils").filterForSnippetNewestIncomingMessages(d("MAWGetThreadUpdateType").getThreadUpdateTypeForMsg(a),a.ephemeralMsgDisappeared===!0))return!1;var e=b==null||(c=b.value)==null?void 0:c.snippetNewestIncomingMsgs;if(e==null||e.length<d("MWThreadListConsts").SNIPPET_MAX_NEWEST_INCOMING_MESSAGES_COUNT)return!0;e=e[e.length-1];if(e==null||e.sortOrderMs==null)return!0;var f=d("MAWMessagesCompare").getSortComparisonFunctionForDirection("desc");return f({externalId:e.externalId,sortOrderMs:e.sortOrderMs},{externalId:a.externalId,sortOrderMs:a.sortOrderMs})>0},forReaction:function(a){return!1}})};e.$MAWSnippetsCacheService$p_7=function(a,b){var c={externalId:b.value.externalId,sortOrderMs:b.value.sortOrderMs};if(a==null||a.some(function(a){return a.externalId===c.externalId}))return[c];b=d("MAWMessagesCompare").getSortComparisonFunctionForDirection("desc");a=[].concat(a,[c]).sort(b).slice(0,d("MWThreadListConsts").SNIPPET_MAX_NEWEST_INCOMING_MESSAGES_COUNT);return a};e.shouldDropDelta=function(a){var b=this;return this.$MAWSnippetsCacheService$p_1(a).then(function(a){return a.length===0?Promise.resolve(!0):Promise.all(a.map(async function(a){var c=a.chatJid,d=a.lastComputedCacheValue;a=a.mutateReq;if(b.$MAWSnippetsCacheService$p_6(a,d))return!1;d=await b.$MAWSnippetsCacheService$p_5(a,d);if(d!=null){k({dropReason:d,key:c,msgOrReaction:a.value,operation:a.type});return!0}return!1})).then(function(a){if(a.every(function(a){return a===!0}))return!0;else return!1})})};e.$MAWSnippetsCacheService$p_4=function(a,b,c){var e=this;return d("MAWThreadSnippetUtils").getThreadSnippetFromScratch(a,b).then(function(a){a=e.$MAWSnippetsCacheService$p_8(b,a,c);return a==null?void 0:d("MAWDexieTable").dexieResolve([b,a])})};e.$MAWSnippetsCacheService$p_3=function(a){var b=this;return a.map(function(a){var c=b.$MAWSnippetsCacheService$p_9(a);return c==null?void 0:[a.chatJid,c]}).filter(Boolean)};e.$MAWSnippetsCacheService$p_2=function(a,b){var c=this;return d("MAWDexieTable").dexieAll(b.map(function(b){return!d("MAWSnippetsCacheCalculateDelta").canCalculateSnippetUpdateFromDelta(b.mutateReq)?c.$MAWSnippetsCacheService$p_4(a,b.chatJid,"realtime-from-scratch"):c.$MAWSnippetsCacheService$p_10(a,b.mutateReq.value).then(function(a){if(a)return void 0;a=c.$MAWSnippetsCacheService$p_9(b);return a==null?void 0:d("MAWDexieTable").dexieResolve([b.chatJid,a])})})).then(function(a){return a.filter(Boolean)})};e.$MAWSnippetsCacheService$p_9=function(a){var b;b=(b=c("qex")._("1213"))!=null?b:!1;if(b)return this.$MAWSnippetsCacheService$p_11(a);b=d("MAWThreadSnippetBuildTxns").buildThreadSnippetForMsgOrIncomingReaction(a.chatJid,a.mutateReq.value);b=this.$MAWSnippetsCacheService$p_8(a.chatJid,{snippet:b,snippetMsgOrReaction:a.mutateReq.value},"realtime-calculate-delta");return b};e.$MAWSnippetsCacheService$p_11=function(a){var b,c=a.chatJid,e=a.lastComputedCacheValue;a=a.mutateReq;var f=this.$MAWSnippetsCacheService$p_6(a,e),g=this.$MAWSnippetsCacheService$p_5(a,e)==null;f=f?this.$MAWSnippetsCacheService$p_7(e==null||(b=e.value)==null?void 0:b.snippetNewestIncomingMsgs,a):e==null?void 0:e.value.snippetNewestIncomingMsgs;if(!g&&e!=null)return babelHelpers.extends({},e,{value:babelHelpers.extends({},e.value,{snippetNewestIncomingMsgs:f})});g=d("MAWThreadSnippetBuildTxns").buildThreadSnippetForMsgOrIncomingReaction(c,a.value);e=this.$MAWSnippetsCacheService$p_8(c,{snippet:g,snippetMsgOrReaction:a.value,snippetNewestIncomingMsgsMetadata:f},"realtime-calculate-delta");return e};e.$MAWSnippetsCacheService$p_8=function(a,b,c){if(b==null){j({flow:c,key:a,threadSnippetResult:b});return void 0}var e=d("MAWSnippetsCacheServiceUtils").getMsgOrReactionIdAndTimestamp(b.snippetMsgOrReaction),f=e.msgAckLevel,g=e.msgId,h=e.reactionId;e=e.timestamp;j({flow:c,key:a,msgAckLevel:f,msgId:g,reactionId:h,threadSnippetResult:b,timestamp:e});if(e==null)return void 0;c=babelHelpers.extends({},b.snippet.snippetParams,{strings:b.snippet.snippetParams.strings.map(function(a){return d("MAWVault").unvault(a)})});return{key:a,timestamp:e,value:{snippet:babelHelpers.extends({},b.snippet,{snippetParams:c}),snippetMsgAckLevel:f,snippetMsgId:g,snippetNewestIncomingMsgs:b.snippetNewestIncomingMsgsMetadata,snippetReactionId:h}}};e.$MAWSnippetsCacheService$p_10=function(a,b){if(!d("MAWSnippetsCacheCalculateDelta").isNeededToCheckMessageExistence(b))return d("MAWDexieTable").dexieResolve(!1);b=d("MAWDbMsgOrReaction").switchOnMsgOrReaction(b,{forMessage:function(a){return null},forReaction:function(a){return a.reactToMsgId}});return b==null?d("MAWDexieTable").dexieResolve(!0):d("MAWDbMsgTxns").getMsgsByMsgIds(a,[b]).then(function(a){return a.length===0})};return b}(c("MAWCacheServiceBase"));function j(a){var b=a.flow,d=a.key,e=a.msgAckLevel,f=a.msgId,g=a.reactionId,h=a.threadSnippetResult;a=a.timestamp;if(h==null){c("FBLogger")("MAWCacheService").warn(i+"["+b+"] Failed to calculate thread snippet, key: %s",d);return}if(a==null){c("FBLogger")("MAWCacheService").warn(i+"["+b+"] No timestamp found for the thread snippet, key: %s,\n      msgId: %s, reactionId: %s",d,f,g);return}c("FBLogger")("MAWCacheService").info(i+"["+b+"] Snippet successfully calculated, key: %s,\n    timestamp: %s, msgId: %s, reactionId: %s, ack level %s",d,a,f,g,e)}function k(a){var b=a.dropReason,e=a.key,f=a.msgOrReaction;a=a.operation;f=d("MAWSnippetsCacheServiceUtils").getMsgOrReactionIdAndTimestamp(f);var g=f.msgAckLevel,h=f.msgId,j=f.reactionId;f=f.timestamp;c("FBLogger")("MAWCacheService").info(i+" Drop update for msg or reaction, reason: %s, key: %s, msgId: %s, reactionId: %s, timestamp: %s, ackLevel: %s, operation: %s",b,e,h,j,f,g,a)}var l=new a();b=function(){return l};g.getMAWSnippetsCacheService=b}),98);
__d("MAWDataSyncQueue",["WALogger","getErrorSafe","qex","throttle"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=c("qex")._("853")||1e3;a=c("qex")._("855")||1e3;b=function(){m=!1;return r({isUnloading:!0})};var k=[],l=[],m=!1,n=[],o=function(){var a,b=k.splice(0,k.length);(a=l).push.apply(a,b)},p=function(){return l.splice(0,j)},q=function(a){var b=p();if(b.length===0)return;return Promise.all(n.map(function(c,e){return c(b,a).catch(function(a){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Unhandled exception caught in middleware "," sync: ",""])),e,a)})})).then(function(){return q(a)})},r=async function(a){if(m)return;m=!0;o();try{await q(a)}catch(e){var b;a=c("getErrorSafe")(e);d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[MAWIndexedDbMiddleware] error handling queue batch: ",""])),(b=a==null?void 0:a.message)!=null?b:a.toString());throw e}finally{m=!1,k.length>0&&s()}},s=c("throttle")(r,a);e=function(a,b){k.push({type:a,value:b}),s()};f=function(a){n.some(function(b){return b===a})||n.push(a)};a=function(){n=[]};var t=function(){k=[],l=[]},u=function(){return k};g.forceFlushDataSyncQueue=b;g.addSyncItem=e;g.registerDataSyncCallback=f;g.clearDataSyncCallbacks=a;g.clearDataSyncQueue_FOR_TESTING_ONLY=t;g.getDataSyncQueue_FOR_TESTING_ONLY=u}),98);
__d("MAWDataSyncMiddleware",["FBLogger","MAWDataSyncQueue"],(function(a,b,c,d,e,f,g){"use strict";var h=new Set(["contacts","groupInfo","messages","participants","threads","reactions","xma","pendingStanzas"]);function i(a,b){var c=a.table(b);return!h.has(b)?c:babelHelpers["extends"]({},c,{mutate:function(a){return c.mutate(a).then(function(c){if(a.type==="delete"){a.keys.forEach(function(c){d("MAWDataSyncQueue").addSyncItem(a.type,{key:c,tableName:b})});return c}else c.results!=null?c.results.forEach(function(c){d("MAWDataSyncQueue").addSyncItem(a.type,{key:c,tableName:b,values:a.values})}):c.lastResult!=null&&d("MAWDataSyncQueue").addSyncItem(a.type,{key:c.lastResult,tableName:b,values:a.values});return c})}})}function a(){return{create:function(a){try{return babelHelpers["extends"]({},a,{table:function(b){return i(a,b)}})}catch(b){c("FBLogger")("messenger_web").catching(b).mustfix("Error applying DataSync Middleware, messages made during this session will not be properly synced to registered consumers");return a}},name:"MAWDataSyncMiddleware",stack:"dbcore"}}g.getDataSyncMiddleware=a}),98);
__d("MAWIndexedDb",["EBGating","ExecutionEnvironment","I64","MAWBridge","MAWCacheServiceMiddleware","MAWDataSyncMiddleware","MAWDbFactory","MAWDbMutationMiddleware","MAWDbMutationValidator","MAWDbProtocolMsgIdMiddleware","MAWDbSchema","MAWDexie","MAWLSDataSyncMiddleware","MAWMiActOnActThreadReadyQueue","MAWTransactor","MWFBLogger","cr:10181","cr:10182","cr:17239","cr:3527","gkx","justknobx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(e){e===void 0&&(e="idb");var f=d("MAWDbFactory").makeIDBFactory(e,"worker");function a(a){return f.setupPromise().then(function(){return f.getDBExn(a)})}return babelHelpers.extends({},f,{getSignalDB:a,makeDB:async function(a,e,g){var h=[d("MAWDbMutationMiddleware").getMAWDbMutationMiddleware];h.push(d("MAWLSDataSyncMiddleware").getMAWLSDataSyncMiddleware);c("gkx")("1760")&&h.push(d("MAWDbProtocolMsgIdMiddleware").MAWDbProtocolMsgIdMiddleware);h.push(c("MAWCacheServiceMiddleware"));e.enableDataSyncMiddleware&&h.push(d("MAWDataSyncMiddleware").getDataSyncMiddleware);e.enableMutationValidator===!0&&h.push(d("MAWDbMutationValidator").getMutationValidatorMiddleware);b("cr:3527")!=null&&h.push(b("cr:3527"));c("justknobx")._("4087")&&b("cr:17239")!=null&&await b("cr:17239")(a);return f.makeDB(a,{autoOpen:!0,middleware:h,onDbPopulate:e.onDbPopulate},g)}})}var j=a(),k="idle",l=j.isNewDb,m=j.willSetupDB,n=function(a,b,c){return j.makeDB(a,b,c).then(function(){k="ready"})},o=j.closeDB,p=j.getDBExn,q=j.getSignalDB,r=j.getDB,s=function(a){return j.reset_singleton_INTERNAL_ONLY()},t=j.deleteDb;function e(){return k}function f(a){var b=k;k="migrating";return a.finally(function(){k=b})}var u=new WeakMap(),v=new WeakMap(),w=d("MWFBLogger").MWLogger.tags(["db","afterTransaction"]);function x(a){var b=c("MAWDexie").currentTransaction;if(b==null)throw w.mustfixThrow("afterTransactionEffect called outside of dexie transaction");if(typeof a!=="function")return;var d=u.get(b)||[];d.push(a);u.set(b,d);d.length===1&&b.on("complete",function(){var a=u.get(b)||[];a.forEach(function(a){a()});u.delete(b)})}function y(a){var e=c("MAWDexie").currentTransaction;if(e==null)throw w.mustfixThrow("afterTransaction called outside of dexie transaction","maw_db");var f=v.get(e);if(f!=null)f.push(a);else{var g=[a];v.set(e,g);e.on("complete",function(){v.delete(e),c("gkx")("5675")&&(i||(i=c("ExecutionEnvironment"))).isInMainThread&&b("cr:10182")!==null&&b("cr:10181")!==null?b("cr:10182").handleEvents(b("cr:10181").LSDatabaseSingleton,g):d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:g})})}}function z(a){if(a.tag==="ThreadUpdated")try{var b=a.value.snippetContactIDs;b!=null&&b.some(function(a){return a==="Facebook User"})&&(w.mustfix('Something is still setting a contact id as "Facebook User"'),a.value=babelHelpers.extends({},a.value,{snippetContactIDs:b.map(function(a){return a==="Facebook User"?"0":a})}))}catch(a){}else if(a.tag==="VerifyThreadExists"&&c("gkx")("13646")&&!(d("EBGating").isEBSMv2Phase1Enabled()||c("gkx")("13647"))){b=a.value;if(b.clientThreadKey!=null){var e=(h||(h=d("I64"))).of_string(b==null?void 0:b.clientThreadKey);c("promiseDone")(d("MAWMiActOnActThreadReadyQueue").processQueueOnActThreadReady(e,b.jid,"MAWIndexedDb:afterTransaction:withClientThreadKey","clientThreadKey"))}if(b.authoritativeThreadKey!=null){e=(h||(h=d("I64"))).of_string(b.authoritativeThreadKey);c("promiseDone")(d("MAWMiActOnActThreadReadyQueue").processQueueOnActThreadReady(e,b.jid,"MAWIndexedDb:afterTransaction:withAuthoritativeThreadKey","authoritativeThreadKey"))}}y(a)}function A(a,b){var e=c("MAWDexie").currentTransaction;if(e==null)throw w.mustfixThrow("afterTransactionForThreadEvent called outside of dexie transaction","maw_db");e.on("complete",function(){d("MAWBridge").getBridge().fireAndForget("threadEvent",b,a)})}g.TABLES_TO_ENCRYPT=d("MAWDbSchema").TABLES_TO_ENCRYPT;g.makeMsgrTransactor=d("MAWTransactor").makeMsgrTransactor;g.makeMAWIndexedDBFactory=a;g.isNewDb=l;g.willSetupDB=m;g.makeDB=n;g.closeDB=o;g.getDBExn=p;g.getSignalDB=q;g.getDB=r;g.setDB_INTERNAL_USE_ONLY=s;g.deleteDb=t;g.getDbStatus=e;g.updateStatusDuringMigration=f;g.afterTransactionEffect=x;g.afterTransaction=z;g.afterTransactionThreadEvent=A}),98);
__d("MAWLLAMigrationUtils",["Random","gkx","justknobx","qpl"],(function(a,b,c,d,e,f,g){"use strict";b=c("justknobx")._("652");var h=Math.max(b,10);e=h*10;var i=new Map([["FTS",e]]);function j(a){if(c("gkx")("9340"))return 1;a=i.get(a);return a!=null?a:h}function a(a,b){b===void 0&&(b={});var e=j(a);return a==="debug"||a==="test"?[]:c("gkx")("23956")&&d("Random").coinflip(e)?[c("qpl")._(1056839327,"560"),babelHelpers["extends"]({"double":{sampleRate:1/e},string:{transactor:a}},b)]:[]}g.getTransactorQPLParam=a}),98);
__d("MAWTransactor",["FBLogger","MAWDexie","MAWDexieTable","MAWErrorObject","MAWIndexedDb","MAWIndexedDbUI","MAWLLAMigrationUtils","MAWQplProxy","MAWTransactionMode","WAExceededStorageQuota","WALogger","gkx","performance"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=["MWPTransactor"],l=c("FBLogger")("messenger_web");function m(a,b,e,f,g,i){f!=null&&c("MAWDexie").currentTransaction!=null&&f.endFail("invoked_in_nested_transaction",{string:{current_transaction_mode:c("MAWDexie").currentTransaction.mode},string_array:{current_transaction_store_names:c("MAWDexie").currentTransaction.storeNames}});c("MAWDexie").currentTransaction!=null&&d("WALogger").WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["makeMsgrTransactor "," should not be called inside another transaction. The transaction will be forced to execute on top-level"])),g);return a.transact(b,e,i)}function n(a){a=d("MAWLLAMigrationUtils").getTransactorQPLParam(a);a=a.length===2?a:[null,void 0];var b=a[0];a=a[1];return b!=null?d("MAWQplProxy").startQplUserFlow(b,a,{sendThroughBridge:!1}):null}function a(a,b,c,e){return q(a,b,function(a){return d("MAWIndexedDb").getDB(a)},c,e)}function b(a,b,c){return q(a,b,d("MAWIndexedDbUI").getDB,c)}function e(a,b,c){return q(a,b,d("MAWIndexedDbUI").getDB,c)}var o=0,p=new Map();function q(a,b,e,f,g){var h=Object.keys(a),q=h.some(function(b){return a[b]===d("MAWTransactionMode").READWRITE})?d("MAWTransactionMode").READWRITE:d("MAWTransactionMode").READONLY;return function(){for(var a=arguments.length,t=new Array(a),u=0;u<a;u++)t[u]=arguments[u];var v=n(b),w=null,x=function(){return self.clearInterval(w)};if(v!=null){v.addAnnotations({string:{mode:q===d("MAWTransactionMode").READWRITE?"readwrite":"readonly"},string_array:{stores:h}});if(c("gkx")("1006")&&b==="bulkCreateThreadByJid"){var y=1e3,z=Date.now();w=self.setInterval(function(){v.addAnnotations({"int":{heartbeatLatestAliveSinceStartMs:Date.now()-z}})},y);self.setTimeout(x,d("MAWQplProxy").DEFAULT_WORKER_QPL_TIMEOUT_MS)}}var A=(j||(j=c("performance"))).now()+j.timeOrigin;return e(b).then(function(a){var e=Array.from(p.values());v==null||v.addPoint("lock_wait_start",{string_array:{maybeLockedOn:e}});var n=(j||(j=c("performance"))).now();g==null||g.onTxnRequestedCb==null||g.onTxnRequestedCb.apply(g,t);return m(a,q,h,v,b,function(){d("MAWDexieTable").setDexiePSDItem("transactionRequested",A);d("MAWDexieTable").setDexiePSDItem("transactorName",b);v==null||v.addPoint("dexie_transaction_start");o+=1;var m=o;p.set(m,b);var q=v!=null?a.stores[h[0]].get("").then(function(){v==null||v.addPoint("lock_wait_end"),v==null||v.addPoint("transaction_opened"),v==null||v.addPoint("transactor_execution_start")}):d("MAWDexieTable").dexieResolve();return q.then(function(){return f(a.stores).apply(void 0,t)}).then(function(a){if(c("gkx")("6795")&&(g==null?void 0:g.explicitlyCloseTxn)===!0){var f;(f=c("MAWDexie").currentTransaction)==null||(f=f.idbtrans)==null||f.commit==null||f.commit()}p["delete"](m);v==null||v.addPoint("transactor_execution_end");v==null||v.endSuccess();x();f=(j||(j=c("performance"))).now()-n;f>5e3&&(d("WALogger").WARN(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[Slow maw transaction] "," took ","ms to complete. Potentially waiting for locks on ",""])),b,f,e.join(", ")),l.mustfix("[Slow maw transaction] %s took long to complete. Potentially waiting for locks on $s",b,e.join(", ")));return a})["catch"](function(a){p["delete"](m);d("WAExceededStorageQuota").checkQuotaExceededError(a);var c=a.name==="AbortError"?a==null?void 0:a.inner:null;c=r(c);v==null||v.markError("transaction_error",null,a);if(a instanceof Error){var e=a,f=typeof (e==null?void 0:e.stack)==="string"?e.stack:typeof (e==null?void 0:e.stack);e=typeof (e==null?void 0:e.message)==="string"?e.message:typeof (e==null?void 0:e.message);v==null||v.addAnnotations({string:{errMessage:e,errStack:f,innerError:c}})}v==null||v.endFail("transaction_fail");x();e=d("MAWErrorObject").getErrorObject(a);throw s(e).mustfixThrow("[%s] Error performing %s transaction. Inner error: %s",k.join("|"),b!=null?b:"",c!=null?c:"unknown")})})})["catch"](function(a){d("WAExceededStorageQuota").checkQuotaExceededError(a);v==null||v.endFail("transaction_fail");x();a=d("MAWErrorObject").getErrorObject(a);throw s(a).mustfixThrow("[%s] Error performing %s transaction",k.join("|"),b!=null?b:"")})}}function r(a){if(typeof a==="string")return a;if(a instanceof Error)return a.name+": "+a.message;if(typeof a==="object")try{return JSON.stringify(a)}catch(a){}return null}function s(a){if(a)return l.catching(a);else return l}g.makeMsgrTransactor=a;g.makeMsgrUITransactor_IMPORT_FROM_MAWIndexedDbUI_INSTEAD=b;g.makeMsgrUIWritableTransactor=e}),98);
__d("MAWThreadUpdateType",[],(function(a,b,c,d,e,f){"use strict";a=0;b=1;c=2;d=3;e=Object.freeze({BUMP_THREAD:c,MARK_THREAD_AS_UNREAD:d,NO_SNIPPET_OR_ACTIVITY_TS_UPDATE:a,SNIPPET_ONLY:b});f.THREAD_UPDATE_TYPE=e}),66);
__d("MAWGetThreadUpdateTypeForAdminMsg",["FBLogger","MAWAdminMsgTypesGrouped","MAWLocalizationType","MAWThreadUpdateType"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=(a=a.msgContent)==null?void 0:a.adminType;if(a==null){c("FBLogger")("messenger_web").mustfix("nullAdminType");return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE}if(h(a))return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD;if(i(a))return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD;if(j(a))return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY;if(k(a))return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE;c("FBLogger")("messenger_web").mustfix("unsupportedAdminMsgType");return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE}function h(a){return d("MAWAdminMsgTypesGrouped").otherUserAddRemoveParticipant.includes(a)||d("MAWAdminMsgTypesGrouped").chatCustomizedByOtherUser.includes(a)||d("MAWAdminMsgTypesGrouped").callActionToNotifyAbout.includes(a)||d("MAWAdminMsgTypesGrouped").twoUsersConnected.includes(a)||d("MAWAdminMsgTypesGrouped").fallbackMsgFromOtherUser.includes(a)||d("MAWAdminMsgTypesGrouped").otherUserBumpsMessage.includes(a)||d("MAWAdminMsgTypesGrouped").otherNonAdminMsgToBeMarkedAsUnread.includes(a)||a===d("MAWLocalizationType").LOCALIZATION_TYPE.REACHABILITY_ERROR}function i(a){return d("MAWAdminMsgTypesGrouped").currentUserAddRemoveParticipant.includes(a)||d("MAWAdminMsgTypesGrouped").chatCustomizedByCurrentUser.includes(a)||d("MAWAdminMsgTypesGrouped").callActionNotToNotifyAbout.includes(a)||d("MAWAdminMsgTypesGrouped").fallbackMsgFromCurrentUser.includes(a)||d("MAWAdminMsgTypesGrouped").currentUserBumpsMessage.includes(a)||d("MAWAdminMsgTypesGrouped").otherNonAdminMsgToBeBumped.includes(a)||d("MAWAdminMsgTypesGrouped").limitSharingUpdate.includes(a)}function j(a){return a===d("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_ROLLBACK_ADMIN_MESSAGE||d("MAWAdminMsgTypesGrouped").ephemeralSettingChanges.includes(a)||d("MAWAdminMsgTypesGrouped").groupPermissionsChanged.includes(a)||d("MAWAdminMsgTypesGrouped").participantLeftGroup.includes(a)||d("MAWAdminMsgTypesGrouped").pinnedMessageUpdate.includes(a)}function k(a){return d("MAWAdminMsgTypesGrouped").cutoverAdminMsgs.includes(a)||d("MAWAdminMsgTypesGrouped").deviceChanges.includes(a)||d("MAWAdminMsgTypesGrouped").icdcAlerts.includes(a)||d("MAWAdminMsgTypesGrouped").otherNonAdminMsgToNotTriggerUpdate.includes(a)||a===d("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_DESCRIPTION||a===d("MAWLocalizationType").LOCALIZATION_TYPE.EMPTY_SNIPPET||a===d("MAWLocalizationType").LOCALIZATION_TYPE.DEBUG_MSG||a===d("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_UK_OSA_ADMIN_MESSAGE}g.getThreadUpdateTypeForAdminMsg=a}),98);
__d("MAWGetThreadUpdateType",["FBLogger","MAWDbMsgOrReaction","MAWGetThreadUpdateTypeForAdminMsg","MAWThreadSnippetUtils","MAWThreadUpdateType","MAWUserJidWrapper","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function h(a){var b=a.reaction==null;return j(a,b)}function i(a){return k(a.reactToAuthor)&&!k(a.author)}function j(a,b){if(i(a)&&!b)if(a.senderTimestampMs==null)return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY;else return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD;else return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE}function k(a){return a===d("WAJids").AUTHOR_ME||a===d("MAWUserJidWrapper").getMyUserJid()}function l(a){var b=a.type,e=function(b){var c=b.me;b=b.other;return d("WAJids").isAuthorMe(a.author)?c:b};switch(b){case"Text":case"ReceiverFetch":case"Sticker":case"Unavailable":case"Video":case"Futureproof":case"DocumentFile":case"EphemeralScreenshotAction":case"Gif":case"Image":case"Ptt":case"RavenAction":case"Raven":case"GroupPollCreate":case"GroupPollUpdate":case"BumpExistingMessage":return e({me:d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD,other:d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD});case"XMA":return d("MAWThreadSnippetUtils").shouldIgnoreXMAMsgForSnippet(a)?d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE:e({me:d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD,other:d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD});case"Revoked":return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY;case"DeleteForMe":return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE;case"EditAction":return e({me:d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY,other:d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE});case"GroupInvite":return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD;case"Admin":if(a.type==="Admin")return d("MAWGetThreadUpdateTypeForAdminMsg").getThreadUpdateTypeForAdminMsg(a);throw c("FBLogger")("messenger_web").mustfixThrow("Non-admin msg passed in "+((e=a.type)!=null?e:"UNKNOWN"));case"SenderKeyDistribution":return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE;case"AlertICDC":return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD;case"Ciphertext":return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD;case"EphemeralSettingAdmin":case"EphemeralSettingChangeFromCurrentDevice":case"EphemeralSyncResponse":return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY;default:b;throw c("FBLogger")("messenger_web").mustfixThrow("[MAWGetThreadUpdateType] Unexpected message type: "+((e=a.type)!=null?e:"UNKNOWN"))}}function m(a){return d("MAWDbMsgOrReaction").switchOnMsgOrReactionMaybeUnstoredNullish(a,{forMessage:function(a){return l(a)},forNull:function(){return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE},forReaction:function(a){return h(a)}})}function a(a){a=m(a);switch(a){case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE:return!1;case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY:case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD:case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD:return!0;default:throw c("FBLogger")("messenger_web").mustfixThrow("[MAWCentralizedThreadUpdate][snippet] Unhandled threadUpdateType: "+a)}}function b(a){a=m(a);switch(a){case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE:case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY:return!1;case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD:case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD:return!0;default:throw c("FBLogger")("messenger_web").mustfixThrow("[MAWCentralizedThreadUpdate][bump] Unhandled threadUpdateType: "+a)}}g.getThreadUpdateTypeForReaction=h;g.canReactionAffectBump=i;g.getReactionThreadUpdateType=j;g.getThreadUpdateTypeForMsg=l;g.getThreadUpdateTypeForMsgOrReaction=m;g.isThreadUpdateTypeEligibleForSnippet=a;g.isThreadUpdateTypeEligibleForBump=b}),98);
__d("MAWCacheServiceMiddleware",["FBLogger","MAWIndexedDb","MAWMpsGating","MAWWorkerCacheServices"],(function(a,b,c,d,e,f,g){"use strict";var h=["messages","reactions"],i=["messages","reactions"];function j(a,b,c){var d,e=c.trans,f=(d=(d=e._transactorMeta)==null?void 0:d.mawCacheServiceAccumulatedRequests)!=null?d:[];if(c.type==="delete"&&i.includes(b.name))return m(a,b.name,c).then(function(a){a=babelHelpers["extends"]({},c,{deletedValues:a});f.push([b.name,a]);e._transactorMeta=babelHelpers["extends"]({},e._transactorMeta,{mawCacheServiceAccumulatedRequests:f});return b.mutate(c)});d=babelHelpers["extends"]({},c,{decryptedValues:c.values?c.values:void 0});f.push([b.name,d]);e._transactorMeta=babelHelpers["extends"]({},e._transactorMeta,{mawCacheServiceAccumulatedRequests:f});return b.mutate(c)}function k(a){var b=a.trans;if(((a=b._transactorMeta)==null?void 0:a.mawCacheServiceAfterTransactionScheduled)===!0)return;d("MAWIndexedDb").afterTransactionEffect(function(){var a;a=(a=(a=b._transactorMeta)==null?void 0:a.mawCacheServiceAccumulatedRequests)!=null?a:[];if(a.length===0)return;d("MAWWorkerCacheServices").getMAWWorkerCacheServices().calculateDelta(a)});b._transactorMeta=babelHelpers["extends"]({},b._transactorMeta,{mawCacheServiceAfterTransactionScheduled:!0})}function l(a,b){var c=a.table(b);if(!h.includes(b))return c;return d("MAWMpsGating").isFullMpsEnabled()?c:babelHelpers["extends"]({},c,{mutate:function(b){k(b);return j(a,c,b)}})}function a(){return{create:function(a){try{return babelHelpers["extends"]({},a,{table:function(b){return l(a,b)}})}catch(b){c("FBLogger")("MAWCacheService").catching(b).mustfix("Error applying MAW Cache Service Middleware");return a}},name:"MAWCacheServiceMiddleware",stack:"dbcore"}}function m(a,b,c){var d=c.keys;c=c.trans;return a.table(b).getMany({keys:d,trans:c}).then(function(a){return a.filter(Boolean)})}g["default"]=a}),98);
__d("isEncryptionAtRestEnabled",["isInstamadillo","qex"],(function(a,b,c,d,e,f,g){"use strict";function a(){if(c("qex")._("507")===!0)return!0;else return c("isInstamadillo")()}g["default"]=a}),98);
__d("MAWDbMiddlewareMutations",["MAWDbObjEncryption","MAWVaultDb","MAWVaultDefinitions","gkx","isEncryptionAtRestEnabled"],(function(a,b,c,d,e,f,g){"use strict";var h=c("gkx")("23909");function a(a,b,e){if(!h&&!(c("isEncryptionAtRestEnabled")()||c("gkx")("23910")))return a;a=babelHelpers["extends"]({},a);a=d("MAWVaultDb").unvaultDbRow(a,b,d("MAWVaultDefinitions").ARMADILLO_IDB_VAULT_DEFINITIONS);a=d("MAWDbObjEncryption").encryptDbObj(a,b,e);return a}function b(a,b){return!h?a:d("MAWVaultDb").unvaultDbRow(babelHelpers["extends"]({},a),b,d("MAWVaultDefinitions").ARMADILLO_IDB_VAULT_DEFINITIONS)}function e(a,b,c){a=d("MAWDbObjEncryption").decryptDbObj(babelHelpers["extends"]({},a),b,c);return!h?a:d("MAWVaultDb").vaultDbRow(a,b,d("MAWVaultDefinitions").ARMADILLO_IDB_VAULT_DEFINITIONS)}function f(a,b){if(a==null)return void 0;return!h?a:d("MAWVaultDb").vaultDbRow(a,b,d("MAWVaultDefinitions").ARMADILLO_IDB_VAULT_DEFINITIONS)}g.mutateValue=a;g.mutateVaultedValue=b;g.getValue=e;g.getVaultedValue=f}),98);
__d("MAWDbMutationValidator",["FBLogger","MAWIndexedDb","MAWMessageHasNonNullServerTsOnReceivedAckValidator","MAWMessageHasUniqueExternalIdValidator","MAWODSProxy","MAWParticipantMatchOneOnOneThreadValidator","MAWReactionHasUniqueProtocolMsgIdValidator","Promise","Random","WAOdsEnums","gkx","justknobx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i=[d("MAWMessageHasUniqueExternalIdValidator").MAWMessageHasUniqueExternalIdValidator,d("MAWParticipantMatchOneOnOneThreadValidator").MAWParticipantMatchOneOnOneThreadValidator,d("MAWReactionHasUniqueProtocolMsgIdValidator").MAWReactionHasUniqueProtocolMsgIdValidator,d("MAWMessageHasNonNullServerTsOnReceivedAckValidator").MAWMessageHasNonNullServerTsOnReceivedAckValidator],j=c("justknobx")._("2610"),k=c("gkx")("5906"),l=function(a){return d("Random").coinflip(a!=null?a:j)||k};function m(a,e){var f=a.table(e),g=i.filter(function(a){return a.table===e});return g.length===0?f:babelHelpers["extends"]({},f,{mutate:function(a){return d("MAWIndexedDb").getDbStatus()!=="ready"?f.mutate(a):f.mutate(a).then(function(e){var f=g.filter(function(b){var c=b.sampleRate;b=b.type;return b.includes(a.type)&&l(c)});d("MAWIndexedDb").afterTransactionEffect(function(){var g=f.flatMap(function(a){var b=a.description,c=a.isValid;return((a=e.results)!=null?a:[]).map(function(a){return c(a).then(function(a){return babelHelpers["extends"]({validatorName:b},a)})})});c("promiseDone")((h||(h=b("Promise"))).all(g).then(function(b){b.forEach(function(b){switch(b.result){case"valid":d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_MUTATION_VALIDATOR,key:b.validatorName+"."+a.type+".valid"});break;case"invalid":d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_MUTATION_VALIDATOR,key:b.validatorName+"."+a.type+".invalid"});c("FBLogger")("maw_mutation_validator").mustfix("Validator %s failed for %s mutation, with description: %s",b.validatorName,a.type,b.description);break;case"skipped":break}})}))});return e})}})}function a(){return{create:function(a){try{return babelHelpers["extends"]({},a,{table:function(b){return m(a,b)}})}catch(b){c("FBLogger")("messenger_web").catching(b).mustfix("Error applying Mutation Validator Middleware");return a}},name:"MAWMutationValidatorMiddleware",stack:"dbcore"}}g.getMutationValidatorMiddleware=a}),98);
__d("MAWDbProtocolMsgIdMiddleware",["FBLogger","MAWDBMigrationUtils","MAWJidUtils","MAWODSProxy","Random","WAOdsEnums","gkx","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h=c("justknobx")._("3300");function i(a){return babelHelpers["extends"]({},a,{get:function(b){return a.get(b).then(function(a){l(a,"get");return a})},getMany:function(b){return a.getMany(b).then(function(a){return a==null?void 0:a.map(function(a){l(a,"getMany");return a})})},mutate:function(b){b.type==="add"?b.values.map(function(a){return j(a)}):b.type==="put"&&c("gkx")("11791")&&c("justknobx")._("3947")&&b.values.map(function(a){a.protocolMsgId==null&&(d("MAWDBMigrationUtils").mawDbMigrationVersion.version>=d("MAWDBMigrationUtils").MAWDB_DEDUPE_MSGS_MIGRATION_VERSION?(d("Random").coinflip(h)&&d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_PROTOCOL_MSG_ID_INDEX,key:"null_protocol_msg_id.put_operation_after_migration_complete.migration_version_"+d("MAWDBMigrationUtils").mawDbMigrationVersion.version}),j(a)):a.rowId<d("MAWDBMigrationUtils").mawDbDedupeMsgsMigrationStatus.cursorValue?(d("Random").coinflip(h)&&d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_PROTOCOL_MSG_ID_INDEX,key:"null_protocol_msg_id.put_operation_below_migration_cursor.migration_version_"+d("MAWDBMigrationUtils").mawDbMigrationVersion.version}),j(a)):d("MAWDBMigrationUtils").mawDbDedupeMsgsMigrationStatus.isRunning&&a.rowId<d("MAWDBMigrationUtils").mawDbDedupeMsgsMigrationStatus.cursorValue+d("MAWDBMigrationUtils").mawDbDedupeMsgsMigrationStatus.batchSize&&(d("Random").coinflip(h)&&d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_PROTOCOL_MSG_ID_INDEX,key:"null_protocol_msg_id.put_operation_in_current_migration_batch.migration_version_"+d("MAWDBMigrationUtils").mawDbMigrationVersion.version}),j(a)))});return a.mutate(b)},query:function(b){return a.query(b).then(function(a){var b;a==null||(b=a.result)==null||b.map(function(a){l(a,"query")});return a})}})}function j(a){a.protocolMsgId=d("MAWJidUtils").toProtocolMsgIdStringForMAWStorage(a)}function k(a){return(a==null?void 0:a.rowId)==null&&(a==null?void 0:a.externalId)==null}function l(a,b){try{var e=c("justknobx")._("3947");if(k(a)){b!=="get"&&d("Random").coinflip(h)&&c("FBLogger")("messenger_web").warn("Corrupted message row returned from DB, msg is null:%s, queryType: %s",a==null,b);return}(a==null?void 0:a.protocolMsgId)==null&&d("Random").coinflip(h)&&(d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_PROTOCOL_MSG_ID_INDEX,key:"null_protocol_msg_id.migration_version_"+d("MAWDBMigrationUtils").mawDbMigrationVersion.version+".append_protocol_msg_id_for_put_operation_jk_"+String(e)}),d("MAWDBMigrationUtils").mawDbMigrationVersion.version>=d("MAWDBMigrationUtils").MAWDB_DEDUPE_MSGS_MIGRATION_VERSION&&c("FBLogger")("maw_db_migration").warn("Message with null protocolMsgId after the msg dedupe migration. type: %s, rowId: %s, externalId: %s",a==null?void 0:a.type,a==null?void 0:a.rowId,a==null?void 0:a.externalId));a!=null&&a.protocolMsgId!=null&&a.protocolMsgId!==d("MAWJidUtils").toProtocolMsgIdStringForMAWStorage(a)&&d("Random").coinflip(h)&&d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_PROTOCOL_MSG_ID_INDEX,key:"inconsistent_protocol_msg_id."+(a==null?void 0:a.type)+".migration_version_"+d("MAWDBMigrationUtils").mawDbMigrationVersion.version+".append_protocol_msg_id_for_put_operation_jk_"+String(e)})}catch(a){c("FBLogger")("messenger_web").catching(a).mustfix("Error while checking protocol msg id")}}function a(){return{create:function(a){try{return babelHelpers["extends"]({},a,{table:function(b){return b!=="messages"?a.table(b):i(a.table(b))}})}catch(b){c("FBLogger")("messenger_web").catching(b).mustfix("Error applying Protocol MsgId Middleware");return a}},name:"MAWDbProtocolMsgIdMiddleware",stack:"dbcore"}}g.appendProtocolMsgId=j;g.isCorruptedMsgRow=k;g.MAWDbProtocolMsgIdMiddleware=a}),98);
__d("MAWLSDataSyncMiddleware",["FBLogger","MAWBridge","MAWLSEditMsgHistoryAddedDataSyncHandler","MAWLSMsgsDataSync","MAWLSReactionsDataSyncHandler","getErrorSafe"],(function(a,b,c,d,e,f,g){"use strict";var h=new Map();function i(){var a=new Set();a.add(d("MAWLSReactionsDataSyncHandler").mawLSReactionsDataSyncHandler);a.add(d("MAWLSEditMsgHistoryAddedDataSyncHandler").mawLSEditHistoryDataSyncHandler);a.add(d("MAWLSMsgsDataSync").mawLSMsgsDataSyncHandler);a.forEach(function(a){h.set(a.tableName,a)})}function j(a){return babelHelpers["extends"]({},a,{mutate:function(b){var c=h.get(a.name);return c!=null?c.performAndSyncMutation(b,a):a.mutate(b)}})}function a(){i();return{create:function(a){try{return babelHelpers["extends"]({},a,{table:function(b){return h.has(b)?j(a.table(b)):a.table(b)}})}catch(d){var b=c("getErrorSafe")(d);c("FBLogger")("maw_db").catching(b).mustfix("Error applying MAW to LS data sync middleware");return a}},name:"MAWLSDataSyncMiddleware",stack:"dbcore"}}function b(a){d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[a]})}g.getMAWLSDataSyncMiddleware=a;g.syncToLS=b}),98);
__d("MAWLSEditMsgHistoryAddedDataSyncHandler",["MAWIndexedDb","MAWLSDataSyncMiddleware"],(function(a,b,c,d,e,f,g){"use strict";function h(a){a=a.map(function(a){return babelHelpers["extends"]({},a)});d("MAWLSDataSyncMiddleware").syncToLS({tag:"EditMsgHistoryAdded",value:a})}a={performAndSyncMutation:function(a,b){switch(a.type){case"put":case"add":var c=[].concat(a.values);d("MAWIndexedDb").afterTransactionEffect(function(){return h(c)});break}return b.mutate(a)},tableName:"editMsgHistory"};g.mawLSEditHistoryDataSyncHandler=a}),98);
__d("MAWLSMsgsDataSync",["MAWBridgeTypesCreators","MAWIndexedDb","MAWLSDataSyncMiddleware"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){var c=b.keys;b=b.trans;return a.getMany({keys:c,trans:b}).then(function(a){return a.filter(Boolean)})}function i(a){a=a.reduce(function(a,b){var c=d("MAWBridgeTypesCreators").createBridgeDeletedMessage(b);a.has(b.threadJid)||a.set(b.threadJid,[]);(b=a.get(b.threadJid))==null||b.push(c);return a},new Map());a.entries().forEach(function(a){var b=a[0];a=a[1];a={messages:a,threadJid:b};d("MAWLSDataSyncMiddleware").syncToLS({tag:"DeleteMessages",value:a})})}a={performAndSyncMutation:function(a,b){switch(a.type){case"delete":return h(b,a).then(function(c){d("MAWIndexedDb").afterTransactionEffect(function(){return i(c)});return b.mutate(a)});default:return b.mutate(a)}},tableName:"messages"};g.mawLSMsgsDataSyncHandler=a}),98);
__d("MAWLSReactionsDataSyncHandler",["MAWBridgeTypesCreators","MAWIndexedDb","MAWLSDataSyncMiddleware"],(function(a,b,c,d,e,f,g){"use strict";function h(a){var b=a.author,c=a.reaction,e=a.reactToMsgId,f=a.threadJid;a=a.ts;if(e==null)return;d("MAWLSDataSyncMiddleware").syncToLS({tag:"UpsertReaction",value:d("MAWBridgeTypesCreators").createBridgeUpsertReaction({author:b,chatJid:f,reaction:c||"",reactToMsgId:e,ts:a})})}function i(a){var b=a.author,c=a.reactToMsgId;a=a.threadJid;if(c==null)return;d("MAWLSDataSyncMiddleware").syncToLS({tag:"DeleteReaction",value:d("MAWBridgeTypesCreators").createBridgeDeleteReaction({author:b,chatJid:a,reactToMsgId:c})})}function j(a){a.forEach(function(a){a.reaction==null?i(a):h(a)})}a={performAndSyncMutation:function(a,b){switch(a.type){case"put":case"add":var c=[].concat(a.values);d("MAWIndexedDb").afterTransactionEffect(function(){return j(c)});break}return b.mutate(a)},tableName:"reactions"};g.mawLSReactionsDataSyncHandler=a}),98);
__d("MAWDbReaction",["FBLogger","I64","MAWAckLevel","MAWGetBumpTimestampMs","MAWUserJidWrapper","WAJids","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){var b=d("MAWUserJidWrapper").getMyUserJid();if(a.reactToAuthor!=="@me"&&a.reactToAuthor!==b||a.reaction==null)return null;b=a.author==="@me"||a.author==="@system"?null:a.author;return b==null?null:babelHelpers["extends"]({},a,{author:b,reaction:a.reaction,reactToAuthor:"@me"})}function a(a){a=i(a);if(a==null)throw c("FBLogger")("messenger_web").mustfixThrow("Cannot cast reaction to incomingDbReaction");return a}function b(a,b,c){var e=d("MAWUserJidWrapper").getMyUserJid();return a.find(function(a){return a.threadJid===b&&d("WAJids").authorToUserId(a.author,e)===d("WAJids").authorToUserId(c,e)})}function e(a){return a}function f(a,b,c,e,f,g,h,i,j,k,l,m,n){m===void 0&&(m=d("MAWAckLevel").ACK.clock);m={ack:m,author:k,externalId:b,groupingKey:g,reaction:f,reactionId:c,reactToAuthor:h,reactToExternalId:e,reactToMsgId:i,senderTimestampMs:n,threadJid:a,ts:j};return l!=null?babelHelpers["extends"]({},m,{rowId:l}):m}function j(a){a=d("MAWGetBumpTimestampMs").getBumpTimestampMs(a);return d("WATimeUtils").castToMillisTime((h||(h=d("I64"))).to_float(a))}g.maybeCastToIncomingDbReaction=i;g.castToIncomingDbReaction=a;g.findMatchingReaction=b;g.reactionIdToMsgId=e;g.formatReactionForDb=f;g.getReactionTimeMs=j}),98);
__d("last",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b=null;if(Array.isArray(a)||typeof a==="string")a.length&&(b={value:a[a.length-1]});else for(a of a)b=b||{},b.value=a;return b?b.value:null}f["default"]=a}),66);
__d("MAWThreadNewestMsgOrReactionUtils",["FBLogger","MAWDbMsg","MAWDbMsgTxns","MAWDbReaction","MAWDbReactionsTxns","MAWDexieTable","MAWGetThreadUpdateType","MAWODSProxy","MAWThreadUpdateType","WALogger","WAMsg","WAOdsEnums","WATimeUtils","first","last"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return l(a,b,i)}function i(a,b){switch(a){case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD:case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD:return b!==!0;case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE:case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY:return!1;default:throw c("FBLogger")("messenger_web").mustfixThrow("[MAWCentralizedThreadUpdate] Unhandled threadUpdateType to create filter function : "+a)}}function b(a,b){return l(a,b,j)}function e(a){var b=a.db,c=a.jid;a=a.limit;return d("MAWDbMsgTxns").fetchMessagesFromDbWithSortOrderMs(b,c,null,!0,a,function(a){return k(d("MAWGetThreadUpdateType").getThreadUpdateTypeForMsg(a),a.ephemeralMsgDisappeared===!0)},"before")}function j(a,b){switch(a){case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY:case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD:case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD:return b!==!0;case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE:return!1;default:throw c("FBLogger")("messenger_web").mustfixThrow("[MAWCentralizedThreadUpdate] Unhandled threadUpdateType to create filter function : %s",a)}}function k(a,b){switch(a){case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD:return b!==!0;case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE:case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY:case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD:return!1;default:throw c("FBLogger")("messenger_web").mustfixThrow("[MAWCacheService] Unhandled threadUpdateType to create filter function : %s",a)}}function l(a,b,c){var e=function(e){return e==null?d("MAWDexieTable").dexieResolve(null):n(a,b,c,e)};return m(a,b,c).then(function(a){return e(a).then(function(c){if(a==null&&c==null){d("WALogger").WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[CentralizedThreadUpdate] No Reaction or Message in "," is eligible for snippet"])),b);return null}if(c==null)return a;if(a==null)return c;var e=d("WATimeUtils").castToMillisTime(d("MAWDbMsg").getSortOrderWithFallback(a)),f=d("MAWDbReaction").getReactionTimeMs(c);return e>=f?a:c})})}function m(a,b,e){return d("MAWDbMsgTxns").fetchMessagesFromDbWithSortOrderMs(a,b,null,!0,1,function(a){return e(d("MAWGetThreadUpdateType").getThreadUpdateTypeForMsg(a),a.ephemeralMsgDisappeared===!0)},"before").then(c("first"))}function n(a,b,e,f){var g=d("MAWDbMsg").getSortOrderWithFallback(f),h=function(c,f){return d("MAWDbReactionsTxns").fetchReactionsFromDbWithTimestamp(a,b,d("WATimeUtils").castToMillisTime(g),f,f==null,c,function(a){return e(d("MAWGetThreadUpdateType").getThreadUpdateTypeForReaction(a),!1)&&d("MAWDbReaction").getReactionTimeMs(a)>g})},i=[1,10],j=100,k=new Set(),l=function(b,e){var f;return h((f=i[b])!=null?f:j,e).then(function(e){var f=e.filter(function(a){return!k.has(q(a))});if(f.length===0){d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_THREAD_GET_NEWEST_REACTION_BATCH_NUM,key:"new."+b});return null}return o(a,f).then(function(a){var f=a.newestReaction;a=a.nullMsgIds;if(f!=null){d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_THREAD_GET_NEWEST_REACTION_BATCH_NUM,key:"new."+b});return f}a.forEach(function(a){return k.add(a)});return l(b+1,c("last")(e))})})};return l(0,null)}function o(a,b){return d("MAWDbMsgTxns").getUniqueMsgsByProtocolMsgIds(a,b.map(p)).then(function(a){var c=new Set(a.map(r)),d=new Set(),e=null;b.forEach(function(a){var b=q(a);c.has(b)?e=s(e,a):d.add(b)});return{newestReaction:e,nullMsgIds:d}})}function p(a){return{author:a.reactToAuthor,chat:a.threadJid,externalId:a.reactToExternalId}}function q(a){return d("WAMsg").craftWAMsgIdString(p(a))}function r(a){return d("WAMsg").craftWAMsgIdString({author:a.author,chat:a.threadJid,externalId:a.externalId})}function s(a,b){if(a==null)return b;return b==null?a:d("MAWDbReaction").getReactionTimeMs(a)>d("MAWDbReaction").getReactionTimeMs(b)?a:b}g.getNewestMsgOrReactionForBump=a;g.filterForBump=i;g.getNewestMsgOrReactionForSnippet=b;g.getNewestIncomingMsgsForSnippet=e;g.filterForSnippet=j;g.filterForSnippetNewestIncomingMessages=k;g.getNewestReactionToNonNullMsg=o}),98);
__d("MAWLocalizationUtils",["MAWAckLevel","MAWLocalizationType","MAWMsgType","WAJids","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h=new Set([(f=d("MAWLocalizationType")).LOCALIZATION_TYPE.CURRENT_USER_CREATED_POLL,f.LOCALIZATION_TYPE.PARTICIPANT_CREATED_POLL,f.LOCALIZATION_TYPE.CURRENT_USER_ADDED_POLL_OPTION,f.LOCALIZATION_TYPE.PARTICIPANT_ADDED_POLL_OPTION,f.LOCALIZATION_TYPE.CURRENT_USER_ADDED_MULTIPLE_POLL_OPTIONS,f.LOCALIZATION_TYPE.PARTICIPANT_ADDED_MULTIPLE_POLL_OPTIONS,f.LOCALIZATION_TYPE.CURRENT_USER_ADDED_POLL_VOTE,f.LOCALIZATION_TYPE.PARTICIPANT_ADDED_POLL_VOTE,f.LOCALIZATION_TYPE.CURRENT_USER_ADDED_MULTIPLE_POLL_VOTES,f.LOCALIZATION_TYPE.PARTICIPANT_ADDED_MULTIPLE_POLL_VOTES,f.LOCALIZATION_TYPE.CURRENT_USER_REMOVED_POLL_VOTE,f.LOCALIZATION_TYPE.PARTICIPANT_REMOVED_POLL_VOTE,f.LOCALIZATION_TYPE.CURRENT_USER_REMOVED_MULTIPLE_POLL_VOTES,f.LOCALIZATION_TYPE.PARTICIPANT_REMOVED_MULTIPLE_POLL_VOTES,f.LOCALIZATION_TYPE.CURRENT_USER_MIXED_POLL_UPDATE,f.LOCALIZATION_TYPE.PARTICIPANT_MIXED_POLL_UPDATE,f.LOCALIZATION_TYPE.CURRENT_USER_CHANGED_POLL_VOTE,f.LOCALIZATION_TYPE.PARTICIPANT_CHANGED_POLL_VOTE,f.LOCALIZATION_TYPE.CURRENT_USER_CHANGED_MULTIPLE_POLL_VOTES,f.LOCALIZATION_TYPE.PARTICIPANT_CHANGED_MULTIPLE_POLL_VOTES,f.LOCALIZATION_TYPE.POLL_UNSENT_UPDATE]);function a(a,b,c,e,f,g){return{ack:d("MAWAckLevel").ACK.sent,altIndex:f!=null?f:void 0,author:d("WAJids").AUTHOR_SYSTEM,externalId:c,msgContent:a,sortOrderMs:g,threadJid:b,ts:e!=null?e:d("WATimeUtils").unixTime(),type:d("MAWMsgType").MSG_TYPE.ADMIN}}function b(a){if(h.has(a))return!0;switch(a){case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_NAMED_GROUP:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_NAMED_GROUP:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_NAMED_GROUP:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_ONE_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_MORE_THAN_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_MORE_THAN_ONE_USERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_MORE_THAN_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_ONE_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_MORE_THAN_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_MORE_THAN_ONE_USERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_MORE_THAN_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_LEFT_GROUP:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SELF_DEMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_PROMOTED_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_DEMOTED_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_GOT_PROMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_GOT_DEMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_GOT_PROMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_GOT_DEMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_PROMOTED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_DEMOTED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_PROMOTED_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SELF_DEMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_DEMOTED_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_UPDATED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_UPDATED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_HOTLIKE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_THEME:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_PHOTO:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_PINNED_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_UNPINNED_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_HOTLIKE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_THEME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_PHOTO:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_PINNED_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_UNPINNED_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_PARTICIPANT_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CLEAR_PARTICIPANT_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_CURRENT_USER_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SET_OWN_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CLEAR_OWN_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CLEAR_PARTICIPANT_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SET_OWN_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CLEAR_OWN_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CLEAR_CURRENT_USER_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_MINUTES:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_MINUTES:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_HOURS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_HOURS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_DAYS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_DAYS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_OFF:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_SECONDS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_SECONDS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_TAKE_SCREENSHOT:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_RECORD_SCREEN:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SET_ADD_MODE_ADMIN_ONLY:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SET_ADD_MODE_ALL_MEMBERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SET_ADD_MODE_ADMIN_ONLY:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SET_ADD_MODE_ALL_MEMBERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.SERVER_SET_ADD_MODE_ADMIN_ONLY:case d("MAWLocalizationType").LOCALIZATION_TYPE.SERVER_SET_ADD_MODE_ALL_MEMBERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_UK_OSA_ADMIN_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_LIMIT_SHARING_DISABLED:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_LIMIT_SHARING_ENABLED:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_LIMIT_SHARING_DISABLED:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_LIMIT_SHARING_ENABLED:return!0}return!1}function c(a){switch(a){case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_UPDATED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_UPDATED_DEVICE:return!0}return!1}function e(a){switch(a){case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_ONE_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_MORE_THAN_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_MORE_THAN_ONE_USERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_MORE_THAN_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU_AND_MORE_THAN_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_MORE_THAN_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_ONE_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_MORE_THAN_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_MORE_THAN_ONE_USERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_MORE_THAN_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_YOU_AND_MORE_THAN_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_MORE_THAN_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_LEFT_GROUP:return!0}return!1}g.POLL_ADMIN_MSG_TYPES=h;g.buildUnstoredDbAdminMsg=a;g.isAdminMsgNormalized=b;g.isDeviceChangeAdminMsg=c;g.isParticipantChangeAdminMsg=e}),98);
__d("MAWThreadSnippetForAdminOrEphemeralMsg",["FBLogger","MAWAdminMsgNormalized","MAWLocalizationType","MAWLocalizationUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var e;e=(e=a.msgContent)==null?void 0:e.adminType;a=(a=a.msgContent)==null?void 0:a.adminMsgContent;if(e==null||a==null){c("FBLogger")("GroupPollsE2EE").mustfix("MAWThreadSnippetForAdminOrEphemeralMsg: snippetType or adminMsgContent is null");return{snippetParams:{contactIDs:[],strings:[]},snippetSenderContactId:b,snippetType:d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET}}a=d("MAWLocalizationUtils").isAdminMsgNormalized(e)?d("MAWAdminMsgNormalized").deconstructContactIdsFromAdminContent(e,a):{contactIds:[],contents:a};var f=a.contactIds;a=a.contents;return{snippetParams:{contactIDs:[].concat(f.map(function(a){return a==="Facebook User"?"0":a})),strings:[].concat(a)},snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippetForBumpExistingMessageMsg",["MAWLocalizationType","WAGlobals","WAJids","WALogger","WAMsgType"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;function l(a,b,c){return{snippetParams:{contactIDs:c!=null?c:[],strings:[]},snippetSenderContactId:a,snippetType:b}}var m=function(a){return l(a,d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET)};function a(a,b){var c;if(d("WAJids").isAuthorSystem(a.author)){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Bumped message can not have AUTHOR_SYSTEM"])));return m(b)}c=(c=a.quote)==null?void 0:c.content.type;if(c===d("WAMsgType").UNAVAILABLE){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Bump message has unavailable content type"])));return m(b)}c=(c=a.quote)==null?void 0:c.content.author;if(c==null){d("WALogger").ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Bump message has no quoted author"])));return m(b)}if(d("WAJids").isAuthorMe(a.author)||a.author===d("WAGlobals").getMyUserJid())return d("WAJids").isAuthorMe(c)||c===d("WAGlobals").getMyUserJid()?l(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_BUMPED_OWN_MESSAGE):l(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_BUMPED_MESSAGE,[d("WAJids").userIdFromJid(c)]);if(b==null){d("WALogger").ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Bump message sender is null"])));return m(b)}if(d("WAJids").isAuthorMe(c)||c===d("WAGlobals").getMyUserJid())return l(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_BUMPED_CURRENT_USER_MESSAGE,[b]);return c===a.author?l(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_BUMPED_OWN_MESSAGE,[b]):l(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_BUMPED_PARTICIPANT_MESSAGE,[b,d("WAJids").userIdFromJid(c)])}g["default"]=a}),98);
__d("MAWThreadSnippetForCiphertextMsg",["MAWLocalizationType"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return{snippetParams:{contactIDs:[],strings:[]},snippetSenderContactId:a,snippetType:d("MAWLocalizationType").LOCALIZATION_TYPE.USER_SEND_ENCRYPTED_MESSAGE_FALLBACK}}g["default"]=a}),98);
__d("MAWThreadSnippetForDocumentFileMsg",["MAWLocalizationType","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){var c,e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET;c={contactIDs:[],mentionJIDs:(c=a.msgContent)==null?void 0:c.mentionedJids,strings:[]};d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_ATTACHMENT:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Document file message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_ATTACHMENT,c.contactIDs.push(b));return{snippetParams:c,snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippetForFallbackMessageMsg",["MAWLocalizationType","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b,c){return{snippetParams:{contactIDs:c!=null?c:[],strings:[]},snippetSenderContactId:a,snippetType:b}}function a(a,b){var c=a.author;a=a.msgContent.subtype;if(d("WAJids").isAuthorMe(c))switch(a){case"liveLocationMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_LIVE_LOCATION_FALLBACK);case"locationMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_LOCATION_FALLBACK);case"contactShareMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_CONTACT_SHARE_FALLBACK);case"storyMentionMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_STORY_MENTION_FALLBACK);case"postMentionMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_POST_MENTION_FALLBACK);case"pollCreationMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_POLL_CREATION_FALLBACK);case"bumpMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_BUMPED_MESSAGE);case"stickerReceiverFetchMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_STICKER_RECEIVER_FETCH_MESSAGE_FALLBACK);case"messengerMemory":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.MESSENGER_MEMORY_ENCRYPTED_MESSAGE_FALLBACK);default:return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET)}else switch(a){case"liveLocationMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_LIVE_LOCATION_FALLBACK);case"locationMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_LOCATION_FALLBACK);case"contactShareMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_CONTACT_SHARE_FALLBACK);case"storyMentionMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_STORY_MENTION_FALLBACK);case"postMentionMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_POST_MENTION_FALLBACK);case"pollCreationMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_POLL_CREATION_FALLBACK);case"bumpMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_BUMPED_PARTICIPANT_MESSAGE);case"metaAiMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.META_AI_SEND_MESSAGE_FALLBACK);case"stickerReceiverFetchMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_STICKER_RECEIVER_FETCH_MESSAGE_FALLBACK);case"messengerMemory":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.MESSENGER_MEMORY_ENCRYPTED_MESSAGE_FALLBACK);default:return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET)}}g["default"]=a}),98);
__d("MAWThreadSnippetForGifMsg",["MAWLocalizationType","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){var c,e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET;c={contactIDs:[],mentionJIDs:(c=a.msgContent)==null?void 0:c.mentionedJids,strings:[]};d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_GIF:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Animated message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_GIF,c.contactIDs.push(b));return{snippetParams:c,snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippetForImageMsg",["MAWLocalizationType","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){var c,e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET;c={contactIDs:[],mentionJIDs:(c=a.msgContent)==null?void 0:c.mentionedJids,strings:[]};d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_IMAGE:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Image message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_IMAGE,c.contactIDs.push(b));return{snippetParams:c,snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippetForPttMsg",["MAWLocalizationType","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){var c,e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET;c={contactIDs:[],mentionJIDs:(c=a.msgContent)==null?void 0:c.mentionedJids,strings:[]};d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_AUDIO:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Ptt message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_AUDIO,c.contactIDs.push(b));return{snippetParams:c,snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippetForRavenMsg",["MAWLocalizationType","MAWMsg","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){var c,e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET;c={contactIDs:[],mentionJIDs:(c=a.msgContent)==null?void 0:c.mentionedJids,strings:[]};d("WAJids").isAuthorMe(a.author)?e=a.ravenMediaType===d("MAWMsg").MAWRavenMsgMediaType.IMAGE?d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_IMAGE:d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_VIDEO:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Animated message can not have AUTHOR_SYSTEM"]))):(e=a.ravenMediaType===d("MAWMsg").MAWRavenMsgMediaType.IMAGE?d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_IMAGE:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_VIDEO,c.contactIDs.push(b));return{snippetParams:c,snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippetForMsgUtils",["MAWLocalizationType","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c){var e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET;b={contactIDs:[],mentionJIDs:b!=null?b:[],strings:[]};d("WAJids").isAuthorMe(a)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_STICKER:d("WAJids").isAuthorSystem(a)||c==null?d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Sticker message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_STICKER,b.contactIDs.push(c));return{snippetParams:b,snippetSenderContactId:c,snippetType:e}}g.getMAWThreadSnippetForStickerMsg=a}),98);
__d("MAWThreadSnippetForReceiverFetchMsg",["MAWThreadSnippetForMsgUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWThreadSnippetForMsgUtils").getMAWThreadSnippetForStickerMsg(a.author,(a=a.msgContent)==null?void 0:a.mentionedJids,b)}g["default"]=a}),98);
__d("MAWThreadSnippetForRevokedMsg",["MAWLocalizationType","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){var c,e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET;c={contactIDs:[],mentionJIDs:(c=a.msgContent)==null?void 0:c.mentionedJids,strings:[]};d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_UNSENT_MESSAGE:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Revoked message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_UNSENT_MESSAGE,c.contactIDs.push(b));return{snippetParams:c,snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippetForStickerMsg",["MAWThreadSnippetForMsgUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWThreadSnippetForMsgUtils").getMAWThreadSnippetForStickerMsg(a.author,(a=a.msgContent)==null?void 0:a.mentionedJids,b)}g["default"]=a}),98);
__d("MAWThreadSnippetForTextMsg",["MAWLocalizationType","MAWVault","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c){var e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET,f={contactIDs:[],mentionJIDs:a.msgContent.mentionedJids,strings:[]};d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_TEXT:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Text message can not have AUTHOR_SYSTEM"]))):(e=c?d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_TEXT_IN_GROUP:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_TEXT,f.contactIDs.push(b));if(a.specialTextSize===1||a.specialTextSize===2||a.specialTextSize===3){c=d("MAWVault").unvault(a.msgContent.content);f.strings.push(c==="\ud83d\udc4d"?"(Y)":a.msgContent.content)}else f.strings.push(a.msgContent.content);return{snippetParams:f,snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippetForVideoMsg",["MAWLocalizationType","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){var c,e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET;c={contactIDs:[],mentionJIDs:(c=a.msgContent)==null?void 0:c.mentionedJids,strings:[]};d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_VIDEO:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Video message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_VIDEO,c.contactIDs.push(b));return{snippetParams:c,snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippetForXMAMsg",["MAWLocalizationType","WAArmadilloXMA.pb","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G;function a(a,b){var c,e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET;c={contactIDs:[],mentionJIDs:(c=a.msgContent)==null?void 0:c.mentionedJids,strings:[]};a.xmaMessageType==null&&d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["XMA message does not have xmaMessageType"])));switch(a.xmaMessageType){case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_GAMING_CUSTOM_UPDATE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_RECEIVER_FETCH:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_ATTACHMENT:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_ATTACHMENT,c.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_EXTERNAL_LINK_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_PROFILE_DIRECTORY_ITEM:if(d("WAJids").isAuthorMe(a.author)){var f;if(a.msgContent!=null&&((f=a.msgContent)==null?void 0:f.content)!=null){f=a.msgContent.content;e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_ATTACHMENT;f!=null&&c.strings.push(f)}else e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_ATTACHMENT}else if(d("WAJids").isAuthorSystem(a.author)||b==null)d("WALogger").ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"])));else{e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_ATTACHMENT;c.contactIDs.push(b);f=(f=a.msgContent)==null?void 0:f.content;f!=null&&c.strings.push(f)}break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_POST_MENTION:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_POST_MENTION:e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_POST_MENTION;break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_MEMORIES_SHARE:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_MEMORIES_SHARE:e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_MEMORIES_SHARE;break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_PRODUCER_STORY_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_SHARE:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_STORY:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_STORY,c.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_MENTION:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(l||(l=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_STORY_MENTION:e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_STORY_MENTION;break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_LOCATION_SHARING:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_LOCATION_SHARING_V2:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_LOCATION:e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_LOCATION;break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_CONTACT:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_AI_CONTACT:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(n||(n=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_CONTACT_SHARE:e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_CONTACT_SHARE;break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_CLIPS_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_SHORT:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_REEL:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(o||(o=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_REEL;break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_POST_PRIVATE_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_MULTIPOST_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_IMAGE_POST_SHARE:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_POST:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_POST;break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_HIGHLIGHTS_TAB_FRIEND_UPDATES_REPLY:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_POST:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(q||(q=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_POST;break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REACTION:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_STORY:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(r||(r=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_STORY,c.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_HIGHLIGHT_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_HIGHLIGHT_SHARE:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_STORY_HIGHLIGHT:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_STORY_HIGHLIGHT;break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_MENTION:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_MENTION:if(d("WAJids").isAuthorMe(a.author)){e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_MENTIONED_STORY_IG;f=a.threadJid;var g;f!=null&&(g=d("WAJids").interpretAsUserJid(f));if(g!=null){f=d("WAJids").userIdFromJid(g);c.contactIDs.push(f)}else d("WALogger").ERROR(t||(t=babelHelpers.taggedTemplateLiteralLoose(["XMA story mentions must have a target Jid"])))}else d("WAJids").isAuthorSystem(a.author)?d("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_RECEIVED_STORY_MENTION_IG;break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_AUDIO_CALL:if(d("WAJids").isAuthorMe(a.author)){e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_AUDIO_CALLED;f=H(a);f!=null?c.contactIDs.push(f):d("WALogger").ERROR(v||(v=babelHelpers.taggedTemplateLiteralLoose(["RTC XMA must have a target Jid"])))}else d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(w||(w=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_AUDIO_CALLED,c.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_VIDEO_CALL:if(d("WAJids").isAuthorMe(a.author)&&b!=null){e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_VIDEO_CALLED;f=H(a);f!=null?c.contactIDs.push(f):d("WALogger").ERROR(x||(x=babelHelpers.taggedTemplateLiteralLoose(["RTC XMA must have a target Jid"])))}else d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(y||(y=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_VIDEO_CALLED,c.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_AUDIO_CALL:if(d("WAJids").isAuthorMe(a.author)){e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_MISSED_AUDIO_CALL;f=H(a);f!=null?c.contactIDs.push(f):d("WALogger").ERROR(z||(z=babelHelpers.taggedTemplateLiteralLoose(["RTC XMA must have a target Jid"])))}else d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(A||(A=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_MISSED_AUDIO_CALL,c.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_VIDEO_CALL:if(d("WAJids").isAuthorMe(a.author)){e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_MISSED_VIDEO_CALL;f=H(a);f!=null?c.contactIDs.push(f):d("WALogger").ERROR(B||(B=babelHelpers.taggedTemplateLiteralLoose(["RTC XMA must have a target Jid"])))}else d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(C||(C=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_MISSED_VIDEO_CALL,c.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_AUDIO_CALL:d("WAJids").isAuthorMe(a.author)&&b!=null?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_STARTED_GROUP_AUDIO_CALL:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(D||(D=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_STARTED_GROUP_AUDIO_CALL,c.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_VIDEO_CALL:d("WAJids").isAuthorMe(a.author)&&b!=null?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_STARTED_GROUP_VIDEO_CALL:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(E||(E=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_STARTED_GROUP_VIDEO_CALL,c.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_EVENT:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_EVENT:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(F||(F=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_EVENT,c.contactIDs.push(b));break;default:d("WALogger").ERROR(G||(G=babelHelpers.taggedTemplateLiteralLoose(["Encountered unexpected XMAMessageType when building a thread snippet: ",""])),a.xmaMessageType)}return{snippetParams:c,snippetSenderContactId:b,snippetType:e}}function H(a){a=a.threadJid!=null?d("WAJids").interpretAsUserJid(a.threadJid):null;return a!=null?d("WAJids").userIdFromJid(a):null}g["default"]=a}),98);
__d("MAWThreadSnippet",["FBLogger","MAWLocalizationType","MAWMsgType","MAWThreadSnippetForAdminOrEphemeralMsg","MAWThreadSnippetForBumpExistingMessageMsg","MAWThreadSnippetForCiphertextMsg","MAWThreadSnippetForDocumentFileMsg","MAWThreadSnippetForFallbackMessageMsg","MAWThreadSnippetForGifMsg","MAWThreadSnippetForImageMsg","MAWThreadSnippetForPttMsg","MAWThreadSnippetForRavenMsg","MAWThreadSnippetForReceiverFetchMsg","MAWThreadSnippetForRevokedMsg","MAWThreadSnippetForStickerMsg","MAWThreadSnippetForTextMsg","MAWThreadSnippetForVideoMsg","MAWThreadSnippetForXMAMsg","MAWUserJidWrapper","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return/^\d+$/.test(a)}function i(a){if(d("WAJids").isAuthorSystem(a))return;a=d("WAJids").isAuthorMe(a)?d("WAJids").userIdFromJid(d("MAWUserJidWrapper").getMyUserJid()):d("WAJids").userIdFromJid(a);if(!h(a)){c("FBLogger")("messenger_web").mustfix("[MAWThreadSnippetBuildTxns] Snippet sender contact id is invalid");return}return a}function a(a){var b=a.chatJid;a=a.dbMsg;b=d("WAJids").switchOnMsgrChatJidType(b,{group:function(a){return!0},user:function(a){return!1}});var e=i(a.author);switch(a.type){case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:return c("MAWThreadSnippetForCiphertextMsg")(e);case d("MAWMsgType").MSG_TYPE.TEXT:return c("MAWThreadSnippetForTextMsg")(a,e,b);case d("MAWMsgType").MSG_TYPE.IMAGE:return c("MAWThreadSnippetForImageMsg")(a,e);case d("MAWMsgType").MSG_TYPE.VIDEO:return c("MAWThreadSnippetForVideoMsg")(a,e);case d("MAWMsgType").MSG_TYPE.PTT:return c("MAWThreadSnippetForPttMsg")(a,e);case d("MAWMsgType").MSG_TYPE.ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case d("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE:case d("MAWMsgType").MSG_TYPE.GROUP_POLL_UPDATE:return c("MAWThreadSnippetForAdminOrEphemeralMsg")(a,e);case d("MAWMsgType").MSG_TYPE.GIF:return c("MAWThreadSnippetForGifMsg")(a,e);case d("MAWMsgType").MSG_TYPE.STICKER:return c("MAWThreadSnippetForStickerMsg")(a,e);case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return c("MAWThreadSnippetForDocumentFileMsg")(a,e);case d("MAWMsgType").MSG_TYPE.REVOKED:return c("MAWThreadSnippetForRevokedMsg")(a,e);case d("MAWMsgType").MSG_TYPE.XMA:return c("MAWThreadSnippetForXMAMsg")(a,e);case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:return c("MAWThreadSnippetForBumpExistingMessageMsg")(a,e);case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:return c("MAWThreadSnippetForFallbackMessageMsg")(a,e);case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:return c("MAWThreadSnippetForReceiverFetchMsg")(a,e);case d("MAWMsgType").MSG_TYPE.RAVEN:return c("MAWThreadSnippetForRavenMsg")(a,e);default:return{snippetParams:{contactIDs:[],strings:[]},snippetSenderContactId:e,snippetType:d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET}}}function b(a,b){a=d("WAJids").switchOnMsgrChatJidType(a,{group:function(a){return!0},user:function(a){return!1}});return j(b,a)}function j(a,b){var e=i(a.author);switch(a.type){case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:return c("MAWThreadSnippetForCiphertextMsg")(e);case d("MAWMsgType").MSG_TYPE.TEXT:return c("MAWThreadSnippetForTextMsg")(a,e,b);case d("MAWMsgType").MSG_TYPE.IMAGE:return c("MAWThreadSnippetForImageMsg")(a,e);case d("MAWMsgType").MSG_TYPE.VIDEO:return c("MAWThreadSnippetForVideoMsg")(a,e);case d("MAWMsgType").MSG_TYPE.PTT:return c("MAWThreadSnippetForPttMsg")(a,e);case d("MAWMsgType").MSG_TYPE.ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case d("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE:case d("MAWMsgType").MSG_TYPE.GROUP_POLL_UPDATE:return c("MAWThreadSnippetForAdminOrEphemeralMsg")(a,e);case d("MAWMsgType").MSG_TYPE.GIF:return c("MAWThreadSnippetForGifMsg")(a,e);case d("MAWMsgType").MSG_TYPE.STICKER:return c("MAWThreadSnippetForStickerMsg")(a,e);case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return c("MAWThreadSnippetForDocumentFileMsg")(a,e);case d("MAWMsgType").MSG_TYPE.REVOKED:return c("MAWThreadSnippetForRevokedMsg")(a,e);case d("MAWMsgType").MSG_TYPE.XMA:return c("MAWThreadSnippetForXMAMsg")(a,e);case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:return c("MAWThreadSnippetForBumpExistingMessageMsg")(a,e);case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:return c("MAWThreadSnippetForFallbackMessageMsg")(a,e);case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:return c("MAWThreadSnippetForReceiverFetchMsg")(a,e);case d("MAWMsgType").MSG_TYPE.RAVEN:return c("MAWThreadSnippetForRavenMsg")(a,e);default:return{snippetParams:{contactIDs:[],strings:[]},snippetSenderContactId:e,snippetType:d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET}}}g.getSnippetContactId=i;g.buildThreadSnippetV2=a;g.buildThreadSnippet=b}),98);
__d("WAProtocolMsgId",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return a.externalId===b.externalId&&a.author===b.author&&a.chat===b.chat}f.equals=a}),66);
__d("MAWThreadSnippetBuildTxns",["FBLogger","MAWDbMsg","MAWDbMsgOrReaction","MAWDbReaction","MAWDexieTable","MAWJidUtils","MAWLocalizationType","MAWThreadSnippet","MAWThreadSnippetUtils","MAWUserJidWrapper","WAJids","WAProtocolMsgId","WATimeUtils","emptyFunction","justknobx"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b,c){return d("WAJids").switchOnMsgrChatJidType(c,{group:function(c){return i(a,b,!0)},user:function(c){return i(a,b,!1)}})}function a(a,b){return d("MAWDbMsgOrReaction").switchOnMsgOrReactionMaybeUnstored(b,{forMessage:function(b){return d("MAWThreadSnippet").buildThreadSnippet(a,b)},forReaction:function(a){a=d("MAWDbReaction").castToIncomingDbReaction(a);return h(a.author,a.reaction,a.threadJid)}})}function i(a,b,e){var f;d("WAJids").isAuthorMe(a)?(c("FBLogger")("messenger_web").warn("[MAWThreadSnippetBuildTxns] Reaction snippet author should not be @me"),f=d("WAJids").userIdFromJid(d("MAWUserJidWrapper").getMyUserJid())):f=d("WAJids").userIdFromJid(a);a={contactIDs:[],strings:[]};e=e?d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REACT_MESSAGE_IN_GROUP:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REACT_MESSAGE;a.contactIDs.push(f);a.strings.push(b);return{snippetParams:a,snippetSenderContactId:f,snippetType:e}}function b(a,b,e,f){var g=e.newestReaction,h=e.reactionsToClear;if(g!=null&&d("WATimeUtils").castUnixTimeToMillisTime(g.ts)>((e=b.snippetMsgTs)!=null?e:0))return d("MAWDexieTable").dexieResolve({newestReaction:g,thread:j(b,g,f)});e=c("justknobx")._("2763")?h!=null&&h.length>0:h!=null;return e&&b.snippetMsg!=null?a.reactions.get({reactionId:b.snippetMsg}).then(function(c){var e=!1;if(c==null)e=!0;else{var f=d("MAWJidUtils").maybeToProtocolMsgId(c.author,c.threadJid,c.reactToExternalId);f!=null&&(e=h.some(function(a){a=d("MAWJidUtils").maybeToProtocolMsgId(a.author,a.threadJid,a.reactToExternalId);return a!=null&&d("WAProtocolMsgId").equals(a,f)}))}return e?k(a,b).then(function(a){return{newestReaction:null,thread:a}}):d("MAWDexieTable").dexieResolve({newestReaction:null,thread:b})}):d("MAWDexieTable").dexieResolve({newestReaction:null,thread:b})}function j(a,b,c){return babelHelpers["extends"]({},a,{snippetMsg:b.reactionId,snippetMsgTs:d("WATimeUtils").castUnixTimeToMillisTime(b.ts)})}function k(a,b){return d("MAWThreadSnippetUtils").recalculateSnippetFromScratch_EXPENSIVE(a,b).then(function(a){if(a==null){c("FBLogger")("messenger_web").mustfix("[Occamadillo] ThreadUpdated handler called for clear snippet when centralized thread bump is enabled");return babelHelpers["extends"]({},b,{snippetMsg:void 0,snippetMsgTs:void 0})}var e=d("WATimeUtils").castUnixTimeToMillisTime(d("MAWDbMsg").getCanonicalTsFromMsg(a));return babelHelpers["extends"]({},b,{snippetMsg:a.msgId,snippetMsgTs:e})})}function e(a,b){return k(a,b).then(function(b){return a.threads.put(b).then(c("emptyFunction"))})}g.buildReactionThreadSnippet=h;g.buildThreadSnippetForMsgOrIncomingReaction=a;g.getReactionSnippetParams=i;g.getThreadChangesetForReactionChanges=b;g.getThreadChangesetForNewReaction=j;g.refreshThreadSnippet=e}),98);
__d("MAWEphemeralMsgUtils",[],(function(a,b,c,d,e,f){"use strict";function a(a){return function(b){return!a.has(b.msgId)&&b.ephemeralMsgDisappeared!==!0}}f.filterNonExpiredMsg=a}),66);
__d("MAWThreadSnippetUtils",["MAWDbReaction","MAWDexieTable","MAWEphemeralMsgUtils","MAWJidUtils","MAWLocalizationType","MAWLocalizationUtils","MAWMsgType","MAWThreadNewestMsgOrReactionUtils","MAWThreadSnippet","MAWThreadSnippetBuildTxns","MAWXMAUtils","MWThreadListConsts","qex"],(function(a,b,c,d,e,f,g){"use strict";function h(a){var b;if(j(a))return!0;b=((b=a.msgContent)==null?void 0:b.adminType)!=null?d("MAWLocalizationUtils").isDeviceChangeAdminMsg(a.msgContent.adminType):!1;if(a.type!==d("MAWMsgType").MSG_TYPE.ADMIN)return!1;a=a.msgContent.adminType;return a===d("MAWLocalizationType").LOCALIZATION_TYPE.DEBUG_MSG?!0:b}function a(a,b,c){return a.messages.where("[threadJid+sortOrderMs]").between([b.jid,Number.MIN_SAFE_INTEGER],[b.jid,Number.MAX_SAFE_INTEGER],!1,!1).filter(function(a){return(c==null||d("MAWEphemeralMsgUtils").filterNonExpiredMsg(c)(a))&&!h(a)}).reverse().first()}var i={snippetParams:{contactIDs:[],mentionJIDs:[],strings:[]},snippetSenderContactId:null,snippetType:d("MAWLocalizationType").LOCALIZATION_TYPE.EMPTY_SNIPPET};function b(a,b){return d("MAWThreadNewestMsgOrReactionUtils").getNewestMsgOrReactionForSnippet(a,b).then(function(c){return c==null?{snippet:i}:l(a,b).then(function(a){var d=k(b,c);return d==null?d:babelHelpers["extends"]({},d,{snippetNewestIncomingMsgsMetadata:a})})})}function j(a){return d("MAWXMAUtils").isXMAStoryReply(a.xmaMessageType)||d("MAWXMAUtils").isXMAMsgHighlightsTabFriendUpdatesReply(a.xmaMessageType)}function k(a,b){if(b.reactionId!=null){var c=d("MAWDbReaction").maybeCastToIncomingDbReaction(b);return c==null?{snippet:i}:{snippet:d("MAWThreadSnippetBuildTxns").buildReactionThreadSnippet(c.author,c.reaction,a),snippetMsgOrReaction:b}}switch(b.type){case d("MAWMsgType").MSG_TYPE.XMA:c=d("MAWJidUtils").toProtocolMsgId(b);return c==null?{snippet:i}:{snippet:d("MAWThreadSnippet").buildThreadSnippetV2({chatJid:b.threadJid,dbMsg:b}),snippetMsgOrReaction:b};default:return{snippet:d("MAWThreadSnippet").buildThreadSnippetV2({chatJid:b.threadJid,dbMsg:b}),snippetMsgOrReaction:b}}}function l(a,b){var e;e=(e=c("qex")._("1213"))!=null?e:!1;return!e?d("MAWDexieTable").dexieResolve(void 0):d("MAWThreadNewestMsgOrReactionUtils").getNewestIncomingMsgsForSnippet({db:a,jid:b,limit:d("MWThreadListConsts").SNIPPET_MAX_NEWEST_INCOMING_MESSAGES_COUNT}).then(function(a){return a.length===0?void 0:a.map(function(a){return{externalId:a.externalId,sortOrderMs:a.sortOrderMs}})})}g.isDbMsgDisabledForThreadSnippet=h;g.recalculateSnippetFromScratch_EXPENSIVE=a;g.EMPTY_SNIPPET_DATA=i;g.getThreadSnippetFromScratch=b;g.shouldIgnoreXMAMsgForSnippet=j}),98);
__d("MAWDbAppMeta",[],(function(a,b,c,d,e,f){"use strict";a={allowSecurityAlert:"allowSecurityAlert",allowSecurityAlertForSelf:"allowSecurityAlertForSelf",dbMigrationVersion:"dbMigrationVersion",deviceJid:"deviceJid",hasMigratedFromDexie:"hasMigratedFromDexie",hmacKey:"hmacKey",hotlikeSticker:"hotlikeSticker",isBackfilledForOccamadillo:"isBackfilledForOccamadillo",msgTypeVersion:"msgTypeVersion",restoreMigrationAttempts:"restoreMigrationAttempts",restoreToDexieMigrationComplete:"restoreToDexieMigrationComplete"};f.AppMetaKeysEnum=a}),66);
__d("MAWDBMigrationUtils",["MAWDbAppMeta","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a={batchSize:0,cursorValue:0,isRunning:!1};var h={version:0};b=d("MAWIndexedDb").makeMsgrTransactor({appMeta:d("MAWTransactionMode").READONLY},"getMigrationVersion",function(a){return function(){return a.appMeta.get(d("MAWDbAppMeta").AppMetaKeysEnum.dbMigrationVersion).then(function(a){a=(a=a==null?void 0:a.value.dbMigrationVersion)!=null?a:0;h.version=a;return a})}});c=6;g.mawDbDedupeMsgsMigrationStatus=a;g.mawDbMigrationVersion=h;g.getMigrationVersion=b;g.MAWDB_DEDUPE_MSGS_MIGRATION_VERSION=c}),98);
__d("MAWLoadReplyMediaTxns",["MAWBridgeReceiverFetchInfo","MAWDbMedia","MAWDbMsg","MAWDbXMATxns","MAWDexieTable","MAWIndexedDb","MAWJidUtils","MAWMediaUtils","MAWMsgType","MAWUserJidWrapper","MAWXMAUtils","MWPBumpEntityKey","WAAssertUnreachable","WAJids","WALogger","WAMsgType","WAResultOrError","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n;function o(a,b,e){if(c("gkx")("2419")&&e!=null){e=d("MAWMediaUtils").genHMACPlaintextHash(e);return a.media.where("hashedPlaintextHash").equals(e).first()}else return a.media.get(b)}var p=new Set([(e=d("MAWDbMedia")).MEDIA_TYPE.IMAGE,e.MEDIA_TYPE.GIF,e.MEDIA_TYPE.PTT,e.MEDIA_TYPE.STICKER,e.MEDIA_TYPE.VIDEO,e.MEDIA_TYPE.DOCUMENT_FILE]);function q(a){var b;switch(a.mediaType){case d("MAWDbMedia").MEDIA_TYPE.IMAGE:case d("MAWDbMedia").MEDIA_TYPE.GIF:case d("MAWDbMedia").MEDIA_TYPE.STICKER:b=a.validatedImageInfo;break;case d("MAWDbMedia").MEDIA_TYPE.VIDEO:b=a.validatedVideoInfo;break}a=b||{};var c=a.height,e=a.jpegThumbnailHeight,f=a.jpegThumbnailWidth;a=a.width;return{replyMediaPreviewHeight:e!=null?e:c,replyMediaPreviewWidth:f!=null?f:a}}function r(a){switch(a.type){case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.PTT:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:return!0;case d("MAWMsgType").MSG_TYPE.XMA:if(c("gkx")("9921"))return!0;else return d("MAWXMAUtils").isXMAShare_DO_NOT_USE(a.xmaMessageType)||d("MAWXMAUtils").isXMAStoryReply(a.xmaMessageType);case d("MAWMsgType").MSG_TYPE.TEXT:case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:case d("MAWMsgType").MSG_TYPE.REVOKED:case d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case d("MAWMsgType").MSG_TYPE.GROUP_INVITE:case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:case d("WAMsgType").NOTE_REPLY:case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:case d("MAWMsgType").MSG_TYPE.RAVEN:return!1;default:return c("WAAssertUnreachable")(a.type)}}function s(a,b,c){if(b==null)return d("MAWDexieTable").dexieResolve();a=o(a,b,c).then(function(a){if(a==null)return d("WAResultOrError").makeError("reply_media_not_found");if(!p.has(a.mediaType))return d("WAResultOrError").makeError("reply_media_type_unknown");var c=q(a),e=c.replyMediaPreviewHeight;c=c.replyMediaPreviewWidth;b!=null&&a.plaintextHash==null&&d("MWPBumpEntityKey").bumpEntityKeyWithAppId("maw.reply_attachment_media_missing_plaintext_hash","load_reply_media_txns_for_reply_type_'unknown'}");return d("WAResultOrError").makeResult({replyMediaId:b,replyMediaPreviewHeight:e,replyMediaPreviewWidth:c,replyPlaintextHash:a.plaintextHash})});return a.then(function(a){if(a.success!==!0){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Unable to fetch reply media with id ",": ",""])),b,a.error);return}return a.value})}function t(a,b){var c=b.defaultPreviewMediaId;if(c==null)return d("MAWDexieTable").dexieResolve({replyXMAId:b.xmaId});a=o(a,c).then(function(a){if(a==null)return d("WAResultOrError").makeError("reply_xma_media_not_found - "+b.targetType);if(!p.has(a.mediaType))return d("WAResultOrError").makeError("reply_xma_media_type_unknown");var c=q(a),e=c.replyMediaPreviewHeight;c=c.replyMediaPreviewWidth;return d("WAResultOrError").makeResult({replyMediaPreviewHeight:e,replyMediaPreviewWidth:c,replyPlaintextHash:a.plaintextHash,replyXMAId:b.xmaId})});return a.then(function(a){if(a.success!==!0){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Unable to fetch reply media XMA with id ",": ",""])),b.xmaId,a.error);return}return a.value})}function a(a,b,e){var f,g;e===void 0&&(e=!1);f=((f=b.quote)==null?void 0:f.content)||{};var h=f.author,i=f.externalId,j=f.mediaId,k=f.msgId,l=f.plaintextHash,m=f.type;f=f.xmaMessageType;if(((g=b.quote)==null?void 0:g.content)==null||!r((g=b.quote)==null?void 0:g.content))return d("MAWDexieTable").dexieResolve();g=b.threadJid;b=h===d("MAWUserJidWrapper").getMyUserJid();b=b?d("WAJids").AUTHOR_ME:h;if(c("gkx")("9921")?m===d("MAWMsgType").MSG_TYPE.XMA:d("MAWXMAUtils").isXMAShare_DO_NOT_USE(f))return u(a,d("MAWJidUtils").maybeToProtocolMsgId(b,g,i));return m===d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH?w(a,k):s(a,j,e?null:l)}function u(a,b){return b==null?d("MAWDexieTable").dexieResolve():d("MAWDbXMATxns").maybeGetXMAFromProtocolMsgId(a,b).then(function(b){if(b==null||d("MAWXMAUtils").isXMAExpired(b.isTombstoned,b.targetExpiringAtSec))return;return t(a,b)})}function b(a,b){var e=b.author,f=b.externalId,g=b.mediaId,h=b.plaintextHash,i=b.threadJid,j=b.type,k=b.xmaMessageType;k=c("gkx")("9921")?j===d("MAWMsgType").MSG_TYPE.XMA:d("MAWXMAUtils").isXMAShare_DO_NOT_USE(k);j=j===d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH;if(!d("MAWDbMsg").isMediaMsg(b)&&!k&&!j)return d("MAWDexieTable").dexieResolve();if(k)return u(a,d("MAWJidUtils").maybeToProtocolMsgId(e,i,f));return j?v(a,b.receiverFetchId):s(a,g,h)}function v(a,b,c){if(b==null){d("WALogger").ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Missing receiverFetchId for getReplyMediaForReceiverFetchWithReceiverFetchId"])));return d("MAWDexieTable").dexieResolve()}return a.receiverFetchInfo.get({receiverFetchId:b}).then(function(a){if(a==null){d("WALogger").WARN(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Missing receiverFetchInfo for getReplyMediaForReceiverFetchWithReceiverFetchId"])));return}try{var b=d("MAWDbMedia").convertNumberToMediaId(parseInt(a.receiverFetchId,10));c!=null&&d("MAWIndexedDb").afterTransaction({tag:"NewReceiverFetchInfo",value:d("MAWBridgeReceiverFetchInfo").createBridgeReceiverFetchInfoPayloadFromDbInfo(c.threadJid,c.msgId,c.sortOrderMs,c.ts,a)});return{replyMediaId:b,replyMediaPreviewHeight:a.previewHeight,replyMediaPreviewWidth:a.previewWidth}}catch(a){d("WALogger").ERROR(l||(l=babelHelpers.taggedTemplateLiteralLoose(["Unable to convert receiver fetch id to media id: ",""])),a);return}})}function w(a,b){if(b==null){d("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Missing msgId for getReplyMediaForReceiverFetch"])));return d("MAWDexieTable").dexieResolve()}return a.messages.get({msgId:b}).then(function(b){if(b==null||b.type!==d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH||b.receiverFetchId==null){d("WALogger").ERROR(n||(n=babelHelpers.taggedTemplateLiteralLoose(["Invalid msg for getReplyMediaForReceiverFetch with type: ",""])),b==null?void 0:b.type);return}return v(a,b.receiverFetchId,b)})}g.getMedia=o;g.MSG_MEDIA_TYPE=p;g.getImageAttributes=q;g.isMediaReplyContent=r;g.getReplyMediaForMsgQuote=a;g.getReplyMediaForMsg=b}),98);
__d("MAWDbChunkTxns",["MAWDexieTable","MAWMediaUtils","MAWODSProxy","MWFBLogger","WAErrorMessage","WAOdsEnums"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=d("MWFBLogger").MWLogger.tags(["maw_db","txn","MAWDbChunkTxns"]);b=function(a,b,c,e,f){f===void 0&&(f=0);var g=d("MAWMediaUtils").genHMACPlaintextHash(b);return m(a,b,g,c,e,f)};var m=function(a,b,c,e,f,g){g===void 0&&(g=0);return a.chunk.where("hashedPlaintextHash").equals(c).first().then(function(n){if(n){g>0&&l.DEBUG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Chunk found after retry for hashedPlaintextHash: ",""])),c);return n}else{var o={blobData:e,hashedPlaintextHash:c,mimetype:f,plaintextHash:b};return a.chunk.add(o).then(function(a){return babelHelpers["extends"]({},o,{chunkId:a})})["catch"](function(h){var n=d("WAErrorMessage").maybeGetMessageFromError(h);if(g>0){l.WARN(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Failed to add chunk for hashedPlaintextHash: ",". Error: ",""])),c,n);l.MUSTFIX(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Failed to add chunk after retry. Error: ",""])),n);throw h}else{l.WARN(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Failed to add chunk. Possible duplicate? Will attempt a retry. For hashedPlaintextHash: ",". Error: ",""])),c,n);d("MAWODSProxy").odsBumpEntityKey({amount:1,entity:d("WAOdsEnums").Entity.MAW_MEDIA_DB_DUPLICATE_CHUNK,key:"retry"});return m(a,b,c,e,f,g+1)}})}})},n=function(a,b){return a.chunk.where("hashedPlaintextHash").equals(b)},o=function(a,b){return n(a,b).count().then(function(a){return a>0})};c=function(a,b){return d("MAWDexieTable").dexieAll(b.map(function(b){return o(a,b).then(function(a){return[b,a]})})).then(function(a){return new Map(a)})};e=function(a,b){return n(a,b).first()};f=function(a,b){return a.chunk.where("hashedPlaintextHash").anyOf(b).toArray().then(function(a){return new Map(a.map(function(a){return[a.hashedPlaintextHash,a]}))})};function a(a,b){return a.chunk.bulkGet(b)}var p=function(a,b){b=d("MAWMediaUtils").genHMACPlaintextHash(b);return a.chunk.get({hashedPlaintextHash:b})};g.getOrCreateMediaChunkWithPlaintextHash=b;g.getOrCreateMediaChunkWithHashedPlaintextHash=m;g.hasMediaChunk=o;g.hasMediaChunks=c;g.maybeGetChunkFromHash=e;g.maybeBulkGetChunksFromHash=f;g.bulkGetChunks=a;g.maybeGetChunkByPlaintextHash=p}),98);
__d("MAWDbMediaTxns",["MAWDbMsg","MAWDexieTable","MAWMediaUtils","MAWMsgType","MAWODSProxy","WAHashUtils","WALogger","WAOdsEnums","WAResultOrError","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;function a(a,b){return b==null?d("MAWDexieTable").dexieResolve():a.media.get({mediaId:b})}function b(a,b){return b.length===0?d("MAWDexieTable").dexieResolve(new Map()):a.media.bulkGet(b).then(function(a){return new Map(a.filter(Boolean).map(function(a){return[a.mediaId,a]}))})}function l(a,b){return a.media.where("hashedPlaintextHash").equals(b).first()}function e(a,b){b=d("MAWMediaUtils").genHMACPlaintextHash(b);return l(a,b)}function f(a,b){b=b.map(function(a){return d("MAWMediaUtils").genHMACPlaintextHash(a)});return m(a,b)}function m(a,b){return a.media.where("hashedPlaintextHash").anyOf(b).toArray()}function n(a,b){return b==null?d("MAWDexieTable").dexieResolve():o(a,b).then(function(c){c=c==null?void 0:c.mediaId;return c!=null?a.media.get({mediaId:c}):a.media.get({objectId:b})})}function o(a,b){return b==null?d("MAWDexieTable").dexieResolve():a.mediaBackup.get({objectId:b})}function p(a,b){if(b==null)return d("MAWDexieTable").dexieResolve();a=a.mediaBackup.where("msgId").equals(b).toArray();return a}function q(a,b){b=b.filter(d("MAWDbMsg").isMediaMsg);if(b.length===0)return d("MAWDexieTable").dexieResolve([]);d("WALogger").LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[getMsgMediaPairFromMsgs] msgs: ",""])),b.map(function(a){return""+a.msgId}));var e=b.reduce(function(a,b){if(b.mediaId==null){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["mediaId is null for media msg with msgId: "," and msg type ",""])),b.msgId,b.type);return a}return a.set(b.mediaId,b)},new Map());b=Array.from(e.keys());return t(a,b).then(function(a){var b=[];a.forEach(function(a){if(a==null)throw c("err")("Error missing media");var f=e.get(a.mediaId);if(f==null)throw c("err")("Error missing media");var g=d("MAWMediaUtils").genHMACPlaintextHash(a.plaintextHash);g!==a.hashedPlaintextHash&&(d("WALogger").WARN(j||(j=babelHelpers.taggedTemplateLiteralLoose(["[getMsgMediaPairFromMsgs] encountered mismatched hashedPlaintextHash for media. PlaintextHash: ",""])),d("WAHashUtils").sanitisePlaintextHash(a.plaintextHash)),d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_MEDIA_MISMATCH_HASHED_PLAINTEXT_HASH,key:"mismatch."+f.type}));b.push([f,a])});return b})}function r(a,b){if(b.length===0)return d("MAWDexieTable").dexieResolve([]);b=b.filter(d("MAWDbMsg").isMediaMsg).map(function(a){var b=a.mediaId;if(b==null){d("WALogger").ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["mediaId is null for media msg with msgId: ",""])),a.msgId);throw c("err")("mediaId is missing")}else return b});return t(a,b).then(function(a){var b=[];a.forEach(function(a){a!=null&&b.push(a)});return b})}function s(a,b){if(b.type===d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME||d("MAWDbMsg").isMediaMsg(b)){var c=b.mediaId;return c==null?b.type===d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME?d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeResult()):d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError("missing")):a.media.get(c).then(function(a){return a==null?d("WAResultOrError").makeError("missing"):d("WAResultOrError").makeResult(a)})}else return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeResult())}function t(a,b){return a.media.bulkGet(b)}function u(a,b){var c=b.previewMediaIds!=null?t(a,b.previewMediaIds):d("MAWDexieTable").dexieResolve(),e=b.headerMediaId!=null?a.media.get(b.headerMediaId):d("MAWDexieTable").dexieResolve(),f=b.faviconMediaId!=null?a.media.get(b.faviconMediaId):d("MAWDexieTable").dexieResolve();a=b.defaultPreviewMediaId!=null?a.media.get(b.defaultPreviewMediaId):d("MAWDexieTable").dexieResolve();return d("MAWDexieTable").dexieAll([c,e,f,a]).then(function(a){var c=a[0],e=a[1],f=a[2];a=a[3];if(b.headerMediaId!=null&&e==null)return d("WAResultOrError").makeError("missing");if(b.faviconMediaId!=null&&f==null)return d("WAResultOrError").makeError("missing");if(c==null)return d("WAResultOrError").makeError("missing");var g=[];for(c of c)if(c==null)return d("WAResultOrError").makeError("missing");else g.push(c);return d("WAResultOrError").makeResult({defaultPreview:a,favicon:f,header:e,previews:g})})}function v(a,b,c){b=babelHelpers["extends"]({},b,c);return a.media.put(b)}g.maybeGetMediaFromMediaId=a;g.maybeBulkGetMediaFromMediaId=b;g.maybeGetMediaFromHashedPlaintextHash=l;g.maybeGetMediaFromPlaintextHash=e;g.maybeBulkGetMediaFromPlaintextHash=f;g.maybeBulkGetMediaFromHashedPlaintextHash=m;g.maybeGetMediaFromObjectId=n;g.maybeGetMediaBackupRowFromObjectId=o;g.maybeGetMediaBackupRowFromMsgId=p;g.getMsgMediaPairFromMsgs=q;g.getMediaFromMsgs=r;g.getAndCheckMediaFromMsg=s;g.bulkGetMedias=t;g.getMediaForXMA=u;g.updateMedia=v}),98);
__d("WAMsgMap",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a){var b=this;this.$1=new Map();a==null||a.forEach(function(a){var c=a[0];a=a[1];b.set(c,a)})}var b=a.prototype;b.clear=function(){this.$1.clear()};b["delete"]=function(a){var b;(b=this.$1.get(a.externalId))==null||(b=b.get(a.author))==null||b["delete"](a.chat)};b.get=function(a){var b;return(b=this.$1.get(a.externalId))==null||(b=b.get(a.author))==null?void 0:b.get(a.chat)};b.has=function(a){var b;return(b=(b=this.$1.get(a.externalId))==null||(b=b.get(a.author))==null?void 0:b.has(a.chat))!=null?b:!1};b.set=function(a,b){var c,d;c=(c=this.$1.get(a.externalId))!=null?c:new Map();this.$1.has(a.externalId)||this.$1.set(a.externalId,c);d=(d=c.get(a.author))!=null?d:new Map();c.has(a.author)||c.set(a.author,d);d.set(a.chat,b);return this};b.keys=function(){var a=[],b=this.$1;for(var c of b.keys()){var d;d=(d=b.get(c))!=null?d:new Map();for(var e of d.keys()){var f;f=(f=d.get(e))!=null?f:new Map();for(f of f.keys())a.push({externalId:c,author:e,chat:f})}}return a};b.entries=function(){var a=[],b=this.$1;for(var c of b.keys()){var d;d=(d=b.get(c))!=null?d:new Map();for(var e of d.keys()){var f;f=(f=d.get(e))!=null?f:new Map();for(var g of f.keys()){var h=f.get(g);h!=null&&a.push([{externalId:c,author:e,chat:g},h])}}}return a};b.values=function(){return this.entries().map(function(a){return a[1]})};return a}();f.MsgMap=a}),66);
__d("MAWDbMsgUtil",["WAJids","WALogger","WAMsgMap"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a){return a.reduce(function(a,b){var c=b.threadJid;if(c==null){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Missing jid prevents adding message to array map"])));return a}if(b.author==="@system"){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Invalid author when converting msg array to map"])));return a}a.set({author:b.author,chat:c,externalId:b.externalId},b);return a},new(d("WAMsgMap").MsgMap)())}function b(a){return d("WAJids").isAuthorSystem(a.author)||a.threadJid==null?null:{author:a.author,chat:a.threadJid,externalId:a.externalId}}g.convertMsgArrayToMap=a;g.getProtocolMsgIdFromDbMsg=b}),98);
__d("MAWDbUnrenderedMsgTxns",["MAWAckLevel","MAWDbMsg","MAWDbMsgUtil","MAWDexieTable","WAJids","WALogger","WAMsgMap","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(a,b){var c=b.author,e=b.chat,f=b.externalId;return a.threads.get({jid:e}).then(function(b){return b==null?d("WAResultOrError").makeError("missing_thread_unrendered_msg"):k(a,f,e,c).then(function(a){return a==null?d("WAResultOrError").makeError("missing_unrendered_msg"):d("WAResultOrError").makeResult(a)})})}function b(a,b){var c=b.map(function(a){a=a.externalId;return a});return a.unrenderedMessages.where("externalId").anyOf(c).toArray().then(function(a){var c=d("MAWDbMsgUtil").convertMsgArrayToMap(a),e=new(d("WAMsgMap").MsgMap)();b.forEach(function(a){var b=c.get(a);b!=null&&e.set(a,b)});return e})}function k(a,b,c,d){return a.unrenderedMessages.where("externalId").equals(b).filter(function(a){return a.author===d&&a.threadJid===c}).first()}function l(a,b){return a+"_"+b}function c(a,b){var c=b.map(function(a){a=a.externalId;return a}),e=Array.from(new Set(b.map(function(a){return a.chat})));return d("MAWDexieTable").dexieAll([a.threads.where("jid").anyOf(e).toArray(),a.unrenderedMessages.where("externalId").anyOf(c).toArray()]).then(function(a){var c=a[0];a=a[1];if(a.length===0||c.length===0)return[];var d=new Map();b.forEach(function(a){var b=a.author,c=a.chat;a=a.externalId;var e=d.get(a)||new Set();e.add(l(b,c));d.set(a,e)});return a.filter(function(a){var b=a.author,c=a.externalId;a=a.threadJid;c=d.get(c);return c!=null&&a!=null&&c.has(l(b,a))})})}function e(a,b,c){return m(a,[{ack:c,msgId:b}]).then(function(a){a=a[0];if(a==null){d("WALogger").LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["updateSystemAckForUnrenderedMsg on non existing message"])));return null}return a})}function m(a,b){var c=b.map(function(a){return a.msgId}),e=new Map();b.forEach(function(a){return e.set(a.msgId,{ack:a.ack})});return a.unrenderedMessages.where("msgId").anyOf(c).toArray().then(function(b){if(b.length===0)return b;var c=[],f=[];b.forEach(function(a){var b;if(a.author!==d("WAJids").AUTHOR_ME){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["bulkUpdateSystemAck on incoming message"])));c.push(a);return}if(a.ack>d("MAWAckLevel").ACK.clock){d("WALogger").LOG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["bulkUpdateSystemAck on sent message"])));c.push(a);return}b=(b=e.get(a.msgId))==null?void 0:b.ack;if(b==null)return null;a=babelHelpers["extends"]({},a,{ack:b});b===d("MAWAckLevel").ACK.sent&&delete a.resendCount;f.push(a)});return a.unrenderedMessages.bulkPut(f).then(function(){return[].concat(f,c)})})}function f(a,b){b=b.map(function(b){return a.unrenderedMessages.get({msgId:b})});return d("MAWDexieTable").dexieAll(b)}function n(a,b){return a.unrenderedMessages.where("msgId").between(d("MAWDbMsg").msgIdsInChatLowerBound(b.chatId),d("MAWDbMsg").msgIdsInChatUpperBound(b.chatId)).last().then(function(a){a=a==null?0:d("MAWDbMsg").getInChatMsgIdFromMsgId(a.msgId);return a+1})}g.maybeGetUnrenderedMsgByProtocolMsgId=a;g.getUnrenderedMsgMapByProtocolMsgId=b;g.maybeGetUnrenderedMsgByExternalId=k;g.getUnrenderedMsgsByProtocolMsgId=c;g.updateSystemAckForUnrenderedMsg=e;g.bulkUpdateSystemAckForUnrenderedMsgs=m;g.getUnrenderedMsgsByMsgIds=f;g.getNextUnrenderedMsgIdNumberForThread=n}),98);
__d("MAWMessageSortOrderUtils",["I64","MAWDbMsg","MAWExtractMsFromExternalId","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l;function a(a){var b=a.revokedExternalId!=null?a.revokedExternalId:a.externalId;b==null&&d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["generateAuthoritativeMessageSortOrder called without ID"])));b=(l||(l=d("I64"))).of_string_opt(b);if(a.serverTs==null){var c;if(a.sortOrderMs!=null)return a.sortOrderMs;b==null&&d("WALogger").WARN(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[sortOrder] ExternalId is not present"])));var e=b==null?null:d("MAWExtractMsFromExternalId").extractMsFromExternalId(b);return Math.floor((c=a.originalTs)!=null?c:d("MAWDbMsg").getCanonicalTsFromMsg(a))*1e3+(e!=null?e:0)}if(b!=null){c=d("MAWExtractMsFromExternalId").extractMsFromExternalId(b);if(c!=null){e=a.originalTs!=null?a.originalTs:a.serverTs;return Number(e)*1e3+c}else d("WALogger").WARN(j||(j=babelHelpers.taggedTemplateLiteralLoose(["[sortOrder] Timestamp bits in externalId not valid"])))}else d("WALogger").WARN(k||(k=babelHelpers.taggedTemplateLiteralLoose(["[sortOrder] externalId is not a valid int64"])));return d("MAWDbMsg").getSortOrderWithFallback(a)}g.generateAuthoritativeMessageSortOrder=a}),98);
__d("WAArrayGroupBy",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){var c=new Map();for(var d=0;d<a.length;d++){var e=b(a[d]),f=c.get(e);f==null?c.set(e,[a[d]]):f.push(a[d])}return Array.from(c.entries())}f.groupBy=a}),66);
__d("MAWDbMsgTxns",["EncryptedBackupsUtils","FBLogger","MAWAckLevel","MAWBridgeMsg","MAWDbMsg","MAWDbMsgUtil","MAWDbThreadTxns","MAWDbUnrenderedMsgTxns","MAWDbXMATxns","MAWDexieTable","MAWIndexedDb","MAWJidUtils","MAWLoadReplyMediaTxns","MAWMessageSortOrderUtils","MAWMsgType","MAWODSProxy","MAWTransactionMode","MAWTransactor","Random","WAArrayGroupBy","WAJids","WALogger","WAMsg","WAMsgMap","WAOdsEnums","WAResultOrError","WATimeUtils","emptyFunction","gkx","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q;function a(a,b){return b==null?d("MAWDexieTable").dexieResolve():a.messages.get({msgId:b})}function b(a,b){return a.messages.where("threadJid").equals(b).count().then(function(a){return a===0})}function e(a,b,c){return a.messages.where("threadJid").equals(b).filter(c).first().then(function(a){return a!=null})}function r(a,b,c,d){return a.messages.where(["threadJid","sortOrderMs"]).between([b,Number.MIN_SAFE_INTEGER],[b,Number.MAX_SAFE_INTEGER],c,d)}function s(a,b){return r(a,b,!1,!1).last()}function f(a,b){return s(a,b).then(function(a){return a==null?void 0:a.msgId})}function t(a,b){return s(a,b).then(function(a){return(a==null?void 0:a.sortOrderMs)==null?null:d("WATimeUtils").castToMillisTime(a.sortOrderMs)})}function u(a,b,c){return r(a,b,!1,!1).reverse().limit(c).toArray()}function v(a,b){return r(a,b,!1,!1).first()}function w(a,b){return v(a,b).then(function(a){return a==null?void 0:a.msgId})}function x(a,b){return a.messages.where("externalId").equals(b.externalId).filter(function(a){return a.author===b.author&&a.threadJid===b.chat}).toArray().then(z)}function y(a,b){var c=new Set(b.map(function(a){var b=a.author,c=a.chat;a=a.externalId;return d("WAMsg").craftWAMsgIdString({author:b,chat:c,externalId:a})}));return a.messages.where("externalId").anyOf(b.map(function(a){a=a.externalId;return a})).filter(function(a){var b=a.author,e=a.externalId;a=a.threadJid;return c.has(d("WAMsg").craftWAMsgIdString({author:b,chat:a,externalId:e}))}).toArray().then(function(a){return d("WAArrayGroupBy").groupBy(a,function(a){return d("WAMsg").craftWAMsgIdString({author:a.author,chat:a.threadJid,externalId:a.externalId})}).map(function(a){a[0];a=a[1];return z(a)}).filter(Boolean)})}function z(a){if(a.length>1){var b=a.map(function(a){var b;return a.type+":"+((b=a.serverTs)!=null?b:0).toString()+":"+((b=a.ts)!=null?b:0).toString()});b=new Set(b).size===1;!b?d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[maybeGetMsgByProtocolMsgId] Can't have "," messages with the same protocolMsgId!"])),a.length):d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[maybeGetMsgByProtocolMsgId] Suspected multiple instances of same message!"])));(c("gkx")("5039")||d("Random").coinflip(c("justknobx")._("3594")))&&A(a)}return a[0]}function A(a){var b=a.length;if(b<=1)return;var e=b-1,f=a[e],g={editCount:0,mediaId:0,revokedStatus:0,serverTs:0,sortOrderMs:0,ts:0,type:0};a.slice(0,e).forEach(function(a){var b=[];if((a==null?void 0:a.editCount)!==(f==null?void 0:f.editCount)){var e;g.editCount++;b.push("editCount, reference: "+((e=f==null?void 0:f.editCount)!=null?e:"")+", duplicate: "+((e=a==null?void 0:a.editCount)!=null?e:"")+". ")}(a==null?void 0:a.mediaId)!==(f==null?void 0:f.mediaId)&&(g.mediaId++,b.push("mediaId, reference: "+((f==null?void 0:f.mediaId)!=null?String(f.mediaId):"")+", duplicate: "+((a==null?void 0:a.mediaId)!=null?String(a.mediaId):"")+". "));a.sortOrderMs!==f.sortOrderMs&&(g.sortOrderMs++,b.push("sortOrderMs, reference: "+String(f.sortOrderMs)+", duplicate: "+String(a.sortOrderMs)+". "));a.serverTs!==f.serverTs&&(g.serverTs++,b.push("serverTs, reference: "+String(f.serverTs)+", duplicate: "+String(a.serverTs)+". "));a.ts!==f.ts&&(g.ts++,b.push("ts, reference: "+String(f.ts)+", duplicate: "+String(a.ts)+". "));if(a.type!==f.type){(a.type===d("MAWMsgType").MSG_TYPE.REVOKED||f.type===d("MAWMsgType").MSG_TYPE.REVOKED)&&(g.revokedStatus++,c("FBLogger")("MAWDuplicateMessageComparison").info("Revoked duplicate msg conflict, duplicate message, %s, has type: %s, externalId: %s, revokedExternalId: %s, sortOrderMs: %s, serverTs: %s, ts: %s, rowId: %s, reference msg, %s, has type: %s, externalId: %s, revokedExternalId: %s, sortOrderMs: %s, serverTs: %s, ts: %s, rowId: %s",a.msgId,a.type,a.externalId,a.revokedExternalId,a.sortOrderMs,a.serverTs,a.ts,a.rowId,f.msgId,f.type,f.externalId,f.revokedExternalId,a.sortOrderMs,a.serverTs,a.ts,a.rowId));g.type++;b.push("type, reference: "+((e=f.type)!=null?e:"")+", duplicate: "+((e=a.type)!=null?e:"")+". ")}e=b.join("");e.length>0?c("FBLogger")("MAWDuplicateMessageComparison").info("Duplicate msg, %s, has conflicting field values to reference msg, %s: %s",a.msgId,f.msgId,e):c("FBLogger")("MAWDuplicateMessageComparison").info("Duplicate msg, %s, has no conflicting field values to reference msg, %s",a.msgId,f.msgId)});d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_DUPLICATE_MSGS,key:"sets_of_duplicate_msgs"});Object.keys(g).forEach(function(a){var b=g[a];b>0&&d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_DUPLICATE_MSGS,key:"sets_of_duplicate_msgs_with_"+a+"_field_differences"})});d("MAWODSProxy").odsBumpEntityKey({amount:b-1,entity:d("WAOdsEnums").Entity.MAW_DUPLICATE_MSGS,key:"number_of_duplicate_msgs"});Object.keys(g).forEach(function(a){var b=g[a];b>0&&d("MAWODSProxy").odsBumpEntityKey({amount:b,entity:d("WAOdsEnums").Entity.MAW_DUPLICATE_MSGS,key:"number_of_duplicate_msgs_with_"+a+"_field_differences"})})}function B(a,b,c,d){d={author:d,chat:c,externalId:b};return x(a,d)}function C(a,b){return a.messages.where("msgId").equals(b).toArray()}function D(a,b){return G(a,b).then(function(a){return a.success?a:a})}function E(a,b){var c=b.map(function(a){a=a.externalId;return a});return a.messages.where("externalId").anyOf(c).toArray().then(function(a){var c=d("MAWDbMsgUtil").convertMsgArrayToMap(a),e=new(d("WAMsgMap").MsgMap)();b.forEach(function(a){var b=c.get(a);b!=null&&e.set(a,b)});return e})}function F(a,b){return a.messages.where("msgId").equals(b).first().then(function(a){return a==null?void 0:a.sortOrderMs})}function G(a,b){var c=b.author,e=b.chat,f=b.externalId;return a.threads.get({jid:e}).then(function(b){return b==null?d("WAResultOrError").makeError("missing_thread_msg"):B(a,f,b.jid,c).then(function(a){return a==null?d("WAResultOrError").makeError("missing_msg"):d("WAResultOrError").makeResult(a)})})}function H(a,b){var c=b.author,d=b.chat,e=b.externalId;return a.threads.get({jid:d}).then(function(b){if(b==null)return;return a.messages.where("revokedExternalId").equals(e).filter(function(a){return a.author===c&&a.threadJid===b.jid&&a.type==="Revoked"}).first()})}function I(a,b,c,e){var f=a.messages.where("revokedExternalId").equals(b).filter(function(a){return a.author===e&&a.threadJid===c&&a.type===d("MAWMsgType").MSG_TYPE.REVOKED}).first();a=d("MAWDbUnrenderedMsgTxns").maybeGetUnrenderedMsgByExternalId(a,b,c,e).then(function(a){if((a==null?void 0:a.type)===d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME)return a});return d("MAWDexieTable").dexieAll([f,a]).then(function(a){var b=a[0];a=a[1];return b!=null||a!=null})}function J(a,b){var c=new Array(b.length),e=new Set();b.forEach(function(a){c.push(a.externalId),e.add(d("EncryptedBackupsUtils").convertWAMsgIdToStringId(a))});return a.messages.where("externalId").anyOf(c).filter(function(a){return e.has(d("EncryptedBackupsUtils").convertWAMsgIdToStringId({author:a.author,chat:a.threadJid,externalId:a.externalId}))}).toArray()}function K(a,b,c,e,f,g){return L(a,[{ack:c,applicationErrorCode:g,msgId:b,reportingMeta:f,serverTs:e}]).then(function(a){a=a.find(function(a){return a.msgId===b});if(a==null){d("WALogger").LOG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["updateSystemAck on non existing message"])));return null}return a})}function L(a,b){var c=b.map(function(a){return a.msgId});return d("MAWDbXMATxns").getXMAMsgIdsFromAssociatedMsgIds(a,c).then(function(e){var f=new Map();b.forEach(function(a){f.set(a.msgId,{ack:a.ack,applicationErrorCode:a.applicationErrorCode,reportingMeta:a.reportingMeta,serverTs:a.serverTs});var b=e.get(a.msgId);b!=null&&f.set(b,{ack:a.ack,applicationErrorCode:a.applicationErrorCode,reportingMeta:a.reportingMeta,serverTs:a.serverTs})});var g=Array.from(new Set(c.concat(Array.from(e.values()))));return a.messages.where("msgId").anyOf(g).toArray().then(function(b){if(b.length===0)return b;var c=[],e=[];b.forEach(function(a){var b,g;if(a.author!==d("WAJids").AUTHOR_ME||a.ack>d("MAWAckLevel").ACK.clock){c.push(a);return}b=(b=f.get(a.msgId))==null?void 0:b.ack;g=(g=f.get(a.msgId))==null?void 0:g.serverTs;if(b==null)return null;var h=babelHelpers["extends"]({},a,{ack:b});M(h,g);a=(g=f.get(a.msgId))==null?void 0:g.reportingMeta;a!=null&&(h.reportingMeta=a);b===d("MAWAckLevel").ACK.sent&&delete h.resendCount;e.push(h)});c.length>0&&d("WALogger").LOG(k||(k=babelHelpers.taggedTemplateLiteralLoose(["bulkUpdateSystemAck: not updating ",""])),c.map(function(a){return a.msgId}).toString());return a.messages.bulkPut(e).then(function(){return d("MAWDexieTable").dexieAll(e.map(function(b){return d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,b)}))}).then(function(a){e.forEach(function(b,c){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(b,a[c])})});return[].concat(e,c)})})})}function M(a,b){if(b==null)return;a.serverTs=b;var e=a.sortOrderMs;if(a.type===d("MAWMsgType").MSG_TYPE.REVOKED&&c("justknobx")._("3841"))return;a.sortOrderMs=d("MAWMessageSortOrderUtils").generateAuthoritativeMessageSortOrder(a);d("WALogger").LOG(l||(l=babelHelpers.taggedTemplateLiteralLoose(["Message was acked by server (serverTs = ","), override sortOrderMs: "," -> ",""])),b,e,a.sortOrderMs)}function N(a,b,e,f){return d("MAWDbThreadTxns").getThread(a,b).then(function(b){if(!b.success||f==null)return;var g=b.value;b=[a.messages.where(["threadJid","sortOrderMs"]).above([g.jid,f]).first(),a.messages.where(["threadJid","sortOrderMs"]).below([g.jid,f]).last()];return d("MAWDexieTable").dexieAll(b).then(function(b){var f=b[0];b=b[1];return d("MAWDbThreadTxns").updateThread(a,babelHelpers["extends"]({},g,{newestMsgTs:(b==null?void 0:b.ts)==null?g.newestMsgTs:d("WATimeUtils").castUnixTimeToMillisTime(b.ts),oldestMsg:g.oldestMsg===e?f==null?void 0:f.msgId:g.oldestMsg})).then(c("emptyFunction"))})})}function O(a){return a.messages.where("altIndex").equals(d("MAWDbMsg").FUTUREPROOF_ALT_INDEX).toArray().then(function(a){var b=[];a.forEach(function(a){if(a.type!==d("MAWMsgType").MSG_TYPE.FUTUREPROOF){d("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["getFutureproofMsg gets a message "," with unsupported type ",""])),a.msgId,a.type);return}b.push(a)});return b})}function P(a){return a.toString()}function Q(a,b,e,f){var g=b.mediaId;if(g===e){d("WALogger").LOG(n||(n=babelHelpers.taggedTemplateLiteralLoose(["updateMediaId on message "," that already has this mediaId ",""])),b.msgId,e);return d("MAWDexieTable").dexieResolve()}g=g!=null?a.media.get(g):d("MAWDexieTable").dexieResolve();return g.then(function(g){g&&d("WALogger").ERROR(o||(o=babelHelpers.taggedTemplateLiteralLoose(["Replacing mediaId for message with pre-existing media. type=",""])),b.type);g=f!=null?f:void 0;g=babelHelpers["extends"]({},b,{mediaId:e,plaintextHash:g});return a.messages.put(g).then(c("emptyFunction"))})}function R(a,b){var e=Array.from(b.keys());return a.messages.where("msgId").anyOf(e).toArray().then(function(e){var f=[];e.map(function(a){var e=b.get(a.msgId),g=a.mediaId;if(g!=null&&g!==e){if(e!=null)throw c("FBLogger")("messenger_web").mustfixThrow("mediaId "+P(g)+" in message "+a.msgId+" is different with the "+P(e)+" in bulkUpdateMediaId");d("WALogger").LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["updateMediaId on message "," that already has this mediaId ",""])),a.msgId,e);return}g=babelHelpers["extends"]({},a,{mediaId:e,plaintextHash:a.plaintextHash});f.push(g)});return a.messages.bulkPut(f).then(c("emptyFunction"))})}function S(a,b){return T(a,[b]).then(c("emptyFunction"))}function T(a,b){return a.messages.where("msgId").anyOf(b).toArray().then(function(b){var c=b.map(function(a){return babelHelpers["extends"]({},a,{isExpiredXmaMsg:!0})});return a.messages.bulkPut(c).then(function(){return c})})}function U(a,b,c,e){if(e!=null&&e<=0)return d("MAWDexieTable").dexieResolve([]);a=a.messages.where("altIndex").equals(d("MAWDbMsg").craftToBeReadAltIndex(b)).filter(function(a){return d("MAWDbMsg").getSortOrderWithFallback(a)<=c});e!=null&&(a=a.limit(e));return a.toArray()}function V(a,b,c){return U(a,b,c).then(function(b){var c=b.map(function(a){return babelHelpers["extends"]({altIndex:null},a)});return a.messages.bulkPut(c).then(function(){return c})})}function W(a,b){return a.messages["delete"](b)}function X(a,b){return a.messages.bulkDelete(b)}function Y(a,b,c){var e=b.map(function(a){return a.rowId});b=c!=null?b.map(function(a){a=d("MAWJidUtils").toProtocolMsgId(a);if(!a)return;return babelHelpers["extends"]({},a,{reason:c})}).filter(Boolean):[];return d("MAWDexieTable").dexieAll([a.deletedMessages.bulkAdd(b),a.messages.bulkDelete(e)]).then(function(a){a[0];a=a[1];d("WALogger").LOG(q||(q=babelHelpers.taggedTemplateLiteralLoose(["Successfull deleted "," messages"])),a)})}function Z(a,b){return a.messages.where("msgId").anyOf(b).toArray()}function aa(a){return a.messages.where("altIndex").anyOf([d("MAWDbMsg").SPAM_ALT_INDEX,d("MAWDbMsg").FUTUREPROOF_SPAM_ALT_INDEX]).toArray()}function ba(a,b,c,e,f,g,h,i){h===void 0&&(h="before");i===void 0&&(i=null);c=c==null?null:d("MAWDbMsg").getSortOrderWithFallback(c);if(h==="before")return a.messages.where(["threadJid","sortOrderMs"]).between([b,i!=null?i:Number.MIN_SAFE_INTEGER],[b,c!=null?c:Number.MAX_SAFE_INTEGER],!0,e).reverse().filter(g).limit(f).toArray();else return a.messages.where(["threadJid","sortOrderMs"]).between([b,c!=null?c:Number.MIN_SAFE_INTEGER],[b,i!=null?i:Number.MAX_SAFE_INTEGER],e,!0).filter(g).limit(f).toArray().then(function(a){return a.sort(function(a,b){return b.ts-a.ts})})}function ca(a,b,c,d){var e=c.msgId;if(d==null){var f;return{oldestMsg:(f=a==null?void 0:a.msgId)!=null?f:e}}f=[a,b,c].filter(Boolean);return{oldestMsg:f.reduce(function(a,b){return $(a,e,d)<$(b,e,d)?a:b}).msgId}}function $(a,b,c){return a.msgId===b?c:d("MAWDbMsg").getSortOrderWithFallback(a)}function da(a,b){return a.messages.where("msgId").between(d("MAWDbMsg").msgIdsInChatLowerBound(b.chatId),d("MAWDbMsg").msgIdsInChatUpperBound(b.chatId)).last().then(function(a){a=a==null?0:d("MAWDbMsg").getInChatMsgIdFromMsgId(a.msgId);return a+1})}function ea(a){return d("MAWTransactor").makeMsgrTransactor({messages:d("MAWTransactionMode").READONLY},"checkMessagesExistenceByProtocolMsgIds",function(b){return function(){return d("MAWDexieTable").dexieAll(a.map(function(a){return b.messages.get({protocolMsgId:a.chat+"."+a.externalId})}))}})()}function fa(a,b){return a.messages.where("externalId").anyOf(b).toArray()}g.maybeGetMsg=a;g.getIsThreadEmpty=b;g.doesThreadHaveMsgsMatchCriteria=e;g.getThreadMessagesBySortOrder=r;g.getThreadNewestMessageBySortOrder=s;g.getThreadNewestMessageId=f;g.getThreadNewestMessageMs=t;g.getThreadNewestNumMessagesBySortOrder=u;g.getThreadOldestMessageBySortOrder=v;g.getThreadOldestMessageId=w;g.maybeGetMsgByProtocolMsgId=x;g.getUniqueMsgsByProtocolMsgIds=y;g.maybeGetMsgByExternalId=B;g.maybeGetMsgListByMsgId_I_KNOW_WHAT_I_AM_DOING=C;g.maybeGetMsgResultByProtocolMsgId=D;g.getMsgMapByProtocolMsgId=E;g.getSortOrderFromMsgId=F;g.maybeGetRevokedMsgByProtocolMsgId=H;g.checkIfMsgIsDeletedForMeOrRevoked=I;g.getMsgsByProtocolMsgId=J;g.updateSystemAck=K;g.bulkUpdateSystemAck=L;g.maybeUpdateThreadMsgsForDeleteForMe=N;g.getFutureProofMsgs=O;g.updateMediaId=Q;g.bulkUpdateMediaId=R;g.updateDbMsgXMAExpiration=S;g.bulkUpdateDbMsgXMAExpired=T;g.getMsgsNeedingRetroactiveReadReceiptsUpTo=U;g.clearRetroactiveReadReceiptStatusFromMsgsUpTo=V;g.deleteDbMsg=W;g.bulkDeleteDbMsg=X;g.deleteMessages=Y;g.getMsgsByMsgIds=Z;g.getSpamMsgs=aa;g.fetchMessagesFromDbWithSortOrderMs=ba;g.calculateOldestMsg=ca;g.getNextMsgIdNumberForThread=da;g.checkMessagesExistenceByProtocolMsgIds=ea;g.UNSAFE_getMultipleMsgsByExternalId=fa}),98);
__d("MAWDbReactionsTxns",["FBLogger","MAWAuthor","MAWBridgeTypesCreators","MAWDbMsg","MAWDexieTable","MAWIndexedDb","WALogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=function(a){return a};function a(a,b){return a.reactions.put(k(b))}function b(a,b){return a.reactions["delete"](b.rowId).then(function(){var a=b.author,c=b.reactionId,e=b.reactToMsgId,f=b.threadJid;if(e==null)return;d("MAWIndexedDb").afterTransaction({tag:"DeleteReaction",value:d("MAWBridgeTypesCreators").createBridgeDeleteReaction({author:a,chatJid:f,reactToMsgId:e})});d("WALogger").LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Successfully deleted reaction with id : ","."])),c)})}function e(a,b){var c=d("MAWAuthor").getAuthorUserJid(b.author);return a.reactions.where("reactToExternalId").equals(b.externalId).filter(function(a){return(a.reactToAuthor===c||a.reactToAuthor===b.author)&&a.threadJid===b.chat}).toArray()}function l(a,b){var d=b.reduce(function(a,b){a.set(b.msgId,b);return a},new Map());return a.reactions.where("reactToMsgId").anyOf(b.map(function(a){return a.msgId})).toArray().then(function(a){var b=a.filter(function(a){var b=a.reactToExternalId;a=a.reactToMsgId;return a!=null&&b===((b=d.get(a))==null?void 0:b.externalId)});b.length<a.length&&c("FBLogger")("messenger_web").mustfix("Reactions query by reactToMsgId returns reactions with mismatching externalId");return b})}function f(a,b){return a.reactions.where("reactToMsgId").equals(b.msgId).toArray().then(function(a){var d=a.filter(function(a){a=a.reactToExternalId;return a===b.externalId});d.length<a.length&&c("FBLogger")("messenger_web").mustfix("Reactions query by reactToMsgId returns reactions with mismatching externalId");return d})}function m(a,b){return l(a,[b])}function n(a,b){var c=b.author,d=b.chat;b=b.externalId;return a.reactions.where("externalId").equals(b).filter(function(a){return a.author===c&&a.threadJid===d}).first()}function o(a,b){return d("MAWDexieTable").dexieAll(b.map(function(b){var c=b.author;b=b.externalId;var e=d("MAWAuthor").getAuthorUserJid(c);return a.reactions.where("reactToExternalId").equals(b).filter(function(a){return d("MAWAuthor").getAuthorUserJid(a.reactToAuthor)===e}).toArray()})).then(function(b){b=b.flat();b.forEach(function(a){var b=a.author,c=a.reactToMsgId;a=a.threadJid;if(c==null)return;d("MAWIndexedDb").afterTransaction({tag:"DeleteReaction",value:d("MAWBridgeTypesCreators").createBridgeDeleteReaction({author:b,chatJid:a,reactToMsgId:c})})});if(b.length===0)return;d("WALogger").LOG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Successfully deleted: "," reactions rows."])),b.length);return a.reactions.bulkDelete(b.map(function(a){return a.rowId}))})}function p(a,b){return a.reactions.where("reactToMsgId").anyOf(b.map(function(a){return a.msgId}))["delete"]().then(function(a){d("WALogger").LOG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Deleted "," reactions"])),a)})}function q(a,b){return a.reactions.where("reactionId").between(d("MAWDbMsg").msgIdsInChatLowerBound(b.chatId),d("MAWDbMsg").msgIdsInChatUpperBound(b.chatId)).last().then(function(a){a=a==null?0:d("MAWDbMsg").getInChatMsgIdFromMsgId(a.reactionId);return a+1})}function r(a,b,c,e,f,g,h){e=(e=e==null?void 0:e.ts)!=null?e:d("WATimeUtils").unixTime();return a.reactions.where(["threadJid","ts"]).between([b,(a=d("WATimeUtils").castMillisTimeToUnixTime(c))!=null?a:d("WATimeUtils").castToUnixTime(0)],[b,e],!0,f).reverse().filter(h).limit(g).toArray()}g.coerceToReaction=k;g.putReaction=a;g.deleteReaction=b;g.getReactionForEcho=e;g.getReactionsFromMessages=l;g.getReactionsForMessage=f;g.getReactionsFromMessage=m;g.maybeGetReactionByProtocolMsgId=n;g.deleteReactionsByUniqueMsgIdentifiers=o;g.deleteAllReactionsForMessages=p;g.getNextReactionIdNumberForThread=q;g.fetchReactionsFromDbWithTimestamp=r}),98);
__d("MaybeCreateOrUpdateThreadResultCache",[],(function(a,b,c,d,e,f){"use strict";var g=new Map();function a(a){g["delete"](a)}f.cache__I_KNOW_WHAT_I_AM_DOING=g;f.deleteCachedThreadResult=a}),66);
__d("MAWDbThreadTxns",["MAWAuthoritativeThreadsCache","MAWBridgeTypesCreators","MAWDbMsgTxns","MAWDexieTable","MAWFolderTypes","MAWIndexedDb","MaybeCreateOrUpdateThreadResultCache","WAArrayZip","WALogger","WAResultOrError","WATimeUtils","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(a,b){return a.threads.get({deduplicationKey:b}).then(function(a){return a==null?d("WAResultOrError").makeError("missing"):d("WAResultOrError").makeResult(a)})}function k(a,b){return a.threads.get({jid:b}).then(function(a){return a==null?d("WAResultOrError").makeError("missing"):d("WAResultOrError").makeResult(a)})}function l(a,b){return a.threads.where("jid").anyOf(b).toArray()}function b(a,b){return a.threads.where("jid").startsWith(b+"@").first().then(function(a){return a==null?d("WAResultOrError").makeError("missing"):d("WAResultOrError").makeResult(a)})}function m(a){d("MaybeCreateOrUpdateThreadResultCache").deleteCachedThreadResult(a),d("MAWAuthoritativeThreadsCache").AuthoritativeThreadsCache["delete"](a)}function e(a,b){return a.threads.where("jid").equals(b)["delete"]().then(function(){return m(b)})}function f(a,b){return a.participants.where("userJid").equals(b).toArray().then(function(b){b=b.map(function(a){return a.threadJid});return l(a,b)})}function n(a,b){return a.participants.where("userJid").anyOf(b).toArray().then(function(b){var c=new Map(),d=new Set();b.forEach(function(a){var b,e=a.userJid;b=(b=c.get(e))!=null?b:[];b.push(a.threadJid);c.set(e,b);d.add(a.threadJid)});return l(a,Array.from(d)).then(function(a){var b=a.reduce(function(a,b){a.set(b.jid,b);return a},new Map());return new Map(Array.from(c.entries()).map(function(a){var c=a[0];a=a[1];return[c,a.map(function(a){return b.get(a)}).filter(Boolean)]}))})})}function o(a,b,c){return(b==null?void 0:b.lastReadMsgReceiptSent)==null?d("MAWDexieTable").dexieResolve(!1):d("MAWDbMsgTxns").getSortOrderFromMsgId(a,b.lastReadMsgReceiptSent).then(function(a){return c.sortOrderMs==null||a==null?!1:c.sortOrderMs<=a})}function p(a,b){return a.threads.get({jid:b.threadJid}).then(function(c){return o(a,c,b)})}function q(a,b){return a.threads.where("jid").anyOf(b.map(function(a){return a.threadJid})).toArray().then(function(c){return d("MAWDexieTable").dexieAll(d("WAArrayZip").zip(b,c).map(function(b){var c=b[0];b=b[1];return o(a,b,c)}))})}function r(a,b,c){return a.threads.where("jid").anyOf(b).toArray().then(function(b){var e=b.filter(Boolean).map(function(a){return babelHelpers["extends"]({},a,{archived:!0,cannotReplyReason:c?"viewer_not_subscribed":a.cannotReplyReason,folder:d("MAWFolderTypes").FOLDER_ID.ARCHIVED})});return a.threads.bulkPut(e).then(function(){e.forEach(function(a){c&&d("WALogger").LOG(["[Occamadillo] Leaving a group thread\n          "+a.jid.toString()+", showing a VIEWER_NOT_SUBSCRIBED composer blocker"]),d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({cannotReplyReason:a.cannotReplyReason,folder:d("MAWFolderTypes").FOLDER_ID.ARCHIVED,threadJid:a.jid})})})})})}function s(a,b){return a.threads.where("jid").anyOf(b).toArray().then(function(b){var c=b.filter(Boolean).map(function(a){return babelHelpers["extends"]({},a,{cannotReplyReason:null})});return a.threads.bulkPut(c).then(function(){c.forEach(function(a){a={cannotReplyReason:null,threadJid:a.jid};d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread(a)})})})})}function t(a,b){return a.threads.where("jid").anyOf(b).toArray().then(function(b){var c=b.filter(Boolean).map(function(a){return babelHelpers["extends"]({},a,{archived:!1,cannotReplyReason:a.cannotReplyReason==="viewer_not_subscribed"?a.cannotReplyReason:null,folder:d("MAWFolderTypes").FOLDER_ID.INBOX})});return a.threads.bulkPut(c).then(function(){c.forEach(function(a){d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({cannotReplyReason:a.cannotReplyReason,folder:d("MAWFolderTypes").FOLDER_ID.INBOX,threadJid:a.jid})})})})})}function u(a,b){return a.threads.where("jid").anyOf(b).toArray().then(function(b){var c=b.filter(Boolean).map(function(a){return babelHelpers["extends"]({},a,{cannotReplyReason:"viewer_not_subscribed"})});return a.threads.bulkPut(c).then(function(){c.forEach(function(a){var b={cannotReplyReason:"viewer_not_subscribed",threadJid:a.jid};d("WALogger").LOG(["[Occamadillo] User is unsubscribed from thread\n          "+a.jid.toString()+", showing a VIEWER_NOT_SUBSCRIBED composer blocker"]);d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread(b)})})})})}function v(a,b){return k(a,b).then(function(b){if(!b.success){d("WALogger").WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["markThreadAsMigratedLocally failed to get the thread"])));return}b=b.value;if(b.isMigratedLocally===!0){d("WALogger").WARN(i||(i=babelHelpers.taggedTemplateLiteralLoose(["markThreadAsMigratedLocally failed because thread is already migrated"])));return}b=babelHelpers["extends"]({},b,{isMigratedLocally:!0});return a.threads.put(b).then(c("emptyFunction"))})}function w(a,b){if(b.isMigratedLocally===!1){d("WALogger").WARN(j||(j=babelHelpers.taggedTemplateLiteralLoose(["markCutoverThreadAsNotMigratedLocally failed because thread is already unmigrated"])));return d("MAWDexieTable").dexieResolve(b)}var c=babelHelpers["extends"]({},b,{isMigratedLocally:!1});return a.threads.put(c).then(function(){return c})}function x(a,b){return a.threads.put(b).then(c("emptyFunction"))}function y(a,b,c,e,f){return x(a,babelHelpers["extends"]({},b,{newestMsgTs:(f==null?void 0:f.ts)==null?b.newestMsgTs:d("WATimeUtils").castUnixTimeToMillisTime(f.ts),oldestMsg:e==null?void 0:e.msgId}))}g.getThreadByDeduplicationKey=a;g.getThread=k;g.getThreads=l;g.getThreadPrimaryId=b;g.deleteThread=e;g.getAllThreadsForUser=f;g.getAllThreadsForUsers=n;g.needsRetroactiveReadReceiptInThread=p;g.bulkNeedsRetroactiveReadReceiptInThread=q;g.archiveThreads=r;g.subscribeToThreads=s;g.unarchiveThreads=t;g.unsubscribeFromThreads=u;g.markCutoverThreadAsMigratedLocally=v;g.markCutoverThreadAsNotMigratedLocally=w;g.updateThread=x;g.updateThreadMsgsForUndefinedOldestOrNewestMsgs=y}),98);
__d("MAWDbXMATxns",["MAWDbChunkTxns","MAWDbMediaTxns","MAWDbMsg","MAWDbMsgTxns","MAWDbThreadTxns","MAWDexieTable","MAWJidUtils","MAWXMAUtils","WAResultOrError","gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return a.xma.bulkGet(b)}function b(a,b){return b==null?d("MAWDexieTable").dexieResolve():a.xma.get({xmaId:b})}function h(a,b){return b==null?d("MAWDexieTable").dexieResolve():a.xma.where("associatedMessageId").equals(b).first()}function i(a,b){return b==null?d("MAWDexieTable").dexieResolve():a.xma.where("externalId").equals(b.externalId).filter(function(a){return a.author===b.author&&a.threadJid===b.chat}).first()}function e(a,b){return i(a,b).then(function(b){return b==null?d("WAResultOrError").makeError("missing"):d("MAWDexieTable").dexieAll([d("MAWDbMediaTxns").getMediaForXMA(a,b),d("MAWDbMsgTxns").maybeGetMsg(a,b.associatedMessageId)]).then(function(a){var c=a[0];a=a[1];if(!c.success)return d("WAResultOrError").makeError("missing");c=c.value;var e=c.defaultPreview,f=c.favicon,g=c.header;c=c.previews;return d("WAResultOrError").makeResult({associatedMessage:a,defaultPreview:e,favicon:f,header:g,previews:c,xma:b})})})}function f(a,b){return h(a,b).then(function(b){if(b==null)return;return d("MAWDbMsgTxns").maybeGetMsg(a,b.msgId)})}function j(a,b){if(b.length===0)return d("MAWDexieTable").dexieResolve([]);b=b.filter(d("MAWDbMsg").isXMAMsg).map(function(a){return d("MAWJidUtils").maybeToProtocolMsgId(a.author,a.threadJid,a.externalId)}).filter(Boolean);b=b.map(function(b){return i(a,b)});return d("MAWDexieTable").dexieAll(b).then(function(a){return a.filter(Boolean)})}function k(a,b){return a.xma.where("associatedMessageId").anyOf(b).toArray().then(function(a){a=a.filter(function(a){return a.msgId!=null&&c("gkx")("9841")?a.targetType!=null:d("MAWXMAUtils").isXMAShare_DO_NOT_USE(a.targetType)});return a.reduce(function(a,b){return b.associatedMessageId!=null&&b.msgId!=null?a.set(b.associatedMessageId,b.msgId):a},new Map())})}function l(a,b){return a.xma.where("associatedMessageId").equals(b).first()}function m(a,b){return a.xma.where("associatedMessageId").equals(b).first().then(function(b){if(b==null)return;b=d("MAWJidUtils").maybeToProtocolMsgId(b.author,b.threadJid,b.externalId);if(b==null)return;return d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b)})}function n(a,b){return l(a,b).then(function(b){return b==null?d("WAResultOrError").makeResult():d("MAWDexieTable").dexieAll([d("MAWDbMediaTxns").getMediaForXMA(a,b),d("MAWDbMsgTxns").maybeGetMsg(a,b.associatedMessageId)]).then(function(a){var c=a[0];a=a[1];if(!c.success)return d("WAResultOrError").makeError("missing");c=c.value;var e=c.defaultPreview,f=c.favicon,g=c.header;c=c.previews;return d("WAResultOrError").makeResult({associatedMessage:a,defaultPreview:e,favicon:f,header:g,previews:c,xma:b})})})}function o(a,b,c){return d("MAWDbThreadTxns").getThread(a,c).then(function(c){if(!c.success)return;c=c.value;if(b==null)return d("MAWDexieTable").dexieResolve();c={author:b.author,chat:c.jid,externalId:b.externalId};return d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,c)})}function p(a,b){return i(a,b).then(function(b){if(b==null)return d("MAWDexieTable").dexieResolve();if(d("MAWXMAUtils").isXMAStoryReply(b.targetType))return;return d("MAWDbMediaTxns").maybeGetMediaFromMediaId(a,b.defaultPreviewMediaId).then(function(c){return c==null?{hasMedia:!1,xma:b}:d("MAWDexieTable").dexieAll([c,d("MAWDbChunkTxns").hasMediaChunk(a,c.hashedPlaintextHash)]).then(function(a){var c=a[0];a=a[1];return{hasMedia:a,previewMedia:c,xma:b}})})})}function q(a,b){return a.xma.where("externalId").anyOf(b).toArray()}g.bulkGetXMAs=a;g.maybeGetXMAFromXMAId=b;g.maybeGetXMAFromAssociatedMsgId=h;g.maybeGetXMAFromProtocolMsgId=i;g.maybeGetXMAPayloadFromProtocolMsgId=e;g.getDbXMAMsgFromAssociatedMsgId=f;g.getXMAFromMsgs=j;g.getXMAMsgIdsFromAssociatedMsgIds=k;g.maybeGetDbXMAMsgByAssociatedMsgId=m;g.maybeGetXMAPayloadFromAssociatedMsgId=n;g.maybeGetAssociatedXMAMsg=o;g.maybeGetXMAAndDefaultPreviewMediaFromProtocolMsg=p;g.getMultipleXMAByExternalId=q}),98);
__d("MAWMessageHasNonNullServerTsOnReceivedAckValidator",["MAWAckLevel","MAWTransactionMode","MAWTransactor"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWTransactor").makeMsgrTransactor({messages:d("MAWTransactionMode").READONLY},"isMessageHasNonNullServerTsOnReceivedAckValidator",function(a){return function(b){return a.messages.get(b).then(function(a){return a==null||a.ack<d("MAWAckLevel").ACK.sent?{key:b,result:"skipped"}:a.serverTs!=null?{key:b,result:"valid"}:{description:"Message with "+a.ack+" ack has empty serverTs.",key:b,result:"invalid"}})}});b={description:"MAWMessageHasNonNullServerTsOnReceivedAckValidator",isValid:a,table:"messages",type:["add","put"]};g.MAWMessageHasNonNullServerTsOnReceivedAckValidator=b}),98);
__d("MAWMessageHasUniqueExternalIdValidator",["MAWDexieTable","MAWTransactionMode","MAWTransactor","WAStanzaUtils","justknobx"],(function(a,b,c,d,e,f,g){"use strict";a=c("justknobx")._("3288");b=d("MAWTransactor").makeMsgrTransactor({messages:d("MAWTransactionMode").READONLY},"isMessageWithUniqueExternalIdValidator",function(a){return function(b){return a.messages.get(b).then(function(c){var e=c==null?void 0:c.externalId;return c==null||e==null?d("MAWDexieTable").dexieResolve({key:b,result:"skipped"}):a.messages.where("externalId").equals(d("WAStanzaUtils").toStanzaId(e)).filter(function(a){return a.author===c.author&&a.threadJid===c.threadJid}).toArray().then(function(a){if(a.length===1)return{key:b,result:"valid"};else{a=h(b,c,a);return{description:a,key:b,result:"invalid"}}})})}});function h(a,b,c){var d,e=c.every(function(a){return a.serverTs===b.serverTs});c=c.filter(function(b){return b.rowId!==a});d="Message has duplicate externalId."+("New message type: "+((d=b.type)!=null?d:"")+". ")+("Existing message types: "+c.map(function(a){return a.type}).join(", ")+". ")+("Messages have same serverTS: "+e.toString()+". ")+("Message has null protocolMsgId: "+(b.protocolMsgId==null).toString()+". ");return d}e={description:"MAWMessageHasUniqueExternalIdValidator",isValid:b,sampleRate:a,table:"messages",type:["add","put"]};g.MAWMessageHasUniqueExternalIdValidator=e}),98);
__d("MAWParticipantMatchOneOnOneThreadValidator",["MAWIndexedDb","MAWTransactionMode","MAWUserJidWrapper","WAJids","justknobx"],(function(a,b,c,d,e,f,g){"use strict";a=c("justknobx")._("3121");b=d("MAWIndexedDb").makeMsgrTransactor({participants:d("MAWTransactionMode").READONLY},"isParticipantMatchingOneOnOneThreadValidator",function(a){return function(b){return a.participants.get(b).then(function(a){return a==null?{key:b,result:"skipped"}:d("WAJids").switchOnMsgrChatJidType(a.threadJid,{group:function(){return{key:b,result:"skipped"}},user:function(c){return a.userJid!==c&&a.userJid!==d("MAWUserJidWrapper").getMyUserJid()?{description:"Participants added to 1:1 thread is neither self or the other user",key:b,result:"invalid"}:{key:b,result:"valid"}}})})}});e={description:"MAWParticipantMatchOneOnOneThreadValidator",isValid:b,sampleRate:a,table:"participants",type:["add","put"]};g.MAWParticipantMatchOneOnOneThreadValidator=e}),98);
__d("MAWReactionHasUniqueProtocolMsgIdValidator",["MAWDexieTable","MAWTransactionMode","MAWTransactor","WAStanzaUtils"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWTransactor").makeMsgrTransactor({reactions:d("MAWTransactionMode").READONLY},"isReactionWithUniqueProtocolMsgIdValidator",function(a){return function(b){return a.reactions.get(b).then(function(c){var e=c==null?void 0:c.externalId;return e==null?d("MAWDexieTable").dexieResolve({key:b,result:"skipped"}):a.reactions.where("externalId").equals(d("WAStanzaUtils").toStanzaId(e)).filter(function(a){return a.threadJid===(c==null?void 0:c.threadJid)}).toArray().then(function(a){if(a.length===1)return{key:b,result:"valid"};else{a=a.find(function(a){return a.author!==(c==null?void 0:c.author)})!=null;return{description:"Reaction has duplicate protocolMsgId, has existing with different author: "+a.toString(),key:b,result:"invalid"}}})})}});b={description:"MAWReactionHasUniqueProtocolMsgIdValidator",isValid:a,table:"reactions",type:["add","put"]};g.MAWReactionHasUniqueProtocolMsgIdValidator=b}),98);
__d("MAWDbMutationMiddleware",["FBLogger","MAWDbMiddlewareMutations"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return{create:function(b){return babelHelpers["extends"]({},b,{table:function(e){var f=b.table(e);try{return babelHelpers["extends"]({},f,{get:function(b){return f.get(b).then(function(b){return b==null?void 0:d("MAWDbMiddlewareMutations").getValue(b,e,a)})},getMany:function(b){return f.getMany(b).then(function(b){return b.map(function(b){return b==null?void 0:d("MAWDbMiddlewareMutations").getValue(b,e,a)})})},mutate:function(b){var c=null;switch(b.type){case"add":case"put":c=b.values.map(function(b){return d("MAWDbMiddlewareMutations").mutateValue(b,e,a)});break;case"delete":break;case"deleteRange":break}if(b.type==="delete"||b.type==="deleteRange"||c==null)return f.mutate(b);b.values=c;return f.mutate(b).then(function(a){return a})},openCursor:function(b){return f.openCursor(b).then(function(b){return b==null||b.value==null?b:h(b,e,a)})},query:function(b){return f.query(b).then(function(b){if(b.result.length===0||typeof b.result[0]!=="object")return b;var c=b.result.map(function(b){return d("MAWDbMiddlewareMutations").getValue(b,e,a)});b.result=c;return b})}})}catch(a){c("FBLogger")("messenger_web").catching(a).mustfix("Error applying MAWDbMiddleware");return f}}})},name:"MAWDbMutationMiddleware",stack:"dbcore"}}function b(){return{create:function(a){return babelHelpers["extends"]({},a,{table:function(b){var e=a.table(b);try{return babelHelpers["extends"]({},e,{get:function(a){return e.get(a).then(function(a){return d("MAWDbMiddlewareMutations").getVaultedValue(a,b)})},getMany:function(a){return e.getMany(a).then(function(a){return a.map(function(a){return d("MAWDbMiddlewareMutations").getVaultedValue(a,b)})})},mutate:function(a){if(a.type==="delete"||a.type==="deleteRange")return e.mutate(a);a.values=a.values.map(function(a){return d("MAWDbMiddlewareMutations").mutateVaultedValue(a,b)});return e.mutate(a)},openCursor:function(a){return e.openCursor(a).then(function(a){return a==null||a.value==null?a:i(a,b)})},query:function(a){return e.query(a).then(function(a){return a.result.length===0||typeof a.result[0]!=="object"?a:babelHelpers["extends"]({},a,{result:a.result.map(function(a){return d("MAWDbMiddlewareMutations").getVaultedValue(a,b)})})})}})}catch(a){c("FBLogger")("messenger_web").catching(a).mustfix("Error applying MAWDbMiddleware");return e}}})},name:"getMAWVaultMiddleware",stack:"dbcore"}}function h(a,b,c){var e;return Object.create(a,{"continue":{get:function(){return a["continue"]}},continuePrimaryKey:{get:function(){return a.continuePrimaryKey}},key:{get:function(){return a.key}},primaryKey:{get:function(){return a.primaryKey}},start:{value:function(f){return a.start(function(){e=d("MAWDbMiddlewareMutations").getValue(a.value,b,c);try{a.value=e}catch(a){}f()})}},value:{get:function(){return e}}})}function i(a,b){var c;return Object.create(a,{"continue":{get:function(){return a["continue"]}},continuePrimaryKey:{get:function(){return a.continuePrimaryKey}},key:{get:function(){return a.key}},primaryKey:{get:function(){return a.primaryKey}},start:{value:function(e){return a.start(function(){c=d("MAWDbMiddlewareMutations").getVaultedValue(a.value,b);try{a.value=c}catch(a){}e()})}},value:{get:function(){return c}}})}g.getMAWDbMutationMiddleware=a;g.getMAWVaultMiddleware=b}),98);
__d("MAWDbEncryptObjContent",["MAWKeychainNaClCrypto"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){return d("MAWKeychainNaClCrypto").encryptTweetNaClArrayBuffer(a,b,c)}g.encryptContent=a}),98);
__d("MAWXMACTAUtil",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b=a.actionUrl,c=a.buttonType,d=a.ctaType,e=a.nativeUrl;a=a.title;return{actionUrl:b,buttonType:c,ctaType:d,nativeUrl:e,title:a}}function b(a){var b=a.actionUrl,c=a.buttonType,d=a.ctaType,e=a.nativeUrl;a=a.title;return{actionUrl:b,buttonType:c,ctaType:d,nativeUrl:e,title:a}}f.toMAWCTAEncode=a;f.fromMAWCTAEncode=b}),66);
__d("WAServerSync.pb",["$InternalEnum","WAProtoConst"],(function(a,b,c,d,e,f,g){a=b("$InternalEnum")({SET:0,REMOVE:1});c={};e={};f={};b={};var h={},i={},j={},k={},l={},m={},n={};c.name="SyncdVersion";c.internalSpec={version:[1,(d=d("WAProtoConst")).TYPES.UINT64]};e.name="ExitCode";e.internalSpec={code:[1,d.TYPES.UINT64],text:[2,d.TYPES.STRING]};f.name="SyncdIndex";f.internalSpec={blob:[1,d.TYPES.BYTES]};b.name="SyncdValue";b.internalSpec={blob:[1,d.TYPES.BYTES]};h.name="KeyId";h.internalSpec={id:[1,d.TYPES.BYTES]};i.name="SyncdRecord";i.internalSpec={index:[1,d.TYPES.MESSAGE,f],value:[2,d.TYPES.MESSAGE,b],keyId:[3,d.TYPES.MESSAGE,h]};j.name="ExternalBlobReference";j.internalSpec={mediaKey:[1,d.TYPES.BYTES],directPath:[2,d.TYPES.STRING],handle:[3,d.TYPES.STRING],fileSizeBytes:[4,d.TYPES.UINT64],fileSha256:[5,d.TYPES.BYTES],fileEncSha256:[6,d.TYPES.BYTES]};k.name="SyncdSnapshot";k.internalSpec={version:[1,d.TYPES.MESSAGE,c],records:[2,d.FLAGS.REPEATED|d.TYPES.MESSAGE,i],mac:[3,d.TYPES.BYTES],keyId:[4,d.TYPES.MESSAGE,h]};l.name="SyncdMutations";l.internalSpec={mutations:[1,d.FLAGS.REPEATED|d.TYPES.MESSAGE,m]};m.name="SyncdMutation";m.internalSpec={operation:[1,d.TYPES.ENUM,a],record:[2,d.TYPES.MESSAGE,i]};n.name="SyncdPatch";n.internalSpec={version:[1,d.TYPES.MESSAGE,c],mutations:[2,d.FLAGS.REPEATED|d.TYPES.MESSAGE,m],externalMutations:[3,d.TYPES.MESSAGE,j],snapshotMac:[4,d.TYPES.BYTES],patchMac:[5,d.TYPES.BYTES],keyId:[6,d.TYPES.MESSAGE,h],exitCode:[7,d.TYPES.MESSAGE,e],deviceIndex:[8,d.TYPES.UINT32],clientDebugData:[9,d.TYPES.BYTES]};g.SyncdMutation$SyncdOperation=a;g.SyncdVersionSpec=c;g.ExitCodeSpec=e;g.SyncdIndexSpec=f;g.SyncdValueSpec=b;g.KeyIdSpec=h;g.SyncdRecordSpec=i;g.ExternalBlobReferenceSpec=j;g.SyncdSnapshotSpec=k;g.SyncdMutationsSpec=l;g.SyncdMutationSpec=m;g.SyncdPatchSpec=n}),98);
__d("MAWDbObjDecode",["FBLogger","MAWArmadilloAppDataTableSchema.pb","MAWArmadilloAppMetaTableSchema.pb","MAWArmadilloCollectionVersionsTableSchema.pb","MAWArmadilloDeletedMessagesTableSchema.pb","MAWArmadilloDeviceChangeAlertsTableSchema.pb","MAWArmadilloDyiBatchTableSchema.pb","MAWArmadilloEBMsgRangesTableSchema.pb","MAWArmadilloEditMsgHistoryTableSchema.pb","MAWArmadilloGroupInfoTableSchema.pb","MAWArmadilloGroupInvitesTableSchema.pb","MAWArmadilloMediaTablesSchema.pb","MAWArmadilloMessagesTableSchema.pb","MAWArmadilloMissingKeysTableSchema.pb","MAWArmadilloParticipantsTableSchema.pb","MAWArmadilloPendingMutationsTableSchema.pb","MAWArmadilloPersonalSenderKeyStatusTableSchema.pb","MAWArmadilloPollTableSchema.pb","MAWArmadilloReactionsTableSchema.pb","MAWArmadilloReceiptTablesSchema.pb","MAWArmadilloReceiverFetchInfoTableSchema.pb","MAWArmadilloSyncActionsTableSchema.pb","MAWArmadilloSyncKeysTableSchema.pb","MAWArmadilloTasksTableSchema.pb","MAWArmadilloThreadsTableSchema.pb","MAWArmadilloUnrenderedMessagesTableSchema.pb","MAWArmadilloXMATableSchema.pb","MAWMsgType","MAWODSProxy","MAWXMACTAUtil","WAOdsEnums","WAServerSync.pb","decodeProtobuf"],(function(a,b,c,d,e,f,g){var h={appData:function(a){return A(a)},appMeta:function(a){return B(a)},chunk:function(a){return C(a)},collectionVersions:function(a){return L(a)},deletedMessages:function(a){return n(a)},deviceChangeAlerts:function(a){return i(a)},dualSendMedia:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},dyiBatch:function(a){return G(a)},ebMessageRestoreTasks:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ebMsgRanges:function(a){return H(a)},ebRestoreQueue:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ebUploadQueue:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},editMsgHistory:function(a){return O(a)},encryptionMetaV3:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ephemeralSettings:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},existingUsers:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ftsBackloggedMessages:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ftsEncryptionMeta:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ftsIndexV3:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ftsPurgeBacklog:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ftsPurgeThreadBacklog:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},groupInfo:function(a){return q(a)},groupInvites:function(a){return x(a)},historySyncQRCodeData:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},historySyncQRCodeSecretKey:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},igMessageAuxiliaryInfo:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},isDualSend:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},media:function(a){return E(a)},mediaBackup:function(a){return D(a)},mediaKeys:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},messages:function(a){return m(a)},missingKeys:function(a){return J(a)},participants:function(a){return w(a)},pendingMessageStanzaQueue:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},pendingMutations:function(a){return K(a)},pendingReceipts:function(a){return u(a)},pendingStanzas:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},personalSenderKeyStatuses:function(a){return z(a)},poll:function(a){return Q(a)},reactions:function(a){return F(a)},receipts:function(a){return t(a)},receiverFetchInfo:function(a){return P(a)},sentBytesCache:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},staleQueue:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},syncActions:function(a){return I(a)},syncKeys:function(a){return M(a)},tasks:function(a){return y(a)},threads:function(a){return v(a)},unrenderedMessages:function(a){return o(a)},xma:function(a){return N(a)}};function a(a,b){if(Object.prototype.hasOwnProperty.call(h,b))b=h[b](a);else throw c("FBLogger")("messenger_web").mustfixThrow("not a valid table name");return b}function i(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloDeviceChangeAlertsTableSchema.pb").DeviceChangeAlertsTableSchemaProtoSpec,a);return{action:a.action,deviceJid:a.deviceJid,identity:a.identity,isArchived:a.isArchived,latitude:a.latitude,location:a.location,loggedOut:a.loggedOut,longitude:a.longitude,model:a.model,platform:a.platform,ts:a.ts}}function j(a){a=a.quote;var b;if(a!=null){if(a.content==null)throw c("FBLogger")("messenger_web").mustfixThrow("QuotedMsgContent missing upon decoding");var d=a.content,e=d.author,f=d.expirationTs,g=d.externalId,h=d.mediaId,i=d.msgContent,j=d.msgId,k=d.plaintextHash,l=d.sourceId,m=d.specialTextSize,n=d.ts,o=d.type;d=d.xmaMessageType;b={content:babelHelpers["extends"]({},a.content,{author:e,expirationTs:f,externalId:g,mediaId:h,msgContent:i,msgId:j,plaintextHash:k,sourceId:l,specialTextSize:m,ts:n,type:o,xmaMessageType:d}),remoteJid:a.remoteJid}}return b}function k(a){if(a==null)return a;else return new Uint8Array(a)}function l(a){if(a==null||a.length===0)return new Set();else return new Set(a)}function m(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloMessagesTableSchema.pb").MessagesTableSchemaProtoSpec,a);var b=a.msgContent;if(a.type===d("MAWMsgType").MSG_TYPE.FUTUREPROOF){if(b==null)throw c("FBLogger")("messenger_web").mustfixThrow("MsgContent missing upon decoding futureproof message");b.subtype=b.subtype}var e=j(a),f=p(a.reportingMeta);return babelHelpers["extends"]({},a,{msgContent:b,quote:e,reportingMeta:f})}function n(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloDeletedMessagesTableSchema.pb").DeletedMessagesTableSchemaProtoSpec,a);return babelHelpers["extends"]({},a)}function o(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloUnrenderedMessagesTableSchema.pb").UnrenderedMessagesTableSchemaProtoSpec,a);var b=j(a),c=p(a.reportingMeta);return babelHelpers["extends"]({},a,{quote:b,reportingMeta:c})}function p(a){if(a==null)return;return{frankingKey:a.frankingKey!=null?new Uint8Array(a.frankingKey):a.frankingKey,frankingTag:a.frankingTag!=null?new Uint8Array(a.frankingTag):a.frankingTag,frankingVersion:a.frankingVersion,reportingContent:a.reportingContent,reportingTag:a.reportingTag!=null?new Uint8Array(a.reportingTag):a.reportingTag}}function q(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloGroupInfoTableSchema.pb").GroupInfoSchemaProtoSpec,a);return{creationTs:a.creationTs,creator:a.creator,inviter:a.inviter,memberAddMode:a.memberAddMode,msgExpiration:a.msgExpiration,name:a.name,nameOwner:a.nameOwner,nameTs:a.nameTs,participantVersion:a.participantVersion}}function r(a){if(a.length===0)return null;else return new Map(a.map(function(a){var b=a.deviceJid;if(b==null||a.serializedPubKey==null)throw c("FBLogger")("messenger_web").mustfixThrow("Expected deviceJid or serializedPubKey are missing ");var d=new Uint8Array(a.serializedPubKey);a=k(a.baseKey);a={baseKey:a,pubKey:d};return[b,a]}))}function s(a){if(a==null)return null;else return new Map(a.map(function(a){if(a.deviceJid==null)throw c("FBLogger")("messenger_web").mustfixThrow("Expected deviceJID is missing ");return[a.deviceJid,(a=a.count)!=null?a:0]}))}function t(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloReceiptTablesSchema.pb").ReceiptsTableSchemaProtoSpec,a);var b=a.recipientDevices;b=l(b);return{permittedIdentitiesPerDevice:r(a.permittedIdentitiesPerDevice),recipientDevices:b,retryCountsPerDevice:s(a.retryCountsPerDevice)}}function u(a){return d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloReceiptTablesSchema.pb").PendingReceiptsTableSchemaProtoSpec,a)}function v(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloThreadsTableSchema.pb").ThreadsTableSchemaProtoSpec,a);return{archived:a.archived,cannotReplyReason:a.cannotReplyReason,didInsertDualThreadCutoverAdminMsg:a.didInsertDualThreadCutoverAdminMsg,folder:a.folder,isMigratedLocally:a.isMigratedLocally,lastReadMsg:a.lastReadMsg,lastReadMsgReceiptSent:a.lastReadMsgReceiptSent,muteCallsExpireTimeMs:a.muteCallsExpireTimeMs,muteExpireTimeMs:a.muteExpireTimeMs,newestMsg:a.newestMsg,newestMsgTs:a.newestMsgTs,oldestMsg:a.oldestMsg,optimisticThreadKey:a.optimisticThreadKey,snippetMsg:a.snippetMsg,snippetMsgTs:a.snippetMsgTs}}function w(a){return d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloParticipantsTableSchema.pb").ParticipantsTableSchemaProtoSpec,a)}function x(a){return d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloGroupInvitesTableSchema.pb").GroupInvitesTableSchemaProtoSpec,a)}function y(a){return d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloTasksTableSchema.pb").TasksTableSchemaProtoSpec,a)}function z(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloPersonalSenderKeyStatusTableSchema.pb").PersonalSenderKeyStatusTableSchemaProtoSpec,a);var b=a.hasSenderKey;b=l(b);return{hasSenderKey:b,rotateSenderKey:a.rotateSenderKey,senderKeyId:a.senderKeyId,senderKeyTs:a.senderKeyTs}}function A(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloAppDataTableSchema.pb").AppDataTableSchemaProtoSpec,a);return{ack:a.ack,contents:a.contents,permittedIdentitiesPerDevice:r(a.permittedIdentitiesPerDevice),recipientDevices:new Set(a.recipientDevices),sendPartial:a.sendPartial,ts:a.ts}}function B(a){return d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloAppMetaTableSchema.pb").AppMetaTableSchemaProtoSpec,a)}function C(a){return d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloMediaTablesSchema.pb").ChunkTableSchemaProtoSpec,a)}function D(a){return d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloMediaTablesSchema.pb").MediaBackupSchemaProtoSpec,a)}function E(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloMediaTablesSchema.pb").MediaTableSchemaProtoSpec,a);var b,e=a.mediaEntries;e==null?b=new Map():b=new Map(e.map(function(a){if(a.msgId==null||a.mediaEntryData==null)throw c("FBLogger")("messenger_web").mustfixThrow("Expected msgId or mediaEntryData are missing ");return[a.msgId,new Uint8Array(a.mediaEntryData)]}));return{accessibilitySummaryText:a.accessibilitySummaryText,mediaEntries:b,mediaType:a.mediaType,plaintextHash:a.plaintextHash,size:a.size,ts:a.ts,validatedAudioInfo:a.validatedAudioInfo,validatedDocumentFileInfo:a.validatedDocumentFileInfo,validatedImageInfo:a.validatedImageInfo,validatedResult:a.validatedResult,validatedVideoInfo:a.validatedVideoInfo}}function F(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloReactionsTableSchema.pb").ReactionsTableSchemaProtoSpec,a);a.ts!=null&&d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_MIGRATE_REACTION_TS_AS_INDEX,key:"reaction_ts_encrypted"});return babelHelpers["extends"]({ack:a.ack,author:a.author,groupingKey:a.groupingKey,reaction:a.reaction,reactToAuthor:a.reactToAuthor,senderTimestampMs:a.senderTimestampMs},a.ts!=null?{ts:a.ts}:{})}function G(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloDyiBatchTableSchema.pb").DyiBatchTableSchemaProtoSpec,a);return{isThread:a.isThread,numMessages:a.numMessages,numMessagesRestored:a.numMessagesRestored,numThreadsRestored:a.numThreadsRestored,oldestTs:a.oldestTs,qplFlowDescriptor:a.qplFlowDescriptor,qplInstanceKeyE2E:a.qplInstanceKeyE2E,qplInstanceKeyForThread:a.qplInstanceKeyForThread,threadId:a.threadId}}function H(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloEBMsgRangesTableSchema.pb").EBMsgRangesTableSchemaProtoSpec,a);return{creationTime:a.creationTime,maxMsgExternalId:a.maxMsgExternalId,maxMsgSortOrderMs:a.maxMsgSortOrderMs,minMsgExternalId:a.minMsgExternalId,minMsgSortOrderMs:a.minMsgSortOrderMs}}function I(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloSyncActionsTableSchema.pb").SyncActionsTableSchemaProtoSpec,a);return{binarySyncData:a.binarySyncData,keyId:a.keyId,timestamp:a.timestamp,valueMac:a.valueMac,version:a.version}}function J(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloMissingKeysTableSchema.pb").MissingKeysTableSchemaProtoSpec,a);var b;a.deviceResponses==null?b=new Map():b=new Map(a.deviceResponses.map(function(a){if(a.deviceId==null)throw c("FBLogger")("messenger_web").mustfixThrow("Expected deviceId is missing");else return[a.deviceId,a.deviceResponse]}));return{deviceResponses:b,keyId:a.keyId,timestamp:a.timestamp}}function K(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloPendingMutationsTableSchema.pb").PendingMutationsTableSchemaProtoSpec,a);var b;switch(a.operation){case d("MAWArmadilloPendingMutationsTableSchema.pb").SYNCD_MUTATION_SYNCD_OPERATION.SET:b=d("WAServerSync.pb").SyncdMutation$SyncdOperation.SET;break;case d("MAWArmadilloPendingMutationsTableSchema.pb").SYNCD_MUTATION_SYNCD_OPERATION.REMOVE:b=d("WAServerSync.pb").SyncdMutation$SyncdOperation.REMOVE;break;default:throw c("FBLogger")("messenger_web").mustfixThrow("operation missing when decoding PendingMutation")}return{binarySyncAction:a.binarySyncAction,operation:b,timestamp:a.timestamp,version:a.version}}function L(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloCollectionVersionsTableSchema.pb").CollectionVersionsTableSchemaProtoSpec,a);return{finiteFailureStartTime:a.finiteFailureStartTime,isCollectionInMacMismatchFatal:a.isCollectionInMacMismatchFatal,isCollectionLthashInconsistent:a.isCollectionLthashInconsistent,ltHash:a.ltHash,state:a.state,version:a.version}}function M(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloSyncKeysTableSchema.pb").SyncKeysTableSchemaProtoSpec,a);return{fingerprint:a.fingerprint,keyData:a.keyData,timestamp:a.timestamp}}function N(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloXMATableSchema.pb").XMATableSchemaProtoSpec,a);return{author:a.author,ctas:a.ctas.map(function(a){return d("MAWXMACTAUtil").fromMAWCTAEncode(a)}),defaultCTA:a.defaultCTA==null?a.defaultCTA:d("MAWXMACTAUtil").fromMAWCTAEncode(a.defaultCTA),defaultPreviewMediaPlaintextHash:a.defaultPreviewMediaPlaintextHash,faviconPlaintextHash:a.faviconPlaintextHash,headerMediaPlaintextHash:a.headerMediaPlaintextHash,headerTitle:a.headerTitle,isTombstoned:a.isTombstoned,maxSubtitleNumOfLines:a.maxSubtitleNumOfLines,maxTitleNumOfLines:a.maxTitleNumOfLines,msgId:a.msgId,overlayDescription:a.overlayDescription,overlayIconGlyph:a.overlayIconGlyph,overlayTitle:a.overlayTitle,previewMediaIds:a.previewMediaIds,subtitleText:a.subtitleText,targetId:a.targetId,targetType:a.targetType,targetUsername:a.targetUsername,threadJid:a.threadJid,titleText:a.titleText,xmaLayoutType:a.xmaLayoutType}}function O(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloEditMsgHistoryTableSchema.pb").EditMsgHistoryTableSchemaProtoSpec,a);return{author:a.author,editExternalId:a.editExternalId,editTs:a.editTs,msgContent:a.msgContent,sendStatus:a.sendStatus,specialTextSize:a.specialTextSize}}function P(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloReceiverFetchInfoTableSchema.pb").ReceiverFetchInfoTableSchemaProtoSpec,a);return{accessibilitySummaryText:a.accessibilitySummaryText,mimetype:a.mimetype,previewHeight:a.previewHeight,previewUrl:a.previewUrl,previewUrlExpirationTimestampMs:a.previewUrlExpirationTimestampMs,previewWidth:a.previewWidth,type:a.type}}function Q(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloPollTableSchema.pb").PollTableSchemaProtoSpec,a);var b=new Map(a.pollOptions.map(function(a){var b=a.pollOptionHash;if(b==null||a.pollOption==null)throw c("FBLogger")("messenger_web").mustfixThrow("Expected pollOptionHash or pollOption is missing");return[b,{optionText:a.pollOption.optionText,voteAuthors:new Set(a.pollOption.voteAuthors)}]}).filter(Boolean)),e=new Map(a.latestSenderTimestampsMs.map(function(a){if(a.author==null||a.latestSenderTimestampMs==null)throw c("FBLogger")("messenger_web").mustfixThrow("Expected author or latestSenderTimestampMs are missing");return[a.author,a.latestSenderTimestampMs]}));return{encKey:a.encKey,latestSenderTimestampsMs:e,pollAuthor:a.pollAuthor,pollOptions:b,pollParticipantCount:a.pollParticipantCount,pollState:a.pollState,selectableOptionsCount:a.selectableOptionsCount,title:a.title}}g.decodeDbObj=a}),98);
__d("WASyncdKeyTypes",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}function b(a){return a}function c(a){return a}function d(a){return a}f.toSyncKeyId=a;f.fromSyncKeyId=b;f.toSyncKeyData=c;f.fromSyncKeyData=d}),66);
__d("MAWDbObjEncode",["FBLogger","MAWArmadilloAppDataTableSchema.pb","MAWArmadilloAppMetaTableSchema.pb","MAWArmadilloDeletedMessagesTableSchema.pb","MAWArmadilloDeviceChangeAlertsTableSchema.pb","MAWArmadilloDyiBatchTableSchema.pb","MAWArmadilloEBMsgRangesTableSchema.pb","MAWArmadilloEditMsgHistoryTableSchema.pb","MAWArmadilloGroupInfoTableSchema.pb","MAWArmadilloGroupInvitesTableSchema.pb","MAWArmadilloMediaTablesSchema.pb","MAWArmadilloMessagesTableSchema.pb","MAWArmadilloParticipantsTableSchema.pb","MAWArmadilloPersonalSenderKeyStatusTableSchema.pb","MAWArmadilloPollTableSchema.pb","MAWArmadilloReactionsTableSchema.pb","MAWArmadilloReceiptTablesSchema.pb","MAWArmadilloReceiverFetchInfoTableSchema.pb","MAWArmadilloTasksTableSchema.pb","MAWArmadilloThreadsTableSchema.pb","MAWArmadilloUnrenderedMessagesTableSchema.pb","MAWArmadilloXMATableSchema.pb","MAWMsgType","MAWXMACTAUtil","WASyncdKeyTypes","encodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";var h=["ack","altIndex","collapsibleId","externalId","messageDeleteTs","messageExpirationTs","msgId","pollStanzaId","protocolMsgId","quoteExpirationTs","quoteExternalId","revokedExternalId","rowId","serverTs","sortOrderMs","threadJid","unsendMsgContentDeleteTs"],i=["author","chat","externalId","rowId"],j={appData:w,appMeta:x,chunk:y,deletedMessages:k,deviceChangeAlerts:a,dualSendMedia:b,dyiBatch:C,ebMessageRestoreTasks:b,ebMsgRanges:D,ebRestoreQueue:b,ebUploadQueue:b,editMsgHistory:F,encryptionMetaV3:b,ephemeralSettings:b,existingUsers:b,ftsBackloggedMessages:b,ftsEncryptionMeta:b,ftsIndexV3:b,ftsPurgeBacklog:b,ftsPurgeThreadBacklog:b,groupInfo:m,groupInvites:t,historySyncQRCodeData:b,historySyncQRCodeSecretKey:b,igMessageAuxiliaryInfo:b,isDualSend:b,media:A,mediaBackup:z,mediaKeys:b,messages:f,participants:s,pendingMessageStanzaQueue:b,pendingReceipts:q,pendingStanzas:b,personalSenderKeyStatuses:v,poll:H,reactions:B,receipts:p,receiverFetchInfo:G,sentBytesCache:b,staleQueue:b,tasks:u,threads:r,unrenderedMessages:l,xma:E};function a(a){a={action:a.action,deviceJid:a.deviceJid,identity:a.identity,isArchived:a.isArchived,latitude:a.latitude,location:a.location,loggedOut:a.loggedOut,longitude:a.longitude,model:a.model,platform:a.platform,ts:a.ts};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloDeviceChangeAlertsTableSchema.pb").DeviceChangeAlertsTableSchemaProtoSpec,a).readByteArrayView()}}function b(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for encryption")}function e(a,b){if(Object.prototype.hasOwnProperty.call(j,b))b=j[b](a);else throw c("FBLogger")("messenger_web").mustfixThrow("not a valid table name");return b}function f(a){a.ack;a.altIndex;a.collapsibleId;a.externalId;a.messageDeleteTs;a.messageExpirationTs;a.msgId;a.pollStanzaId;a.protocolMsgId;a.quoteExpirationTs;a.quoteExternalId;a.revokedExternalId;a.rowId;a.serverTs;a.sortOrderMs;a.threadJid;a.unsendMsgContentDeleteTs;a=babelHelpers.objectWithoutPropertiesLoose(a,h);a=a;var b;if(a.quote==null)b=a.quote;else{var c;c={author:a.quote.content.author,expirationTs:a.quote.content.expirationTs,externalId:(c=a.quote)==null?void 0:c.content.externalId,mediaId:a.quote.content.mediaId,msgContent:a.quote.content.msgContent,msgId:a.quote.content.msgId,plaintextHash:a.quote.content.plaintextHash,sourceId:a.quote.content.sourceId,specialTextSize:a.quote.content.specialTextSize,ts:a.quote.content.ts,type:a.quote.content.type,xmaMessageType:a.quote.content.xmaMessageType};c={content:c,remoteJid:a.quote.remoteJid};b=c}c=a.msgContent;a.type===d("MAWMsgType").MSG_TYPE.FUTUREPROOF&&(c={protobuf:a.msgContent.protobuf,subtype:a.msgContent.subtype});var e=a.ravenEphemeralType,f=a.ravenEphemeralMediaState;e=e!=null?e:null;f=f!=null?f:null;c={applicationErrorCode:a.applicationErrorCode,author:a.author,editCount:a.editCount,ephemeralCounterStarted:a.ephemeralCounterStarted,ephemeralMsgDisappeared:a.ephemeralMsgDisappeared,ephemeralSetting:a.ephemeralSetting,forwardingScore:a.forwardingScore,groupId:a.groupId,groupIndex:a.groupIndex,groupSize:a.groupSize,hdType:a.hdType,isCollapsed:a.isCollapsed,isExpiredXmaMsg:a.isExpiredXmaMsg,isForwarded:a.isForwarded,mediaId:a.mediaId,msgContent:c,originalTs:a.originalTs,quote:b,ravenEphemeralMediaState:f,ravenEphemeralType:e,receiverFetchId:a.receiverFetchId,reportingMeta:a.reportingMeta,resendCount:a.resendCount,source:a.source,specialTextSize:a.specialTextSize,ts:a.ts,type:a.type,xmaMessageType:a.xmaMessageType};return{encodedFields:c,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloMessagesTableSchema.pb").MessagesTableSchemaProtoSpec,c).readByteArrayView()}}function k(a){a.author;a.chat;a.externalId;a.rowId;a=babelHelpers.objectWithoutPropertiesLoose(a,i);a={reason:String(a.reason)};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloDeletedMessagesTableSchema.pb").DeletedMessagesTableSchemaProtoSpec,a).readByteArrayView()}}function l(a){var b;if(a.quote==null)b=a.quote;else{var c;c={author:a.quote.content.author,expirationTs:a.quote.content.expirationTs,externalId:(c=a.quote)==null?void 0:c.content.externalId,mediaId:a.quote.content.mediaId,msgContent:a.quote.content.msgContent,msgId:a.quote.content.msgId,plaintextHash:a.quote.content.plaintextHash,sourceId:a.quote.content.sourceId,ts:a.quote.content.ts,type:a.quote.content.type,xmaMessageType:a.quote.content.xmaMessageType};c={content:c,remoteJid:a.quote.remoteJid};b=c}c={ack:a.ack,author:a.author,ephemeralSetting:a.ephemeralSetting,groupName:a.groupName,invitedParticipantUserJid:a.invitedParticipantUserJid,mediaId:a.mediaId,msgContent:a.msgContent,quote:b,reportingMeta:a.reportingMeta,resendCount:a.resendCount,ts:a.ts,type:a.type,xmaMessageType:a.xmaMessageType};return{encodedFields:c,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloUnrenderedMessagesTableSchema.pb").UnrenderedMessagesTableSchemaProtoSpec,c).readByteArrayView()}}function m(a){a={creationTs:a.creationTs,creator:a.creator,inviter:a.inviter,memberAddMode:a.memberAddMode,msgExpiration:a.msgExpiration,name:a.name,nameOwner:a.nameOwner,nameTs:a.nameTs,participantVersion:a.participantVersion};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloGroupInfoTableSchema.pb").GroupInfoSchemaProtoSpec,a).readByteArrayView()}}function n(a){if(a==null)return a;else return Array.from(a,function(a){var b=a[0];a=a[1];return{baseKey:a.baseKey,deviceJid:b,serializedPubKey:a.pubKey}})}function o(a){if(a==null)return null;else return Array.from(a,function(a){var b=a[0];a=a[1];return{count:a,deviceJid:b}})}function p(a){var b=Array.from(a.recipientDevices);b={permittedIdentitiesPerDevice:n(a.permittedIdentitiesPerDevice),recipientDevices:b,retryCountsPerDevice:o(a.retryCountsPerDevice)};return{encodedFields:b,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloReceiptTablesSchema.pb").ReceiptsTableSchemaProtoSpec,b).readByteArrayView()}}function q(a){a={author:a.author,deliveryReceipts:a.deliveryReceipts,externalId:a.externalId,readReceipts:a.readReceipts,thread:a.thread};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloReceiptTablesSchema.pb").PendingReceiptsTableSchemaProtoSpec,a).readByteArrayView()}}function r(a){a={archived:a.archived,cannotReplyReason:a.cannotReplyReason,didInsertDualThreadCutoverAdminMsg:a.didInsertDualThreadCutoverAdminMsg,folder:a.folder,isMigratedLocally:a.isMigratedLocally,lastReadMsg:a.lastReadMsg,lastReadMsgReceiptSent:a.lastReadMsgReceiptSent,newestMsgTs:a.newestMsgTs,oldestMsg:a.oldestMsg,optimisticThreadKey:a.optimisticThreadKey,snippetMsg:a.snippetMsg,snippetMsgTs:a.snippetMsgTs};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloThreadsTableSchema.pb").ThreadsTableSchemaProtoSpec,a).readByteArrayView()}}function s(a){a={addressable:a.addressable,deliveredWatermarkTs:a.deliveredWatermarkTs,lastReadActionTs:a.lastReadActionTs,lastReadWatermarkTs:a.lastReadWatermarkTs,type:a.type};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloParticipantsTableSchema.pb").ParticipantsTableSchemaProtoSpec,a).readByteArrayView()}}function t(a){a={caption:a.caption,inviteCode:a.inviteCode,inviteExpirationTs:a.inviteExpirationTs};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloGroupInvitesTableSchema.pb").GroupInvitesTableSchemaProtoSpec,a).readByteArrayView()}}function u(a){a={scheduledTime:a.scheduledTime};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloTasksTableSchema.pb").TasksTableSchemaProtoSpec,a).readByteArrayView()}}function v(a){var b=Array.from(a.hasSenderKey);b={hasSenderKey:b,rotateSenderKey:a.rotateSenderKey,senderKeyId:a.senderKeyId,senderKeyTs:a.senderKeyTs};return{encodedFields:b,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloPersonalSenderKeyStatusTableSchema.pb").PersonalSenderKeyStatusTableSchemaProtoSpec,b).readByteArrayView()}}function w(a){var b;switch(a.contents.type){case"meta_sync":var e=[];for(var f of a.contents.actions)f.chatAction?e.push({chatAction:f.chatAction}):f.messageAction&&e.push({messageAction:f.messageAction});b={actions:e,type:"meta_sync"};break;case"backups_secrets":b={encryptedBackupsSecrets:a.contents.encryptedBackupsSecrets,type:"backups_secrets"};break;case"sync_key_share":b={syncKeyShare:{keys:a.contents.syncKeyShare.keys,orphanKeys:(f=a.contents.syncKeyShare)==null||(f=f.orphanKeys)==null?void 0:f.map(d("WASyncdKeyTypes").fromSyncKeyId)},type:"sync_key_share"};break;case"sync_key_request":b={syncKeyRequest:{keyIds:a.contents.syncKeyRequest.keyIds.map(d("WASyncdKeyTypes").fromSyncKeyId)},type:"sync_key_request"};break;default:a.contents.type;throw c("FBLogger")("messenger_web").mustfixThrow("Unknown appdata type: "+a.contents.type)}e={ack:a.ack,contents:b,permittedIdentitiesPerDevice:n(a.permittedIdentitiesPerDevice),recipientDevices:Array.from(a.recipientDevices),sendPartial:a.sendPartial,ts:a.ts};return{encodedFields:e,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloAppDataTableSchema.pb").AppDataTableSchemaProtoSpec,e).readByteArrayView()}}function x(a){a={value:a.value};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloAppMetaTableSchema.pb").AppMetaTableSchemaProtoSpec,a).readByteArrayView()}}function y(a){a={blobData:a.blobData,mimetype:a.mimetype,plaintextHash:a.plaintextHash};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloMediaTablesSchema.pb").ChunkTableSchemaProtoSpec,a).readByteArrayView()}}function z(a){a={fbid:a.fbid};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloMediaTablesSchema.pb").MediaBackupSchemaProtoSpec,a).readByteArrayView()}}function A(a){var b=Array.from(a.mediaEntries,function(a){var b=a[0];a=a[1];return{mediaEntryData:a,msgId:b}});b={accessibilitySummaryText:a.accessibilitySummaryText,mediaEntries:b,mediaType:a.mediaType,plaintextHash:a.plaintextHash,size:a.size,ts:a.ts,validatedAudioInfo:a.validatedAudioInfo,validatedDocumentFileInfo:a.validatedDocumentFileInfo,validatedImageInfo:a.validatedImageInfo,validatedResult:a.validatedResult,validatedVideoInfo:a.validatedVideoInfo};return{encodedFields:b,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloMediaTablesSchema.pb").MediaTableSchemaProtoSpec,b).readByteArrayView()}}function B(a){a={ack:a.ack,author:a.author,groupingKey:a.groupingKey,reaction:a.reaction,reactToAuthor:a.reactToAuthor,senderTimestampMs:a.senderTimestampMs};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloReactionsTableSchema.pb").ReactionsTableSchemaProtoSpec,a).readByteArrayView()}}function C(a){a={isThread:a.isThread,numMessages:a.numMessages,numMessagesRestored:a.numMessagesRestored,numThreadsRestored:a.numThreadsRestored,oldestTs:a.oldestTs,qplFlowDescriptor:a.qplFlowDescriptor,qplInstanceKeyE2E:a.qplInstanceKeyE2E,qplInstanceKeyForThread:a.qplInstanceKeyForThread,threadId:a.threadId};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloDyiBatchTableSchema.pb").DyiBatchTableSchemaProtoSpec,a).readByteArrayView()}}function D(a){a={creationTime:a.creationTime,maxMsgExternalId:a.maxMsgExternalId,maxMsgSortOrderMs:a.maxMsgSortOrderMs,minMsgExternalId:a.minMsgExternalId,minMsgSortOrderMs:a.minMsgSortOrderMs};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloEBMsgRangesTableSchema.pb").EBMsgRangesTableSchemaProtoSpec,a).readByteArrayView()}}function E(a){var b=a.ctas==null?[]:a.ctas.map(function(a){return d("MAWXMACTAUtil").toMAWCTAEncode(a)});b={author:a.author,ctas:b,defaultCTA:a.defaultCTA==null?a.defaultCTA:d("MAWXMACTAUtil").toMAWCTAEncode(a.defaultCTA),defaultPreviewMediaPlaintextHash:a.defaultPreviewMediaPlaintextHash,faviconPlaintextHash:a.faviconPlaintextHash,headerMediaPlaintextHash:a.headerMediaPlaintextHash,headerTitle:a.headerTitle,isTombstoned:a.isTombstoned,maxSubtitleNumOfLines:a.maxSubtitleNumOfLines,maxTitleNumOfLines:a.maxTitleNumOfLines,msgId:a.msgId,overlayDescription:a.overlayDescription,overlayIconGlyph:a.overlayIconGlyph,overlayTitle:a.overlayTitle,previewMediaIds:a.previewMediaIds,subtitleText:a.subtitleText,targetId:a.targetId,targetType:a.targetType,targetUsername:a.targetUsername,threadJid:a.threadJid,titleText:a.titleText,xmaLayoutType:a.xmaLayoutType};return{encodedFields:b,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloXMATableSchema.pb").XMATableSchemaProtoSpec,b).readByteArrayView()}}function F(a){a={author:a.author,editExternalId:a.editExternalId,editTs:a.editTs,msgContent:a.msgContent,sendStatus:a.sendStatus,specialTextSize:a.specialTextSize};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloEditMsgHistoryTableSchema.pb").EditMsgHistoryTableSchemaProtoSpec,a).readByteArrayView()}}function G(a){a={accessibilitySummaryText:a.accessibilitySummaryText,mimetype:a.mimetype,previewHeight:a.previewHeight,previewUrl:a.previewUrl,previewUrlExpirationTimestampMs:a.previewUrlExpirationTimestampMs,previewWidth:a.previewWidth,type:a.type};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloReceiverFetchInfoTableSchema.pb").ReceiverFetchInfoTableSchemaProtoSpec,a).readByteArrayView()}}function H(a){var b=Array.from(a.pollOptions,function(a){var b=a[0];a=a[1];return{pollOption:{optionText:a.optionText,voteAuthors:Array.from(a.voteAuthors)},pollOptionHash:b}}),c=Array.from(a.latestSenderTimestampsMs,function(a){var b=a[0];a=a[1];return{author:b,latestSenderTimestampMs:a}});c={encKey:a.encKey,latestSenderTimestampsMs:c,pollAuthor:a.pollAuthor,pollOptions:b,pollParticipantCount:a.pollParticipantCount,pollState:a.pollState,selectableOptionsCount:a.selectableOptionsCount,title:a.title};return{encodedFields:c,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloPollTableSchema.pb").PollTableSchemaProtoSpec,c).readByteArrayView()}}g.encodeDbObj=e;g.encodeDbPollForEncryption=H}),98);
__d("MAWDbObjEncryption",["ExecutionEnvironment","FBLogger","MAWBridge","MAWCryptoConsts","MAWDbEncryptObjContent","MAWDbObjDecode","MAWDbObjEncode","MAWDexieTable","MAWIndexedDb","MAWKeychainCrypto","MAWKeychainNaClCrypto","MAWKeychainUtil","MAWQplProxy","MAWUnrecoverableDbErrors","MWEARKeychainV3","MWEARKeychainV3Errors","ODS","WABase64","WATimeUtils","getErrorSafe","gkx","isEncryptionAtRestEnabled","justknobx","pageID","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j="_encryptedContent",k=new Set(["threads","messages","participants"]);function a(a,b,e){if(!(c("isEncryptionAtRestEnabled")()||c("gkx")("23910")===!0)||!d("MAWIndexedDb").TABLES_TO_ENCRYPT.includes(b))return a;var f=d("MAWQplProxy").startQplUserFlow(c("qpl")._(25300256,"115"),{bool:{isWorker:(i||(i=c("ExecutionEnvironment"))).isInWorker,useMawEar:d("MWEARKeychainV3").isKeychainSettled("maw_ear")},string:{pageID:c("pageID"),tableName:b}});try{var g=babelHelpers["extends"]({},a);e=e(d("MWEARKeychainV3").isKeychainSettled("maw_ear")?"maw_ear":"global_ear");var h=e.keys;h=h[0];var l=e.version;e=e.randomisedVersion;d("MWEARKeychainV3").isKeychainSettled("maw_ear")===!1&&c("FBLogger")("messenger_web").mustfix("[EAR] Encrypting %s data with global ear. Transactor: %s",b,d("MAWDexieTable").getDexiePSDItem("transactorName"));f.addAnnotations({"int":{keyVersion:l,randomisedVersion:e}});var m=d("MAWKeychainUtil").makeAAD(l,d("MAWCryptoConsts").CIPHER_ID),n=d("MAWDbObjEncode").encodeDbObj(a,b),o=n.encodedFields;n=n.proto;Object.keys(o).forEach(function(b){Object.prototype.hasOwnProperty.call(a,b)&&delete g[b]});o=d("MAWDbEncryptObjContent").encryptContent(h,n,m);g[j]=o;k.has(b)&&(g.updatedAt_S456130=Date.now(),g.randomisedVersion_S456130=e,g.encryptedWith_S456130=d("MWEARKeychainV3").isKeychainSettled("maw_ear")?"maw_ear":"global_ear",g.keyVersion_S456130=l);f==null||f.endSuccess();return g}catch(a){f==null||f.endFail("ear_encrypt_fail");throw c("FBLogger")("messenger_web").catching(a).mustfixThrow("[%s] %s - Encrypted dexie was unable to encrypt an entity for table %s",a.name,a.message,b)}}function b(a,b,e){if(!d("MAWIndexedDb").TABLES_TO_ENCRYPT.includes(b)||!Object.prototype.hasOwnProperty.call(a,j))return a;var f=(i||(i=c("ExecutionEnvironment"))).isInMainThread&&c("justknobx")._("3378")?null:d("MAWQplProxy").startQplUserFlow(c("qpl")._(25313004,"118"));f==null||f.addAnnotations({bool:{isWorker:(i||(i=c("ExecutionEnvironment"))).isInWorker,useMawEar:d("MWEARKeychainV3").isKeychainSettled("maw_ear")},string:{pageID:c("pageID"),tableName:b}});var g;try{var n=a[j],o=babelHelpers["extends"]({},a);(h||(h=d("ODS"))).bumpEntityKey(3185,"maw_db_ear_decryption","encrypted_content_type."+b+"."+(n instanceof ArrayBuffer?"ArrayBuffer":"string"));n=n instanceof ArrayBuffer?n:d("WABase64").decodeB64(n);var p=d("MAWKeychainCrypto").getKeyVersionFromCipherDataString(n),q=p.aadLengthInBytes;p=p.keyVersion;e=e(d("MWEARKeychainV3").isKeychainSettled("maw_ear")?"maw_ear":"global_ear",p);g=e;var r=e.dbEntry,s=e.keys;e=e.randomisedVersion;f==null||f.addAnnotations({"int":{contentVersion:a==null?void 0:a.keyVersion_S456130,keyVersion:p,randomisedVersion:e},string:{encryptedWith:a==null?void 0:a.encryptedWith_S456130,randomisedVersionEncryption:a==null?void 0:a.randomisedVersion_S456130}});var t={},u,v;for(e of s)try{u=d("MAWKeychainNaClCrypto").decryptArrayBuffer(e,n,p,r.formatVersion,q);break}catch(a){v=a}if(u==null)throw c("getErrorSafe")(v);var w=d("MAWDbObjDecode").decodeDbObj(u,b);Object.keys(w).forEach(function(a){t[a]=w[a]});delete o[j];s=babelHelpers["extends"]({},o,t);f==null||f.endSuccess();return s}catch(h){if(k.has(b)){f==null||f.addAnnotations({"int":{updatedAt:(q=a==null?void 0:a.updatedAt_S456130)!=null?q:-1}})}c("justknobx")._("3208")&&(i||(i=c("ExecutionEnvironment"))).isInWorker&&(h instanceof d("MAWKeychainNaClCrypto").EARDecryptionError||h instanceof d("MWEARKeychainV3Errors").EARKeychainNotFoundError)&&(f==null||f.addAnnotations({bool:{unrecoverableDbError:!0}}),d("MAWBridge").getBridge().fireAndForget("event","unrecoverableDbError",{error:new(d("MAWUnrecoverableDbErrors").EarRuntimeError)()}));f==null||f.markError("ear_decrypt_exception",null,h);f==null||f.endFail("ear_decrypt_fail");throw c("FBLogger")("messenger_web").catching(h).mustfixThrow("[%s] %s - (v2) Encrypted dexie was unable to decrypt an entity for table %s. UpdatedAt: %s. KeyStatus: %s. Signature matches: %s. Key source: %s. Using MAW EAR: %s. Worker: %s. Encrypted With: %s. PageID: %s. Source: %s",h.name,h.message,b,l(a==null?void 0:a.updatedAt_S456130),m(a,g),(a==null?void 0:a.randomisedVersion_S456130)!=null&&((r=g)==null?void 0:r.randomisedVersion)!=null?a.randomisedVersion_S456130===g.randomisedVersion:null,(e=(n=g)==null?void 0:n.dbEntry.source)!=null?e:"-1",d("MWEARKeychainV3").isKeychainSettled("maw_ear"),(i||(i=c("ExecutionEnvironment"))).isInWorker,a==null?void 0:a.encryptedWith_S456130,c("pageID"),d("MAWDexieTable").getDexiePSDItem("transactorName"))}}function l(a){if(a==null)return"unknown";a=Date.now()-a;a=Math.floor(a/(1e3*60*60*24));if(a<1)return"0-1 days";else if(a<7)return"1-7 days";else if(a<14)return"7-14 days";else if(a<30)return"14-30 days";else return"30+ days"}function m(a,b){if((a==null?void 0:a.updatedAt_S456130)==null||b==null)return null;a=d("WATimeUtils").castToUnixTime(a.updatedAt_S456130/1e3);b=b.dbEntry.expiration-d("MAWCryptoConsts").ENC_KEY_TTL;if(a===b)return"same";else if(a>b)return"key_older";else return"key_newer"}g.ENCRYPTED_COLUMN_NAME=j;g.encryptDbObj=a;g.decryptDbObj=b}),98);
__d("MAWDbMsgTypeVersionTxns",["MAWDbAppMeta","MAWDexieTable","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return a.appMeta.get({key:d("MAWDbAppMeta").AppMetaKeysEnum.msgTypeVersion}).then(function(a){return a==null?void 0:a.value.msgTypeVersion})}function b(a,b){return a.appMeta.add({key:d("MAWDbAppMeta").AppMetaKeysEnum.msgTypeVersion,value:{msgTypeVersion:b}})}function e(a,b){return a.appMeta.put({key:d("MAWDbAppMeta").AppMetaKeysEnum.msgTypeVersion,value:{msgTypeVersion:b}})}function f(a,b){return a.appMeta.add({key:d("MAWDbAppMeta").AppMetaKeysEnum.hmacKey,value:{hmacKey:b}})}function i(a){return a.appMeta.get({key:d("MAWDbAppMeta").AppMetaKeysEnum.hmacKey}).then(function(a){return a==null?void 0:a.value.hmacKey})}function j(a,b){return a.appMeta.get({key:b})}function k(a,b){return a.appMeta.put({key:d("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlert,value:{allowSecurityAlert:b}}).then(c("emptyFunction"))}function l(a,b){return a.appMeta.put({key:d("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlertForSelf,value:{allowSecurityAlertForSelf:b}}).then(c("emptyFunction"))}function m(a){return j(a,d("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlert).then(function(a){return(a=a==null?void 0:a.value.allowSecurityAlert)!=null?a:!1})}function n(a){return j(a,d("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlertForSelf).then(function(a){return(a=a==null?void 0:a.value.allowSecurityAlertForSelf)!=null?a:!0})}function o(a,b){return a.appMeta.add({key:d("MAWDbAppMeta").AppMetaKeysEnum.hotlikeSticker,value:{hotlikeSticker:b}})}function p(a){return d("MAWDexieTable").dexieAll([n(a),m(a)]).then(function(a){var b=a[0];a=a[1];return{allowSecurityAlertForContact:a,allowSecurityAlertForSelf:b}})}g.MSG_TYPE_VERSION=(h=d("MAWDbAppMeta")).AppMetaKeysEnum.msgTypeVersion;g.ALLOW_SECURITY_ALERT_FOR_CONTACT=h.AppMetaKeysEnum.allowSecurityAlert;g.ALLOW_SECURITY_ALERT_FOR_SELF=h.AppMetaKeysEnum.allowSecurityAlertForSelf;g.HOT_LIKE=h.AppMetaKeysEnum.hotlikeSticker;g.getMsgTypeVersion=a;g.addMsgTypeVersion=b;g.updateMsgTypeVersion=e;g.addHMACKey=f;g.getHMACKey=i;g.getAppMetaValue=j;g.updateSecurityAlertValueForContact=k;g.updateSecurityAlertValueForSelf=l;g.getSecuritySettingForContact=m;g.getSecuritySettingForSelf=n;g.addHotLike=o;g.maybeBulkGetSecuritySetting=p}),98);
__d("MAWHMACKey",["MAWCryptoConsts","MAWDbMsgTypeVersionTxns","MAWIndexedDb","MAWKeychainUtil","MAWSubtleCrypto","MAWTransactionMode","WABase64","tweetnacl-auth"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=d("MAWKeychainUtil").getBufferWithRandomValuesFromLength(d("MAWCryptoConsts").HKDF_SEED_LENGTH_IN_BYTES);return i(a).then(function(a){return d("MAWSubtleCrypto").MAWSubtleCrypto.exportKey("raw",a)})}function a(a,b){a=new TextEncoder().encode(a);b=new Uint8Array(b);a=c("tweetnacl-auth")(a,b);return d("WABase64").encodeB64UrlSafe(a)}function b(){return h().then(function(a){return d("MAWIndexedDb").makeMsgrTransactor({appMeta:d("MAWTransactionMode").READWRITE},"generateAndInsertHMACKey",function(b){return function(){return d("MAWDbMsgTypeVersionTxns").getHMACKey(b).then(function(c){return c!=null?c:d("MAWDbMsgTypeVersionTxns").addHMACKey(b,a).then(function(){return a})})}})()})}function i(a){return d("MAWSubtleCrypto").MAWSubtleCrypto.importKey("raw",a,{hash:"SHA-256",name:"HMAC"},!0,["sign"])}g.genHMACKey=h;g.hmacTweetNaCl=a;g.generateAndInsertHMACKey=b}),98);
__d("MAWMediaUtils",["FBLogger","MAWDbMedia","MAWDexieTable","MAWHMACKey","MAWImageUtils","MAWMsgType","WABlobToArrayBuffer","WAGlobals","WAHashUtils","WAMsgType","WATimeUtils","justknobx"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){b===void 0&&(b="media");switch(a){case d("MAWDbMedia").MEDIA_TYPE.IMAGE:return b==="xma-media"?"xma-image":"image";case d("MAWDbMedia").MEDIA_TYPE.VIDEO:return"video";case d("MAWDbMedia").MEDIA_TYPE.PTT:return"ptt";case d("MAWDbMedia").MEDIA_TYPE.GIF:return"gif";case d("MAWDbMedia").MEDIA_TYPE.STICKER:return"sticker";case d("MAWDbMedia").MEDIA_TYPE.DOCUMENT_FILE:return"document";default:throw c("FBLogger")("messenger_web").mustfixThrow("get a wrong media file with type "+a)}}function h(a){try{return d("WABlobToArrayBuffer").blobToArrayBuffer(a).then(i)}catch(a){throw c("FBLogger")("messenger_web").mustfixThrow("Got "+a+" when convert the blob to Uint8Array")}}function i(a){return self.crypto.subtle.digest("SHA-256",a).then(function(a){return new Uint8Array(a)})}async function b(a){a=await h(a);a=d("WAHashUtils").toPlaintextHash(a);var b=j(a);return[a,b]}function j(a){var b=d("WAGlobals").getHMACKey();return d("WAHashUtils").toHashedPlaintextHash(d("MAWHMACKey").hmacTweetNaCl(a,b))}function e(a){if(a==null)return null;var b="preview-"+d("WATimeUtils").unixTime().toString()+".jpeg";return k(a,b,"image/jpeg")}function k(a,b,c){return new File([new Blob([new Uint8Array(a)],{type:c})],b,{type:c})}function f(a,b,c){var e=function(){return c!=null?d("MAWDexieTable").dexieResolve(c.filter(function(a){return a.type!==d("WAMsgType").REVOKED&&b.msgIds.includes(a.msgId)})):a.messages.where("msgId").anyOf(b.msgIds).filter(function(a){return a.type!==d("WAMsgType").REVOKED}).toArray()};return e().then(function(a){return m(b,a)})}function l(a){return a.reduce(function(a,b){var c=b.hdType;c!=null&&(a[b.msgId]=c);return a},{})}function m(a,b){b=b.filter(function(b){return b.type!==d("WAMsgType").REVOKED&&a.msgIds.includes(b.msgId)});var e=b.map(function(a){return a.msgId});e=babelHelpers.extends({},a,{msgIds:e});var f=b.reduce(function(a,b){a[b.msgId]=d("WATimeUtils").castToMillisTime(b.sortOrderMs!=null?b.sortOrderMs:b.ts*1e3);return a},{});e=babelHelpers.extends({},e,{messagesSortOrderMs:f});if(b.every(function(a){return a.type===d("WAMsgType").STICKER})&&c("justknobx")._("2932")){f=d("MAWImageUtils").boundHeightWidth(e.previewHeight,e.previewWidth,d("MAWImageUtils").STICKER_THUMBNAIL_MAX_SIZE);var g=f.height;f=f.width;e=babelHelpers.extends({},e,{mediaType:d("MAWDbMedia").MEDIA_TYPE.STICKER,previewHeight:g,previewHeightLarge:g,previewWidth:f,previewWidthLarge:f})}g=new Set(b.map(function(a){return a.type}));g.forEach(function(b){if(b===d("MAWMsgType").MSG_TYPE.RAVEN)return;a.mediaType!==n(b)&&c("FBLogger")("messenger_web").mustfix("Message and media type mismatch: message with type %s is associated with media with type %s",b,a.mediaType)});return e}function n(a){switch(a){case d("MAWMsgType").MSG_TYPE.IMAGE:return d("MAWDbMedia").MEDIA_TYPE.IMAGE;case d("MAWMsgType").MSG_TYPE.VIDEO:return d("MAWDbMedia").MEDIA_TYPE.VIDEO;case d("MAWMsgType").MSG_TYPE.PTT:return d("MAWDbMedia").MEDIA_TYPE.PTT;case d("MAWMsgType").MSG_TYPE.GIF:return d("MAWDbMedia").MEDIA_TYPE.GIF;case d("MAWMsgType").MSG_TYPE.STICKER:return d("MAWDbMedia").MEDIA_TYPE.STICKER;case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return d("MAWDbMedia").MEDIA_TYPE.DOCUMENT_FILE}}g.getServerMediaTypeFromMediaType=a;g.hashBlob=h;g.hashArrayBuffer=i;g.genBlobHashes=b;g.genHMACPlaintextHash=j;g.convertJpegThumbnailArrayBufferToFile=e;g.getBridgeMediaAnnotatedForDisplay=f;g.createHdTypesForBridgeMedia=l;g.annotateBridgeMediaForDisplay=m;g.getMediaTypeFromMsgType=n}),98);
__d("MAWMessageDropError",[],(function(a,b,c,d,e,f){"use strict";a=function(a){function b(b){var c;c=a.call(this,b)||this;c.name="MAWMessageDropError";c.message=b;return c}babelHelpers.inheritsLoose(b,a);return b}(babelHelpers.wrapNativeSuper(Error));f.MAWMessageDropError=a}),66);
__d("MAWMessageParseError",[],(function(a,b,c,d,e,f){"use strict";a=function(a){function b(b){var c;c=a.call(this,b)||this;c.name="MAWMessageParseError";c.message=b;return c}babelHelpers.inheritsLoose(b,a);return b}(babelHelpers.wrapNativeSuper(Error));f.MAWMessageParseError=a}),66);
__d("WAMessageKey",["WAGlobals","WAJids","WAStanzaUtils","err"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return a===d("WAJids").AUTHOR_ME||a==d("WAGlobals").getMyUserJid()}function a(a,b,e){if(e==null)throw c("err")("messageKey is null");var f=e.id,g=e.remoteJid;if(f==null)throw c("err")("messageKey.id is null");else if(g==null)throw c("err")("messageKey.remoteJid is null");g=d("WAJids").interpretAndValidateJid(g);if(g.jidType==="unknown")throw c("err")("messageKey.remoteJid is invalid");var i,j=d("WAJids").AUTHOR_ME;if(g.jidType==="group"){i=g.groupJid;if(h(b)&&e.fromMe===!0)j=d("WAJids").AUTHOR_ME;else if(e.fromMe==!0)j=b;else{var k=e.participant;if(k==null)throw c("err")("key.participant is null");k=d("WAJids").interpretAndValidateJid(k);if(k.jidType==="msgrUser")j=k.userJid;else throw c("err")("key.participant is invalid")}}else if(g.jidType==="msgrUser"||g.jidType==="msgrDevice"){k=d("WAJids").interpretAndValidateJid(a);if(k.jidType!=="msgrUser")throw c("err")("expected user type jid.");i=k.userJid;h(b)?e.fromMe===!0?j=d("WAJids").AUTHOR_ME:j=k.userJid:e.fromMe===!0&&(j=k.userJid)}else throw c("err")("Unsupported jidtype type");return{chat:i,author:h(j)?d("WAJids").AUTHOR_ME:j,externalId:d("WAStanzaUtils").toStanzaId(f)}}g.extractProtocolMessageId=a}),98);
__d("WAParseConsumerMessagePollCreation",["WAGlobals","WAHex","WAMsgType"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e){a={unstoredMsg:{type:d("WAMsgType").MSG_TYPE.FUTUREPROOF,msgContent:{protobuf:d("WAHex").bytesToBuffer(a),subtype:"pollCreationMessage"},id:b.id,ts:b.ts,sentTs:b.sentTs,serverTs:b.serverTs,ack:b.ack,reportingMeta:c},unstoredMedia:null,unstoredQuotedMedia:null};if(!e||!d("WAGlobals").getConfig().isPollsEnabled())return a;c=e.encKey;var f=e.options,g=e.name;e=e.selectableOptionsCount;var h=b.id,i=b.ts;b=b.ack;if(c==null||g==null||e==null)return a;a=f.map(function(a){return a.optionName}).filter(Boolean);return{unstoredMsg:{ack:b,id:h,ts:i,type:d("WAMsgType").MSG_TYPE.GROUP_POLL_CREATE},unstoredGroupPollCreateInfo:{encKey:c,name:g,selectableOptionsCount:e,options:a},unstoredMedia:null,unstoredQuotedMedia:null}}g["default"]=a}),98);
__d("WAParseConsumerMessagePollUpdate",["WAGlobals","WAMsgType"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e){a=b.id;c=b.ts;b=b.ack;return e==null||!d("WAGlobals").getConfig().isPollsEnabled()?{unstoredMsg:null,unstoredMedia:null,unstoredQuotedMedia:null}:{unstoredMsg:{ack:b,id:a,ts:c,type:d("WAMsgType").MSG_TYPE.GROUP_POLL_UPDATE},unstoredGroupPollUpdateInfo:{pollUpdateMessage:e,type:d("WAMsgType").MSG_TYPE.GROUP_POLL_UPDATE},unstoredMedia:null,unstoredQuotedMedia:null}}g["default"]=a}),98);
__d("WAParseProtocolUtils",["WAGlobals","WALogger","WALongInt","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){b=i(b,a.serverTs);a=b==null?void 0:b.expirationTs;var c=b==null?void 0:b.deleteTs;b=b==null?void 0:b.ephemeralSetting;return{expirationTs:a,deleteTs:c,ephemeralSetting:b}}function b(a,b){b=j(b);b!=null&&(a.reportingMeta=b);return b}function i(a,b){var c,e,f=a==null||(c=a.chatEphemeralSetting)==null?void 0:c.ephemeralExpiration;a=a==null||(e=a.chatEphemeralSetting)==null?void 0:e.ephemeralSettingTimestamp;if(f==null||a==null||f===0||!d("WAGlobals").getConfig().isEphemeralMessagesEnabled())return null;b=d("WATimeUtils").castToUnixTime(b+d("WAGlobals").getDependencies().ephemeralMaxDeletionWindowForUnseenMessage());var g=b,h=null;try{a=d("WALongInt").numberOrThrowIfTooLarge(a)/1e3;h=d("WATimeUtils").castToUnixTime(a)}catch(a){return null}return{expirationTs:b,deleteTs:g,ephemeralSetting:{expirationTs:f,updatedTs:h}}}function j(a){a=a==null?void 0:a.frankingVersion;a!=null&&a!==0&&d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Unsupported franking version ",""])),a);return{frankingKey:void 0,frankingTag:void 0,frankingVersion:a,reportingContent:void 0,reportingTag:void 0}}g.parseEphemerality=a;g.enhanceReportingMeta=b}),98);
__d("WAParseReadOnlyMetadataDataclassToUnsafeObject",["err"],(function(a,b,c,d,e,f,g){"use strict";function a(a){if((a==null?void 0:a.readonlyMetadataDataclass)!=null)try{a=JSON.parse(a==null?void 0:a.readonlyMetadataDataclass);return a}catch(a){throw c("err")("Failed to parse readonly metadata dataclass JSON")}return null}g["default"]=a}),98);
__d("WAParseConsumerMessageProtocol",["WACommon.pb","WAConsumerApplication.pb","WAGlobals","WAHex","WAJids","WALogger","WAMediaTransport.pb","WAMessageKey","WAMsgType","WAParseConsumerMessagePollCreation","WAParseConsumerMessagePollUpdate","WAParseMediaTransportProtocol","WAParseProtocolUtils","WAParseReadOnlyMetadataDataclassToUnsafeObject","WAResultOrError","WAStanzaUtils","WATimeUtils","decodeProtobuf","err","maybeConvertMessageTextMentionsV2ToV1"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=90*d("WATimeUtils").DAY_SECONDS;b=1;e=0;f=1;f=d("WAGlobals").getConfig().armadilloWebProcessFutureproof()?f+1:f;function a(a,b,e,f,g,k){var l;b=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAConsumerApplication.pb").ConsumerApplicationSpec,b);l=(l=b.payload)==null||(l=l.applicationData)==null||(l=l.revoke)==null||(l=l.key)==null?void 0:l.id;if(l!=null)return{unstoredMsg:{type:d("WAMsgType").MSG_TYPE.REVOKED,id:e.id,ts:e.ts,sentTs:e.sentTs,serverTs:e.serverTs,ack:e.ack,reportingMeta:e.reportingMeta,revokedExternalId:d("WAStanzaUtils").toStanzaId(l),unsendMsgContentDeleteTs:null,msgContent:null,ebTimestampMs:k},unstoredMedia:null,unstoredQuotedMedia:null};var m=(g==null?void 0:g.isForwarded)||!1;l=d("WAParseProtocolUtils").parseEphemerality(e,g);var x=l.expirationTs,y=l.deleteTs,z=l.ephemeralSetting;if(z!=null&&(z.expirationTs<0||z.expirationTs>j)){l=d("WAJids").interpretAndValidateJid(a);l=l.jidType;var A=z.expirationTs;d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["WAParseConsumerMessageProtocol - ephemeralSetting duration is invalid ",", jidType: ",""])),A,l)}var B=d("WAParseProtocolUtils").enhanceReportingMeta(e,g),C=(A=o(g))!=null?A:void 0,D=(l=b.payload)==null?void 0:l.content;if(!D)return{unstoredMsg:null,unstoredMedia:null,unstoredQuotedMedia:null};var E=(A=b.metadata)==null?void 0:A.specialTextSize,F=t(D),G={contentTypeForLogging:F,unstoredMsg:{type:d("WAMsgType").MSG_TYPE.FUTUREPROOF,msgContent:{protobuf:d("WAHex").bytesToBuffer(f),subtype:null},id:e.id,ts:e.ts,sentTs:e.sentTs,serverTs:e.serverTs,ack:e.ack,reportingMeta:B},unstoredMedia:null,unstoredQuotedMedia:null},H=function(a){return babelHelpers["extends"]({},G,{unstoredMsg:babelHelpers["extends"]({},G.unstoredMsg,{msgContent:babelHelpers["extends"]({},G.unstoredMsg.msgContent,{subtype:a})})})};l=function(){try{switch(F){case"messageText":var b,h=c("maybeConvertMessageTextMentionsV2ToV1")(D[F]);if(h==null)throw c("err")("consumerMessage has no messageText");b=((b=h.commands)==null?void 0:b.some(function(a){return a.commandType===d("WACommon.pb").COMMAND_COMMAND_TYPE.AI}))===!0;if(b&&!d("WAGlobals").getConfig().isMetaAiInvocationMessageRenderEnabled())return H("metaAiMessage");if(w(g))return H("noteMention");if(h.text==null)throw c("err")("consumerMessage has no messageText");return{unstoredMsg:babelHelpers["extends"]({type:d("WAMsgType").MSG_TYPE.TEXT,msgContent:{content:h.text,mentionedJids:h.mentionedJid.map(d("WAJids").validateUserJid).filter(Boolean),commands:h.commands},quote:C,expirationTs:x,deleteTs:y,ephemeralSetting:z,isForwarded:m},e,{specialTextSize:E,ebTimestampMs:k}),unstoredMedia:null,unstoredQuotedMedia:null};case"reactionMessage":return{unstoredMsg:n(a,e,D[F]),unstoredMedia:null,unstoredQuotedMedia:null};case"imageMessage":b=p(D,e.ts);return{unstoredMsg:babelHelpers["extends"]({type:d("WAMsgType").MSG_TYPE.IMAGE,quote:C,expirationTs:x,deleteTs:y,ephemeralSetting:z,isForwarded:m,mediaId:b.plaintextHash},e,{ebTimestampMs:k}),unstoredMedia:b,unstoredQuotedMedia:null};case"videoMessage":var j,l,o,t;h=D[F];if(h==null)throw c("err")("consumerMessage has no videoMessage");b=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMediaTransport.pb").VideoTransportSpec,h==null||(j=h.video)==null?void 0:j.payload);var A=b==null||(l=b.integral)==null||(l=l.transport)==null||(l=l.ancillary)==null?void 0:l.mimetype;A=(b==null||(o=b.ancillary)==null?void 0:o.gifPlayback)===!0&&A==="image/gif";if(A&&!d("WAGlobals").getConfig().isGifEnabled())return G;b=d("WAParseMediaTransportProtocol").parseVideoMsg(b,e.ts,A);if(b==null)throw c("err")("consumerMessage has no video media info");if(v(g)&&((t=h.caption)==null?void 0:t.text)!=null){return{unstoredMsg:babelHelpers["extends"]({type:d("WAMsgType").MSG_TYPE.TEXT,msgContent:{content:(t=h.caption)==null?void 0:t.text,mentionedJids:h.caption.mentionedJid.map(d("WAJids").validateUserJid).filter(Boolean)},quote:C,expirationTs:x,deleteTs:y,ephemeralSetting:z,isForwarded:m},e,{specialTextSize:E,ebTimestampMs:k}),unstoredMedia:null,unstoredQuotedMedia:null}}return{unstoredMsg:A?babelHelpers["extends"]({type:d("WAMsgType").MSG_TYPE.GIF},e,{quote:C,expirationTs:x,deleteTs:y,ephemeralSetting:z,isForwarded:m,reportingMeta:B,mediaId:b.plaintextHash}):babelHelpers["extends"]({type:d("WAMsgType").MSG_TYPE.VIDEO},e,{quote:C,expirationTs:x,deleteTs:y,ephemeralSetting:z,isForwarded:m,mediaId:b.plaintextHash}),unstoredMedia:b,unstoredQuotedMedia:null};case"audioMessage":t=q(D,e.ts);return{unstoredMsg:babelHelpers["extends"]({type:d("WAMsgType").MSG_TYPE.PTT,quote:C,expirationTs:x,deleteTs:y,ephemeralSetting:z,isForwarded:m,mediaId:t.plaintextHash},e,{ebTimestampMs:k}),unstoredMedia:t,unstoredQuotedMedia:null};case"stickerMessage":if(d("WAGlobals").getConfig().isStickerEnabled()){h=r(D);A=d("WAParseMediaTransportProtocol").parseStickerMsg(h,e.ts);b=((b=h.integral)==null?void 0:b.receiverFetchId)!=null||((t=h.ancillary)==null?void 0:t.receiverFetchId)!=null;t=d("WAGlobals").getConfig().isStickerReceiverFetchEnabled();if(A==null){if(b){if(t){b=d("WAParseMediaTransportProtocol").parseStickerReceiverFetchInfo(h);if(b==null)throw c("err")("consumerMessage has no sticker receiver fetch info");return{unstoredMsg:babelHelpers["extends"]({type:d("WAMsgType").MSG_TYPE.RECEIVER_FETCH,quote:C,expirationTs:x,deleteTs:y,ephemeralSetting:z,isForwarded:m,reportingMeta:B},e,{ebTimestampMs:k}),unstoredMedia:null,unstoredQuotedMedia:null,unstoredReceiverFetchInfo:b}}return H("stickerReceiverFetchMessage")}throw c("err")("consumerMessage has no sticker media info")}return{unstoredMsg:babelHelpers["extends"]({type:d("WAMsgType").MSG_TYPE.STICKER,quote:C,expirationTs:x,deleteTs:y,ephemeralSetting:z,isForwarded:m,reportingMeta:B,mediaId:A.plaintextHash},e,{ebTimestampMs:k}),unstoredMedia:A,unstoredQuotedMedia:null}}return G;case"documentMessage":if(d("WAGlobals").getConfig().isDocumentReceiveEnabled()){t=s(D,e.ts);return{unstoredMsg:babelHelpers["extends"]({type:d("WAMsgType").MSG_TYPE.DOCUMENT_FILE,quote:C,expirationTs:x,deleteTs:y,ephemeralSetting:z,isForwarded:m,reportingMeta:B,mediaId:t.plaintextHash},e,{ebTimestampMs:k}),unstoredMedia:t,unstoredQuotedMedia:null}}return G;case"groupInviteMessage":return{unstoredMsg:null,unstoredMedia:null,unstoredQuotedMedia:null,unstoredIncomingGroupInvite:u(e,D)};case"editMessage":var I;h=D[F];b=h==null?void 0:h.message;A=b==null?void 0:b.text;t=h==null||(I=h.key)==null?void 0:I.id;if(h==null||b==null||A==null)throw c("err")("consumerMessage with editMessage type has no editMessage");if(t==null)throw c("err")("consumerMessage with editMessage type has no original Msg External Id.");h=d("WAStanzaUtils").toStanzaId(t);return{unstoredEditMsg:{type:d("WAMsgType").MSG_TYPE.EDIT_ACTION,editMsgContent:{content:A,mentionedJids:b.mentionedJid.map(d("WAJids").validateUserJid).filter(Boolean),commands:b.commands},originalMsgExternalId:h,id:e.id,ts:e.ts,sentTs:e.sentTs,serverTs:e.serverTs,ack:e.ack,reportingMeta:B,specialTextSize:E},unstoredMsg:null,unstoredMedia:null,unstoredQuotedMedia:null};case"pollCreationMessage":return c("WAParseConsumerMessagePollCreation")(f,e,B,D[F]);case"pollUpdateMessage":return c("WAParseConsumerMessagePollUpdate")(f,e,B,D[F]);case"contactMessage":case"locationMessage":case"extendedTextMessage":case"statusTextMessage":case"contactsArrayMessage":case"liveLocationMessage":case"viewOnceMessage":default:return G}}catch(a){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["parseConsumerMessageProtocol error :",""])),a);return{unstoredMsg:null,unstoredMedia:null,unstoredQuotedMedia:null}}}();return babelHelpers["extends"]({},l,{contentTypeForLogging:F})}function k(a){if(d("WAJids").isAuthorSystem(a))throw c("err")("Got system author");return a}var l=30;function m(a){if(a==null)return d("WAResultOrError").makeResult(null);return a.length>l?d("WAResultOrError").makeError("invalid-reaction-text-length"):d("WAResultOrError").makeResult(a)}function n(a,b,e){if(e==null)throw c("err")("consumerMessage has no reactionMessage");var f=k(b.id.author);a=d("WAMessageKey").extractProtocolMessageId(a,f,e.key);f=e.text;var g=e.groupingKey;e=e.senderTimestampMs;var h=m(f);if(!h.success)throw c("err")('"'+(f!=null?f:"")+'" is not a valid reaction ['+h.error+"]");return{type:d("WAMsgType").MSG_TYPE.REACTION,ack:b.ack,id:b.id,reactToExternalId:a.externalId,reactToAuthor:a.author,reaction:h.value,groupingKey:g,ts:b.ts,senderTimestampMs:e}}function o(a){var b,e,f,g=a==null||(b=a.quotedMessage)==null?void 0:b.stanzaId,h=a==null||(e=a.quotedMessage)==null?void 0:e.participant;a=a==null||(f=a.quotedMessage)==null?void 0:f.remoteJid;h=h!=null?d("WAJids").interpretAndValidateJid(h):null;var i;(h==null?void 0:h.jidType)==="msgrUser"&&h.userJid===d("WAGlobals").getMyUserJid()?i=d("WAJids").AUTHOR_ME:(h==null?void 0:h.jidType)==="msgrUser"?i=h.userJid:i=d("WAJids").AUTHOR_ME;if(g==null)return null;h={type:d("WAMsgType").MSG_TYPE.UNAVAILABLE,author:i,externalId:d("WAStanzaUtils").toStanzaId(g),ts:null};if(a!=null){i=d("WAJids").interpretAndValidateJid(a);if(i.jidType==="group")return{remoteJid:i.groupJid,content:h};else throw c("err")("not supported")}else return{remoteJid:null,content:h}}function p(a,b){var e;a=a.imageMessage;if(a==null)throw c("err")("consumerMessage has no imageMessage");return d("WAParseMediaTransportProtocol").decodeImageTransport(a==null||(e=a.image)==null?void 0:e.payload,b,"image")}function q(a,b){var e;a=a.audioMessage;if(a==null)throw c("err")("consumerMessage has no audioMessage");var f=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMediaTransport.pb").AudioTransportSpec,a==null||(e=a.audio)==null?void 0:e.payload);f=d("WAParseMediaTransportProtocol").parseAudioMsg(f,(a==null?void 0:a.ptt)||!1,b);if(f==null)throw c("err")("consumerMessage has no audio media info");return f}function r(a){var b;a=a.stickerMessage;if(a==null)throw c("err")("consumerMessage has no stickerMessage");return d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMediaTransport.pb").StickerTransportSpec,a==null||(b=a.sticker)==null?void 0:b.payload)}function s(a,b){var e;a=a.documentMessage;if(a==null)throw c("err")("consumerMessage has no documentMessage");var f=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMediaTransport.pb").DocumentTransportSpec,a==null||(e=a.document)==null?void 0:e.payload);a=a==null?void 0:a.fileName;f=d("WAParseMediaTransportProtocol").parseDocumentMsg(f,a,b);if(f==null)throw c("err")("consumerMessage has no document media info");return f}function t(a){var b=Object.keys(a).filter(function(a){return a!=="$$unknownFieldCount"});if(b.length!==1)throw c("err")(JSON.stringify(a)+" consumerMessage payload content should have exactly one field, instead found "+JSON.stringify(b));return b[0]}function u(a,b){b=b.groupInviteMessage;if(b==null)throw c("err")("consumerMessage has no GroupInvite Data");return babelHelpers["extends"]({ack:a.ack,author:a.id.author,externalId:a.id.externalId,ts:a.ts},b)}function v(a){var b;a=c("WAParseReadOnlyMetadataDataclassToUnsafeObject")(a);return(a==null||(b=a.power_up)==null?void 0:b.power_up_style)!=null}function w(a){var b;a=c("WAParseReadOnlyMetadataDataclassToUnsafeObject")(a);return(a==null||(b=a.note_metadata)==null?void 0:b.message_type)==="MENTION"}g.MINIMAL_MEDIA_DURATION=b;g.DEFAULT_FILE_SIZE=e;g.SUPPORTED_TYPES_VERSION=f;g.parseConsumerMessageProtocol=a;g.interpretAsNonSystemAuthor=k;g.validReactionMessageText=m;g.parseReactionMessage=n;g.parsedQuotedConsumerMessage=o;g.parseOneOfContentType=t}),98);
__d("WAMedia",[],(function(a,b,c,d,e,f){"use strict";a="Image";b="Video";c="Ptt";d="Gif";e="Sticker";var g="DocumentFile",h={IMAGE:a,VIDEO:b,PTT:c,GIF:d,STICKER:e,DOCUMENT_FILE:g};f.IMAGE=a;f.VIDEO=b;f.PTT=c;f.GIF=d;f.STICKER=e;f.DOCUMENT_FILE=g;f.MEDIA_TYPE=h}),66);
__d("WAParseMediaTransportProtocol",["WAHashUtils","WALogger","WALongInt","WAMedia","WAMediaHdType","WAMediaTransport.pb","WAMediaUtils","WAMsgMap","WAParseConsumerMessageProtocol","WAProgressiveJpegGetScanLengths","WATimeUtils","decodeProtobuf","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(a,b,c,e){var f,g,k;if(!((f=a.integral)!=null&&f.transport))return null;f=(f=a.integral)==null?void 0:f.transport;if(d("decodeProtobuf").getUnknownFields(f.integral)!=null){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["There is unknown fileds in integral of VideoTransport"])));return null}g=(g=f.integral)==null?void 0:g.fileSha256;if(!g){c||d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["protobuf msg with no plaintext hash"])));return null}c=null;if(((k=a.ancillary)==null?void 0:k.scansSidecar)!=null&&((k=a.ancillary)==null?void 0:k.scanLengths)!=null){c={sidecar:(k=a.ancillary)==null?void 0:k.scansSidecar,scanLengths:(k=a.ancillary)==null||(k=k.scanLengths)==null?void 0:k.map(d("WAProgressiveJpegGetScanLengths").asProgressiveJpegScanLength)}}if(((a=f.integral)==null?void 0:a.fileSha256)==null||((k=f.integral)==null?void 0:k.fileEncSha256)==null||((a=f.integral)==null?void 0:a.mediaKey)==null||((k=f.integral)==null?void 0:k.directPath)==null||((a=f.integral)==null?void 0:a.mediaKeyTimestamp)==null||((k=f.ancillary)==null?void 0:k.objectId)==null){d("WALogger").ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["cannot compose mediaEntry with the media message"])));return null}k=(a=f.ancillary)==null?void 0:a.fileLength;a=(a=f.ancillary.thumbnail)==null?void 0:a.downloadableThumbnail;f=d("WAMediaUtils").rawDataToMediaEntry({fileSha256:f.integral.fileSha256,fileEncSha256:f.integral.fileEncSha256,mediaKey:f.integral.mediaKey,directPath:f.integral.directPath,mediaKeyTimestamp:d("WATimeUtils").castLongIntToUnixTime(f.integral.mediaKeyTimestamp),serverMediaType:b,objectId:(b=f.ancillary)==null?void 0:b.objectId,fbid:void 0,downloadableThumbnail:{directPath:a==null?void 0:a.directPath,fileEncSha256:a==null?void 0:a.fileEncSha256,fileSha256:a==null?void 0:a.fileSha256,mediaKey:a==null?void 0:a.mediaKey,mediaKeyTimestamp:(a==null?void 0:a.mediaKeyTimestamp)==null?null:d("WATimeUtils").castLongIntToUnixTime(a==null?void 0:a.mediaKeyTimestamp),objectId:a==null?void 0:a.objectId},filename:e,progressiveJpegDetails:c,size:k==null?k:d("WALongInt").numberOrThrowIfTooLarge(k)});return{size:k==null?d("WAParseConsumerMessageProtocol").DEFAULT_FILE_SIZE:d("WALongInt").numberOrThrowIfTooLarge(k),plaintextHash:d("WAHashUtils").toPlaintextHash(new Uint8Array(g)),mediaEntry:f}}function l(a){switch(a){case d("WAMediaTransport.pb").IMAGE_TRANSPORT_ANCILLARY_HD_TYPE.NONE:return d("WAMediaHdType").HD_TYPE_NONE;case d("WAMediaTransport.pb").IMAGE_TRANSPORT_ANCILLARY_HD_TYPE.LQ_4K:return d("WAMediaHdType").HD_TYPE_LQ_4K;case d("WAMediaTransport.pb").IMAGE_TRANSPORT_ANCILLARY_HD_TYPE.HQ_4K:return d("WAMediaHdType").HD_TYPE_HQ_4K;default:a;return d("WAMediaHdType").HD_TYPE_NONE}}function m(a,b,c){var e;c=k(a,c,!1);if(!c)return null;c=p(c,b);b=(b=a.ancillary)==null?void 0:b.width;e=(e=a.ancillary)==null?void 0:e.height;a.ancillary!=null&&(a.ancillary.width!=null&&a.ancillary.width===4294967295&&(b=void 0),a.ancillary.height!=null&&a.ancillary.height===4294967295&&(e=void 0));b=babelHelpers["extends"]({},c,{mediaType:d("WAMedia").MEDIA_TYPE.IMAGE,validatedVideoInfo:null,validatedImageInfo:{width:b,height:e,jpegThumbnail:(c=a.integral)==null||(c=c.transport)==null||(c=c.ancillary)==null||(c=c.thumbnail)==null?void 0:c.jpegThumbnail,jpegThumbnailHeight:(b=a.integral)==null||(b=b.transport)==null||(b=b.ancillary)==null||(b=b.thumbnail)==null?void 0:b.thumbnailHeight,jpegThumbnailWidth:(e=a.integral)==null||(e=e.transport)==null||(e=e.ancillary)==null||(e=e.thumbnail)==null?void 0:e.thumbnailWidth,hdType:l((c=a.ancillary)==null?void 0:c.hdType)},validatedAudioInfo:null,validatedDocumentFileInfo:null});return b}function a(a,b,e){a=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMediaTransport.pb").ImageTransportSpec,a);a=m(a,b,e);if(a==null)throw c("err")("consumerMessage has no image media info");return a}function b(a,b,c){var e,f,g,h,i,j,l;if(!((e=a.integral)!=null&&e.transport))return null;e=k(a,c?"gif":"video",!1);if(!e)return null;e=p(e,b);c=babelHelpers["extends"]({},e,{accessibilitySummaryText:(b=a.ancillary)==null?void 0:b.accessibilityLabel,mediaType:c?d("WAMedia").MEDIA_TYPE.GIF:d("WAMedia").MEDIA_TYPE.VIDEO,validatedVideoInfo:c?null:{duration:(a==null||(f=a.ancillary)==null?void 0:f.seconds)!=null&&(a==null||(g=a.ancillary)==null?void 0:g.seconds)>d("WAParseConsumerMessageProtocol").MINIMAL_MEDIA_DURATION?a==null||(h=a.ancillary)==null?void 0:h.seconds:d("WAParseConsumerMessageProtocol").MINIMAL_MEDIA_DURATION,width:a==null||(i=a.ancillary)==null?void 0:i.width,height:a==null||(j=a.ancillary)==null?void 0:j.height,mimetype:a==null||(l=a.integral)==null||(l=l.transport)==null||(l=l.ancillary)==null?void 0:l.mimetype,jpegThumbnail:(e=a.integral)==null||(e=e.transport)==null||(e=e.ancillary)==null||(e=e.thumbnail)==null?void 0:e.jpegThumbnail,jpegThumbnailHeight:(b=a.integral)==null||(b=b.transport)==null||(b=b.ancillary)==null||(b=b.thumbnail)==null?void 0:b.thumbnailHeight,jpegThumbnailWidth:(e=a.integral)==null||(e=e.transport)==null||(e=e.ancillary)==null||(e=e.thumbnail)==null?void 0:e.thumbnailWidth},validatedImageInfo:c?{width:(b=a.ancillary)==null?void 0:b.width,height:(e=a.ancillary)==null?void 0:e.height,jpegThumbnail:(c=a.integral)==null||(c=c.transport)==null||(c=c.ancillary)==null||(c=c.thumbnail)==null?void 0:c.jpegThumbnail,jpegThumbnailHeight:(b=a.integral)==null||(b=b.transport)==null||(b=b.ancillary)==null||(b=b.thumbnail)==null?void 0:b.thumbnailHeight,jpegThumbnailWidth:(e=a.integral)==null||(e=e.transport)==null||(e=e.ancillary)==null||(e=e.thumbnail)==null?void 0:e.thumbnailWidth}:null,validatedAudioInfo:null,validatedDocumentFileInfo:null});return c}function e(a,b,c){var e,f,g,h;if(!((b=a.integral)!=null&&b.transport))return null;b=k(a,"ptt",!1);if(!b)return null;b=p(b,c);c=babelHelpers["extends"]({},b,{mediaType:d("WAMedia").MEDIA_TYPE.PTT,validatedVideoInfo:null,validatedImageInfo:null,validatedDocumentFileInfo:null,validatedAudioInfo:{duration:(a==null||(e=a.ancillary)==null?void 0:e.seconds)!=null&&(a==null||(f=a.ancillary)==null?void 0:f.seconds)>d("WAParseConsumerMessageProtocol").MINIMAL_MEDIA_DURATION?a==null||(g=a.ancillary)==null?void 0:g.seconds:d("WAParseConsumerMessageProtocol").MINIMAL_MEDIA_DURATION,mimetype:a==null||(h=a.integral)==null||(h=h.transport)==null||(h=h.ancillary)==null?void 0:h.mimetype,played:!1}});return c}function f(a,b){var c;if(!((c=a.integral)!=null&&c.transport))return null;c=((c=a.integral)==null?void 0:c.receiverFetchId)!=null;c=k(a,"sticker",c);if(!c)return null;c=p(c,b);b=babelHelpers["extends"]({},c,{accessibilitySummaryText:(b=a.ancillary)==null?void 0:b.accessibilityLabel,mediaType:d("WAMedia").MEDIA_TYPE.STICKER,validatedVideoInfo:null,validatedImageInfo:{width:(c=a.ancillary)==null?void 0:c.width,height:(b=a.ancillary)==null?void 0:b.height,jpegThumbnail:(c=a.integral)==null||(c=c.transport)==null||(c=c.ancillary)==null||(c=c.thumbnail)==null?void 0:c.jpegThumbnail,jpegThumbnailHeight:(b=a.integral)==null||(b=b.transport)==null||(b=b.ancillary)==null||(b=b.thumbnail)==null?void 0:b.thumbnailHeight,jpegThumbnailWidth:(c=a.integral)==null||(c=c.transport)==null||(c=c.ancillary)==null||(c=c.thumbnail)==null?void 0:c.thumbnailWidth},validatedAudioInfo:null,validatedDocumentFileInfo:null});return b}function n(a){var b,c,d,e;if(!((b=a.integral)!=null&&b.transport))return null;b=(b=a.ancillary)==null?void 0:b.width;c=(c=a.ancillary)==null?void 0:c.height;d=(d=(d=a.integral)==null?void 0:d.receiverFetchId)!=null?d:(d=a.ancillary)==null?void 0:d.receiverFetchId;a=a==null||(e=a.integral)==null||(e=e.transport)==null||(e=e.ancillary)==null?void 0:e.mimetype;if(b==null||c==null||d==null||a==null)return null;d={receiverFetchId:d,previewWidth:b,previewHeight:c,mimetype:a,type:"sticker"};return d}function o(a,b,c){var e,f;if(!((e=a.integral)!=null&&e.transport))return null;e=k(a,"document",!1,b);if(!e)return null;e=p(e,c);return babelHelpers["extends"]({},e,{mediaType:d("WAMedia").MEDIA_TYPE.DOCUMENT_FILE,validatedVideoInfo:null,validatedImageInfo:null,validatedAudioInfo:null,validatedDocumentFileInfo:{mimetype:a==null||(f=a.integral)==null||(f=f.transport)==null||(f=f.ancillary)==null?void 0:f.mimetype,filename:b!=null?b:void 0}})}function p(a,b){return{mediaEntry:a.mediaEntry,plaintextHash:a.plaintextHash,size:a.size,msgIds:[],mediaEntries:new(d("WAMsgMap").MsgMap)(),ts:b}}g.getMediaMeta=k;g.decodeImageTransport=a;g.parseVideoMsg=b;g.parseAudioMsg=e;g.parseStickerMsg=f;g.parseStickerReceiverFetchInfo=n;g.parseDocumentMsg=o}),98);
__d("MAWParseBumpExistingMessageMsg",["FBLogger","WAMessageKey","WAParseConsumerMessageProtocol","WAParseProtocolUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.chat,e=a.content,f=a.meta;a=a.metadata;e=e.bumpExistingMessage;if(e==null)throw c("FBLogger")("messenger_web").mustfixThrow("bumpExistingMessage has no content");e=e.key;if(e==null)throw c("FBLogger")("messenger_web").mustfixThrow("bumpExistingMessage has no message key");var g=d("WAParseConsumerMessageProtocol").interpretAsNonSystemAuthor(f.id.author);g=d("WAMessageKey").extractProtocolMessageId(b,g,e);e=g.author;g=g.externalId;a=d("WAParseProtocolUtils").parseEphemerality(f,a);var h=a.deleteTs,i=a.ephemeralSetting;a=a.expirationTs;h={ack:f.ack,deleteTs:h,ephemeralSetting:i,expirationTs:a,id:{author:f.id.author,chat:f.id.chat,externalId:f.id.externalId},quote:{content:{author:e,externalId:g,ts:null,type:"Unavailable"},remoteJid:b},reportingMeta:f.reportingMeta,sentTs:f.sentTs,serverTs:f.serverTs,ts:f.serverTs,type:"BumpExistingMessage"};return{contentTypeForLogging:"bumpExistingMessage",unstoredMedia:null,unstoredMsg:h,unstoredQuotedMedia:null,unstoredXMA:null}}g["default"]=a}),98);
__d("MAWParseNetworkVerificationMsg",["MAWMessageDropError","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){d("WALogger").EXPECTED_ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Web does not support network verification code"])));throw new(d("MAWMessageDropError").MAWMessageDropError)("Web does not support network verification")}g.parseNetworkVerificationMsg=a}),98);
__d("MAWParseNoteReplyMsg",["FBLogger","MAWJids","MAWMsgType","WAGlobals","WAJids","WALongInt","WAMediaTransport.pb","WAMsgType","WAParseMediaTransportProtocol","WAParseProtocolUtils","WAParseReadOnlyMetadataDataclassToUnsafeObject","WATimeUtils","decodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b,e=a.content,f=a.ebTimestampMs,g=a.meta;a=a.metadata;e=e.noteReplyMessage;if(h(a))return"noteMention";if(e==null)throw c("FBLogger")("messenger_web").mustfixThrow("noteReplyMessage has no content");b=(b=e.noteText)==null?void 0:b.text;if(b==null)throw c("FBLogger")("messenger_web").mustfixThrow("noteReplyMessage has no note text");var i=e.noteTimestampMs!=null?d("WATimeUtils").castMilliSecondsToUnixTime(d("WALongInt").numberOrThrowIfTooLarge(e.noteTimestampMs)):void 0,j=d("MAWJids").toUserJid(g.id.author),k=d("MAWJids").toUserJid(g.id.chat);j=k===j?d("WAJids").AUTHOR_ME:k;k=d("WAParseProtocolUtils").parseEphemerality(g,a);a=k.deleteTs;var l=k.ephemeralSetting;k=k.expirationTs;a={ack:g.ack,deleteTs:a,ebTimestampMs:f,ephemeralSetting:l,expirationTs:k,forwardingScore:g.forwardingScore,id:{author:g.id.author,chat:g.id.chat,externalId:g.id.externalId},quote:{content:{author:j,expirationTs:i,externalId:g.id.externalId,msgContent:{content:b},ts:g.serverTs,type:d("WAMsgType").NOTE_REPLY},remoteJid:g.id.chat},ts:g.serverTs};var m,n;l=(f=e.textContent)==null?void 0:f.text;k=e.stickerContent;j=e.videoContent;if(l!=null){i=babelHelpers["extends"]({msgContent:{content:l},type:d("MAWMsgType").MSG_TYPE.TEXT},a);b=i}else if(k!=null){f=d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").StickerTransportSpec,k==null?void 0:k.payload);m=d("WAParseMediaTransportProtocol").parseStickerMsg(f,g.ts);if(m){e=babelHelpers["extends"]({mediaId:m.plaintextHash,type:d("MAWMsgType").MSG_TYPE.STICKER},a);b=e}else{if(((l=f.integral)==null?void 0:l.receiverFetchId)!=null)if(d("WAGlobals").getConfig().isStickerReceiverFetchEnabled()){n=d("WAParseMediaTransportProtocol").parseStickerReceiverFetchInfo(f);if(n==null)throw c("FBLogger")("messenger_web").mustfixThrow("consumerMessage has no sticker receiver fetch info");i=babelHelpers["extends"]({type:d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH},a);b=i}else throw c("FBLogger")("messenger_web").mustfixThrow("noteReplyMessage sticker receiver fetch is not enabled");else throw c("FBLogger")("messenger_web").mustfixThrow("noteReplyMessage sticker has no media")}}else if(j!=null){var o,p;k=d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").VideoTransportSpec,j==null?void 0:j.payload);e=k==null||(o=k.integral)==null||(o=o.transport)==null||(o=o.ancillary)==null?void 0:o.mimetype;l=(k==null||(p=k.ancillary)==null?void 0:p.gifPlayback)===!0&&e==="image/gif";m=d("WAParseMediaTransportProtocol").parseVideoMsg(k,g.ts,l);if(m&&l){f=babelHelpers["extends"]({mediaId:m.plaintextHash,type:d("MAWMsgType").MSG_TYPE.GIF},a);b=f}else if(!m)throw c("FBLogger")("messenger_web").mustfixThrow("noteReplyMessage video has no media");else throw c("FBLogger")("messenger_web").mustfixThrow("noteReplyMessage video is not a gif")}else throw c("FBLogger")("messenger_web").mustfixThrow("noteReplyMessage has no valid content");return{contentTypeForLogging:"noteReplyMessage",unstoredMedia:m,unstoredMsg:b,unstoredQuotedMedia:null,unstoredReceiverFetchInfo:n,unstoredXMA:null}}function h(a){var b;a=c("WAParseReadOnlyMetadataDataclassToUnsafeObject")(a);return(a==null||(b=a.note_metadata)==null?void 0:b.message_type)==="MENTION"}g["default"]=a}),98);
__d("MAWParseRavenActionNotificationMsg",["FBLogger","MAWMsg","WAStanzaUtils","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b,e,f=a.content;a=a.meta;b=(b=f.ravenActionNotifMessage)==null?void 0:b.actionType;b=d("MAWMsg").MAWRavenActionNotifType.cast(b);e=(e=f.ravenActionNotifMessage)==null?void 0:e.actionTimestamp;var g;if(e!=null){e=Number(e);e>d("WATimeUtils").MAX_INT?g=d("WATimeUtils").castMilliSecondsToUnixTime(e):g=d("WATimeUtils").castToUnixTime(e)}f=((e=f.ravenActionNotifMessage)==null||(e=e.key)==null?void 0:e.id)!=null?d("WAStanzaUtils").toStanzaId((e=f.ravenActionNotifMessage)==null||(e=e.key)==null?void 0:e.id):null;if(b==null)throw c("FBLogger")("messenger_web").mustfixThrow("Error when getting actionType for RavenNotificationMessage "+a.id.externalId);if(g==null)throw c("FBLogger")("messenger_web").mustfixThrow("Error when getting actionTimestamp for RavenNotificationMessage "+a.id.externalId);if(f==null)throw c("FBLogger")("messenger_web").mustfixThrow("Error when getting ravenActionToMsgExternalId for RavenNotificationMessage "+a.id.externalId);e={ack:a.ack,actionTimestamp:g,actionType:b,id:a.id,ravenActionToMsgExternalId:f,sentTs:a.sentTs,serverTs:a.serverTs,ts:a.serverTs,type:"RavenAction"};return{unstoredMedia:null,unstoredMsg:e,unstoredQuotedMedia:null,unstoredXMA:null}}g.parseRavenActionNotificationMessage=a}),98);
__d("MAWParseSubprotocolVersionConsts",[],(function(a,b,c,d,e,f){"use strict";a=2;b=2;c=1;d=2;e=1;var g=1;f.ASSOCIATED_MESSAGE_SUBPROTOCOL_VERSION=a;f.XMA_PREVIEW_SUBPROTOCOL_VERSION=b;f.XMA_FAVICON_SUBPROTOCOL_VERSION=c;f.XMA_HEADER_SUBPROTOCOL_VERSION=d;f.RAVEN_IMAGE_MESSAGE_SUBPROTOCOL_VERSION=e;f.RAVEN_VIDEO_MESSAGE_SUBPROTOCOL_VERSION=g}),66);
__d("MAWParseRavenMsg",["FBLogger","MAWMsg","MAWMsgType","MAWParseSubprotocolVersionConsts","WALogger","WAMediaTransport.pb","WAParseMediaTransportProtocol","WAParseProtocolUtils","decodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a){var b=a.content,e=a.ebTimestampMs,f=a.meta;a=a.metadata;b=b.ravenMessageMsgr;if(b==null)throw c("FBLogger")("messenger_web").mustfixThrow("Raven message payload has no content");var g=d("MAWMsg").MAWRavenMsgEphemeralType.cast(b.ephemeralType);if(g==null)throw c("FBLogger")("messenger_web").mustfixThrow("Error when casting ephemeralType for Raven message");var j=void 0,k=void 0;if(b.imageMessage)(b.imageMessage.version==null||b.imageMessage.version<d("MAWParseSubprotocolVersionConsts").RAVEN_IMAGE_MESSAGE_SUBPROTOCOL_VERSION)&&d("WALogger").WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["\n        received image messsage version is older than expected ",". "])),d("MAWParseSubprotocolVersionConsts").RAVEN_IMAGE_MESSAGE_SUBPROTOCOL_VERSION),j=d("WAParseMediaTransportProtocol").decodeImageTransport(b.imageMessage.payload,f.ts,"image"),k=d("MAWMsg").MAWRavenMsgMediaType.IMAGE;else if(b.videoMessage){(b.videoMessage.version==null||b.videoMessage.version<d("MAWParseSubprotocolVersionConsts").RAVEN_VIDEO_MESSAGE_SUBPROTOCOL_VERSION)&&d("WALogger").WARN(i||(i=babelHelpers.taggedTemplateLiteralLoose(["\n        received video messsage version is older than expected ",". "])),d("MAWParseSubprotocolVersionConsts").RAVEN_VIDEO_MESSAGE_SUBPROTOCOL_VERSION);b=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMediaTransport.pb").VideoTransportSpec,b.videoMessage.payload);j=d("WAParseMediaTransportProtocol").parseVideoMsg(b,f.ts,!1);k=d("MAWMsg").MAWRavenMsgMediaType.VIDEO}else throw c("FBLogger")("messenger_web").mustfixThrow("Error unsupported Raven message type");if(j==null)throw c("FBLogger")("messenger_web").mustfixThrow("Error Raven message has no associated image or video");b=d("WAParseProtocolUtils").parseEphemerality(f,a);a=b.deleteTs;var l=b.ephemeralSetting;b=b.expirationTs;a={ack:f.ack,deleteTs:a,ebTimestampMs:e,ephemeralSetting:l,expirationTs:b,id:f.id,mediaId:j.plaintextHash,ravenEphemeralMediaState:g===d("MAWMsg").MAWRavenMsgEphemeralType.KEEP_IN_CHAT?d("MAWMsg").MAWRavenMsgEphemeralMediaState.PERMANENT:d("MAWMsg").MAWRavenMsgEphemeralMediaState.UNSEEN,ravenEphemeralType:g,ravenMediaType:k,reportingMeta:f.reportingMeta,sentTs:f.sentTs,serverTs:f.serverTs,ts:f.ts,type:d("MAWMsgType").MSG_TYPE.RAVEN};return{unstoredMedia:j,unstoredMsg:a,unstoredQuotedMedia:null,unstoredXMA:null}}g.parseRavenMessage=a}),98);
__d("WAAckLevel",[],(function(a,b,c,d,e,f){"use strict";a={SENDER_BACKFILL_SENT:-7,INACTIVE_RECEIVED:-6,CONTENT_UNUPLOADABLE:-5,CONTENT_TOO_BIG:-4,CONTENT_GONE:-3,EXPIRED:-2,FAILED:-1,CLOCK:0,SENT:1,RECEIVED:2,READ:3,PLAYED:4};f.ACK=a}),66);
__d("MAWParseScreenshotActionMsg",["FBLogger","MAWExternalId","MAWMsgType","WAAckLevel","WAArmadilloApplication.pb","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.content;a=a.meta;b=b.screenshotAction;if(b==null)throw c("FBLogger")("messenger_web").mustfixThrow("screenshotAction has no content");b=b.screenshotType;if(b==null)throw c("FBLogger")("messenger_web").mustfixThrow("Missing screenshot type in payload");if(![d("WAArmadilloApplication.pb").ARMADILLO_CONTENT_SCREENSHOT_ACTION_SCREENSHOT_TYPE.SCREENSHOT_IMAGE,d("WAArmadilloApplication.pb").ARMADILLO_CONTENT_SCREENSHOT_ACTION_SCREENSHOT_TYPE.SCREEN_RECORDING].includes(b))throw c("FBLogger")("messenger_web").mustfixThrow("Received unexpected screenshot action type");b={ack:d("WAAckLevel").ACK.SENT,id:{author:d("WAJids").AUTHOR_SYSTEM,chat:a.id.chat,externalId:d("MAWExternalId").generateExternalId()},msgContent:{adminMsgContent:[],adminType:"youEphemeralTakeScreenshot",screenshotActionType:b},ts:a.serverTs,type:d("MAWMsgType").EPHEMERAL_SCREENSHOT_ACTION};return{contentTypeForLogging:"screenshotAction",unstoredMedia:null,unstoredMsg:b,unstoredQuotedMedia:null,unstoredXMA:null}}g.parseEphemeralScreenshotActionProtocol=a}),98);
__d("MAWParseArmadilloProtocol",["FBLogger","MAWMessageParseError","MAWMsgType","MAWParseBumpExistingMessageMsg","MAWParseNetworkVerificationMsg","MAWParseNoteReplyMsg","MAWParseRavenActionNotificationMsg","MAWParseRavenMsg","MAWParseScreenshotActionMsg","MAWParseXMAProtocol","WAArmadilloApplication.pb","WAHex","WALogger","decodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";var h,i;b={unstoredMedia:null,unstoredMsg:null,unstoredQuotedMedia:null,unstoredXMA:null};var j=new Map([["screenshotAction",d("MAWParseScreenshotActionMsg").parseEphemeralScreenshotActionProtocol],["extendedContentMessage",d("MAWParseXMAProtocol").parseXMAProtocol],["paymentsTransactionMessage",d("MAWParseXMAProtocol").parseXMAProtocol],["noteReplyMessage",c("MAWParseNoteReplyMsg")],["bumpExistingMessage",c("MAWParseBumpExistingMessageMsg")],["ravenMessageMsgr",d("MAWParseRavenMsg").parseRavenMessage],["ravenActionNotifMessage",d("MAWParseRavenActionNotificationMsg").parseRavenActionNotificationMessage],["networkVerificationMessage",d("MAWParseNetworkVerificationMsg").parseNetworkVerificationMsg]]);function a(a,b,c,e,f,g){b=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAArmadilloApplication.pb").ArmadilloSpec,b);b=(b=b.payload)==null?void 0:b.content;if(!b)throw new(d("MAWMessageParseError").MAWMessageParseError)("parse_armadillo_protocol_error:: empty_payload_content");var m=l(b);try{var n=j.get(m),o=null;if(n!=null){n=n({chat:a,content:b,ebTimestampMs:g,meta:c,metadata:f,protobuf:e});if(typeof n!=="string")return n;else o=n}d("WALogger").LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["MAWParseArmadilloProtocol - handling futureproof message for contentType: ",""])),m);return{contentTypeForLogging:m,unstoredMedia:null,unstoredMsg:{ack:c.ack,id:c.id,msgContent:{protobuf:d("WAHex").bytesToBuffer(e),subtype:o!=null?o:k(m)},reportingMeta:c.reportingMeta,sentTs:c.sentTs,serverTs:c.serverTs,ts:c.ts,type:d("MAWMsgType").MSG_TYPE.FUTUREPROOF},unstoredQuotedMedia:null,unstoredXMA:null}}catch(a){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["MAWParseArmadilloProtocol - Dropping message. contentType: ",", reason: ",""])),m,a);throw new(d("MAWMessageParseError").MAWMessageParseError)("parse_armadillo_protocol_error:: contentType:: "+m+" reason:: "+a)}}function k(a){switch(a){case"bumpExistingMessage":return"bumpMessage";default:return null}}function l(a){var b=Object.keys(a).filter(function(a){return a!=="$$unknownFieldCount"});if(b.length!==1)throw c("FBLogger")("messenger_web").mustfixThrow(JSON.stringify(a)+" armadillo payload content should only have one field");a=b[0];return a}g.EMPTY_CONTENT=b;g.parseArmadilloProtocol=a;g.parseOneOfContentType=l}),98);
__d("MAWParseCollapsibleIdFromXMADataClass",["FBLogger","MWXMAV2IsDataclassLiveLocationXMA"],(function(a,b,c,d,e,f,g){"use strict";function a(a){if(a==null)throw c("FBLogger")("messenger_web").mustfixThrow("xmaDataclass is missing or invalid");var b=d("MWXMAV2IsDataclassLiveLocationXMA").isDataclassLiveLocationXMA(a);if(b)return h(a);b=JSON.parse(a);a=b.layout_config;if(a==null||typeof a.collapsible_id!=="number")throw c("FBLogger")("messenger_web").mustfixThrow("Layout config or collapsible_id is missing or invalid");return a.collapsible_id}function h(a){a=JSON.parse(a);a=(a=a.content)==null?void 0:a.custom_template_data;if((a==null?void 0:a.__typename)!=="XMSGXmaLocationTemplateData"||a==null)throw c("FBLogger")("messenger_web").mustfixThrow("Live location metadata or session_id is missing");return parseInt(a.location_metadata.session_id,10)}g.parseCollapsibleIdFromXMADataClass=a}),98);
__d("MWXMAV2IsCollapsibleXMA",["FBLogger","MWXMAV2IsDataclassLiveLocationXMA"],(function(a,b,c,d,e,f,g){"use strict";function a(a){if(a==null)return!1;var b;try{b=JSON.parse(a)}catch(a){c("FBLogger")("messenger_web_sharing").mustfix("Error parsing xma dataclass");return!1}if(b==null)return!1;var e=b.layout_config;return(e==null?void 0:e.collapsible_id)==null&&!d("MWXMAV2IsDataclassLiveLocationXMA").isDataclassLiveLocationXMA(a)?!1:!0}g.isCollapsibleXMA=a}),98);
__d("MAWParseXMAProtocol",["FBLogger","MAWMsgType","MAWODSProxy","MAWParseArmadilloProtocol","MAWParseCollapsibleIdFromXMADataClass","MAWParseSubprotocolVersionConsts","MAWParseXMAFBConfig","MAWXMALoggingUtils","MWXMAV2IsCollapsibleXMA","MWXMAV2IsDataclassLiveLocationXMA","WAArmadilloXMA.pb","WAGetPlatformFromStanzaId","WAHex","WAJids","WALogger","WAMedia","WAMsgApplication.pb","WAOdsEnums","WAParseConsumerMessageProtocol","WAParseMediaTransportProtocol","WAParseMessageApplication","WAParseProtocolUtils","WAStanzaUtils","WATimeUtils","decodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";var aa=["actionContentBlob"],h,i,j,k,l,m,n,o,p,q,r,s,t,u=new Set([d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_REPLY]);function v(a,b){return a==null||a.payload==null?void 0:d("WAParseMediaTransportProtocol").decodeImageTransport(a.payload,b,"xma-image")}function ba(a,b,e,f,g){if(b==null||b.payload==null)return null;b.version!==d("MAWParseSubprotocolVersionConsts").ASSOCIATED_MESSAGE_SUBPROTOCOL_VERSION&&d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[XMA] received associated message with incorrect version ",""])),b.version);b=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMsgApplication.pb").MessageApplicationSpec,b.payload);b=d("WAParseMessageApplication").parseMessageApplication(b);if(b.type==="error")throw c("FBLogger")("messenger_web").mustfixThrow("XMA contains unparseable message application.");b=b;if(b.subprotocolType!=="consumerMessage")throw c("FBLogger")("messenger_web").mustfixThrow("XMA contains incorrect message application type: "+b.subprotocolType);return d("WAParseConsumerMessageProtocol").parseConsumerMessageProtocol(a,b.payload,e,f,g)}var w="https://www.instagram.com/stories/",x="https://www.instagram.com/reel/",y="https://www.instagram.com/tv/",z="https://www.instagram.com/_n/profile_shop?",A="https://www.instagram.com/",B="https://www.alpha.facebook.com/share/",C="https://m.facebook.com/share/",D="https://www.facebook.com/share/",E="https://m.alpha.facebook.com/share/",F="https://facebook.com/share/",G="https://www.alpha.facebook.com/stories/",H="https://www.facebook.com/stories/",I="https://fb.gg/",J="https://www.facebook.com/",K="https://m.facebook.com/",L="https://www.alpha.facebook.com/",M="https://m.alpha.facebook.com/",N="https://facebook.com/",O="https://fb.watch/",P="https://www.facebook.com/l.php",Q="https://m.facebook.com/l.php",R="https://www.alpha.facebook.com/l.php",S="https://m.alpha.facebook.com/l.php",T="https://facebook.com/l.php",U="https://l.facebook.com/l.php",V="https://facebook.com/events/",W="https://www.facebook.com/events/",X="https://www.alpha.facebook.com/events/",Y="https://m.facebook.com/events/",ca="https://m.alpha.facebook.com/events/",da="fb-messenger://payments/receipt?product_id=",ea="messenger://location_share",fa="http://m.me/",ga=":",ha="http://",ia="https://";function a(a){var b=a.chat,e=a.content,f=a.ebTimestampMs,g=a.meta,h=a.metadata;a=a.protobuf;var n=d("MAWParseArmadilloProtocol").parseOneOfContentType(e);n=n==="paymentsTransactionMessage";var o=null;if(n){var p;o=(p=e.paymentsTransactionMessage)==null?void 0:p.extendedContentMessage}else o=e.extendedContentMessage;if(o==null&&n)return"paymentsTransactionMessage";if(o==null)throw c("FBLogger")("messenger_web").mustfixThrow("extendedContentMessage has no content");p=o;e=p.targetType;p=p.xmaDataclass;var q=d("WAGetPlatformFromStanzaId").getPlatformFromStanzaId(g.id.externalId);p!=null&&d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_XMA_PROTOCOL_PARSING,key:"xma_dataclass.exists."+(e!=null?e:"null")});if(e==null||!d("MAWParseXMAFBConfig").isFBSupportedTargetType({fbTargetType:e,xmaDataclass:p}))return{contentTypeForLogging:"extendedContentMessage",unstoredMedia:null,unstoredMsg:{ack:g.ack,id:g.id,msgContent:{protobuf:d("WAHex").bytesToBuffer(a),subtype:ka(e,p,n)},reportingMeta:g.reportingMeta,sentTs:g.sentTs,serverTs:g.serverTs,ts:g.ts,type:d("MAWMsgType").MSG_TYPE.FUTUREPROOF},unstoredQuotedMedia:null,unstoredXMA:null,xmaTargetTypeForLogging:e};n=d("WAParseProtocolUtils").parseEphemerality(g,h);var r=n.deleteTs,s=n.ephemeralSetting;n=n.expirationTs;var t=d("WAParseProtocolUtils").enhanceReportingMeta(g,h),w=o,x=w.associatedMessage,y=w.commands,z=w.contentRef,A=w.ctas,B=w.favicon,C=w.headerImage,D=w.headerTitle,E=w.maxSubtitleNumOfLines,F=w.maxTitleNumOfLines,G=w.mentionedJid,H=w.messageText,I=w.overlayDescription,J=w.overlayIconGlyph,K=w.overlayTitle,L=w.previews,M=w.sentWithMessageId,N=w.subtitleText,O=w.targetId,P=w.targetUsername,Q=w.titleText;w=w.xmaLayoutType;x!=null&&(x.version==null||x.version<d("MAWParseSubprotocolVersionConsts").ASSOCIATED_MESSAGE_SUBPROTOCOL_VERSION)&&d("WALogger").WARN(i||(i=babelHelpers.taggedTemplateLiteralLoose(["\n      received associatedMessage version is older than expected "," as expected. "])),d("MAWParseSubprotocolVersionConsts").ASSOCIATED_MESSAGE_SUBPROTOCOL_VERSION);C!=null&&(C.version==null||C.version<d("MAWParseSubprotocolVersionConsts").XMA_HEADER_SUBPROTOCOL_VERSION)&&d("WALogger").WARN(j||(j=babelHelpers.taggedTemplateLiteralLoose(["\n    received headerImage version is older than expected ",". "])),d("MAWParseSubprotocolVersionConsts").XMA_HEADER_SUBPROTOCOL_VERSION);B!=null&&(B.version==null||B.version<d("MAWParseSubprotocolVersionConsts").XMA_FAVICON_SUBPROTOCOL_VERSION)&&d("WALogger").WARN(k||(k=babelHelpers.taggedTemplateLiteralLoose(["\n    received favicon version is older than expected ",". "])),d("MAWParseSubprotocolVersionConsts").XMA_FAVICON_SUBPROTOCOL_VERSION);L.every(function(a){(a.version==null||a.version<d("MAWParseSubprotocolVersionConsts").XMA_PREVIEW_SUBPROTOCOL_VERSION)&&d("WALogger").WARN(l||(l=babelHelpers.taggedTemplateLiteralLoose(["\n      received previews version is older than expected ",". "])),d("MAWParseSubprotocolVersionConsts").XMA_PREVIEW_SUBPROTOCOL_VERSION)});o=o.targetExpiringAtSec!=null?d("WATimeUtils").castLongIntToUnixTime(o.targetExpiringAtSec):void 0;var R=x!=null&&M!=null?[d("WAStanzaUtils").toStanzaId(M),g.id.externalId]:[g.id.externalId,void 0],S=R[0];R=R[1];var T=[];if(L!=null)for(var U=0;U<L.length;U++){var V,W=v(L[U],g.ts);W!=null&&!((e===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_EXTERNAL_LINK_SHARE||e===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_SHARE)&&W.mediaType===d("WAMedia").MEDIA_TYPE.IMAGE&&((V=W.validatedImageInfo)==null?void 0:V.height)===1&&((V=W.validatedImageInfo)==null?void 0:V.width)===1)&&T.push(W)}V=v(C,g.ts);W=v(B,g.ts);L=(U=d("WAParseConsumerMessageProtocol").parsedQuotedConsumerMessage(h))!=null?U:void 0;var X;if(d("MWXMAV2IsCollapsibleXMA").isCollapsibleXMA(p))try{X=d("MAWParseCollapsibleIdFromXMADataClass").parseCollapsibleIdFromXMADataClass(p)}catch(a){d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_XMA_PROTOCOL_PARSING,key:"xma_validation."+q+"."+(e||0)+".error"});throw c("FBLogger")("messenger_web").mustfixThrow("Unexpected error trying to parse collapsible ID: "+a.message)}C=babelHelpers["extends"]({collapsibleId:X,deleteTs:r,ebTimestampMs:f,ephemeralSetting:s,expirationTs:n,id:babelHelpers["extends"]({},g.id,{externalId:S}),quote:L,reportingMeta:t,type:d("MAWMsgType").MSG_TYPE.XMA},g);B=A.map(function(a){a.actionContentBlob;a=babelHelpers.objectWithoutPropertiesLoose(a,aa);return a});U=B.slice(1);e===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_GAMING_CUSTOM_UPDATE&&A.length===1&&(U=B);q=e===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_CONTACT;L={author:g.id.author,commands:y,contentRef:z,ctas:U,defaultCTA:B[0],externalId:S,faviconMediaId:q?(r=V==null?void 0:V.plaintextHash)!=null?r:void 0:(f=W==null?void 0:W.plaintextHash)!=null?f:void 0,headerMediaId:q?(s=W==null?void 0:W.plaintextHash)!=null?s:void 0:(n=V==null?void 0:V.plaintextHash)!=null?n:void 0,headerTitle:D,isTombstoned:o!=null?d("WATimeUtils").unixTime()>o:!1,maxSubtitleNumOfLines:E,maxTitleNumOfLines:F,mentionedJids:G.map(d("WAJids").validateUserJid).filter(Boolean),overlayDescription:I,overlayIconGlyph:J,overlayTitle:K,previewMediaIds:T.length>0?T.map(function(a){return a.plaintextHash}):void 0,sentWithMessage:H,subtitleText:N,targetExpiringAtSec:o,targetId:O,targetType:e,targetUsername:P,threadJid:b,titleText:Q,xmaDataclass:p,xmaLayoutType:w};var Y;if(x!=null&&M==null)throw c("FBLogger")("messenger_web").mustfixThrow("XMA associatedMessage cannot be received without sentWithMessageId field");x!=null&&R!=null&&(Y=ba(b,x,g,a,h));y=(A=(t=Y)==null?void 0:t.unstoredMedia)!=null?A:null;z=u.has(e);if(y!=null&&!z){U=d("MAWXMALoggingUtils").getXmaTargetTypeStringFromEnum(e);d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_XMA_PROTOCOL_PARSING,key:"assoc_msg_media_"+(U!=null?U:"unknown")});throw c("FBLogger")("messenger_web").mustfixThrow("XMA associated msg cannot have additioinal dbMedia")}f=(r=(B=Y)==null?void 0:B.unstoredMsg)!=null?r:null;R!=null&&f!=null&&(d("WALogger").DEV(m||(m=babelHelpers.taggedTemplateLiteralLoose(["ExternalId: "," textId: ",""])),S,R),f.id=babelHelpers["extends"]({},f.id,{externalId:R}),C.id=babelHelpers["extends"]({},f.id,{externalId:S}),L.externalId=S);if(z&&y!=null&&((f==null?void 0:f.type)==="Gif"||(f==null?void 0:f.type)==="Sticker"))return{contentTypeForLogging:"extendedContentMessage",unstoredMedia:null,unstoredMsg:C,unstoredQuotedMedia:null,unstoredXMA:{unstoredAssociatedMedia:y!=null?y:void 0,unstoredAssociatedMsg:f!=null?f:void 0,unstoredFavicon:q?T[0]:W,unstoredHeaderMedia:V,unstoredPreviews:T.length>0?T:void 0,xma:L},xmaTargetTypeForLogging:e};if(f!=null&&f.type!=="Text")throw c("FBLogger")("messenger_web").mustfixThrow('XMA associated msg cannot have type different from "Text". Received type: '+f.type);return{contentTypeForLogging:"extendedContentMessage",unstoredMedia:null,unstoredMsg:C,unstoredQuotedMedia:null,unstoredXMA:{unstoredAssociatedMedia:void 0,unstoredAssociatedMsg:f!=null?f:void 0,unstoredFavicon:q?T[0]:W,unstoredHeaderMedia:V,unstoredPreviews:T.length>0&&!q?T:void 0,xma:L},xmaTargetTypeForLogging:e}}function ja(a){var b=a.ebRestore,c=a.hasActionUrl,e=a.hasNativeUrl,f=a.isActionUrlValid,g=a.isNativeUrlValid;a=a.targetType;!g&&!f?d("WALogger").ERROR(n||(n=babelHelpers.taggedTemplateLiteralLoose([""," XMA has invalid action and native URL for target type: ",". hasNativeUrl: ",". hasActionUrl: ","."])),b!=null&&b?"[labyrinth_web]":"[S410301][transport]",a,e,c):g&&!f?d("WALogger").ERROR(o||(o=babelHelpers.taggedTemplateLiteralLoose([""," XMA has invalid action URL for target type: ",". hasNativeUrl: ",". hasActionUrl: ","."])),b!=null&&b?"[labyrinth_web]":"[S410301][transport]",a,e,c):f&&!g&&d("WALogger").ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose([""," XMA has invalid native URL for target type: ",". hasNativeUrl: ",". hasActionUrl: ","."])),b!=null&&b?"[labyrinth_web]":"[S410301][transport]",a,e,c)}function b(a,b,c){var d=a.nativeUrl;a=a.actionUrl;var e=Z(d,b,c),f=Z(a,b,c);ja({ebRestore:c,hasActionUrl:a!=null,hasNativeUrl:d!=null,isActionUrlValid:f,isNativeUrlValid:e,targetType:b});return e&&f}function ka(a,b,c){c===void 0&&(c=!1);if(a==null)return null;if(c)return"paymentsTransactionMessage";switch(a){case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_LOCATION_SHARING:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_LOCATION_SHARING_V2:return d("MWXMAV2IsDataclassLiveLocationXMA").isDataclassLiveLocationXMA(b)?"liveLocationMessage":"locationMessage";case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_CONTACT:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_AI_CONTACT:return"contactShareMessage";case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_MENTION:return"storyMentionMessage";case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_POST_MENTION:return"postMentionMessage";case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_MEMORIES_SHARE:return"messengerMemory";case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_AUDIO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_VIDEO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_AUDIO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_VIDEO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_GROUP_AUDIO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_GROUP_VIDEO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_AUDIO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_VIDEO_CALL:return"rtcMessage";default:return null}}function Z(a,b,c,e){e===void 0&&(e=!1);if(a==null)return!0;if(oa(a,b)===!1){c!=null&&c&&!e&&d("WALogger").ERROR(q||(q=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Invalid url prefix during XMA restore"])));return!1}if(!pa(a)){c!=null&&c&&!e&&d("WALogger").ERROR(r||(r=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Invalid message text during XMA restore"])));return!1}return!0}function la(a){return a.startsWith(B)||a.startsWith(C)||a.startsWith(D)||a.startsWith(E)||a.startsWith(F)}function ma(a){return a.startsWith(P)||a.startsWith(Q)||a.startsWith(R)||a.startsWith(S)||a.startsWith(T)||a.startsWith(U)}function $(a){return a.startsWith(J)||a.startsWith(K)||a.startsWith(L)||a.startsWith(M)||a.startsWith(N)}function na(a){return a.startsWith(V)||a.startsWith(W)||a.startsWith(X)||a.startsWith(Y)||a.startsWith(ca)}function oa(a,b){if(a==null)return!0;switch(b){case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_MENTION:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_HIGHLIGHT_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_HIGHLIGHT_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_HIGHLIGHT_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REACTION:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_HIGHLIGHT_REACTION:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_MENTION:return a.startsWith(w);case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_CLIPS_SHARE:return a.startsWith(x);case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_IGTV_SHARE:return a.startsWith(y);case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SHOP_SHARE:return a.startsWith(z);case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_IMAGE_POST_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_MULTIPOST_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_VIDEO_POST_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_PROFILE_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_IG_MEDIA_SHARE:return a.startsWith(A);case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_PRODUCER_STORY_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_MENTION:return a.startsWith(H)||a.startsWith(G)||la(a);case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_PROFILE_DIRECTORY_ITEM:return $(a);case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_GAMING_CUSTOM_UPDATE:return a.startsWith(I);case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_POST_PRIVATE_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_SHORT:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_VIDEO_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_HIGHLIGHTS_TAB_FRIEND_UPDATES_REPLY:return($(a)||a.startsWith(O))&&!ma(a);case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_LOCATION_SHARING:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_LOCATION_SHARING_V2:return a.startsWith(ea);case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_HIGHLIGHTS_TAB_LOCAL_EVENT_REPLY:return na(a);case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_EVENT:return na(a)||la(a);case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_CONTACT:return $(a)||a.startsWith(fa);case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_EXTERNAL_LINK:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_EXTERNAL_LINK_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_AUDIO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_VIDEO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_AUDIO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_VIDEO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_AUDIO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_VIDEO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_GROUP_AUDIO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_GROUP_VIDEO_CALL:if(a.includes(ga)&&(!a.startsWith(ha)&&!a.startsWith(ia))){b=a.indexOf("://");b===-1&&d("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(['S410301 The url is invalid. It contains a colon separator, but not "://"'])));return!1}break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_RECEIVER_FETCH:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.DATACLASS_SENDER_COPY:return!0;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_P2P_PAYMENT:return a.startsWith(da)}return!0}function pa(a){for(var b=0;b<a.length;b++){var c=a.charAt(b);switch(c){case"\u202c":case"\u202d":case"\u202e":d("WALogger").ERROR(t||(t=babelHelpers.taggedTemplateLiteralLoose(["S410301 The url contains RTL characters"])));return!1;default:break}}return!0}g.SUPPORTED_XMA_ASSOC_MEDIA_TARGET_TYPES=u;g.kIGStoryCtaPrefix=w;g.kIGClipsCtaPrefix=x;g.kIGTVCtaPrefix=y;g.kIGShopCtaPrefix=z;g.kIGDefaultCtaPrefix=A;g.kFBStoryCtaPrefix=H;g.kFBGamingCustomUpdateCtaPrefix=I;g.kFBDefaultWWWCtaPrefix=J;g.kFBEventCtaPrefix=V;g.kMSGP2PPaymentUrlPrefix=da;g.kMessengerLocationSharePrefix=ea;g.kHttpPrefix=ha;g.parseXMAProtocol=a;g.isValidCTA=b;g.getUnsupportedMessageType=ka;g.isURLValid=Z}),98);
__d("MAWSupportedDocumentTypes",[],(function(a,b,c,d,e,f){"use strict";var g=["apk","pyc","7z","z","gz","xz","rar","zip","zipx","ace","arc","zpaq","quad","balz","cab","arj","lzh","uue","bz","bz2","bzip2","jar","iso","tar","ade","adp","air","app","application","bas","bat","chm","cmd","com","command","cpl","crt","dll","dmg","dpkg","exe","hlp","hta","inf","ins","isp","jnlp","js","jse","lib","lnk","lua","mde","msc","msi","msp","mst","ocx","pcd","pif","pkg","ps1","reg","scr","sct","sh","shb","shs","sys","term","url","vb","vbe","vbs","vxd","webarchive","wsc","wsf","wsh","xbap"];function a(a){if(a==null)return!1;a=a.includes(".")?a.split(".").pop():null;return a!=null&&!g.includes(a)}f.isAllowedType=a}),66);
__d("WAPREList",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({APP_STATE_SYNC_DAILY:"app_state_sync_daily",CREATE_GROUP:"create_group",DECRYPT_MESSAGE_FINAL:"decrypt_message_final",DELETE_THREAD:"delete_thread",DOWNLOAD_AND_DECRYPT:"download_and_decrypt",EBDB_INIT:"ebdb_init",FRANKING_VALIDATION:"franking_validation",GET_DEVICES:"get_devices",ICDC_ERROR:"icdc_error",MEDIA_DOWNLOAD:"media_download",MEDIA_UPLOAD:"media_upload",MEDIA_VALIDATE:"media_validate",MESSAGE_DECRYPTION:"message_decryption",MESSAGE_ENCRYPTION:"message_encryption",OFFLINE_QUEUE:"offline_queue",OFFLINE_RETRY:"offline_retry",ONE_QUEUE:"one_queue",QUERY_GROUP:"query_group",QUERY_GROUPS:"query_groups",RECEIVE_MESSAGE:"receive_message",REMOVE_PARTICIPANTS:"remove_participants",SEND_MESSAGE:"send_message",STANZA_QUEUE_MESSAGE_CONSUMER:"stanza_queue_message_consumer",SYNCD:"syncd",SYNCD_BOOTSTRAP_APP_STATE_DOWNLOAD:"syncd_bootstrap_app_state_download",SYNCD_BOOTSTRAP_DATA_APPLIED:"syncd_bootstrap_data_applied",SYNCD_CRITICAL_BOOTSTRAP_STAGE:"syncd_critical_bootstrap_stage",SYNCD_CRITICAL_EVENT:"syncd_critical_event",SYNCD_DECRYPT_MUTATIONS:"syncd_decrypt_mutations",SYNCD_FATAL_ERROR:"syncd_fatal_error",SYNCD_KEY_ROTATION:"syncd_key_rotation",WA_DISCONNECT:"wa_disconnect",WA_FAIL_STANZA_QUEUE_ITEM:"stanza_queue_item_failure",WA_JOB_MANAGER:"wa_job_manager",WA_JOBS_ORCHESTRATOR:"wa_jobs_orchestrator",WA_NO_SIGNED_PRE_KEY:"wa_no_signed_pre_key"});f.PRE_METRIC=a}),66);
__d("WAPREMetrics",["WALogger","WAPREList"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;c=6e4;e=18e4;f=10*60*1e3;var k=0;function a(){var c=[];function e(a){c.push(a)}function b(){d("WALogger").WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Removing all listeners from PRE_METRICS"]))),c.length=0}function a(a){c.length===0&&d("WALogger").WARN(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[PRE] There are no subscribers to PRE events "," ",""])),a.name,a.stage),c.forEach(function(b){b(a)})}return{subscribe:e,notify:a,clear:b}}a=a();var l=a.notify,m=a.clear;a=a.subscribe;var n;"FinalizationRegistry"in self&&"WeakRef"in self&&(n=new FinalizationRegistry(function(a){var b=a.event;a=a.eventFlow;if(a.isActive())try{d("WALogger").ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["[PRE][","] EventFlow still active during garbage collection"])),b)}catch(a){}}));var o=new Set([d("WAPREList").PRE_METRIC.SEND_MESSAGE,d("WAPREList").PRE_METRIC.MEDIA_DOWNLOAD]);function b(a,b,c,d){c==null&&k++;var e=c!=null?c:k,f="open";c==null?l({name:a,stage:"START",instanceKey:e,annotations:b,timeoutInMs:d}):l({name:a,stage:"RESUME",instanceKey:e,annotations:b});var g;function h(){if(g!=null){var a=g.deref();if(a!=null){var b;(b=n)==null||b.unregister(a)}}}d={addPoint:function(c,b){l({name:a,stage:"POINT",reason:c,instanceKey:e,annotations:b})},addAnnotations:function(b){l({name:a,stage:"ANNOTATE",instanceKey:e,annotations:b})},endSuccess:function(b){l({name:a,stage:"SUCCESS",instanceKey:e,annotations:b}),f="closed",h()},endCancel:function(b){l({name:a,stage:"CANCEL",instanceKey:e,annotations:b}),h()},endFail:function(c,b){l({name:a,stage:"FAIL",reason:c,instanceKey:e,annotations:b}),f="closed",h()},getFlowDetails:function(){return{name:a,instanceKey:e}},isActive:function(){return f==="open"}};n&&!o.has(a)&&c==null&&(n.register(d,{event:a,eventFlow:{endCancel:d.endCancel,isActive:d.isActive}}),g=new WeakRef(d));return d}g.QPL_DEFAULT_TIMEOUT_IN_MS=c;g.QPL_RECEIVE_MESSAGE_TIMEOUT_IN_MS=e;g.QPL_MEDIA_DOWNLOAD_TIMEOUT_IN_MS=f;g.clear=m;g.subscribe=a;g.startMetric=b}),98);
__d("WAWaitForUserUnblocked",["WAResolvable","WorkerScheduler"],(function(a,b,c,d,e,f,g){"use strict";f=2*60*1e3;var h=new(d("WAResolvable").Resolvable)(),i=d("WorkerScheduler").makeScheduler("offline-queue",{concurrency:1,maxConcurrency:1,defaultSamplingRate:1e3,timeToStuckMs:f});function a(){h.resolveWasCalled()&&(h=new(d("WAResolvable").Resolvable)(),j())}function j(){void i.runTask({name:"offline-queue",fn:function(){return h.promise},priority:d("WorkerScheduler").BLOCKING_PRIORITY})}function b(){return h.promise}function c(){h.resolve()}function e(){return!h.resolveWasCalled()}g.maybeResetWaitForUserUnblocked=a;g.markOfflineQueueAsStarted=j;g.waitForUserUnblocked=b;g.unblockUser=c;g.isStillWaitingForUserUnblocked=e}),98);
__d("isE2EEConversationSearchEnabled",["gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("gkx")("4741")}g["default"]=a}),98);
__d("isMAWUniversalSearchEnabled",["gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("gkx")("4741")}g["default"]=a}),98);
__d("memoizeWithArgsLFUCache",["LFUCache"],(function(a,b,c,d,e,f,g){function a(a,b,d,e){var f;function g(){f||(f=new(c("LFUCache"))(d));return f}function h(){f=null}e&&e(h);e=function(){var c=g(),d=b.apply(void 0,arguments);c.has(d)||c.set(d,a.apply(void 0,arguments));var e=c.get(d);return e};return e}g["default"]=a}),98);/*FB_PKG_DELIM*/
__d("useBaseTypeaheadSubscriptionDataSourceFetchResolverNetwork",["react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h;b=h||d("react");b.useCallback;var i=b.useEffect,j=b.useRef,k=b.useState;function a(a,b){var c=d("react-compiler-runtime").c(9),e=a.dataSource;a=b===void 0?!1:b;b=k(a);a=b[0];var f=b[1],g=j(null);c[0]!==e?(b=function(a){var b,c=a.onResolvePayload;a=a.requestParams;(b=g.current)==null||b.unsubscribe();g.current=e.fetchNetwork(a).subscribe({complete:function(){f(!1)},error:function(a){f(!1)},next:function(a){return c(a)},start:function(a){f(!0)},unsubscribe:function(){f(!1)}})},c[0]=e,c[1]=b):b=c[1];b=b;var h,l;c[2]===Symbol["for"]("react.memo_cache_sentinel")?(h=function(){return function(){var a;(a=g.current)==null||a.unsubscribe()}},l=[],c[2]=h,c[3]=l):(h=c[2],l=c[3]);i(h,l);c[4]!==a?(h={isLoading:a},c[4]=a,c[5]=h):h=c[5];c[6]!==b||c[7]!==h?(l=[h,b],c[6]=b,c[7]=h,c[8]=l):l=c[8];return l}g["default"]=a}),98);
__d("useBaseTypeaheadSubscriptionDataSourceFetchResolver",["cometTypeaheadODSLogFetchNetworkEvent","cr:2557","react","react-compiler-runtime","recoverableViolation","useBaseTypeaheadSubscriptionDataSourceFetchResolverNetwork","useDebouncedComet"],(function(a,b,c,d,e,f,g){"use strict";var h;e=h||d("react");e.useCallback;var i=e.useEffect,j=e.useRef;function a(a,e){var f=d("react-compiler-runtime").c(17),g=a.dataSource,h=a.dataSourceFetchConfigParams,k=a.onResolvePayload;f[0]!==h?(a=h===void 0?{}:h,f[0]=h,f[1]=a):a=f[1];h=a;a=h.requestFlow;h=h.shouldDebounceNetwork;var l=h===void 0?!0:h;f[2]!==g?(h={dataSource:g},f[2]=g,f[3]=h):h=f[3];g=c("useBaseTypeaheadSubscriptionDataSourceFetchResolverNetwork")(h);h=g[0];var m=g[1];g=h.isLoading;var n=c("useDebouncedComet")(m);f[4]!==k?(h=function(a,b){var d=b.isTraceComplete;b=b.source;try{k(a,{isTraceComplete:d,source:b})}catch(a){c("recoverableViolation")("Failed to resolve fetched payload","search")}return b},f[4]=k,f[5]=h):h=f[5];var o=h,p=j(a);f[6]!==o?(h=function(a){o(a,{isTraceComplete:!0,source:a.entries.length>0?"network":"network-no-results"}),c("cometTypeaheadODSLogFetchNetworkEvent")&&c("cometTypeaheadODSLogFetchNetworkEvent")("comet.ta.fetch",!0,1),b("cr:2557")&&b("cr:2557")(["all"],a)},f[6]=o,f[7]=h):h=f[7];var q=h;f[8]!==m||f[9]!==n||f[10]!==e||f[11]!==q||f[12]!==l?(a=function(){var a=function(a){a=a.requestParams;var b=a.requestFlow;b!=null&&(p.current=b);b={onResolvePayload:q,requestParams:babelHelpers["extends"]({},a,{requestFlow:p.current})};Boolean(l)?n(b):m(b)};e!=null&&a(e)},h=[m,n,e,q,l],f[8]=m,f[9]=n,f[10]=e,f[11]=q,f[12]=l,f[13]=a,f[14]=h):(a=f[13],h=f[14]);i(a,h);f[15]!==g?(a=[{isLoading:g}],f[15]=g,f[16]=a):a=f[16];return a}g["default"]=a}),98);
__d("useBaseTypeaheadSubscriptionDataSourceFetch",["react","react-compiler-runtime","recoverableViolation","useBaseTypeaheadSubscriptionDataSourceFetchResolver"],(function(a,b,c,d,e,f,g){"use strict";var h=["loggingEventTrace"],i;b=i||d("react");b.useCallback;var j=b.useState;function a(a){var b,e=d("react-compiler-runtime").c(9),f=j(null),g=f[0],i=f[1];f=c("useBaseTypeaheadSubscriptionDataSourceFetchResolver")(a,g);a=f[0];f=a.isLoading;e[0]===Symbol["for"]("react.memo_cache_sentinel")?(a=function(a,b){b=b===void 0?"all":b;i({requestParams:a,source:b})},e[0]=a):a=e[0];var k=a;e[1]!==g?(a=function(a){a=a||{};var b=a.requestFlow;a=a.source;if(g==null){c("recoverableViolation")("Refetch cannot be called with undefined `fetchParams`","search");return}var d=g.requestParams,e=d.loggingEventTrace;d=babelHelpers.objectWithoutPropertiesLoose(d,h);e=babelHelpers["extends"]({loggingEventTrace:babelHelpers["extends"]({},e,{sequenceID:String(Date.now())}),requestFlow:b},d);k(e,a)},e[1]=g,e[2]=a):a=e[2];a=a;b=(b=g==null?void 0:g.source)!=null?b:"all";var l;e[3]!==f||e[4]!==b?(l={isLoading:f,source:b},e[3]=f,e[4]=b,e[5]=l):l=e[5];e[6]!==a||e[7]!==l?(f=[l,k,a],e[6]=a,e[7]=l,e[8]=f):f=e[8];return f}g["default"]=a}),98);
__d("TypeaheadLoggingFetchRequestFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("1880031");b=d("FalcoLoggerInternal").create("typeahead_logging_fetch_request",a);e=b;g["default"]=e}),98);
__d("CometTypeaheadVolumeLoggingProvider",["TypeaheadLoggingFetchRequestFalcoEvent","recoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h=function(){return Math.random().toString()};a=function(){function a(a){this.$2=null,this.$1=a,this.$2=h()}var b=a.prototype;b.getContext=function(){return this.$1};b.getSessionID=function(){this.$2==null&&c("recoverableViolation")("Logging sessionID requested from "+this.getContext()+" surface does not exist.","search");return this.$2};b.logRequest=function(a){var b={context:this.getContext(),requestType:a,sessionID:this.getSessionID()};c("TypeaheadLoggingFetchRequestFalcoEvent").log(function(){return{fetchRequest:b}})};return a}();g["default"]=a}),98);
__d("useCometTypeaheadVolumeLoggingProvider",["CometTypeaheadVolumeLoggingProvider","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h;(h||d("react")).useMemo;function a(a){var b=d("react-compiler-runtime").c(2);a=a===void 0?"UNKNOWN":a;var e;b[0]!==a?(e=new(c("CometTypeaheadVolumeLoggingProvider"))(a),b[0]=a,b[1]=e):e=b[1];a=e;return a}g["default"]=a}),98);
__d("CometInternalTypeaheadSubscriptionProvider",["CometInternalTypeaheadEmptyFetchProvider","CometInternalTypeaheadFetchContext","react","useBaseTypeaheadSubscriptionDataSourceFetch","useCometInternalTypeaheadStateDispatcher","useCometTypeaheadVolumeLoggingProvider"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react"));b=h;var j=b.useCallback,k=b.useMemo;function a(a){var b=a.children,d=a.dataSource,e=a.dataSourceFetchConfigParams,f=a.loggingContext,g=a.onFetchEntries_DO_NOT_USE,h=a.traceProvider;a=c("useCometInternalTypeaheadStateDispatcher")();var l=a.dispatchActiveEntries,m=c("useCometTypeaheadVolumeLoggingProvider")(f);a=c("useBaseTypeaheadSubscriptionDataSourceFetch")({dataSource:d,dataSourceFetchConfigParams:e,onResolvePayload:j(function(a,b){a=a.entries;var c=b.isTraceComplete;b=b.source;l(a!=null?a:[]);m.logRequest(o);g&&g(a);h&&!h.isResolved()&&(c&&(b==="cache"&&a.length>=h.getEntriesCountForVisualComplete()?h.setEndReason("max_suggestions_reached"):b==="network"?h.setEndReason("all_queries_completed"):b==="network-no-results"&&h.setEndReason("all_queries_completed_no_network_results"),h.resolve()))},[l,g,h])});f=a[0];var n=f.isLoading,o=f.source,p=a[1],q=a[2];d=k(function(){return{fetch:p,isLoading:n,refetch:q,source:o}},[p,n,q,o]);return i.jsx(c("CometInternalTypeaheadFetchContext").Provider,{value:d,children:i.jsx(c("CometInternalTypeaheadEmptyFetchProvider"),{isLoading:n,source:o,children:b})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("BaseSubscriptionTypeahead.react",["CometHeroInteractionContextPassthrough.react","CometInternalTypeahead.react","CometInternalTypeaheadStateProvider","CometInternalTypeaheadSubscriptionProvider","emptyFunction","react","withCometTypeaheadInputStrategyShouldQueryStringFollowHighlightedEntry"],(function(a,b,c,d,e,f,g){"use strict";var h=["autoOpen","autoFocus","isDisabled","errorMessage","inputStrategyRenderer","dataSource","dataSourceFetchConfigParams","decorators","emptyEntries_DO_NOT_USE","id","label","loggingContext","onBackspace","onBlur","onChange","onClose","onEnter","onEscape","onFetchEntries_DO_NOT_USE","onFocus","onOpen","onPressEntry","placeholder","shouldQueryStringFollowHighlightedEntry","shouldQueryStringUpdateFromSelectedEntryOnClick","testid","traceProvider","inputRef","viewRole","viewStrategyRenderer"],i,j=i||(i=d("react"));b=i;var k=b.useCallback,l=b.useId,m=b.useMemo;function a(a){var b=a.autoOpen;b=b===void 0?!1:b;var d=a.autoFocus;d=d===void 0?!1:d;var e=a.isDisabled;e=e===void 0?!1:e;var f=a.errorMessage;f=f===void 0?null:f;var g=a.inputStrategyRenderer,i=a.dataSource,n=a.dataSourceFetchConfigParams,o=a.decorators,p=o===void 0?[]:o;o=a.emptyEntries_DO_NOT_USE;var q=a.id,r=a.label;r=r===void 0?"":r;var s=a.loggingContext,t=a.onBackspace;t=t===void 0?c("emptyFunction"):t;var u=a.onBlur;u=u===void 0?c("emptyFunction"):u;var v=a.onChange,w=a.onClose;w=w===void 0?c("emptyFunction"):w;var x=a.onEnter;x=x===void 0?c("emptyFunction"):x;var y=a.onEscape;y=y===void 0?c("emptyFunction"):y;var z=a.onFetchEntries_DO_NOT_USE,A=a.onFocus;A=A===void 0?c("emptyFunction"):A;var B=a.onOpen;B=B===void 0?c("emptyFunction"):B;var C=a.onPressEntry,D=a.placeholder;D=D===void 0?"":D;var E=a.shouldQueryStringFollowHighlightedEntry,F=E===void 0?!0:E;E=a.shouldQueryStringUpdateFromSelectedEntryOnClick;var G=E===void 0?!0:E;E=a.testid;E=E===void 0?"":E;E=a.traceProvider;var H=a.inputRef,I=a.viewRole;I=I===void 0?"listbox":I;var J=a.viewStrategyRenderer;a=babelHelpers.objectWithoutPropertiesLoose(a,h);var K=l(),L=m(function(){var a=c("CometInternalTypeahead.react");p.forEach(function(b){var c=b.decorate;b=b.params;a=c(a,b)});return a},[p]),M=k(function(a){G&&v(a.label),C&&C(a)},[v,C,G]),N=m(function(){return c("withCometTypeaheadInputStrategyShouldQueryStringFollowHighlightedEntry")(g,{shouldQueryStringFollowHighlightedEntry:F})},[g,F]);r=r||D;return j.jsx(c("CometHeroInteractionContextPassthrough.react"),{clear:!0,children:j.jsx(c("CometInternalTypeaheadStateProvider"),{autoOpen:b,emptyEntries_DO_NOT_USE:o,onClose:w,onOpen:B,children:j.jsx(c("CometInternalTypeaheadSubscriptionProvider"),{dataSource:i,dataSourceFetchConfigParams:n,loggingContext:s,onFetchEntries_DO_NOT_USE:z,traceProvider:E,children:j.jsx(L,babelHelpers["extends"]({},a,{autoFocus:d,errorMessage:f,id:q!=null?q:K,inputRef:H,inputStrategyRenderer:N,isDisabled:e,label:r,onBackspace:t,onBlur:u,onChange:v,onDownArrow:c("emptyFunction"),onEnter:x,onEscape:y,onFocus:A,onHighlightEntry:c("emptyFunction"),onPressEntry:M,onShiftTab:c("emptyFunction"),onTab:c("emptyFunction"),onUpArrow:c("emptyFunction"),placeholder:D,testid:void 0,viewRole:I,viewStrategyRenderer:J}))})})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("BroadcastChat.svg.react",["react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){return i.jsxs("svg",babelHelpers["extends"]({viewBox:"5 5 25 25",fill:"currentColor",width:"1em",height:"1em"},a,{children:[a.title!=null&&i.jsx("title",{children:a.title}),a.children!=null&&i.jsx("defs",{children:a.children}),i.jsx("path",{fillRule:"evenodd",d:"M18 28.07c6.393 0 11-4.467 11-10.57v-.002C29 11.396 24.393 7 18 7S7 11.396 7 17.498v.002c0 2.091.414 3.98 1.383 5.562.458.747.564 1.664.29 2.5l-.727 2.411c-.2.614.373 1.188.964.986l3.668-1.126a4.261 4.261 0 0 1 2.39-.09c.952.233 1.966.328 3.032.328zm0-8.27a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm4.31-5.888a.75.75 0 0 1 1.06.008l.176.179a5.293 5.293 0 0 1 0 7.402l-.175.178a.75.75 0 0 1-1.061.01l-.357-.351a.75.75 0 0 1-.008-1.061l.175-.178a3.293 3.293 0 0 0 0-4.598l-.175-.178a.75.75 0 0 1 .008-1.06l.357-.351zm-8.255 1.411a.75.75 0 0 0-.008-1.06l-.357-.351a.75.75 0 0 0-1.06.008l-.176.179a5.293 5.293 0 0 0 0 7.402l.175.178a.75.75 0 0 0 1.061.01l.357-.351a.75.75 0 0 0 .008-1.061l-.175-.178a3.293 3.293 0 0 1 0-4.598l.175-.178z",clipRule:"evenodd"})]}))}a.displayName=a.name+" [from "+f.id+"]";a._isSVG=!0;b=a;g["default"]=b}),98);
__d("CancellablePromise",["Promise","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i="CancellationToken.TokenCancelled";function a(a,d,e){return e.then(function(e){return a.isCancelled()?(h||(h=b("Promise"))).reject(c("err")(i)):d(e)})}function d(a,d){return d["catch"](function(d){return d instanceof Error&&d.message===i?(h||(h=b("Promise"))).resolve(a):(h||(h=b("Promise"))).reject(c("err"))})}g.then_=a;g.ignoreFailed=d}),98);
__d("CancellationToken",[],(function(a,b,c,d,e,f){"use strict";function a(){var a={contents:!1};return{cancel:function(){a.contents=!0},isCancelled:function(){return a.contents}}}f["default"]=a}),66);
__d("MWTopNavListDropdownTitle.react",["fbt","BaseHeading.react","Locale","MWXCircleButton.react","MWXIconArrowLeft","MWXIconArrowRight","MWXRow.react","MWXRowItem.react","MWXText.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react"),k=[];function a(a){var b=d("react-compiler-runtime").c(16),e=a.actions,f=a.onReturn,g=a.testid;a=a.title;e=e===void 0?k:e;var i;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(i={className:"x6s0dn4 x78zum5 x2lah0s x1qughib x21xpn4 x1whwgri x1hndj7l xdwfu72 xnx504b"},b[0]=i):i=b[0];var m;b[1]!==f?(m=f!=null?j.jsx(c("MWXRowItem.react"),{children:j.jsx(c("MWXCircleButton.react"),{icon:d("Locale").isRTL()?c("MWXIconArrowRight"):c("MWXIconArrowLeft"),iconRatio:"large",label:h._(/*BTDS*/"\u0e22\u0e49\u0e2d\u0e19\u0e01\u0e25\u0e31\u0e1a"),onPress:f,size:32,type:"deemphasized"})}):null,b[1]=f,b[2]=m):m=b[2];b[3]!==a?(f=j.jsx(c("MWXRowItem.react"),{verticalAlign:"center",children:j.jsx(c("BaseHeading.react"),{isPrimaryHeading:!0,children:j.jsx(c("MWXText.react"),{type:"headlineEmphasized1",children:a})})}),b[3]=a,b[4]=f):f=b[4];b[5]!==m||b[6]!==f?(a=j.jsxs(c("MWXRow.react"),{paddingHorizontal:0,paddingTop:0,spacingHorizontal:8,children:[m,f]}),b[5]=m,b[6]=f,b[7]=a):a=b[7];b[8]!==e?(m=e.map(l),b[8]=e,b[9]=m):m=b[9];b[10]!==m?(f=j.jsx(c("MWXRow.react"),{paddingHorizontal:0,paddingTop:0,spacingHorizontal:8,children:m}),b[10]=m,b[11]=f):f=b[11];b[12]!==a||b[13]!==f||b[14]!==g?(e=j.jsxs("header",babelHelpers["extends"]({},i,{"data-testid":void 0,children:[a,f]})),b[12]=a,b[13]=f,b[14]=g,b[15]=e):e=b[15];return e}function l(a,b){return j.jsx(c("MWXRowItem.react"),{children:a},b)}l.displayName=l.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("CometMessagingJewelDropdownContentGlimmer.react",["FDSListCellGlimmer.react","MWTopNavListDropdownTitle.react","emptyFunction","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){var b=d("react-compiler-runtime").c(9),e=a.isFullHeight,f=a.title;a=a.withBackButton;e=e===void 0?!1:e;a=a===void 0?!1:a;var g;b[0]!==e?(g={0:{},1:{className:"x9f619 x20eyyc xvv7f4i x1cvmir6"}}[!!e<<0],b[0]=e,b[1]=g):g=b[1];b[2]!==f||b[3]!==a?(e=f!=null&&i.jsx(c("MWTopNavListDropdownTitle.react"),{onReturn:a?c("emptyFunction"):void 0,title:f}),b[2]=f,b[3]=a,b[4]=e):e=b[4];b[5]===Symbol["for"]("react.memo_cache_sentinel")?(f=i.jsx(c("FDSListCellGlimmer.react"),{imageSize:56,imageStyle:"circle",numberOfItems:Math.max(Math.ceil((window.innerHeight-72-45)/76),1)}),b[5]=f):f=b[5];b[6]!==g||b[7]!==e?(a=i.jsxs("div",babelHelpers["extends"]({},g,{children:[e,f]})),b[6]=g,b[7]=e,b[8]=a):a=b[8];return a}g["default"]=a}),98);
__d("CometMessagingJewelDropdownEBUpsellContainerQuery.graphql",["CometMessagingJewelDropdownEBUpsellContainerQuery_facebookRelayOperation","MWEBNewUserOnboardingShouldLoadUpsells.relayprovider","relay-runtime"],(function(a,b,c,d,e,f){"use strict";a=function(){var a={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},c={alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},d={alias:null,args:null,concreteType:"MessengerDefaultEncryptedBackup",kind:"LinkedField",name:"messenger_default_encrypted_backup",plural:!1,selections:[{alias:null,args:null,concreteType:"VestaGetUserInfoResponse",kind:"LinkedField",name:"vesta_user_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"attempts_remaining",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_registered",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"login_timeout_remaining_secs",storageKey:null}],storageKey:null}],storageKey:null};return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"CometMessagingJewelDropdownEBUpsellContainerQuery",selections:[{args:null,kind:"FragmentSpread",name:"MWEncryptedBackupsJewelNuxWrapper_query"},{kind:"RequiredField",field:{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"CometMessagingJewelDropdownQPBannerContainer_viewer"}],storageKey:null},action:"THROW",path:"viewer"}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[{defaultValue:null,kind:"LocalArgument",name:"__relay_internal__pv__MWEBNewUserOnboardingShouldLoadUpsellsrelayprovider"}],kind:"Operation",name:"CometMessagingJewelDropdownEBUpsellContainerQuery",selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"xfb_backup",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEBVirtualDevice",kind:"LinkedField",name:"virtual_devices",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"client_generated_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_type",storageKey:null},a],storageKey:null},{alias:null,args:[{kind:"Literal",name:"family_device_id",value:""}],kind:"ScalarField",name:"has_otc_eligible_devices",storageKey:'has_otc_eligible_devices(family_device_id:"")'},a,c],storageKey:null},{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[d,{condition:"__relay_internal__pv__MWEBNewUserOnboardingShouldLoadUpsellsrelayprovider",kind:"Condition",passingValue:!0,selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"if_viewer_can_see_messenger_eb_new_user_onboarding_upsells",plural:!1,selections:[{args:null,documentName:"MWEncryptedBackupsJewelNuxWrapper_query",fragmentName:"MWEBNewUserOnboardingThreadListUpsellWrapper_viewer",fragmentPropName:"viewer",kind:"ModuleImport"}],storageKey:null}]},{kind:"ClientExtension",selections:[{alias:null,args:null,kind:"ScalarField",name:"backup_state",storageKey:null}]},{alias:"jewel_qp",args:[{kind:"Literal",name:"surface_nux_id",value:8439},{kind:"Literal",name:"trigger",value:"MESSAGING_JEWEL_OPEN"}],concreteType:"ViewerEligibleQuickPromotionsConnection",kind:"LinkedField",name:"eligible_promotions",plural:!1,selections:[{alias:null,args:null,concreteType:"QuickPromotion",kind:"LinkedField",name:"nodes",plural:!0,selections:[{alias:null,args:null,concreteType:"CometQuickPromotionSections",kind:"LinkedField",name:"comet_qp_sections",plural:!1,selections:[{alias:null,args:[{kind:"Literal",name:"supported",value:"3nNEjf"}],concreteType:null,kind:"LinkedField",name:"renderer_strategy",plural:!1,selections:[c,{kind:"InlineFragment",selections:[{args:null,documentName:"CometMessagingJewelDropdownQPBannerContainer_viewer",fragmentName:"CometQuickPromotionMessengerDesktopDownloadBannerRendererStrategy_cometQuickPromotionBaseStrategy",fragmentPropName:"cometQuickPromotionBaseStrategy",kind:"ModuleImport"}],type:"CometQuickPromotionMessengerDesktopDownloadBannerRendererStrategy",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"CometMessagingJewelDropdownQPBannerContainer_viewer",fragmentName:"CometQuickPromotionMessengerWebEPDBannerRendererStrategy_cometQuickPromotionBaseStrategy",fragmentPropName:"cometQuickPromotionBaseStrategy",kind:"ModuleImport"}],type:"CometQuickPromotionMessengerWebEPDBannerRendererStrategy",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"CometMessagingJewelDropdownQPBannerContainer_viewer",fragmentName:"CometQuickPromotionMessengerWebPrivacyPolicyNoticeBannerRendererStrategy_quickPromotionRef",fragmentPropName:"quickPromotionRef",kind:"ModuleImport"}],type:"CometQuickPromotionMessengerWebPrivacyPolicyNoticeBannerRendererStrategy",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"CometMessagingJewelDropdownQPBannerContainer_viewer",fragmentName:"CometQuickPromotionArmadilloSecurityAlertsSettingsDefaultOffBannerRendererStrategy_cometQuickPromotionBaseStrategy",fragmentPropName:"cometQuickPromotionBaseStrategy",kind:"ModuleImport"}],type:"CometQuickPromotionArmadilloSecurityAlertsSettingsDefaultOffBannerRendererStrategy",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"CometMessagingJewelDropdownQPBannerContainer_viewer",fragmentName:"CometQuickPromotionMWXCardRendererStrategy_strategy",fragmentPropName:"strategy",kind:"ModuleImport"}],type:"CometQuickPromotionMWXCardRendererStrategy",abstractKey:null}],storageKey:'renderer_strategy(supported:"3nNEjf")'}],storageKey:null},a],storageKey:null}],storageKey:'eligible_promotions(surface_nux_id:8439,trigger:"MESSAGING_JEWEL_OPEN")'}],storageKey:null},{"if":null,kind:"Defer",label:"MWEncryptedBackupsJewelNuxWrapper_query$defer$MWEncryptedBackupsThreadListRestoreQPWrapperDeferred_query",selections:[{"if":null,kind:"Defer",label:"MWEncryptedBackupsThreadListRestoreQPWrapperDeferred_query$defer$MWEncryptedBackupsThreadListRestoreQPWrapper_query",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[d,{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"encrypted_backup",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"has_seen_eb_auto_restore_notice",storageKey:null},a],storageKey:null},{kind:"ClientExtension",selections:[{alias:null,args:null,kind:"ScalarField",name:"qp_with_pin_state",storageKey:null}]}],storageKey:null}]}]}]},params:{id:b("CometMessagingJewelDropdownEBUpsellContainerQuery_facebookRelayOperation"),metadata:{},name:"CometMessagingJewelDropdownEBUpsellContainerQuery",operationKind:"query",text:null,providedVariables:{__relay_internal__pv__MWEBNewUserOnboardingShouldLoadUpsellsrelayprovider:b("MWEBNewUserOnboardingShouldLoadUpsells.relayprovider")}}}}();b("relay-runtime").PreloadableQueryRegistry.set(a.params.id,a);e.exports=a}),null);
__d("CometMessagingJewelDropdownQPBannerContainer_viewer.graphql",[],(function(a,b,c,d,e,f){"use strict";a={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"CometMessagingJewelDropdownQPBannerContainer_viewer",selections:[{alias:"jewel_qp",args:[{kind:"Literal",name:"surface_nux_id",value:8439},{kind:"Literal",name:"trigger",value:"MESSAGING_JEWEL_OPEN"}],concreteType:"ViewerEligibleQuickPromotionsConnection",kind:"LinkedField",name:"eligible_promotions",plural:!1,selections:[{alias:null,args:null,concreteType:"QuickPromotion",kind:"LinkedField",name:"nodes",plural:!0,selections:[{alias:null,args:null,concreteType:"CometQuickPromotionSections",kind:"LinkedField",name:"comet_qp_sections",plural:!1,selections:[{alias:null,args:[{kind:"Literal",name:"supported",value:"3nNEjf"}],concreteType:null,kind:"LinkedField",name:"renderer_strategy",plural:!1,selections:[{kind:"InlineFragment",selections:[{args:null,documentName:"CometMessagingJewelDropdownQPBannerContainer_viewer",fragmentName:"CometQuickPromotionMessengerDesktopDownloadBannerRendererStrategy_cometQuickPromotionBaseStrategy",fragmentPropName:"cometQuickPromotionBaseStrategy",kind:"ModuleImport"}],type:"CometQuickPromotionMessengerDesktopDownloadBannerRendererStrategy",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"CometMessagingJewelDropdownQPBannerContainer_viewer",fragmentName:"CometQuickPromotionMessengerWebEPDBannerRendererStrategy_cometQuickPromotionBaseStrategy",fragmentPropName:"cometQuickPromotionBaseStrategy",kind:"ModuleImport"}],type:"CometQuickPromotionMessengerWebEPDBannerRendererStrategy",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"CometMessagingJewelDropdownQPBannerContainer_viewer",fragmentName:"CometQuickPromotionMessengerWebPrivacyPolicyNoticeBannerRendererStrategy_quickPromotionRef",fragmentPropName:"quickPromotionRef",kind:"ModuleImport"}],type:"CometQuickPromotionMessengerWebPrivacyPolicyNoticeBannerRendererStrategy",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"CometMessagingJewelDropdownQPBannerContainer_viewer",fragmentName:"CometQuickPromotionArmadilloSecurityAlertsSettingsDefaultOffBannerRendererStrategy_cometQuickPromotionBaseStrategy",fragmentPropName:"cometQuickPromotionBaseStrategy",kind:"ModuleImport"}],type:"CometQuickPromotionArmadilloSecurityAlertsSettingsDefaultOffBannerRendererStrategy",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"CometMessagingJewelDropdownQPBannerContainer_viewer",fragmentName:"CometQuickPromotionMWXCardRendererStrategy_strategy",fragmentPropName:"strategy",kind:"ModuleImport"}],type:"CometQuickPromotionMWXCardRendererStrategy",abstractKey:null}],storageKey:'renderer_strategy(supported:"3nNEjf")'}],storageKey:null}],storageKey:null}],storageKey:'eligible_promotions(surface_nux_id:8439,trigger:"MESSAGING_JEWEL_OPEN")'}],type:"Viewer",abstractKey:null};e.exports=a}),null);
__d("CometMessagingJewelDropdownQPBannerContainer.react",["CometMessagingJewelDropdownQPBannerContainer_viewer.graphql","CometMessagingJewelDropdownQPBannerPlaceholder.react","CometPageletWithDiv.react","CometQuickPromotionLoggerContext.react","CometRelay","react","react-compiler-runtime","useQuickPromotionFalcoEvent"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=i||d("react");function a(a){var e,f,g=d("react-compiler-runtime").c(9);a=a.viewer;a=d("CometRelay").useFragment(h!==void 0?h:h=b("CometMessagingJewelDropdownQPBannerContainer_viewer.graphql"),a);var i;g[0]===Symbol["for"]("react.memo_cache_sentinel")?(i={context_surface_id:8439,context_trigger:"messaging_jewel_open"},g[0]=i):i=g[0];i=c("useQuickPromotionFalcoEvent")(i);var l;if(g[1]!==(a==null||(e=a.jewel_qp)==null?void 0:e.nodes)){var m,n;l=a==null||(m=a.jewel_qp)==null||(m=m.nodes)==null?void 0:m.find(k);g[1]=a==null||(n=a.jewel_qp)==null?void 0:n.nodes;g[2]=l}else l=g[2];a=l;l=a==null||(f=a.comet_qp_sections)==null?void 0:f.renderer_strategy;if(l==null)return null;g[3]===Symbol["for"]("react.memo_cache_sentinel")?(a=j.jsx(c("CometMessagingJewelDropdownQPBannerPlaceholder.react"),{}),g[3]=a):a=g[3];var o;g[4]!==l?(o=j.jsx(d("CometRelay").MatchContainer,{match:l}),g[4]=l,g[5]=o):o=g[5];g[6]!==i||g[7]!==o?(l=j.jsx(d("CometPageletWithDiv.react").Placeholder,{fallback:a,name:"CometMessagingJewelDropdownQPBannerContainer",children:j.jsx(c("CometQuickPromotionLoggerContext.react").Provider,{value:i,children:o})}),g[6]=i,g[7]=o,g[8]=l):l=g[8];return l}function k(a){return((a=a.comet_qp_sections)==null?void 0:a.renderer_strategy)!=null}g["default"]=a}),98);
__d("MWEncryptedBackupsJewelNuxWrapperDeferred.react",["deferredLoadComponent","react","requireDeferredForDisplay"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react"),j=c("deferredLoadComponent")(c("requireDeferredForDisplay")("MWEncryptedBackupsJewelNuxWrapper.react").__setRef("MWEncryptedBackupsJewelNuxWrapperDeferred.react"));function a(a){return i.jsx(j,babelHelpers["extends"]({},a))}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWInboxQuickPromotionWrapper.react",["CometErrorBoundary.react","CometPageletWithDiv.react","deferredLoadComponent","react","react-compiler-runtime","requireDeferredForDisplay"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react"),j=c("deferredLoadComponent")(c("requireDeferredForDisplay")("MAWUserVisibleErrorsNuxWrapper.react").__setRef("MWInboxQuickPromotionWrapper.react"));function a(a){var b=d("react-compiler-runtime").c(5),e=a.children;a=a.onError;var f;b[0]!==e?(f=i.jsx(d("CometPageletWithDiv.react").Placeholder,{fallback:null,name:"MWInboxQuickPromotionWrapper",children:i.jsx(j,{children:e})}),b[0]=e,b[1]=f):f=b[1];b[2]!==a||b[3]!==f?(e=i.jsx(c("CometErrorBoundary.react"),{onError:a,children:f}),b[2]=a,b[3]=f,b[4]=e):e=b[4];return e}g["default"]=a}),98);
__d("CometMessagingJewelDropdownEBUpsellContainer.react",["CometMessagingJewelDropdownEBUpsellContainerQuery.graphql","CometMessagingJewelDropdownQPBannerContainer.react","CometRelay","MWEncryptedBackupsJewelNuxWrapperDeferred.react","MWInboxContextSwitcherUtils","MWInboxQuickPromotionWrapper.react","react","react-compiler-runtime","recoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=i||d("react");function a(a){var b=d("react-compiler-runtime").c(4),e=a.ebSoftblockUpsell,f=a.ebUpsellContainerQueryRef;a=a.selectedFilterTab;var g;b[0]!==e||b[1]!==f||b[2]!==a?(g=d("MWInboxContextSwitcherUtils").shouldShowEBUpsellFromFilter(a)&&e==null?j.jsx(c("MWInboxQuickPromotionWrapper.react"),{onError:k,children:j.jsx(l,{ebUpsellContainerQueryRef:f})}):null,b[0]=e,b[1]=f,b[2]=a,b[3]=g):g=b[3];return g}function k(a){c("recoverableViolation")("CometMessagingJewelDropdownQPBannerContainer failed to render","messenger_web_entrypoints",{error:a})}function l(a){var e=d("react-compiler-runtime").c(5);a=a.ebUpsellContainerQueryRef;a=d("CometRelay").usePreloadedQuery(h!==void 0?h:h=b("CometMessagingJewelDropdownEBUpsellContainerQuery.graphql"),a);var f;e[0]!==a.viewer?(f=j.jsx(c("CometMessagingJewelDropdownQPBannerContainer.react"),{viewer:a.viewer}),e[0]=a.viewer,e[1]=f):f=e[1];var g;e[2]!==a||e[3]!==f?(g=j.jsx(c("MWEncryptedBackupsJewelNuxWrapperDeferred.react"),{query:a,children:f}),e[2]=a,e[3]=f,e[4]=g):g=e[4];return g}g["default"]=a}),98);
__d("CometMessagingJewelDropdownScrollableAreaForSmallScreens.react",["CometScrollableArea.react","qex","react","react-compiler-runtime","useMatchViewport"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react"),j=700;function k(){return c("useMatchViewport")("max","height",j)}function a(a){var b,e=d("react-compiler-runtime").c(6),f=a.children,g=a.expanding,h=a.forceBrowserDefault,j=a.scrollRef;a=a.scrollTracePolicy;b=(b=c("qex")._("1689"))!=null?b:!1;if(k()&&b===!0){e[0]!==f||e[1]!==g||e[2]!==h||e[3]!==j||e[4]!==a?(b=i.jsx(c("CometScrollableArea.react"),{expanding:g,forceBrowserDefault:h,horizontal:!1,ref:j,scrollTracePolicy:a,children:f}),e[0]=f,e[1]=g,e[2]=h,e[3]=j,e[4]=a,e[5]=b):b=e[5];return b}return f}g["default"]=a}),98);
__d("MWInboxContextSwitcherDeferred.react",["deferredLoadComponent","react","react-compiler-runtime","requireDeferredForDisplay"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react"),j=c("deferredLoadComponent")(c("requireDeferredForDisplay")("MWInboxContextSwitcher.react").__setRef("MWInboxContextSwitcherDeferred.react"));function a(a){var b=d("react-compiler-runtime").c(2),c;b[0]!==a?(c=i.jsx(j,babelHelpers["extends"]({},a)),b[0]=a,b[1]=c):c=b[1];return c}g["default"]=a}),98);
__d("MWInboxContextSwitcherGlimmer.react",["MDSGlimmer.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react"),j={tabPlaceholder:{borderStartStartRadius:"x1xn7y0n",borderStartEndRadius:"x1uxb8k9",borderEndEndRadius:"x1vmbcc8",borderEndStartRadius:"x16xm01d",display:"x78zum5",flexDirection:"xdt5ytf",flexGrow:"x1iyjqo2",justifyContent:"xl56j7k",$$css:!0}};function a(){var a=d("react-compiler-runtime").c(1),b;a[0]===Symbol["for"]("react.memo_cache_sentinel")?(b=i.jsx("div",babelHelpers["extends"]({className:"x78zum5 xu0aao5 x1y1aw1k xwib8y2 xf7dkkf xv54qhq x3bhodz"},{children:i.jsx(c("MDSGlimmer.react"),{index:0,xstyle:j.tabPlaceholder})})),a[0]=b):b=a[0];return b}g["default"]=a}),98);
__d("MWInboxTrayContainer.react",["MWInboxTrayGating","cr:17196","react","react-compiler-runtime","useMatchViewport"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react"),j=512;function a(a){var c=d("react-compiler-runtime").c(3),e=a.mwInboxTrayContainerQuery;a=a.onClose;var f=k();if(e==null)return null;if(!d("MWInboxTrayGating").isInboxTrayEnabled())return null;if(f)return null;c[0]!==e||c[1]!==a?(f=b("cr:17196")!=null?i.jsx(b("cr:17196"),{mwInboxTrayContainerQuery:e,onClose:a}):null,c[0]=e,c[1]=a,c[2]=f):f=c[2];return f}e=i.memo(a);function k(){var a=c("useMatchViewport")("max","height",j);return a}g["default"]=e}),98);
__d("MWJewelDropdownHeaderOpenInAppButton.react",["fbt","ix","Actor","FDSCircleButton.react","FDSTooltip.react","ImageIconSource","MessengerDesktopDeeplinkEventFalcoEvent","XMessengerDotComDesktopLaunchAppInterstitialControllerRouteBuilder","react","react-compiler-runtime","useCurrentDisplayMode","useSinglePartialViewImpression","useStable","uuidv4"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j,k=j||d("react");function a(a){var b=d("react-compiler-runtime").c(18),e=a.onClose;a=d("Actor").useActor();a=a[0];var f=c("useStable")(l),g=c("useCurrentDisplayMode")();g=g==="dark";var j;b[0]!==f?(j={onImpressionStart:function(){return c("MessengerDesktopDeeplinkEventFalcoEvent").log(function(){return{event:"open_in_app_button_impression",eventLocation:"browser",eventType:"thread",funnelSessionId:f,mobile_app_source:"unknown"}})}},b[0]=f,b[1]=j):j=b[1];j=c("useSinglePartialViewImpression")(j);var m;b[2]===Symbol["for"]("react.memo_cache_sentinel")?(m=h._(/*BTDS*/"\u0e40\u0e1b\u0e34\u0e14\u0e41\u0e2d\u0e1e Messenger"),b[2]=m):m=b[2];m=m;if(b[3]!==a||b[4]!==f){var n;n=(n=c("XMessengerDotComDesktopLaunchAppInterstitialControllerRouteBuilder").buildUri({funnel_session_id:f,id:a,origin:"FB"}).setDomain("messenger.com"))==null||(n=n.setProtocol("https"))==null?void 0:n.toString();b[3]=a;b[4]=f;b[5]=n}else n=b[5];a=n;b[6]!==g?(n=g?new(c("ImageIconSource"))(i("2009370"),32,32):new(c("ImageIconSource"))(i("1996477"),32,32),b[6]=g,b[7]=n):n=b[7];g=n;b[8]!==a?(n={url:a},b[8]=a,b[9]=n):n=b[9];b[10]!==f||b[11]!==e?(a=function(){c("MessengerDesktopDeeplinkEventFalcoEvent").log(function(){return{event:"open_in_app_button_click",eventLocation:"browser",eventType:"thread",funnelSessionId:f,mobile_app_source:"unknown"}}),e()},b[10]=f,b[11]=e,b[12]=a):a=b[12];b[13]!==g||b[14]!==j||b[15]!==n||b[16]!==a?(m=k.jsx(c("FDSTooltip.react"),{align:"end",tooltip:m,children:k.jsx(c("FDSCircleButton.react"),{color_DEPRECATED:"secondary",icon:g,label:m,linkProps:n,onPress:a,ref:j,size:32,testid:void 0,type_DEPRECATED:"deemphasized"})}),b[13]=g,b[14]=j,b[15]=n,b[16]=a,b[17]=m):m=b[17];return m}function l(){return c("uuidv4")()}g["default"]=a}),226);
__d("useMWJewelSettingsButtonBadge",["cr:4042","react"],(function(a,b,c,d,e,f,g){"use strict";var h;h||d("react");function a(){var a;a=(a=b("cr:4042")==null?void 0:b("cr:4042")())!=null?a:{};a=a.badge;a=a===void 0?null:a;return{badge:a,onButtonPress:function(){}}}g["default"]=a}),98);
__d("MWJewelDropdownHeader.react",["fbt","CometHomeChatSettings.entrypoint","FDSCircleButton.react","FDSComposeFilled16Icon","FDSDots3HorizontalFilled20Icon","FDSEntryPointPopoverTrigger.react","FDSTooltip.react","LSThreadAttributionStore","MWFacebookUserWithoutMessengerAccess","MWJewelDropdownHeaderOpenInAppButton.react","MWJewelDropdownHeaderSeeAllButton.react","MWJewelPopoverDialogContext.react","MWPSearchSystem","MWTopNavListDropdownTitle.react","MessengerDesktopDeepLinkUtils","MessengerWebUXLogger","emptyFunction","gkx","qex","react","react-compiler-runtime","useCometPreloader","useMWChatOpenNewTab","useMWJewelSettingsButtonBadge","useMWNewChatTabContainerPreload","useReStore","useShouldShowMessagingEntrypointInCometRoot"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=j||(j=d("react"));b=j;b.useCallback;var l=b.useContext;function m(a){var b=d("react-compiler-runtime").c(13),e=a.onOpenArchivedChats,f=a.onOpenMessageRequests;a=a.onOpenRestrictedAccountsList;var g;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(g=h._(/*BTDS*/"\u0e15\u0e31\u0e27\u0e40\u0e25\u0e37\u0e2d\u0e01"),b[0]=g):g=b[0];var i=g;g=l(c("MWJewelPopoverDialogContext.react"));var j=g.setIsOpenForDialog;g=c("useMWJewelSettingsButtonBadge")();var m=g.badge,n=g.onButtonPress;g=c("qex")._("760")?"button_aggressive":"button";var o;b[1]===Symbol["for"]("react.memo_cache_sentinel")?(o={},b[1]=o):o=b[1];e=e!=null?e:void 0;f=f!=null?f:void 0;a=a!=null?a:void 0;var p;b[2]!==e||b[3]!==f||b[4]!==a?(p={onOpenArchivedChats:e,onOpenMessageRequests:f,onOpenRestrictedAccountsList:a},b[2]=e,b[3]=f,b[4]=a,b[5]=p):p=b[5];b[6]!==m||b[7]!==n||b[8]!==j?(e=function(a,b,d,e,f,g){return k.jsxs(c("FDSTooltip.react"),{align:"end",tooltip:i,children:[m,k.jsx(c("FDSCircleButton.react"),{color_DEPRECATED:"secondary",icon:c("FDSDots3HorizontalFilled20Icon"),label:i,onHoverIn:e,onHoverOut:f,onPress:function(){j(!1),b(),n()},onPressIn:g,ref:a,size:32,testid:void 0,type_DEPRECATED:"deemphasized"})]})},b[6]=m,b[7]=n,b[8]=j,b[9]=e):e=b[9];b[10]!==p||b[11]!==e?(f=k.jsx(c("FDSEntryPointPopoverTrigger.react"),{align:"end",entryPointParams:o,otherProps:p,popoverEntryPoint:c("CometHomeChatSettings.entrypoint"),position:"below",preloadTrigger:g,children:e}),b[10]=p,b[11]=e,b[12]=f):f=b[12];return f}function a(a){var b=d("react-compiler-runtime").c(37),e=a.inboxUrl,f=a.onClose,g=a.onOpenArchivedChats,j=a.onOpenMessageRequests,l=a.onOpenRestrictedAccountsList,n=a.onReturn;a=a.title;var o=c("useShouldShowMessagingEntrypointInCometRoot")("CHAT"),p=c("useMWChatOpenNewTab")("jewelNewMessage"),q=c("MessengerWebUXLogger").useInteractionLogger(),r;b[0]!==o||b[1]!==q||b[2]!==f||b[3]!==p?(r=function(){d("LSThreadAttributionStore").setSourceForNewThread("jewelNewMessage"),o&&(p(!1),f()),q==null||q({eventName:"create_thread"})},b[0]=o,b[1]=q,b[2]=f,b[3]=p,b[4]=r):r=b[4];r=r;var s=c("useMWNewChatTabContainerPreload")(),t=s[0],u=s[1],v=(i||(i=c("useReStore")))();b[5]!==v?(s=function(){return d("MWPSearchSystem").makeAll(v)},b[5]=v,b[6]=s):s=b[6];s=s;var w=c("useCometPreloader")("button_aggressive",c("emptyFunction"),s),x=w.onHoverInPreloader,y=w.onHoverMovePreloader,z=w.onHoverOutPreloader;b[7]===Symbol["for"]("react.memo_cache_sentinel")?(w=h._(/*BTDS*/"\u0e02\u0e49\u0e2d\u0e04\u0e27\u0e32\u0e21\u0e43\u0e2b\u0e21\u0e48"),b[7]=w):w=b[7];w=w;var A=d("MessengerDesktopDeepLinkUtils").isMessengerDesktopDeeplinkEnabled,B=d("MWFacebookUserWithoutMessengerAccess").useIsFacebookUserWithoutMessengerAccess();A=!c("gkx")("2669")&&A()&&!B;if(A){b[8]!==f?(B=k.jsx(c("MWJewelDropdownHeaderOpenInAppButton.react"),{onClose:f}),b[8]=f,b[9]=B):B=b[9];A=B}else{b[10]!==e||b[11]!==f?(B=k.jsx(c("MWJewelDropdownHeaderSeeAllButton.react"),{onClose:f,testid:void 0,url:e}),b[10]=e,b[11]=f,b[12]=B):B=b[12];A=B}b[13]!==g||b[14]!==j||b[15]!==l?(e=k.jsx(m,{onOpenArchivedChats:g,onOpenMessageRequests:j,onOpenRestrictedAccountsList:l},"mw-jewel-settings"),b[13]=g,b[14]=j,b[15]=l,b[16]=e):e=b[16];b[17]!==t||b[18]!==x?(B=function(a){t(a),x(a)},b[17]=t,b[18]=x,b[19]=B):B=b[19];b[20]!==u||b[21]!==z?(g=function(){u(),z()},b[20]=u,b[21]=z,b[22]=g):g=b[22];b[23]!==r||b[24]!==s||b[25]!==y||b[26]!==B||b[27]!==g?(j=k.jsx(c("FDSTooltip.react"),{align:"end",tooltip:w,children:k.jsx(c("FDSCircleButton.react"),{color_DEPRECATED:"secondary",icon:c("FDSComposeFilled16Icon"),label:w,onFocusIn:s,onHoverIn:B,onHoverMove:y,onHoverOut:g,onPress:r,role:"button",size:32,testid:void 0,type_DEPRECATED:"deemphasized"})},"mw-jewel-new-message"),b[23]=r,b[24]=s,b[25]=y,b[26]=B,b[27]=g,b[28]=j):j=b[28];b[29]!==A||b[30]!==e||b[31]!==j?(l=[e,A,j].filter(Boolean),b[29]=A,b[30]=e,b[31]=j,b[32]=l):l=b[32];b[33]!==n||b[34]!==l||b[35]!==a?(w=k.jsx(c("MWTopNavListDropdownTitle.react"),{actions:l,onReturn:n,title:a}),b[33]=n,b[34]=l,b[35]=a,b[36]=w):w=b[36];return w}g["default"]=a}),226);
__d("MWJewelNestedFolderThreadListHeader.react",["MWTopNavListDropdownTitle.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){var b=d("react-compiler-runtime").c(3),e=a.onReturn;a=a.title;var f;b[0]!==e||b[1]!==a?(f=i.jsx(c("MWTopNavListDropdownTitle.react"),{onReturn:e,title:a}),b[0]=e,b[1]=a,b[2]=f):f=b[2];return f}g["default"]=a}),98);
__d("MWJewelMessageRequestsThread.react",["fbt","FDSChevronLeftFilled16Icon","FDSChevronRightFilled16Icon","FDSIcon.react","FDSMessagesFilled24Icon","I64","LSIntEnum","Locale","MWJewelThreadSnippet.react","MWXListCellStrict.react","ReQL","ReQLSuspense","react","react-compiler-runtime","useReStore"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k,l,m=l||d("react");function n(){var a=d("react-compiler-runtime").c(5),b=(i||(i=c("useReStore")))(),e;a[0]!==b.tables.contacts||a[1]!==b.tables.threads?(e=function(){return d("ReQL").fromTableDescending(b.tables.threads.index("parentThreadKeyLastActivityTimestampMs")).getKeyRange((j||(j=d("LSIntEnum"))).ofNumber(-1)).filter(o).map(function(a){a=a.snippetSenderContactId;if(a!=null){a=d("ReQLSuspense").first(d("ReQL").fromTableAscending(b.tables.contacts).getKeyRange(a),f.id+":51");return a?a.name:void 0}})},a[0]=b.tables.contacts,a[1]=b.tables.threads,a[2]=e):e=a[2];var g;a[3]!==b?(g=[b],a[3]=b,a[4]=g):g=a[4];return d("ReQLSuspense").useFirst(e,g,f.id+":36")}function o(a){return(k||(k=d("I64"))).gt(a.lastActivityTimestampMs,a.lastReadWatermarkTimestampMs)}function a(a){var b=d("react-compiler-runtime").c(17),e=a.onOpenMessageRequests;a=a.unreadRequestsCount;var f;b[0]!==a?(f=h._(/*BTDS*/"_j{\"*\":\"\\u0e04\\u0e33\\u0e02\\u0e2d\\u0e2a\\u0e48\\u0e07\\u0e02\\u0e49\\u0e2d\\u0e04\\u0e27\\u0e32\\u0e21\\u0e43\\u0e2b\\u0e21\\u0e48\"}",[h._plural(a)]),b[0]=a,b[1]=f):f=b[1];f=f;var g;b[2]!==a?(g=h._(/*BTDS*/"_j{\"someone\":\"\\u0e08\\u0e32\\u0e01\\u0e1a\\u0e38\\u0e04\\u0e04\\u0e25\\u0e17\\u0e35\\u0e48\\u0e04\\u0e38\\u0e13\\u0e2d\\u0e32\\u0e08\\u0e23\\u0e39\\u0e49\\u0e08\\u0e31\\u0e01\",\"people\":\"\\u0e08\\u0e32\\u0e01\\u0e04\\u0e19\\u0e17\\u0e35\\u0e48\\u0e04\\u0e38\\u0e13\\u0e2d\\u0e32\\u0e08\\u0e08\\u0e30\\u0e23\\u0e39\\u0e49\\u0e08\\u0e31\\u0e01\"}",[h._enum(a===1?"someone":"people",{someone:"someone",people:"people"})]),b[2]=a,b[3]=g):g=b[3];g=g;var i=n();if(i!=null)if(a===1){var j;b[4]!==i?(j=h._(/*BTDS*/"\u0e08\u0e32\u0e01 {name}:",[h._param("name",i)]),b[4]=i,b[5]=j):j=b[5];g=j}else{b[6]!==i||b[7]!==a?(j=h._(/*BTDS*/"\u0e08\u0e32\u0e01 {name} \u0e41\u0e25\u0e30\u0e04\u0e19\u0e2d\u0e37\u0e48\u0e19\u0e46 \u0e2d\u0e35\u0e01 {count} \u0e04\u0e19",[h._param("name",i),h._param("count",a-1)]),b[6]=i,b[7]=a,b[8]=j):j=b[8];g=j}b[9]===Symbol["for"]("react.memo_cache_sentinel")?(i={addOn:m.jsx(c("FDSIcon.react"),{color:"secondary",icon:d("Locale").isRTL()?c("FDSChevronLeftFilled16Icon"):c("FDSChevronRightFilled16Icon")}),type:"body"},a={icon:c("FDSMessagesFilled24Icon"),size:56,type:"contained-icon"},b[9]=i,b[10]=a):(i=b[9],a=b[10]);b[11]!==g?(j=m.jsx(c("MWJewelThreadSnippet.react"),{isUnread:!0,text:g}),b[11]=g,b[12]=j):j=b[12];b[13]!==e||b[14]!==j||b[15]!==f?(g=m.jsx(c("MWXListCellStrict.react"),{addOnEnd:i,addOnStart:a,body:j,headline:f,level:4,onPress:e}),b[13]=e,b[14]=j,b[15]=f,b[16]=g):g=b[16];return g}g["default"]=a}),226);
__d("useMWLSJewelLoadMoreThreads",["Int64Hooks","loadMoreLSThreads","promiseDone","react-compiler-runtime","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){var b=d("react-compiler-runtime").c(4),e=(h||(h=c("useReStore")))(),g,i;b[0]!==a||b[1]!==e?(g=function(){return function(){var b=e.runInTransaction(function(b){return c("loadMoreLSThreads")(b,a)},"readwrite",void 0,void 0,f.id+":26");c("promiseDone")(b)}},i=[e,a],b[0]=a,b[1]=e,b[2]=g,b[3]=i):(g=b[2],i=b[3]);return d("Int64Hooks").useMemoInt64(g,i)}g["default"]=a}),98);
__d("useMWLSLoadThreadFolderIfNotPresent",["CancellablePromise","CancellationToken","I64","Int64Hooks","ReQL","promiseDone","react-compiler-runtime","useMWLSJewelLoadMoreThreads","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a){var b=d("react-compiler-runtime").c(8),e=(i||(i=c("useReStore")))(),f=c("useMWLSJewelLoadMoreThreads")(a),g;b[0]!==e.tables.threads_ranges_v2__generated||b[1]!==f||b[2]!==a?(g=function(){var b=c("CancellationToken")();c("promiseDone")(d("CancellablePromise").ignoreFailed(void 0,d("CancellablePromise").then_(b,function(a){a==null&&f()},d("ReQL").firstAsync(d("ReQL").fromTableAscending(e.tables.threads_ranges_v2__generated).filter(function(b){return(h||(h=d("I64"))).equal(b.parentThreadKey,a)})))));return b.cancel},b[0]=e.tables.threads_ranges_v2__generated,b[1]=f,b[2]=a,b[3]=g):g=b[3];var j;b[4]!==e||b[5]!==f||b[6]!==a?(j=[f,e,a],b[4]=e,b[5]=f,b[6]=a,b[7]=j):j=b[7];d("Int64Hooks").useEffectInt64(g,j)}g["default"]=a}),98);
__d("MWLSJewelMessageRequestsThreadContainer.react",["I64","LSIntEnum","MWJewelMessageRequestsThread.react","ReQL","ReQLSuspense","react","react-compiler-runtime","useMWLSLoadThreadFolderIfNotPresent","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=k||d("react");function m(){var a=d("react-compiler-runtime").c(4),b=(h||(h=c("useReStore")))(),e;a[0]!==b.tables.threads?(e=function(){return d("ReQL").fromTableDescending(b.tables.threads.index("parentThreadKeyLastActivityTimestampMs")).getKeyRange((i||(i=d("LSIntEnum"))).ofNumber(-1)).filter(n)},a[0]=b.tables.threads,a[1]=e):e=a[1];var g;a[2]!==b?(g=[b],a[2]=b,a[3]=g):g=a[3];a=d("ReQLSuspense").useArray(e,g,f.id+":26");return a.length}function n(a){return(j||(j=d("I64"))).gt(a.lastActivityTimestampMs,a.lastReadWatermarkTimestampMs)}function a(a){var b=d("react-compiler-runtime").c(4);a=a.onOpenMessageRequests;var e;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(e=(i||(i=d("LSIntEnum"))).ofNumber(-1),b[0]=e):e=b[0];c("useMWLSLoadThreadFolderIfNotPresent")(e);e=m();if(a==null||e===0)return null;var f;b[1]!==a||b[2]!==e?(f=l.jsx(c("MWJewelMessageRequestsThread.react"),{onOpenMessageRequests:a,unreadRequestsCount:e}),b[1]=a,b[2]=e,b[3]=f):f=b[3];return f}g["default"]=a}),98);
__d("LSFilteredThreadsRangesQuery",["LSGetCursor","LSIssueNewTaskAndGetTaskID"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.i64.neq(a[10],void 0)?d[0]=a[10]:d[0]=c.i64.cast([0,0]),a[11]!==void 0?d[1]=a[11]:d[1]="",(a[2]&&c.i64.neq(a[7],void 0)&&c.i64.neq(a[4],void 0)||a[3]&&c.i64.neq(a[6],void 0)&&c.i64.neq(a[5],void 0))&&!(a[2]&&c.i64.neq(a[7],void 0)&&c.i64.neq(a[4],void 0)&&a[3]&&c.i64.neq(a[6],void 0)&&c.i64.neq(a[5],void 0))?c.sequence([function(e){return d[3]=a[4]==null?c.i64.cast([-2147483648,0]):a[4],d[4]=a[7]==null?c.i64.cast([0,1]):a[7],d[10]=c.i64.gt(d[4],c.i64.cast([0,1]))&&c.i64.gt(d[3],c.i64.cast([-2147483648,0])),c.storedProcedure(b("LSGetCursor"),c.i64.cast([0,1])).then(function(a){return a=a,d[2]=a[0],a})},function(e){return d[5]=new c.Map(),d[5].set("cursor",d[2]),d[5].set("filter",a[1]),d[5].set("is_after",a[3]),d[5].set("parent_thread_key",a[0]),d[5].set("reference_activity_timestamp",a[3]?a[6]:a[7]),d[5].set("reference_thread_key",a[3]?a[5]:a[4]),d[5].set("secondary_filter",d[0]),d[5].set("filter_value",d[1]),d[5].set("sync_group",c.i64.cast([0,1])),c.i64.gt(c.i64.cast([0,0]),c.i64.cast([0,0]))?(d[11]=c.i64.of_float(Date.now()),d[6]=c.i64.add(d[11],c.i64.cast([0,0]))):d[6]=c.i64.cast([0,0]),d[7]=c.toJSON(d[5]),c.storedProcedure(b("LSIssueNewTaskAndGetTaskID"),"trq",c.i64.cast([0,313]),d[7],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,d[6],c.i64.cast([0,0])).then(function(a){return a=a,d[8]=a[0],a})},function(b){return c.filter(c.db.table(247).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.parentThreadKey,a[0])&&c.i64.eq(b.threadRangeFilter,a[1])&&c.i64.eq(b.secondaryThreadRangeFilter,d[0])&&b.threadRangeFilterValue===d[1]}).next().then(function(b,e){e=b.done;b=b.value;return e?c.db.table(247).add({folderName:"",parentThreadKey:a[0],minThreadKey:d[3]==null?c.i64.cast([-2147483648,0]):d[3],minLastActivityTimestampMs:d[4]==null?c.i64.cast([0,1]):d[4],threadRangeFilter:a[1],secondaryThreadRangeFilter:d[0],threadRangeFilterValue:d[1],maxLastActivityTimestampMs:c.i64.cast([0,1]),maxThreadKey:c.i64.cast([-2147483648,0]),isLoadingBefore:!0,isLoadingAfter:!1,hasMoreBefore:d[10],hasMoreAfter:!1,syncGroup:c.i64.cast([0,1])}):(b.item,c.forEach(c.filter(c.db.table(247).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.parentThreadKey,a[0])&&c.i64.eq(b.threadRangeFilter,a[1])&&c.i64.eq(b.secondaryThreadRangeFilter,d[0])&&b.threadRangeFilterValue===d[1]}),function(a){var b=a.update;a.item;return b({isLoadingBefore:!0,isLoadingAfter:!1,hasMoreBefore:d[10],hasMoreAfter:!1})}))})}]):c.resolve()},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxFilteredThreadsRangesQueryStoredProcedure";a.__tables__=["filtered_threads_ranges_v3__generated"];e.exports=a}),null);
__d("LSFilteredThreadsRangesQueryStoredProcedure",["LSFilteredThreadsRangesQuery","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSFilteredThreadsRangesQuery"),e.parentThreadKey,e.filter,e.isLoadingBefore,e.isLoadingAfter,e.minThreadKey,e.maxThreadKey,e.maxLastActivityTimestampMs,e.minLastActivityTimestampMs,e.numThreads,e.numMessages,e.secondaryFilter,e.filterValue);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("MWPBaseThreadListUtils",["I64","LSFactory","LSFilteredThreadsRangesQueryStoredProcedure","LSIntEnum","LSThreadRangeFilter","LSThreadsRangesQueryStoredProcedure","ReQL","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,b,e,g,j,k){k===void 0&&(k=!1);var l=(h||(h=d("I64"))).equal(e,(i||(i=d("LSIntEnum"))).ofNumber(c("LSThreadRangeFilter").NONE));c("promiseDone")(async function(){var m=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.sync_groups).getKeyRange((i||(i=d("LSIntEnum"))).ofNumber(1)));m!=null&&(h||(h=d("I64"))).equal(m.syncStatus,(i||(i=d("LSIntEnum"))).ofNumber(2))&&await a.runInTransaction(function(a){j==null||j();if(l)return c("LSThreadsRangesQueryStoredProcedure")(c("LSFactory")(a),{additionalPagesToFetch:(h||(h=d("I64"))).zero,isLoadingAfter:!1,isLoadingBefore:!0,maxLastActivityTimestampMs:h.max_int,maxThreadKey:h.max_int,minLastActivityTimestampMs:h.max_int,minThreadKey:h.max_int,parentThreadKey:b,shouldSkipE2eeThreadsRanges:k});else return c("LSFilteredThreadsRangesQueryStoredProcedure")(c("LSFactory")(a),{filter:e,isLoadingAfter:!1,isLoadingBefore:!0,maxLastActivityTimestampMs:(h||(h=d("I64"))).max_int,maxThreadKey:h.max_int,minLastActivityTimestampMs:h.max_int,minThreadKey:h.max_int,parentThreadKey:b,secondaryFilter:g})},"readwrite","ui",void 0,f.id+":56")}())}g.loadMoreThreadsForEmptyRangeDefault=a}),98);
__d("ReQLScrollAnchored.react",["BaseScrollableAreaContext","BaseThemeProvider.react","CometPlaceholder.react","CometSSRSuspendOnServer.react","MWXScrollableAreaStyles","intersectionObserverEntryIsIntersecting","react","stylex","useResizeObserver"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=i||(i=d("react"));b=i;var k=b.useCallback,l=b.useContext,aa=b.useEffect,ba=b.useImperativeHandle,ca=b.useLayoutEffect,m=b.useMemo,n=b.useRef,da=b.useState,o=function(b){function a(){var a;for(var c=arguments.length,d=new Array(c),e=0;e<c;e++)d[e]=arguments[e];return(a=b.call.apply(b,[this].concat(d))||this,a.render=function(){return a.props.children},babelHelpers.assertThisInitialized(a))||babelHelpers.assertThisInitialized(a)}babelHelpers.inheritsLoose(a,b);var c=a.prototype;c.componentDidUpdate=function(a,b,c){b=a.children;this.props.componentDidUpdate(b,c)};c.getSnapshotBeforeUpdate=function(a){a=a.children;return this.props.getSnapshotBeforeUpdate(a)};return a}(j.PureComponent),p={overscrollBehaviorContain:{overscrollBehavior:"xish69e",$$css:!0},scrollArea:{display:"x78zum5",flexDirection:"xdt5ytf",flexGrow:"x1iyjqo2",flexShrink:"xs83m0k",overflowAnchor:"x1xzczws",overflowX:"x6ikm8r",overflowY:"x1odjw0f",position:"x1n2onr6",width:"xh8yej3",$$css:!0}},q=typeof ResizeObserver!=="undefined";function ea(a){var b=a.clientHeight;a=a.scrollTop;return a>b*2}function fa(a,b){return a-b.scrollTop>b.clientHeight*2}var ga=5;function a(a){var b=a.ref,d=a.hasReachedBottom,e=d===void 0?!0:d;d=a.hasReachedTop;var f=d===void 0?!0:d;d=a.setScrollTopInResetForBottomAnchor;var g=d===void 0?!0:d,i=a.initialAnchor,r=a.initialRenderComplete,s=a.onReachingBottom,t=a.onReachingTop,u=a.onScroll,v=a.onUserScroll,w=a.renderEmptyContent,x=a.renderFooter,y=a.renderHeader,z=a.renderHeaderContentSpacer,A=a.renderLoadingAnimation;d=a.isSufficientContentLoadedAbove;var B=d===void 0?ea:d;d=a.isSufficientContentLoadedBelow;var C=d===void 0?fa:d,ha=a.headerStyle;d=a.snapThreshold;var D=d===void 0?5:d;d=a.xstyle;var ia=a.shouldOverscrollBehaviourContain,E=a.elements,F=l(c("BaseScrollableAreaContext")),G=n();a=m(function(){return[].concat(F,[{getDOMNode:function(){return G==null?void 0:G.current}}])},[F]);var H=n(),I=n(),J=da(i),ja=J[0],K=J[1],L=n(i),M=n(null),N=k(function(){var a=G.current,b=I.current;if(a==null||b==null||a.offsetParent===null||b.offsetParent===null)return;b=C(b.clientHeight,a);M.current=a.scrollTop;if(!b&&!e&&s!=null){s();return}b=B(a);M.current=a.scrollTop;!b&&!f&&t!=null&&t()},[e,f,B,C,s,t]);aa(N,[N,E.length]);var O=k(function(a){if(a.scrollHeight===a.clientHeight)return;var b=a.scrollHeight-a.clientHeight-a.scrollTop<D&&e?"bottom":"top";K(L.current=b);M.current=a.scrollTop},[e,D]),P=k(function(){var a=G.current,b=M.current;if(b==null||a==null)return;a.scrollTop!==b&&(a.scrollTop=b,u&&u(a))},[u]),Q=k(function(){var a=G.current,b=I.current;if(a==null||b==null)return;i==="bottom"?(g&&(a.scrollTop=a.scrollHeight),u&&u(a)):f||(a.scrollTop=b.offsetTop,u&&u(a));e&&a.scrollHeight-a.clientHeight-a.scrollTop<D?K(L.current="bottom"):K(L.current=i);M.current=a.scrollTop},[e,f,i,u,D,g]),R=n(!1);ca(function(){if(R.current)return;Q();R.current=!0},[Q]);var S=k(function(){var a=G.current;if(a==null)return;r&&a.scrollHeight>a.clientHeight&&r();L.current==="bottom"&&(a.scrollTop=a.scrollHeight,u&&u(a));M.current=a.scrollTop},[r,u]),ka=k(function(){var a=G.current;if(a==null)return;u&&u(a);if(a.scrollTop===M.current)return;M.current=null;N();O(a);v&&v()},[N,u,v,O]),T=k(function(){S(),N()},[S,N]);J=k(function(){return S()},[S]);var U=c("useResizeObserver")(J),V=c("useResizeObserver")(T),la=k(function(a){U(a),I.current=a},[U]),ma=k(function(a){V(a),G.current=a},[V]),W=k(function(a,b){if(b!=null){a=b.element;var c=b.height;b=b.scrollAreaElement;a=a.clientHeight;M.current=b.scrollTop;a!==c&&!(a<=c&&L.current==="bottom")&&(b.scrollTop+=a-c,M.current=b.scrollTop,u&&u(b))}},[u]),X=k(function(){if(G.current!=null){var a=G.current;a.scrollTop=a.scrollHeight;M.current=a.scrollTop;u&&u(a)}K(L.current=e?"bottom":"top")},[e,u]);function na(){if(G.current!=null){var a=G.current,b=a.scrollHeight-a.scrollTop-a.clientHeight<ga;M.current=a.scrollTop;return b}else return!1}var Y=n(null),Z=k(function(a,b){var d=Y.current,e=G.current;if(d!=null&&e!=null){var f=new IntersectionObserver(function(a){a=a[0];(a.boundingClientRect.height!==0||a.boundingClientRect.width!==0)&&b(c("intersectionObserverEntryIsIntersecting")(a))},{root:e,rootMargin:a+"px"});f.observe(d);return function(){return f.disconnect()}}},[]),$=k(function(){var a=G.current;if(a!=null){var b=a.scrollHeight-a.clientHeight>0;M.current=a.scrollTop;return b}return!1},[]);function oa(){var a=G.current;if(a==null)return null;var b={clientHeight:a.clientHeight,scrollHeight:a.scrollHeight,scrollTop:a.scrollTop};M.current=a.scrollTop;return b}ba(b,function(){return{doesContentFillScroll:$,getScrollAreaElement:function(){return G.current},getScrollerMeasurements:oa,isAtBottom:na,onCloseToBottom:Z,resetScrollPosition:Q,restoreScrollPosition:P,scrollToBottom:X}},[$,Z,Q,P,X]);var pa=m(function(){return j.jsx(o,{componentDidUpdate:W,getSnapshotBeforeUpdate:function(a){var b=I.current,c=G.current;if(b!=null&&c!=null&&!(f&&c.scrollTop===0)&&(!a.length||E.length&&a[0].key!==E[0].key&&a.length!==E.length)){a=b.clientHeight;M.current=c.scrollTop;return{element:b,height:a,scrollAreaElement:c}}return null},children:E})},[E,W,f]);return j.jsx(c("BaseScrollableAreaContext").Provider,{value:a,children:j.jsx("div",babelHelpers.extends({},(h||(h=c("stylex"))).props(d),{children:j.jsx("div",babelHelpers.extends({},{0:{className:"x78zum5 xdt5ytf x1iyjqo2 x6ikm8r x10wlt62 x1n2onr6"},1:{className:"x78zum5 xdt5ytf x1iyjqo2 x6ikm8r x10wlt62 x1n2onr6 x1xzczws"}}[!!(ja==="bottom")<<0],{children:j.jsx(c("BaseThemeProvider.react"),{children:function(a,b){return j.jsxs("div",{className:(h||(h=c("stylex")))(p.scrollArea,ia===!0&&p.overscrollBehaviorContain,c("MWXScrollableAreaStyles").themed,a),"data-testid":void 0,onScroll:ka,ref:ma,style:b,children:[j.jsx(c("CometPlaceholder.react"),{fallback:null,name:"ReQLScrollAnchored.ScrollArea",children:j.jsx(c("CometSSRSuspendOnServer.react"),{children:!q&&j.jsx("iframe",babelHelpers.extends({className:"x76ihet xtmcdsl x112ta8 x4gj9lk x5yr21d x1o0tod x1ty9z65 xg01cxk x47corl x10l6tqk x1yhy09f xh8yej3"},{ref:function(a){a!=null&&(a.contentWindow.onresize=T)}}))})}),j.jsxs(o,{componentDidUpdate:W,getSnapshotBeforeUpdate:function(){var a=H.current,b=G.current;if(a!=null&&b!=null){M.current=b.scrollTop;if(M.current!==0){var c=a.clientHeight;return{element:a,height:c,scrollAreaElement:b}}}return null},children:[j.jsx("div",babelHelpers.extends({},h.props(ha),{ref:H,children:f?y&&y():A&&A("onTop",E.length)})),w!=null?w():null]}),z!=null&&z(),j.jsx("div",babelHelpers.extends({},{0:{},1:{className:"x1us19tq"}}[!!(E.length!==0&&!f&&!e)<<0],{children:j.jsxs("div",babelHelpers.extends({className:"x1n2onr6"},{ref:la,children:[j.jsx(c("CometPlaceholder.react"),{fallback:null,name:"ReQLScrollAnchored.elementsHOC",children:j.jsx(c("CometSSRSuspendOnServer.react"),{children:!q&&j.jsx("iframe",babelHelpers.extends({className:"x76ihet xtmcdsl x112ta8 x4gj9lk x5yr21d x1o0tod x1ty9z65 xg01cxk x47corl x10l6tqk x1yhy09f xh8yej3"},{ref:function(a){a!=null&&(a.contentWindow.onresize=S)}}))})}),pa,j.jsx("div",babelHelpers.extends({className:"x1ey2m1c xjm9jq1 x1y332i5 x47corl x10l6tqk"},{ref:Y})),e?x&&x():A&&A("onBottom",E.length)]}))}))]})}})}))}))})}a.displayName=a.name+" [from "+f.id+"]";g.default=a}),98);
__d("useStableValue",["I64","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=(h||d("react")).useRef;function a(a){return k(a,(i||(i=d("I64"))).equal)}function k(a,b){var c=j(a);b(c.current,a)||(c.current=a);return c.current}g.useStableI64=a;g.useStableValue=k}),98);
__d("useStableBounds",["deepEquals","useStableValue"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("useStableValue").useStableValue(a,c("deepEquals"))}g["default"]=a}),98);
__d("ReQLPaginatedList.react",["FBLogger","I64","PromiseOrValue","ReQL","ReQLScrollAnchored.react","ReQLSuspense","SortedAsyncIterable","deepEquals","gkx","justknobx","promiseDone","react","useMergeRefs","useStableBounds","useStableValue"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=h||(h=d("react"));b=h;var l=b.useCallback,m=b.useEffect,aa=b.useLayoutEffect,n=b.useMemo,o=b.useRef,p=b.useState,q=b.useTransition;function r(a,b){return b==null?a:a.bounds(b)}function s(a){if(a instanceof Promise)throw a;return a}function t(a){return{direction:a.direction,iterator:function(b,c){var e=a.iterator(b,c);return{next:function(a){return(i||(i=d("PromiseOrValue"))).map(e.next(a),function(a){return a.done?a:{done:!1,value:[a.value[0],a.value]}})}}},keyLength:a.keyLength,subscribe:function(b,c){return a.subscribe(async function(a,c,d){c.operation==="delete"?await b(a,c,d):c.operation==="add"?await b(a,{operation:"add",value:[a,c.value]},d):c.operation==="put"&&await b(a,{operation:"put",value:[a,c.value]},d)},c)}}}function ba(a){var b=a.clientHeight;a=a.scrollTop;return a>b*2}function a(a){var b=a.bounds,e=a.direction,g=e===void 0?"asc":e;e=a.hasReachedBottom;var h=e===void 0?!0:e;e=a.hasReachedTop;var i=e===void 0?!0:e;e=a.imperativeRef;var j=a.initialAnchor,da=a.initialRenderComplete,u=a.onDataLoaded,v=a.onPageLoaded,w=a.onReachingBottom,x=a.onReachingTop,ea=a.onScroll,fa=a.onUserScroll,y=a.pageSize,z=y===void 0?15:y;y=a.renderEmptyContent;var A=a.renderFooter,ga=a.renderHeader,ha=a.renderHeaderContentSpacer,B=a.renderItem,ia=a.renderLoadingAnimation,ja=a.headerStyle,C=a.isSufficientContentLoadedAbove;C=C===void 0?ba:C;var ka=a.isSufficientContentLoadedBelow,D=a.snapThreshold;D=D===void 0?5:D;var E=a.setScrollTopInResetForBottomAnchor;E=E===void 0?!0:E;var F=a.data,G=F.ascending,H=F.descending;F=a.xstyle;var I=a.isLogDuplicatedItemEnabled;I=I===void 0?!1:I;a=a.shouldOverscrollBehaviourContain;var J=q();J[0];var K=J[1],L=c("useStableBounds")(b);if(j!=null&&j!=="top"&&j!=="bottom"){J=r(H,L).bounds({lt:j}).iterator(new WeakMap()).next();if(J instanceof Promise)throw J;j=J.done?"top":J.value[0]}var M=d("useStableValue").useStableValue(j,c("deepEquals")),N=n(function(){var a,b;M==="top"||M==null?(a=d("ReQL").empty(),b=g==="asc"?G:H):M==="bottom"?(a=g==="asc"?H:G,b=d("ReQL").empty()):(a=g==="asc"?H.bounds({lt:M}):G.bounds({gt:M}),b=g==="asc"?G.bounds({gte:M}):H.bounds({lte:M}));return{after:b,before:a}},[M,G,H,g]),O=o(!1),P=n(function(){var a=s(d("SortedAsyncIterable").toArray(r(N.before,L).take(M==="bottom"?z:0),f.id+":205")).reverse(),b=s(d("SortedAsyncIterable").toArray(r(N.after,L).take(z),f.id+":212")),c=M==="bottom"?!0:b.length<z,e=M==="top"||M==null?!0:M==="bottom"?a.length<z:!1;return{firstKey:e?void 0:M==="bottom"?(e=a[0])==null?void 0:e[0]:(a=b[0])==null?void 0:a[0],lastKey:c?void 0:(e=b[b.length-1])==null?void 0:e[0]}},[M,L,N.after,N.before,z]);b=p(function(){return{anchor:M,iterables:N,values:P}});J=b[0];var Q=b[1];j=J.iterables===N&&J.anchor===M;b=j?J.values:P;var R=b.firstKey,S=b.lastKey,T=d("ReQLSuspense").useArray(function(){return t(R==null?r(N.before,L).take(z):r(N.before,L).bounds(g==="asc"?{gte:R}:{lte:R}))},[L,g,R,N.before,z],f.id+":247"),U=n(function(){return[].concat(T).reverse()},[T]);m(function(){U.length===z&&R==null&&K(function(){return Q({anchor:M,iterables:N,values:{firstKey:U[0][0],lastKey:S}})})},[U,R,M,N,S,z]);var V=d("ReQLSuspense").useArray(function(){return t(S==null?r(N.after,L).take(z):r(N.after,L).bounds(g==="asc"?{lte:S}:{gte:S}))},[L,g,N.after,S,z],f.id+":274");m(function(){V.length===z&&S==null&&K(function(){return Q({anchor:M,iterables:N,values:{firstKey:R,lastKey:V[V.length-1][0]}})})},[V,R,M,N,S,z]);var W=n(function(){return[].concat(U,V)},[U,V]);m(function(){u==null||u(W)},[W,u]);var X=d("ReQLSuspense").useFirst(function(){return W.length===0?d("ReQL").empty():r(N.before,L).bounds(g==="asc"?{lt:W[0][0]}:{gt:W[0][0]})},[W,L,g,N.before],f.id+":306")==null,Y=d("ReQLSuspense").useFirst(function(){return W.length===0?d("ReQL").empty():r(N.after,L).bounds(g==="asc"?{gt:W[W.length-1][0]}:{lt:W[W.length-1][0]})},[W,L,g,N.after],f.id+":316")==null;j=q();var la=j[0],ma=j[1];J=l(function(){if(O.current||la)return;if(Y){if(!h&&w!=null)return w()}else{O.current=!0;c("promiseDone")(Promise.resolve(d("SortedAsyncIterable").toArray(r(g==="asc"?G:H,L).bounds(g==="asc"?{gt:W[W.length-1][0]}:{lt:W[W.length-1][0]}).take(z),f.id+":343")),function(a){O.current=!1,v!=null&&v("bottom",W[W.length-1][1],a.map(function(a){return a[1]})),ma(function(){var b;return Q({anchor:M,iterables:N,values:{firstKey:R,lastKey:(b=(b=a[a.length-1])==null?void 0:b[0])!=null?b:W[W.length-1][0]}})})});return}},[la,Y,h,w,g,G,H,L,W,z,v,R,N,M]);b=q();var na=b[0],oa=b[1],pa=o(!0);j=l(function(){if(O.current||na)return;if(X){if(!i)return x==null?void 0:x();return}O.current=!0;c("promiseDone")(Promise.resolve(d("SortedAsyncIterable").toArray(r(g==="asc"?H:G,L).bounds(g==="asc"?{lt:W[0][0]}:{gt:W[0][0]}).take(z),f.id+":415")),function(a){O.current=!1,v!=null&&(pa.current?(pa.current=!1,v("top",null,W.slice(0,z).map(function(a){return a[1]}).reverse())):v("top",W[0][1],a.map(function(a){return a[1]}))),a.reverse(),oa(function(){var b;return Q({anchor:M,iterables:N,values:{firstKey:(b=(b=a[0])==null?void 0:b[0])!=null?b:W[0][0],lastKey:S}})})})},[na,X,i,x,g,H,G,L,W,z,v,S,N,M]);var Z=X&&i?0:1,$=W.length-(Y&&h?0:1);b=n(function(){var a=new Array($>Z?$-Z:0);for(var b=Z;b<$;b++){var d;a[b-Z]=B(W[b][1],{nextItem:(d=W[b+1])==null?void 0:d[1],previousItem:(d=W[b-1])==null?void 0:d[1]},c("gkx")("7810")?$-Z-b:0)}return a},[W,Z,B,$]);var qa=o(null);e=c("useMergeRefs")(qa,e);aa(function(){var a;(a=qa.current)==null||a.resetScrollPosition()},[M]);var ra=l(function(){return A==null?void 0:A(W.length>0?W[W.length-1][1]:void 0)},[W,A]);ca(I,W);return k.jsx(c("ReQLScrollAnchored.react"),{elements:b,hasReachedBottom:Y&&h,hasReachedTop:X&&i,headerStyle:ja,initialAnchor:M==="bottom"?"bottom":"top",initialRenderComplete:da,isSufficientContentLoadedAbove:C,isSufficientContentLoadedBelow:ka,onReachingBottom:J,onReachingTop:j,onScroll:ea,onUserScroll:fa,pageSize:z,ref:e,renderEmptyContent:y,renderFooter:ra,renderHeader:ga,renderHeaderContentSpacer:ha,renderLoadingAnimation:ia,setScrollTopInResetForBottomAnchor:E,shouldOverscrollBehaviourContain:a,snapThreshold:D,xstyle:F})}a.displayName=a.name+" [from "+f.id+"]";function ca(a,b){var e=p(!1),f=e[0],g=e[1];m(function(){try{if(!c("justknobx")._("1789"))return;if(a&&!f){var e=new Set(),h=[];for(var i of b){var k=i[1];if(typeof k==="object"&&(k==null?void 0:k.threadKey)!=null&&(j||(j=d("I64"))).isI64(k==null?void 0:k.threadKey)){k=(j||(j=d("I64"))).to_string(k==null?void 0:k.threadKey);e.has(k)&&h.push(k);e.add(k)}}e.size!==b.length&&(g(!0),c("FBLogger")("messenger_web").warn("Duplicated thread item detected in ReQLPaginatedList %s",h.join(",")))}}catch(a){c("FBLogger")("messenger_web").warn("Duplicated thread item error",a)}},[b,f,a])}g.default=a}),98);
__d("useMWCMMarkBumpedThreadsSeen",["Int64Hooks","react-compiler-runtime","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("MWCMMarkBumpedThreadsSeen").__setRef("useMWCMMarkBumpedThreadsSeen");function a(a){var b=d("react-compiler-runtime").c(3),c,e;b[0]!==a?(c=function(){return{load:async function(){var b=await h.load();return function(c){return b.MWCMMarkBumpedThreadsSeen(a,c)}}}},e=[a],b[0]=a,b[1]=c,b[2]=e):(c=b[1],e=b[2]);return d("Int64Hooks").useMemoInt64(c,e)}g.default=a}),98);
__d("useMarkSeenWhenVisible",["CometDebounce","Int64Hooks","ReQL","UserActivity","promiseDone","react","useMWCMMarkBumpedThreadsSeen","useMWPMarkSeen","useMWPWatchFolderFocusChanges","useReStore","useSimpleImpression","useVisibilityObserver"],(function(a,b,c,d,e,f,g){"use strict";var h,i;b=i||d("react");var j=b.useCallback,k=b.useRef;function a(a){var b=(h||(h=c("useReStore")))(),e=k(!1),g=c("useMWCMMarkBumpedThreadsSeen")(a),i=c("useVisibilityObserver")({onHidden:function(){e.current=!1},onVisible:function(){e.current=!0}}),l=c("useMWPMarkSeen")(a),m=c("CometDebounce")(j(function(){c("promiseDone")(async function(){var a=await Promise.all([l.load(),g.load()]),c=a[0],d=a[1];await b.runInTransaction(async function(a){await c(a),await d(a)},"readwrite",void 0,void 0,f.id+":56")}())},[l,g,b]),{leading:!0,wait:500});c("useMWPWatchFolderFocusChanges")(m,e);c("useSimpleImpression")(m);d("Int64Hooks").useEffectInt64(function(){return d("ReQL").fromTableDescending(b.tables.threads.index("parentThreadKeyLastActivityTimestampMs"),[]).getKeyRange(a).take(1).subscribe(function(){c("UserActivity").isOnTab()&&e.current===!0&&m()})},[b,a,m]);return i}g.default=a}),98);
__d("MWPBaseThreadList.react",["Box.react","FBLogger","I64","Int64Hooks","LSFactory","LSFilteredThreadsRangesQueryStoredProcedure","LSIntEnum","LSThreadRangeFilter","LSThreadsRangesQueryStoredProcedure","MAWMaybeWithTimeout","MWPBaseThreadListHooks","MWPBaseThreadListUtils","MWThreadListFocusableTable.react","ReQL","ReQLPaginatedList.react","ReQLSuspense","react","react-compiler-runtime","useMarkSeenWhenVisible","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=i||(i=d("react"));b=i;b.useCallback;var m=b.useEffect,n={container:{display:"x78zum5",flexDirection:"xdt5ytf",flexGrow:"x1iyjqo2",flexShrink:"xs83m0k",overflowX:"x6ikm8r",overflowY:"x10wlt62",$$css:!0},emptyContentContainer:{alignItems:"x6s0dn4",display:"x78zum5",flexGrow:"x1iyjqo2",justifyContent:"xl56j7k",$$css:!0},list:{display:"x78zum5",flexDirection:"xdt5ytf",flexGrow:"x1iyjqo2",overflowX:"x6ikm8r",overflowY:"x10wlt62",$$css:!0}},o=1e4;function p(a,b,e,g){g===void 0&&(g=!1),void d("MAWMaybeWithTimeout").maybeWithTimeout(a.runInTransaction(async function(a){var f;f=await (f=a.threads_ranges_v2__generated).get.apply(f,b);if(f==null||f.isLoadingBefore)return;e&&e();return c("LSThreadsRangesQueryStoredProcedure")(c("LSFactory")(a),{additionalPagesToFetch:(j||(j=d("I64"))).zero,isLoadingAfter:!1,isLoadingBefore:!0,maxLastActivityTimestampMs:f.maxLastActivityTimestampMs,maxThreadKey:f.maxThreadKey,minLastActivityTimestampMs:f.minLastActivityTimestampMs,minThreadKey:f.minThreadKey,parentThreadKey:f.parentThreadKey,shouldSkipE2eeThreadsRanges:g})},"readwrite","ui",void 0,f.id+":91"),o,function(){c("FBLogger")("messenger_web").warn("Paginated threads load took longer than "+o/1e3+" seconds.\n        parent_thread_key: "+(j||(j=d("I64"))).to_string(b[0])+"\n        min_thread_key: "+j.to_string(b[1])+"\n        min_last_activity_timestamp_ms: "+j.to_string(b[2]))})}function q(a,b,e,g,h){g===void 0&&(g=(k||(k=d("LSIntEnum"))).ofNumber(c("LSThreadRangeFilter").NONE)),void d("MAWMaybeWithTimeout").maybeWithTimeout(a.runInTransaction(async function(a){var d;d=await (d=a.filtered_threads_ranges_v3__generated).get.apply(d,b);if(d==null||d.isLoadingBefore)return;h&&h();return c("LSFilteredThreadsRangesQueryStoredProcedure")(c("LSFactory")(a),{filter:e,isLoadingAfter:!1,isLoadingBefore:!0,maxLastActivityTimestampMs:d.maxLastActivityTimestampMs,maxThreadKey:d.maxThreadKey,minLastActivityTimestampMs:d.minLastActivityTimestampMs,minThreadKey:d.minThreadKey,parentThreadKey:d.parentThreadKey,secondaryFilter:g})},"readwrite","ui",void 0,f.id+":150"),o,function(){c("FBLogger")("messenger_web").warn("Filtered paginated threads load took longer than "+o/1e3+" seconds.\n        parent_thread_key: "+(j||(j=d("I64"))).to_string(b[0])+"\n        min_thread_key: "+j.to_string(b[1])+"\n        min_last_activity_timestamp_ms: "+j.to_string(b[2])+"\n        thread_range_filter: "+j.to_string(b[3])+"\n        secondary_thread_range_filter: "+j.to_string(b[5]))})}function r(a,b,e,f,g,h){f===void 0&&(f=(k||(k=d("LSIntEnum"))).ofNumber(c("LSThreadRangeFilter").NONE));h===void 0&&(h=!1);if(b==null)return;if(!b.threadRangeFilter){var i=[b.parentThreadKey,b.minThreadKey,b.minLastActivityTimestampMs];p(a,i,g,h)}else{i=[b.parentThreadKey,b.minThreadKey,b.minLastActivityTimestampMs,b.threadRangeFilter,b.folderName,b.secondaryThreadRangeFilter,b.threadRangeFilterValue];q(a,i,e,f,g)}}function s(a,b,e,g){var h=d("react-compiler-runtime").c(14),i;h[0]!==e?(i=(j||(j=d("I64"))).equal(e,(k||(k=d("LSIntEnum"))).ofNumber(c("LSThreadRangeFilter").NONE)),h[0]=e,h[1]=i):i=h[1];var l=i,m;h[2]!==a||h[3]!==l||h[4]!==b?(i=function(){return l?d("ReQL").fromTableDescending(a.tables.threads_ranges_v2__generated).getKeyRange(b):d("ReQL").empty()},m=[a,b,l],h[2]=a,h[3]=l,h[4]=b,h[5]=i,h[6]=m):(i=h[5],m=h[6]);i=d("ReQLSuspense").useFirst(i,m,f.id+":250");var n;h[7]!==a||h[8]!==e||h[9]!==l||h[10]!==b||h[11]!==g?(m=function(){return l?d("ReQL").empty():d("ReQL").fromTableDescending(a.tables.filtered_threads_ranges_v3__generated).getKeyRange(b).filter(function(a){return(j||(j=d("I64"))).equal(a.threadRangeFilter,e)&&(g==null||(j||(j=d("I64"))).equal(a.secondaryThreadRangeFilter,g))})},n=[a,e,b,g,l],h[7]=a,h[8]=e,h[9]=l,h[10]=b,h[11]=g,h[12]=m,h[13]=n):(m=h[12],n=h[13]);h=d("ReQLSuspense").useFirst(m,n,f.id+":257");return l?i:h}function a(a){var b=d("react-compiler-runtime").c(71),e=a.afterContent,g=a.beforeContent,i=a.containerStyle,o=a.customThreadFilter,p=a.emptyContent,q=a.filter,t=a.gridLabel,u=a.imperativeRef,v=a.isSufficientContentLoadedBelow,w=a.loadMoreThreads,x=a.loadMoreThreadsForEmptyRange,y=a.onDataLoaded,z=a.onLoadMoreThreads,A=a.onReachingTop,B=a.onScroll,C=a.onThreadsLoaded,D=a.pageSize,E=a.parentThreadKey,F=a.renderItem,G=a.renderLoadingAnimation,H=a.role,I=a.secondaryFilter,J=a.setIsEmptyInbox;a=a.shouldSkipE2eeThreadsRanges;var K;b[0]!==q?(K=q===void 0?(k||(k=d("LSIntEnum"))).ofNumber(c("LSThreadRangeFilter").NONE):q,b[0]=q,b[1]=K):K=b[1];var L=K,M=w===void 0?r:w,N=x===void 0?d("MWPBaseThreadListUtils").loadMoreThreadsForEmptyRangeDefault:x;q=H===void 0?"grid":H;var O=a===void 0?!1:a,P=(h||(h=c("useReStore")))(),Q=s(P,E,L,I);Q!=null&&!Q.isLoadingBefore&&(C&&C());var R=d("MWPBaseThreadListHooks").useMWPBaseThreadListBounds(Q);b[2]!==o||b[3]!==P||b[4]!==E?(K={customThreadFilter:o,db:P,parentThreadKey:E},b[2]=o,b[3]=P,b[4]=E,b[5]=K):K=b[5];var S=d("MWPBaseThreadListHooks").useMWPBaseThreadListFilteredData(K);b[6]!==R||b[7]!==S.descending?(w=function(){return S.descending.bounds(R)},b[6]=R,b[7]=S.descending,b[8]=w):w=b[8];b[9]!==R||b[10]!==S?(x=[R,S],b[9]=R,b[10]=S,b[11]=x):x=b[11];var T=d("ReQLSuspense").useFirst(w,x,f.id+":345")==null;b[12]!==T||b[13]!==J?(H=function(){J&&J(T)},a=[T,J],b[12]=T,b[13]=J,b[14]=H,b[15]=a):(H=b[14],a=b[15]);m(H,a);b[16]!==P||b[17]!==Q||b[18]!==L||b[19]!==N||b[20]!==z||b[21]!==E||b[22]!==I?(C=function(){Q==null&&N(P,E,L,I,z)},o=[E,Q,P,L,I,z,N],b[16]=P,b[17]=Q,b[18]=L,b[19]=N,b[20]=z,b[21]=E,b[22]=I,b[23]=C,b[24]=o):(C=b[23],o=b[24]);d("Int64Hooks").useEffectInt64(C,o);K=c("useMarkSeenWhenVisible")(E);b[25]!==P||b[26]!==Q||b[27]!==L||b[28]!==M||b[29]!==z||b[30]!==I||b[31]!==O?(w=function(){M(P,Q,L,I,z,O)},b[25]=P,b[26]=Q,b[27]=L,b[28]=M,b[29]=z,b[30]=I,b[31]=O,b[32]=w):w=b[32];x=w;b[33]!==F?(H=function(a){return l.jsx(l.Fragment,{children:F(a)},(j||(j=d("I64"))).to_string(a.threadKey))},b[33]=F,b[34]=H):H=b[34];a=H;if(Q==null){b[35]!==G?(C=G!=null?G("nullState",0):null,b[35]=G,b[36]=C):C=b[36];o=C}else{w=!Q.hasMoreBefore;H=!Q.hasMoreAfter;b[37]!==Q.isLoadingAfter||b[38]!==Q.isLoadingBefore||b[39]!==p||b[40]!==T?(C=function(){return T&&!Q.isLoadingAfter&&!Q.isLoadingBefore?l.jsx(c("Box.react"),{xstyle:n.emptyContentContainer,children:p}):null},b[37]=Q.isLoadingAfter,b[38]=Q.isLoadingBefore,b[39]=p,b[40]=T,b[41]=C):C=b[41];var U;b[42]!==e?(U=function(){return e},b[42]=e,b[43]=U):U=b[43];var V;b[44]!==g?(V=function(){return g},b[44]=g,b[45]=V):V=b[45];var W;b[46]!==R||b[47]!==S||b[48]!==u||b[49]!==v||b[50]!==y||b[51]!==x||b[52]!==A||b[53]!==B||b[54]!==D||b[55]!==a||b[56]!==G||b[57]!==w||b[58]!==H||b[59]!==C||b[60]!==U||b[61]!==V?(W=l.jsx(d("MWThreadListFocusableTable.react").MWThreadListFocusableTable,{children:l.jsx(c("ReQLPaginatedList.react"),{bounds:R,data:S,direction:"desc",hasReachedBottom:w,hasReachedTop:H,imperativeRef:u,isLogDuplicatedItemEnabled:!0,isSufficientContentLoadedBelow:v,onDataLoaded:y,onReachingBottom:x,onReachingTop:A,onScroll:B,pageSize:D,renderEmptyContent:C,renderFooter:U,renderHeader:V,renderItem:a,renderLoadingAnimation:G,shouldOverscrollBehaviourContain:!0,xstyle:n.list})}),b[46]=R,b[47]=S,b[48]=u,b[49]=v,b[50]=y,b[51]=x,b[52]=A,b[53]=B,b[54]=D,b[55]=a,b[56]=G,b[57]=w,b[58]=H,b[59]=C,b[60]=U,b[61]=V,b[62]=W):W=b[62];o=W}b[63]!==i?(u=[n.container,i],b[63]=i,b[64]=u):u=b[64];b[65]!==o||b[66]!==t||b[67]!==q||b[68]!==u||b[69]!==K?(v=l.jsx(c("Box.react"),{"aria-label":t,"data-testid":void 0,ref:K,role:q,xstyle:u,children:o}),b[65]=o,b[66]=t,b[67]=q,b[68]=u,b[69]=K,b[70]=v):v=b[70];return v}g.default=a}),98);
__d("MWPParentThreadKeyContext",["react"],(function(a,b,c,d,e,f,g){"use strict";var h;a=h||d("react");b=a.createContext(null);g["default"]=b}),98);
__d("useMWLogLongSuspense",["MWPBumpEntityKey","clearTimeout","react","react-compiler-runtime","setTimeout","useMergeRefs","useVisibilityObserver"],(function(a,b,c,d,e,f,g){"use strict";var h;b=h||d("react");b.useCallback;var i=b.useEffect,j=b.useRef;function a(a,b){var d=l(a,5,b),e=l(a,15,b),f=l(a,60,b);a=l(a,300,b);return c("useMergeRefs")(d,e,f,a)}var k=/\W/g;function l(a,b,e){var f=d("react-compiler-runtime").c(11),g;f[0]!==a?(g=a.replace(k,"_"),f[0]=a,f[1]=g):g=f[1];var h=g,l=j();f[2]!==e||f[3]!==h||f[4]!==b?(a=function(){l.current=c("setTimeout")(function(){d("MWPBumpEntityKey").bumpEntityKeyWithAppId("mwp","long_suspension."+h+".suspended_"+b+"_sec"),e==null||e(b)},b*1e3)},f[2]=e,f[3]=h,f[4]=b,f[5]=a):a=f[5];g=a;f[6]===Symbol["for"]("react.memo_cache_sentinel")?(a=function(){c("clearTimeout")(l.current)},f[6]=a):a=f[6];var m=a,n;f[7]===Symbol["for"]("react.memo_cache_sentinel")?(a=function(){return m},n=[m],f[7]=a,f[8]=n):(a=f[7],n=f[8]);i(a,n);f[9]!==g?(a={onHidden:m,onVisible:g},f[9]=g,f[10]=a):a=f[10];return c("useVisibilityObserver")(a)}g["default"]=a}),98);
__d("MWThreadListGlimmer.react",["CometVisualCompletionAttributes","MWXGlimmer.react","gkx","react","react-compiler-runtime","react-strict-dom","useMWLogLongSuspense"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react"),j={glimmerBody:{borderStartStartRadius:"x1obq294",borderStartEndRadius:"x5a5i1n",borderEndEndRadius:"xde0f50",borderEndStartRadius:"x15x8krk",height:"xlup9mm",width:"xktia5q",$$css:!0},glimmerHeadline:{borderStartStartRadius:"x1obq294",borderStartEndRadius:"x5a5i1n",borderEndEndRadius:"xde0f50",borderEndStartRadius:"x15x8krk",height:"x1qx5ct2",marginBottom:"x1e56ztr",width:"x3hqpx7",$$css:!0},glimmerPhoto:{flexShrink:"x2lah0s",$$css:!0},glimmerPhoto48:{borderStartStartRadius:"x1iwo8zk",borderStartEndRadius:"x1033uif",borderEndEndRadius:"x179ill4",borderEndStartRadius:"x1b60jn0",height:"xsdox4t",marginInlineEnd:"x1sa5p1d",width:"x1useyqa",$$css:!0},glimmerPhoto56:{borderStartStartRadius:"x1iwo8zk",borderStartEndRadius:"x1033uif",borderEndEndRadius:"x179ill4",borderEndStartRadius:"x1b60jn0",height:"xnnlda6",marginInlineEnd:"x1sa5p1d",width:"x15yg21f",$$css:!0},glimmerRoot:{display:"x78zum5",paddingBottom:"x1a8lsjc",paddingInlineStart:"xf7dkkf",paddingInlineEnd:"xv54qhq",paddingLeft:null,paddingRight:null,paddingTop:"x889kno",$$css:!0},glimmerText:{display:"x78zum5",flexDirection:"xdt5ytf",flexGrow:"x1iyjqo2",justifyContent:"xl56j7k",$$css:!0}},k=c("gkx")("23219");function l(a){var b=d("react-compiler-runtime").c(8),e=a.ref,f=a.role;a=a.vcIgnore;var g;b[0]!==a?(g=a===!0?c("CometVisualCompletionAttributes").IGNORE:{},b[0]=a,b[1]=g):g=b[1];b[2]===Symbol["for"]("react.memo_cache_sentinel")?(a=i.jsx(c("MWXGlimmer.react"),{index:0,xstyle:[k?j.glimmerPhoto48:j.glimmerPhoto56,j.glimmerPhoto]}),b[2]=a):a=b[2];var h;b[3]===Symbol["for"]("react.memo_cache_sentinel")?(h=i.jsxs(d("react-strict-dom").html.div,{style:j.glimmerText,children:[i.jsx(c("MWXGlimmer.react"),{index:1,xstyle:j.glimmerHeadline}),i.jsx(c("MWXGlimmer.react"),{index:2,xstyle:j.glimmerBody})]}),b[3]=h):h=b[3];b[4]!==e||b[5]!==f||b[6]!==g?(a=i.jsxs(d("react-strict-dom").html.div,babelHelpers["extends"]({ref:e,role:f,style:j.glimmerRoot},g,{children:[a,h]})),b[4]=e,b[5]=f,b[6]=g,b[7]=a):a=b[7];return a}function a(a){var b=d("react-compiler-runtime").c(11),e=a.numberOfItems,f=a.parentComponentForDebug,g=a.role,h=a.vcIgnore;a=e===void 0?1:e;var j=c("useMWLogLongSuspense")(f+".MWThreadListGlimmer");if(b[0]!==a||b[1]!==j||b[2]!==g||b[3]!==h){b[5]!==j||b[6]!==g||b[7]!==h?(e=function(a,b){return i.jsx(l,{ref:b===0?j:void 0,role:g,vcIgnore:h},"mw_list_glimmer_"+b)},b[5]=j,b[6]=g,b[7]=h,b[8]=e):e=b[8];f=Array(a).fill(!0).map(e);b[0]=a;b[1]=j;b[2]=g;b[3]=h;b[4]=f}else f=b[4];b[9]!==f?(e=i.jsx(i.Fragment,{children:f}),b[9]=f,b[10]=e):e=b[10];return e}g["default"]=a}),98);
__d("LSOptimisticUpdateHasPendingJoinRequest",["LSLocalize"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.forEach(c.filter(c.db.table(9).fetch(),function(b){return b.needsAdminApprovalForNewParticipant===!0&&c.i64.eq(b.threadKey,a[0])}),function(e){var f=e.item;return c.sequence([function(e){return a[1]?c.sequence([function(a){return b("LSLocalize").localizeV2Async(c.i64.cast([0,3199643703]),void 0).then(function(a){return d[2]=a})},function(a){return d[0]=d[2]}]):c.sequence([function(a){return b("LSLocalize").localizeV2Async(c.i64.cast([0,1531706844]),void 0).then(function(a){return d[2]=a})},function(a){return d[0]=d[2]}])},function(b){return d[1]=f.lastReadWatermarkTimestampMs,c.forEach(c.db.table(9).fetch([[[f.threadKey]]]),function(b){var c=b.update;b.item;return c({hasPendingJoinRequest:a[1],snippet:d[0],lastReadWatermarkTimestampMs:d[1]})})}])})},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxOptimisticUpdateHasPendingJoinRequestStoredProcedure";a.__tables__=["threads"];e.exports=a}),null);
__d("LSUpdateCommunityChannelJoiningTaskID",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.forEach(b.filter(b.db.table(162).fetch([[[a[0]]],"byFbGroupId"],[[[a[0]]]]),function(c){return b.i64.eq(c.fbGroupId,a[0])||b.i64.eq(c.communityType,b.i64.cast([0,1]))&&b.i64.eq(c.folderId,a[0])}),function(b){var c=b.update;b.item;return c({joiningChannelTaskId:a[1]})})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxUpdateCommunityChannelJoiningTaskIDStoredProcedure";a.__tables__=["community_folders"];e.exports=a}),null);
__d("LSUpdateCommunityChannelDirectInvite",["LSIssueNewError","LSIssueNewTaskAndGetTaskID","LSLocalize","LSOptimisticUpdateHasPendingJoinRequest","LSUpdateCommunityChannelJoiningTaskID"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(d){return c.i64.eq(a[1],c.i64.cast([0,1]))&&!1!==void 0&&!1?c.storedProcedure(b("LSOptimisticUpdateHasPendingJoinRequest"),a[0],!0):c.resolve()},function(a){return c.sortBy(c.db.table(115).fetch(),[["timestampMs","DESC"]]).next().then(function(a,b){var c=a.done;a=a.value;return c?d[0]=!1:(b=a.item,d[0]=b.errorShouldBeShown)})},function(a){return d[0]===!0?c.sequence([function(a){return b("LSLocalize").localizeV2Async(c.i64.cast([0,2285622730]),void 0).then(function(a){return d[11]=a})},function(a){return b("LSLocalize").localizeV2Async(c.i64.cast([0,1919524925]),void 0).then(function(a){return d[12]=a})},function(a){return c.storedProcedure(b("LSIssueNewError"),void 0,c.i64.cast([0,1545093]),d[11],d[12],void 0,void 0)}]):c.resolve()},function(e){return d[2]=new c.Map(),d[2].set("channel_id",a[0]),d[2].set("state",a[1]),d[2].set("is_request_to_join",!1!==void 0&&!1),c.i64.gt(c.i64.cast([0,0]),c.i64.cast([0,0]))?(d[11]=c.i64.of_float(Date.now()),d[3]=c.i64.add(d[11],c.i64.cast([0,0]))):d[3]=c.i64.cast([0,0]),d[4]=d[2].get("channel_id"),d[5]=c.toJSON(d[2]),c.storedProcedure(b("LSIssueNewTaskAndGetTaskID"),["community_channel_invitation","_",c.i64.to_string(d[4])].join(""),c.i64.cast([0,463]),d[5],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,d[3],c.i64.cast([0,0])).then(function(a){return a=a,d[6]=a[0],a})},function(b){return c.db.table(9).fetch([[[a[0]]]]).next().then(function(a,b){var e=a.done;a=a.value;return e?d[7]=c.i64.cast([-1,4294967295]):(b=a.item,d[7]=b.parentThreadKey)})},function(a){return c.db.table(162).fetch([[[d[7]]]]).next().then(function(a,b){var e=a.done;a=a.value;return e?d[9]=c.i64.cast([-1,4294967295]):(b=a.item,d[9]=b.fbGroupId)})},function(e){return c.i64.eq(a[1],c.i64.cast([0,1]))?c.storedProcedure(b("LSUpdateCommunityChannelJoiningTaskID"),d[9],d[6]):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxUpdateCommunityChannelDirectInviteStoredProcedure";a.__tables__=["user_visible_network_connectivity_error","threads","community_folders"];e.exports=a}),null);
__d("LSUpdateCommunityChannelDirectInviteStoredProcedure",["LSSynchronousPromise","LSUpdateCommunityChannelDirectInvite","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSUpdateCommunityChannelDirectInvite"),e.channelId,e.state);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("MWPThreadListItemInviteAddOn.react",["fbt","MWPBumpEntityKey","MWXCircleButton.react","MWXIconCheckmark","MWXIconCross","MWXRow.react","MWXRowItem.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react"),k=h._(/*BTDS*/"\u0e22\u0e2d\u0e21\u0e23\u0e31\u0e1a\u0e04\u0e33\u0e40\u0e0a\u0e34\u0e0d"),l=h._(/*BTDS*/"\u0e1b\u0e0f\u0e34\u0e40\u0e2a\u0e18\u0e04\u0e33\u0e40\u0e0a\u0e34\u0e0d");function a(a){var b=d("react-compiler-runtime").c(7),e=a.onAccept,f=a.onDecline;b[0]!==e?(a=j.jsx(c("MWXRowItem.react"),{children:j.jsx(c("MWXCircleButton.react"),{icon:c("MWXIconCheckmark"),label:k,onPress:function(a){d("MWPBumpEntityKey").bumpEntityKeyWithAppId("mw.sidebar","thread_invite.accept"),e(a)},size:32})}),b[0]=e,b[1]=a):a=b[1];var g;b[2]!==f?(g=j.jsx(c("MWXRowItem.react"),{children:j.jsx(c("MWXCircleButton.react"),{icon:c("MWXIconCross"),label:l,onPress:function(a){d("MWPBumpEntityKey").bumpEntityKeyWithAppId("mw.sidebar","thread_invite.decline"),f(a)},size:32})}),b[2]=f,b[3]=g):g=b[3];var h;b[4]!==a||b[5]!==g?(h=j.jsxs(c("MWXRow.react"),{paddingHorizontal:0,paddingVertical:0,verticalAlign:"center",children:[a,g]}),b[4]=a,b[5]=g,b[6]=h):h=b[6];return h}g["default"]=a}),226);
__d("MWXIconPauseChat",["MWXSvgIcon","SVGIcon","cr:22420","gkx"],(function(a,b,c,d,e,f,g){"use strict";a=d("MWXSvgIcon").mwxSvgIcon(d("SVGIcon").svgIcon(b("cr:22420")),c("gkx")("23219"));g["default"]=a}),98);
__d("MWThreadAddOnSecondary.react",["fbt","CometOverlappingFacepile_DEPRECATED.react","CurrentEnvironment","FDSBadge.react","I64","MWPActor.react","MWXIconBellCross","MWXIconPauseChat","MWXIconPushpin","MWXIconStrict.react","MWXPressable.react","ReQL","ReQLSuspense","getLSMediaContactProfilePictureUrl","isArmadillo","react","react-compiler-runtime","useMWIsReadReceiptsDisabledForThread","useMWLSMarkThreadAsRead","useReStore"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k,l=k||(k=d("react"));b=k.memo;function m(a){var b=d("react-compiler-runtime").c(19),e=(i||(i=c("useReStore")))(),g=d("MWPActor.react").useActor(),h;b[0]!==e.tables.threads||b[1]!==a?(h=function(){return d("ReQL").fromTableAscending(e.tables.threads,["threadKey","lastActivityTimestampMs"]).getKeyRange(a)},b[0]=e.tables.threads,b[1]=a,b[2]=h):h=b[2];var k;b[3]!==e||b[4]!==a?(k=[e,a],b[3]=e,b[4]=a,b[5]=k):k=b[5];var l=d("ReQLSuspense").useFirst(h,k,f.id+":54"),m=c("useMWIsReadReceiptsDisabledForThread")(a);b[6]!==g||b[7]!==e.tables.contacts||b[8]!==e.tables.participants||b[9]!==m||b[10]!==l?(h=function(){if(m||l==null)return d("ReQL").empty();else return d("ReQL").fromTableAscending(e.tables.participants.index("threadKeyReadWatermarkTimestampMs"),["contactId"]).getKeyRange(l.threadKey).bounds({gte:d("ReQL").key(l.lastActivityTimestampMs)}).filter(function(a){a=a.contactId;return!(j||(j=d("I64"))).equal(a,g)}).take(3).map(function(a){a=a.contactId;a=d("ReQLSuspense").first(d("ReQL").fromTableAscending(e.tables.contacts,["name","profilePictureFallbackUrl","profilePictureUrl","profilePictureUrlExpirationTimestampMs"]).getKeyRange(a),f.id+":84");return a!=null?{alt:a.name,source:{uri:c("getLSMediaContactProfilePictureUrl")(a)}}:null})},b[6]=g,b[7]=e.tables.contacts,b[8]=e.tables.participants,b[9]=m,b[10]=l,b[11]=h):h=b[11];b[12]!==g||b[13]!==e||b[14]!==m||b[15]!==l?(k=[e,g,l,m],b[12]=g,b[13]=e,b[14]=m,b[15]=l,b[16]=k):k=b[16];h=d("ReQLSuspense").useArray(h,k,f.id+":65");b[17]!==h?(k=h.filter(Boolean),b[17]=h,b[18]=k):k=b[18];return k}function a(a){var b=d("react-compiler-runtime").c(26),e=a.entryPoint,f=a.isMuted,g=a.isPaused,i=a.isPinnedThread,j=a.isUnread,k=a.isViewerSender,o=a.lastMessageDeliveryStatusIcon;a=a.thread;var p=c("useMWLSMarkThreadAsRead")(e);e=m(a.threadKey);if(b[0]!==f||b[1]!==g||b[2]!==i||b[3]!==j||b[4]!==k||b[5]!==o||b[6]!==p||b[7]!==e){a=[];if(g){var q;b[9]===Symbol["for"]("react.memo_cache_sentinel")?(q=l.jsx(c("MWXIconStrict.react"),{color:"disabled",icon:c("MWXIconPauseChat"),size:16}),b[9]=q):q=b[9];a.push(q)}if(f){b[10]===Symbol["for"]("react.memo_cache_sentinel")?(q=l.jsx(c("MWXIconStrict.react"),{color:"disabled",icon:c("MWXIconBellCross"),size:16}),b[10]=q):q=b[10];a.push(q)}if(i){b[11]===Symbol["for"]("react.memo_cache_sentinel")?(q=l.jsx(c("MWXIconStrict.react"),{alt:h._(/*BTDS*/"\u0e40\u0e18\u0e23\u0e14\u0e17\u0e35\u0e48\u0e1b\u0e31\u0e01\u0e2b\u0e21\u0e38\u0e14\u0e44\u0e27\u0e49"),color:"disabled",icon:c("MWXIconPushpin"),size:16}),b[11]=q):q=b[11];a.push(q)}if(j){b[12]!==p?(q=function(a){return p()},b[12]=p,b[13]=q):q=b[13];var r;b[14]===Symbol["for"]("react.memo_cache_sentinel")?(r=l.jsx(c("FDSBadge.react"),{color:"blue",isProfileBadge:!0,size:c("isArmadillo")()&&c("CurrentEnvironment").messengerdotcom?10:12}),b[14]=r):r=b[14];b[15]!==q?(r=l.jsx(c("MWXPressable.react"),{"aria-hidden":!0,expanding:!0,focusable:!1,onPress:q,testid:void 0,children:r}),b[15]=q,b[16]=r):r=b[16];a.push(r)}else if(k)if(e.length===0)o&&a.push(o);else{b[17]!==e[0]||b[18]!==e.length?(q=e.length===1?h._(/*BTDS*/"{=personName} \u0e40\u0e2b\u0e47\u0e19\u0e41\u0e25\u0e49\u0e27",[h._param("=personName",e[0].alt)]):h._(/*BTDS*/"_j{\"*\":\"{=numPeople} \\u0e04\\u0e19\\u0e40\\u0e2b\\u0e47\\u0e19\\u0e41\\u0e25\\u0e49\\u0e27\"}",[h._param("=numPeople",e.length,[0])]),b[17]=e[0],b[18]=e.length,b[19]=q):q=b[19];b[20]!==e||b[21]!==q?(r=l.jsx(c("CometOverlappingFacepile_DEPRECATED.react"),{count:e.length,isTextInline:!0,items:e,screenReaderLabel:q,size:16}),b[20]=e,b[21]=q,b[22]=r):r=b[22];a.push(r)}b[0]=f;b[1]=g;b[2]=i;b[3]=j;b[4]=k;b[5]=o;b[6]=p;b[7]=e;b[8]=a}else a=b[8];b[23]===Symbol["for"]("react.memo_cache_sentinel")?(q={className:"x6s0dn4 x78zum5 xozqiw3"},b[23]=q):q=b[23];b[24]!==a?(r=l.jsx("div",babelHelpers["extends"]({},q,{children:a.map(n)})),b[24]=a,b[25]=r):r=b[25];return r}function n(a,b){return l.jsxs(l.Fragment,{children:[b!==0?l.jsx("div",{className:"x1fsd2vl"}):null,a]},"item_"+b.toString(10))}n.displayName=n.name+" [from "+f.id+"]";e=b(a);g["default"]=e}),226);
__d("MWThreadListItemAddOnEnd.react",["fbt","FBGroupChatInviteState","I64","Int64Hooks","LSFactory","LSIntEnum","LSUpdateCommunityChannelDirectInviteStoredProcedure","MWCMGetValidId","MWJewelPopoverDialogContext.react","MWPActor.react","MWPIsThreadUnread","MWPThreadListItemInviteAddOn.react","MWThreadAddOnSecondary.react","ReQL","ReQLSuspense","ThreadStatus","cometPushToast","cr:21160","promiseDone","react","react-compiler-runtime","requireDeferred","useEmptyFunction","useMWChatCalculateIsMutedFromExpireTime","useReStore"],(function(a,b,c,d,e,f,g,h){"use strict";var i=["threadKey","communityId","fbGroupId","renderAddOnEnd"],j,k,l,m,n=k||(k=d("react")),o=k.useContext,p=c("requireDeferred")("C4gEngagementFalcoEvent").__setRef("MWThreadListItemAddOnEnd.react"),q=(b=(b=b("cr:21160"))==null?void 0:b.useIsPinnedThread)!=null?b:c("useEmptyFunction");function r(a){var b=a.clientExtras,c=a.communityId,e=a.event,f=a.groupId,g=a.parentSurface,h=g===void 0?"channel_list":g,i=a.source,j=a.threadId;p.onReady(function(a){return a.log(function(){return{action:"tap",client_extras:b,community_id:c==null?null:(m||(m=d("I64"))).to_string(c),event:e,group_id:d("MWCMGetValidId").MWCMHasValidFbGroupId(f)?(m||(m=d("I64"))).to_string(f):null,parent_surface:h,source:i,surface:"chat_row",thread_id:(m||(m=d("I64"))).to_string(j)}})})}function a(a){var b,e=d("react-compiler-runtime").c(32),g=a.communityId,i=a.fbGroupId,k=a.isMaximized,p=a.messagingEntrypoint,s=a.mutedUntilMs,t=a.parentSurface,u=a.showGroupsJoinChatDialog,v=a.thread,w=(j||(j=c("useReStore")))();a=d("MWPActor.react").useActor();var x=v.snippetSenderContactId,y;e[0]!==a||e[1]!==x?(y=x!=null?(m||(m=d("I64"))).equal(x,a):!1,e[0]=a,e[1]=x,e[2]=y):y=e[2];a=y;x=(m||(m=d("I64"))).equal(v.parentThreadKey,(l||(l=d("LSIntEnum"))).ofNumber(0));y=o(c("MWJewelPopoverDialogContext.react"));var z=y.setIsOpenForDialog;y=v.hasPendingInvitation||!1;s=c("useMWChatCalculateIsMutedFromExpireTime")(s);b=(b=q(v.threadTags))!=null?b:!1;var A=d("MWPIsThreadUnread").useIsThreadUnread(v.threadKey),B;e[3]!==v.threadStatus?(B=v.threadStatus!=null&&((m||(m=d("I64"))).equal(v.threadStatus,(m||(m=d("I64"))).of_int32(c("ThreadStatus").PAUSED))||(m||(m=d("I64"))).equal(v.threadStatus,(m||(m=d("I64"))).of_int32(c("ThreadStatus").UPGRADED_TO_COMMUNITY_AND_TO_BE_PAUSED))),e[3]=v.threadStatus,e[4]=B):B=e[4];B=B;var C;e[5]!==g||e[6]!==w||e[7]!==i||e[8]!==t||e[9]!==v.needsAdminApprovalForNewParticipant||e[10]!==v.threadKey?(C=function(){var a;c("promiseDone")(w.runInTransaction(function(a){return c("LSUpdateCommunityChannelDirectInviteStoredProcedure")(c("LSFactory")(a),{channelId:v.threadKey,state:(l||(l=d("LSIntEnum"))).ofNumber(c("FBGroupChatInviteState").DECLINED_BY_RECEIVER)})},"readwrite",void 0,void 0,f.id+":158"));r({clientExtras:{member_join_request_enabled:((a=v.needsAdminApprovalForNewParticipant)!=null?a:!1)?"1":"0"},communityId:g,event:"invite_declined",groupId:i,parentSurface:t,source:"direct_invite_decline_button",threadId:v.threadKey});d("cometPushToast").cometPushSimpleToast(h._(/*BTDS*/"\u0e04\u0e38\u0e13\u0e1b\u0e0f\u0e34\u0e40\u0e2a\u0e18\u0e04\u0e33\u0e40\u0e0a\u0e34\u0e0d\u0e43\u0e2b\u0e49\u0e40\u0e02\u0e49\u0e32\u0e23\u0e48\u0e27\u0e21").toString())},e[5]=g,e[6]=w,e[7]=i,e[8]=t,e[9]=v.needsAdminApprovalForNewParticipant,e[10]=v.threadKey,e[11]=C):C=e[11];C=C;if(y){e[12]!==g||e[13]!==i||e[14]!==p||e[15]!==t||e[16]!==z||e[17]!==u||e[18]!==v.needsAdminApprovalForNewParticipant||e[19]!==v.threadKey?(y=function(a){var b;r({clientExtras:{member_join_request_enabled:((b=v.needsAdminApprovalForNewParticipant)!=null?b:!1)?"1":"0"},communityId:g,event:"invite_accepted",groupId:i,parentSurface:t,source:"direct_invite_join_button",threadId:v.threadKey});z(p==="jewel");return u(a)},e[12]=g,e[13]=i,e[14]=p,e[15]=t,e[16]=z,e[17]=u,e[18]=v.needsAdminApprovalForNewParticipant,e[19]=v.threadKey,e[20]=y):y=e[20];var D;e[21]!==C||e[22]!==y?(D=n.jsx(c("MWPThreadListItemInviteAddOn.react"),{onAccept:y,onDecline:C}),e[21]=C,e[22]=y,e[23]=D):D=e[23];return D}if(k||!x){e[24]!==s||e[25]!==B||e[26]!==b||e[27]!==A||e[28]!==a||e[29]!==p||e[30]!==v?(C=n.jsx(c("MWThreadAddOnSecondary.react"),{entryPoint:p,isMuted:s,isPaused:B,isPinnedThread:b,isUnread:A,isViewerSender:a,lastMessageDeliveryStatusIcon:null,thread:v}),e[24]=s,e[25]=B,e[26]=b,e[27]=A,e[28]=a,e[29]=p,e[30]=v,e[31]=C):C=e[31];return C}return null}var s=n.memo(a);function e(a){var b=d("react-compiler-runtime").c(25),e,g,h,k,l;b[0]!==a?(l=a.threadKey,e=a.communityId,g=a.fbGroupId,h=a.renderAddOnEnd,k=babelHelpers.objectWithoutPropertiesLoose(a,i),b[0]=a,b[1]=e,b[2]=g,b[3]=h,b[4]=k,b[5]=l):(e=b[1],g=b[2],h=b[3],k=b[4],l=b[5]);var m;b[6]!==g?(a=function(){return g},m=[g],b[6]=g,b[7]=a,b[8]=m):(a=b[7],m=b[8]);a=d("Int64Hooks").useMemoInt64(a,m);var o;b[9]!==e?(m=function(){return e},o=[e],b[9]=e,b[10]=m,b[11]=o):(m=b[10],o=b[11]);m=d("Int64Hooks").useMemoInt64(m,o);var p=(j||(j=c("useReStore")))();b[12]!==p.tables.threads||b[13]!==l?(o=function(){return d("ReQL").fromTableAscending(p.tables.threads,["threadType","threadStatus","threadKey","snippetSenderContactId","parentThreadKey","hasPendingInvitation","takedownState","needsAdminApprovalForNewParticipant","threadTags"]).getKeyRange(l)},b[12]=p.tables.threads,b[13]=l,b[14]=o):o=b[14];var q;b[15]!==p||b[16]!==l?(q=[p,l],b[15]=p,b[16]=l,b[17]=q):q=b[17];o=d("ReQLSuspense").useFirst(o,q,f.id+":248");if(h!=null){b[18]!==h?(q=h(),b[18]=h,b[19]=q):q=b[19];return q}if(o==null)return null;b[20]!==m||b[21]!==a||b[22]!==k||b[23]!==o?(h=n.jsx(s,babelHelpers["extends"]({communityId:m,fbGroupId:a,thread:o},k)),b[20]=m,b[21]=a,b[22]=k,b[23]=o,b[24]=h):h=b[24];return h}g["default"]=e}),226);
__d("JSSet.bs",[],(function(a,b,c,d,e,f){"use strict";function a(a){return Array.from(a.values())}f.values=a}),66);
__d("MessageRequestsBulkActionsThreadListItem",["ix","CometPressable.react","I64","JSSet.bs","MWPIsThreadUnread","MWXIcon_DEPRECATED.react","MessageRequestsBulkActionsContext.react","fbicon","react","react-compiler-runtime","useMWAriaLabelForThread"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=i||(i=d("react"));b=i;b.useCallback;var l=b.useContext,m=b.useEffect,n={pressableContent:{borderStartStartRadius:"x1obq294",borderStartEndRadius:"x5a5i1n",borderEndEndRadius:"xde0f50",borderEndStartRadius:"x15x8krk",display:"x1lliihq",width:"xh8yej3",$$css:!0}};function a(a){var b=d("react-compiler-runtime").c(33),e=a.thread;a=a.threadListCell;var f=l(c("MessageRequestsBulkActionsContext.react")),g=f.setBulkActionsUnreadSelectedThreads,i=f.setBulkActionsSelectedThreads,n=f.bulkActionsSelectedThreads;b[0]!==e.threadKey?(f=(j||(j=d("I64"))).to_string(e.threadKey),b[0]=e.threadKey,b[1]=f):f=b[1];var p=f;b[2]!==i||b[3]!==p?(f=function(){return i(function(a){a=new Set(d("JSSet.bs").values(a));if(a["delete"](p))return a;else return a.add(p)})},b[2]=i,b[3]=p,b[4]=f):f=b[4];f=f;var q;b[5]!==n||b[6]!==g||b[7]!==e||b[8]!==p?(q=function(){g(function(a){a=new Set(d("JSSet.bs").values(a));if(d("MWPIsThreadUnread").isThreadUnread(e)&&n.has(p))return a.add(p);else if(d("MWPIsThreadUnread").isThreadUnread(e)){a["delete"](p);return a}else return a})},b[5]=n,b[6]=g,b[7]=e,b[8]=p,b[9]=q):q=b[9];var r;b[10]!==n?(r=[n],b[10]=n,b[11]=r):r=b[11];m(q,r);b[12]!==n||b[13]!==p?(q=n.has(p),b[12]=n,b[13]=p,b[14]=q):q=b[14];r=q;q=c("useMWAriaLabelForThread")(e);var s,t;b[15]===Symbol["for"]("react.memo_cache_sentinel")?(s={className:"x6s0dn4 x78zum5 xexx8yu x2vl965 x18d9i69 xe2zdcy"},t={className:"xf159sx"},b[15]=s,b[16]=t):(s=b[15],t=b[16]);var u=r?"highlight":"disabled",v;b[17]!==r?(v=r?d("fbicon")._(h("484757"),20):d("fbicon")._(h("659288"),20),b[17]=r,b[18]=v):v=b[18];b[19]!==u||b[20]!==v?(t=k.jsx("div",babelHelpers["extends"]({},t,{children:k.jsx(c("MWXIcon_DEPRECATED.react"),{color:u,hideHoverOverlay:!0,icon:v})})),b[19]=u,b[20]=v,b[21]=t):t=b[21];b[22]===Symbol["for"]("react.memo_cache_sentinel")?(u={className:"x1iyjqo2 xeuugli x47corl"},b[22]=u):u=b[22];b[23]!==a?(v=k.jsx("div",babelHelpers["extends"]({},u,{children:a})),b[23]=a,b[24]=v):v=b[24];b[25]!==v||b[26]!==t?(u=k.jsxs("div",babelHelpers["extends"]({"aria-hidden":!0},s,{children:[t,v]})),b[25]=v,b[26]=t,b[27]=u):u=b[27];b[28]!==q||b[29]!==r||b[30]!==f||b[31]!==u?(a=k.jsx(c("CometPressable.react"),{"aria-checked":r,"aria-label":q,onPress:f,role:"checkbox",xstyle:o,children:u}),b[28]=q,b[29]=r,b[30]=f,b[31]=u,b[32]=a):a=b[32];return a}function o(){return[n.pressableContent]}g["default"]=a}),98);
__d("useGroupsCometJoinChatDialog",["GroupsCometJoinChatDialog.entrypoint","I64","Int64Hooks","MWXCardedDialogLoadingState.react","react","react-compiler-runtime","useMWCMShouldGoToFullScreenChatHook","useMWXEntryPointDialog"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=h||(h=d("react"));h.useCallback;function k(){return j.jsx(c("MWXCardedDialogLoadingState.react"),{})}k.displayName=k.name+" [from "+f.id+"]";function a(a,b,e,f,g,h){var j=d("react-compiler-runtime").c(12),l,m;j[0]!==b||j[1]!==a.threadKey?(l=function(){return{groupID:(i||(i=d("I64"))).to_string(b!=null?b:(i||(i=d("I64"))).zero),threadID:i.to_string(a.threadKey)}},m=[b,a.threadKey],j[0]=b,j[1]=a.threadKey,j[2]=l,j[3]=m):(l=j[2],m=j[3]);l=d("Int64Hooks").useMemoInt64(l,m);m=c("useMWXEntryPointDialog")(c("GroupsCometJoinChatDialog.entrypoint"),l,void 0,k);var n=m[0],o=c("useMWCMShouldGoToFullScreenChatHook")(),p=a.hasPendingInvitation||!1;j[4]!==p||j[5]!==h||j[6]!==g||j[7]!==e||j[8]!==o||j[9]!==n||j[10]!==f?(l=function(){var a={invited:p,isSMC:h,onSuccess:g,parentSurface:e,shouldGoToMessenger:o,surface:f};n(a)},j[4]=p,j[5]=h,j[6]=g,j[7]=e,j[8]=o,j[9]=n,j[10]=f,j[11]=l):l=j[11];return l}g["default"]=a}),98);
__d("LSSetCommunityChannelJoiningErrorCodeForTask",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.resolve(c)}a.__sproc_name__="LSMailboxSetCommunityChannelJoiningErrorCodeForTaskStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSJoinCommunityChannel",["LSIssueNewError","LSIssueNewTaskAndGetTaskID","LSLocalize","LSOptimisticUpdateHasPendingJoinRequest","LSSetCommunityChannelJoiningErrorCodeForTask","LSUpdateCommunityChannelJoiningTaskID"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(b){return c.db.table(9).fetch([[[a[0]]]]).next().then(function(a,b){var e=a.done;a=a.value;return e?d[0]=c.i64.cast([-1,4294967295]):(b=a.item,d[0]=b.parentThreadKey)})},function(a){return c.db.table(162).fetch([[[d[0]]]]).next().then(function(a,b){var e=a.done;a=a.value;return e?d[2]=c.i64.cast([-1,4294967295]):(b=a.item,c.i64.eq(b.communityType,c.i64.cast([0,1]))?d[13]=b.folderId:d[13]=b.fbGroupId,d[2]=d[13])})},function(a){return c.storedProcedure(b("LSSetCommunityChannelJoiningErrorCodeForTask"),d[2],void 0)},function(d){return a[2]?c.storedProcedure(b("LSOptimisticUpdateHasPendingJoinRequest"),a[0],!0):c.resolve()},function(b){return c.db.table(9).fetch([[[a[0]]]]).next().then(function(a,b){var e=a.done;a=a.value;return e?d[4]=c.i64.cast([0,1]):(b=a.item,d[14]=b.syncGroup,c.i64.neq(d[14],void 0)?d[13]=d[14]:d[13]=c.i64.cast([0,1]),d[4]=d[13])})},function(a){return c.sortBy(c.db.table(115).fetch(),[["timestampMs","DESC"]]).next().then(function(a,b){var c=a.done;a=a.value;return c?d[6]=!1:(b=a.item,d[6]=b.errorShouldBeShown)})},function(a){return d[6]===!0?c.sequence([function(a){return b("LSLocalize").localizeV2Async(c.i64.cast([0,2285622730]),void 0).then(function(a){return d[13]=a})},function(a){return b("LSLocalize").localizeV2Async(c.i64.cast([0,1919524925]),void 0).then(function(a){return d[14]=a})},function(a){return c.storedProcedure(b("LSIssueNewError"),void 0,c.i64.cast([0,1545093]),d[13],d[14],void 0,void 0)}]):c.resolve()},function(e){return d[8]=new c.Map(),d[8].set("thread_key",a[0]),d[8].set("community_id",d[2]),d[8].set("sync_group",d[4]),d[8].set("entry_point",a[1]),d[8].set("is_request_to_join",a[2]),d[8].set("request_source",void 0),c.i64.gt(c.i64.cast([0,0]),c.i64.cast([0,0]))?(d[13]=c.i64.of_float(Date.now()),d[9]=c.i64.add(d[13],c.i64.cast([0,0]))):d[9]=c.i64.cast([0,0]),d[10]=d[8].get("thread_key"),d[11]=c.toJSON(d[8]),c.storedProcedure(b("LSIssueNewTaskAndGetTaskID"),c.i64.to_string(d[10]),c.i64.cast([0,337]),d[11],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,d[9],c.i64.cast([0,0])).then(function(a){return a=a,d[12]=a[0],a})},function(a){return c.storedProcedure(b("LSUpdateCommunityChannelJoiningTaskID"),d[2],d[12])}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxJoinCommunityChannelStoredProcedure";a.__tables__=["threads","community_folders","user_visible_network_connectivity_error"];e.exports=a}),null);
__d("LSJoinCommunityChannelStoredProcedure",["LSJoinCommunityChannel","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSJoinCommunityChannel"),e.threadKey,e.entryPoint,e.isRequestToJoin);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("getValidMediaURL",["I64","ServerTime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){return(h||(h=d("I64"))).of_float(d("ServerTime").getMillis()/1e3)}function j(a){if((h||(h=d("I64"))).gt(a,(h||(h=d("I64"))).zero))return(h||(h=d("I64"))).lt(a,i());else return!1}function a(a,b,c){return a!=null?j(a)?c:b:c}g["default"]=a}),98);
__d("useMWCMJoinCMThread",["C4GFalcoLoggerDeferred","CommunityMessagingEnableState","I64","Int64Hooks","JSResourceForInteraction","LSCommunityBitOffset","LSFactory","LSIntEnum","LSJoinCommunityChannelStoredProcedure","LSMailboxType","LSThreadBitOffset","LSVec","LSVerifyThreadViewStoredProcedure","ReQL","ThreadStatus","emptyFunction","mwCMisStandAloneCommunity","promiseDone","react","react-compiler-runtime","useGroupsCometCMOffboardingEntryPointDialog","useIsChatPreviewsEnabled","useMWNavigation","useMWXLazyDialog","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=(i||d("react")).useState,m=function(a){return(j||(j=d("I64"))).equal(a,(k||(k=d("LSIntEnum"))).ofNumber(18))||(j||(j=d("I64"))).equal(a,(k||(k=d("LSIntEnum"))).ofNumber(21))};function a(a,b){var e=d("react-compiler-runtime").c(32),g=(h||(h=c("useReStore")))(),i;e[0]!==b?(i=b?d("LSCommunityBitOffset").has(1,b):!1,e[0]=b,e[1]=i):i=e[1];var n=i;e[2]===Symbol.for("react.memo_cache_sentinel")?(i=c("JSResourceForInteraction")("MWCMPausedChatMemberDialog.react").__setRef("useMWCMJoinCMThread"),e[2]=i):i=e[2];i=c("useMWXLazyDialog")(i);var o=i[0],p=c("useMWNavigation")();i=l(!1);var q=i[0],r=i[1];e[3]!==(b==null?void 0:b.fbGroupId)?(i=function(){var a;return{groupID:(j||(j=d("I64"))).to_string((a=b==null?void 0:b.fbGroupId)!=null?a:(j||(j=d("I64"))).zero)}},e[3]=b==null?void 0:b.fbGroupId,e[4]=i):i=e[4];var s=b==null?void 0:b.fbGroupId,t;e[5]!==s?(t=[s],e[5]=s,e[6]=t):t=e[6];s=c("useGroupsCometCMOffboardingEntryPointDialog")(d("Int64Hooks").useMemoInt64(i,t));var u=s[0],v=a.clientThreadKey,w=a.threadKey,x=a.threadType;e[7]!==v||e[8]!==p||e[9]!==q||e[10]!==w||e[11]!==x?(i=function(){if(!q)return;m(x)&&(p.openTabOrInbox({clientThreadKey:v,threadKey:w,threadType:x},"inboxThreadList"),r(!1))},t=[x,v,w,q,p],e[7]=v,e[8]=p,e[9]=q,e[10]=w,e[11]=x,e[12]=i,e[13]=t):(i=e[12],t=e[13]);d("Int64Hooks").useEffectInt64(i,t);e[14]!==g||e[15]!==(b==null?void 0:b.communityType)||e[16]!==(b==null?void 0:b.enableState)||e[17]!==(b==null?void 0:b.fbGroupId)||e[18]!==n||e[19]!==u||e[20]!==o||e[21]!==w?(s=function(a,e,h,i){c("promiseDone")(async function(l){var m=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(g.tables.threads).getKeyRange(w));if(m==null)return;var p=function(){c("promiseDone")(g.runInTransaction(function(a){return c("LSVerifyThreadViewStoredProcedure")(c("LSFactory")(a),{contacts:c("LSVec").ofArray([]),mailboxType:(k||(k=d("LSIntEnum"))).ofNumber(c("LSMailboxType").MESSENGER),threadKey:m.threadKey,threadType:m.threadType})},"readwrite",void 0,void 0,f.id+":148"))},q=m.hasPendingInvitation||!1,s=m.threadStatus!=null&&(j||(j=d("I64"))).equal(m.threadStatus,(j||(j=d("I64"))).of_int32(c("ThreadStatus").PAUSED));l=(j||(j=d("I64"))).equal((l=b==null?void 0:b.enableState)!=null?l:(k||(k=d("LSIntEnum"))).ofNumber(c("CommunityMessagingEnableState").ENABLED),(k||(k=d("LSIntEnum"))).ofNumber(c("CommunityMessagingEnableState").DISABLE_REQUESTED));s=!l&&s&&!d("LSThreadBitOffset").has(154,m)&&!q;if(s)return o({thread:m},c("emptyFunction"));if(!l&&d("useIsChatPreviewsEnabled").isChatPreviewsEnabled(m,b==null?void 0:b.communityType)&&h){q=e?e.metaKey||e.ctrlKey||e.shiftKey:!1;p();return h(q)}if(c("mwCMisStandAloneCommunity")(b==null?void 0:b.communityType)){!d("useIsChatPreviewsEnabled").isChatPreviewsEnabled(m,b==null?void 0:b.communityType)?(a(),r(!0)):c("promiseDone")(g.runInTransaction(function(a){r(!0);return c("LSJoinCommunityChannelStoredProcedure")(c("LSFactory")(a),{entryPoint:"",isRequestToJoin:!1,threadKey:m.threadKey})},"readwrite","ui",void 0,f.id+":213"));return}if(m.needsAdminApprovalForNewParticipant===!0&&n&&i){d("C4GFalcoLoggerDeferred").logC4GEngagementFalcoEvent({action:"tap",client_extras:{member_join_request_enabled:"1"},community_id:(j||(j=d("I64"))).to_string(m.parentThreadKey),event:"thread_join",parent_surface:"thread_list",source:m.hasPendingInvitation===!0?"direct_invite_join_button":"join_button",surface:"messenger_inbox",thread_id:j.to_string(m.threadKey)});return i()}if(!l)return a();if((b==null?void 0:b.fbGroupId)==null)return;return u({},c("emptyFunction"))}())},e[14]=g,e[15]=b==null?void 0:b.communityType,e[16]=b==null?void 0:b.enableState,e[17]=b==null?void 0:b.fbGroupId,e[18]=n,e[19]=u,e[20]=o,e[21]=w,e[22]=s):s=e[22];a=b==null?void 0:b.communityType;i=b==null?void 0:b.enableState;t=b==null?void 0:b.fbGroupId;var y;e[23]!==g||e[24]!==n||e[25]!==u||e[26]!==o||e[27]!==t||e[28]!==a||e[29]!==i||e[30]!==w?(y=[g,a,i,t,n,u,o,w],e[23]=g,e[24]=n,e[25]=u,e[26]=o,e[27]=t,e[28]=a,e[29]=i,e[30]=w,e[31]=y):y=e[31];return d("Int64Hooks").useCallbackInt64(s,y)}g.default=a}),98);
__d("useMWResponsiveLogExtraData",["gkx","react-compiler-runtime","useMatchViewport"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a=d("react-compiler-runtime").c(2),b=c("gkx")("24056"),e=c("useMatchViewport")("min","width",900);b="mw_responsive_layout: "+b.toString()+", is900px: "+e.toString();a[0]!==b?(e={responsive:b},a[0]=b,a[1]=e):e=a[1];return e}g["default"]=a}),98);
__d("useOnPressMWThreadListItem",["fbt","CommunityMessagingEnableState","I64","Int64Hooks","JSResourceForInteraction","LSFactory","LSIntEnum","LSJoinCommunityChannelStoredProcedure","LSMessagingThreadTypeUtil","LSPlatformWaitForTaskCompletion","LSThreadBitOffset","MAWGroupInvitesForThread","MWCMThreadTypes.react","MWPIsThreadUnread","MessengerThreadTakedownState","MessengerWebUXLogger","ReQL","ThreadStatus","cr:12043","emptyFunction","getValidMediaURL","promiseDone","react-compiler-runtime","useCommunityFolder","useGroupsCometCMDisabledChatEntryPointDialog","useMWCMJoinCMThread","useMWNavigation","useMWResponsiveLogExtraData","useMWXLazyDialog","useMWXPushErrorToast","useReStore"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k;function l(a){var b=d("react-compiler-runtime").c(9),e;b[0]===Symbol.for("react.memo_cache_sentinel")?(e=c("JSResourceForInteraction")("MWCMPausedChannelMemberDialog.react").__setRef("useOnPressMWThreadListItem"),b[0]=e):e=b[0];e=c("useMWXLazyDialog")(e);var f=e[0],g=(k||(k=c("useReStore")))();b[1]!==g.tables.threads||b[2]!==f||b[3]!==a?(e=function(){return function(){c("promiseDone")(async function(b){b=(b=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(g.tables.threads).getKeyRange(a)))!=null?b:{};var e=b.threadName,h=b.threadPictureUrl,i=b.threadPictureUrlExpirationTimestampMs;b=b.threadPictureUrlFallback;if(i==null||h==null||b==null||e==null)return;i=c("getValidMediaURL")(i,h,b);f({threadImageUrl:i,threadTitle:e},c("emptyFunction"))}())}},b[1]=g.tables.threads,b[2]=f,b[3]=a,b[4]=e):e=b[4];var h;b[5]!==g||b[6]!==f||b[7]!==a?(h=[g,f,a],b[5]=g,b[6]=f,b[7]=a,b[8]=h):h=b[8];return d("Int64Hooks").useMemoInt64(e,h)}function a(a,e,f,g,m,n){var o=d("react-compiler-runtime").c(47),p=m===void 0?!0:m,q=(k||(k=c("useReStore")))(),r=c("useMWNavigation")();o[0]===Symbol.for("react.memo_cache_sentinel")?(m=c("JSResourceForInteraction")("MAWGroupInviteDialog.react").__setRef("useOnPressMWThreadListItem"),o[0]=m):m=o[0];m=c("useMWXLazyDialog")(m);var s=m[0],t=c("useCommunityFolder")(f),u=c("MessengerWebUXLogger").useInteractionLogger();o[1]!==f.takedownState?(m=f.takedownState!=null&&(i||(i=d("I64"))).equal(f.takedownState,(j||(j=d("LSIntEnum"))).ofNumber(c("MessengerThreadTakedownState").GEO_BLOCKED)),o[1]=f.takedownState,o[2]=m):m=o[2];var v=m;o[3]!==f.threadKey?(m=(i||(i=d("I64"))).to_string(f.threadKey),o[3]=f.threadKey,o[4]=m):m=o[4];var w;o[5]!==v||o[6]!==m?(w={isGeoBlocked:v,threadID:m},o[5]=v,o[6]=m,o[7]=w):w=o[7];m=c("useGroupsCometCMDisabledChatEntryPointDialog")(w);var x=m[0];o[8]!==f.threadType?(w=d("LSMessagingThreadTypeUtil").isPublicCMThread(f.threadType),o[8]=f.threadType,o[9]=w):w=o[9];var y=w;m=l(f.threadKey);var z=m[0],A=c("useMWCMJoinCMThread")(f,t),B=c("useMWXPushErrorToast")(),C=c("useMWResponsiveLogExtraData")();o[10]!==q||o[11]!==C||o[12]!==a||o[13]!==v||o[14]!==p||o[15]!==y||o[16]!==A||o[17]!==u||o[18]!==e||o[19]!==n||o[20]!==(t==null?void 0:t.takedownState)||o[21]!==r||o[22]!==B||o[23]!==g||o[24]!==x||o[25]!==s||o[26]!==z||o[27]!==f.threadKey?(w=function(k,l,m,o){c("promiseDone")(async function(){var w=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(q.tables.threads).getKeyRange(f.threadKey));if(w==null)return;var D=d("MAWGroupInvitesForThread").isGroupInviteThread(w),E=d("LSMessagingThreadTypeUtil").isSocialChannelUnjoined(w.threadType),F=d("MWCMThreadTypes.react").isUnjoinedCMThread(w.threadType),G=d("LSMessagingThreadTypeUtil").isCMSubthread(w.threadType),H=w.threadStatus!=null&&((i||(i=d("I64"))).equal(w.threadStatus,(i||(i=d("I64"))).of_int32(c("ThreadStatus").PAUSED))||(i||(i=d("I64"))).equal(w.threadStatus,(i||(i=d("I64"))).of_int32(c("ThreadStatus").UPGRADED_TO_COMMUNITY_AND_TO_BE_PAUSED))),I=(t==null?void 0:t.takedownState)!=null&&(i||(i=d("I64"))).equal(t==null?void 0:t.takedownState,(i||(i=d("I64"))).of_int32(1)),J=w.takedownState!=null&&(i||(i=d("I64"))).equal(w.takedownState,(j||(j=d("LSIntEnum"))).ofNumber(c("MessengerThreadTakedownState").TAKEN_DOWN)),K=w.needsAdminApprovalForNewParticipant===!0,L=(i||(i=d("I64"))).equal(a!=null?a:(j||(j=d("LSIntEnum"))).ofNumber(c("CommunityMessagingEnableState").ENABLED),(j||(j=d("LSIntEnum"))).ofNumber(c("CommunityMessagingEnableState").DISABLE_REQUESTED)),M=w.folderName==="inbox"?(j||(j=d("LSIntEnum"))).ofNumber(12):w.folderName==="pending"?(j||(j=d("LSIntEnum"))).ofNumber(29):(j||(j=d("LSIntEnum"))).ofNumber(30),N=d("MWPIsThreadUnread").isThreadUnread(w),O=function(a){var f={clientThreadKey:w.clientThreadKey,isUnread:N,threadKey:w.threadKey,threadType:w.threadType};b("cr:12043")!=null&&b("cr:12043").checkThreadEligibleForFollowUp(w)&&c("promiseDone")(b("cr:12043").setMetadata(w.threadKey,{lastAccessedThread:(i||(i=d("I64"))).of_float(Date.now())}));if(a)return r.openInbox(f,e,M);r.openTabOrInbox(f,e,o,M,{subEntrypoint:n});m&&m()},P=function(){g==null||g(!0),c("promiseDone")(c("LSPlatformWaitForTaskCompletion")(q,function(a){return c("LSJoinCommunityChannelStoredProcedure")(c("LSFactory")(a),{entryPoint:"messengerdotcom",isRequestToJoin:K,threadKey:f.threadKey})},"joinCommunityChannel"),function(){O(!1),g==null||g(!1)},function(){B({title:h._(/*BTDS*/"\u0e44\u0e21\u0e48\u0e2a\u0e32\u0e21\u0e32\u0e23\u0e16\u0e40\u0e02\u0e49\u0e32\u0e23\u0e48\u0e27\u0e21\u0e41\u0e0a\u0e17\u0e44\u0e14\u0e49 \u0e42\u0e1b\u0e23\u0e14\u0e25\u0e2d\u0e07\u0e2d\u0e35\u0e01\u0e04\u0e23\u0e31\u0e49\u0e07\u0e43\u0e19\u0e20\u0e32\u0e22\u0e2b\u0e25\u0e31\u0e07")})})},Q=w.hasPendingInvitation||!1;L=!L&&H&&!d("LSThreadBitOffset").has(154,w)&&!Q;u==null||u({eventName:"open_thread",extraData:C,threadKey:w.threadKey,threadType:w.threadType});p||(u==null||u({eventName:"open_thread_from_mini_list",extraData:C,threadKey:w.threadKey,threadType:w.threadType}));if(y&&(J||I||v))return x({threadID:(i||(i=d("I64"))).to_string(w.threadKey)});if(F)return A(l,k,O,P);if(E&&L)return z();D?s({thread:w},c("emptyFunction")):G||O(k.metaKey||k.ctrlKey||k.shiftKey)}())},o[10]=q,o[11]=C,o[12]=a,o[13]=v,o[14]=p,o[15]=y,o[16]=A,o[17]=u,o[18]=e,o[19]=n,o[20]=t==null?void 0:t.takedownState,o[21]=r,o[22]=B,o[23]=g,o[24]=x,o[25]=s,o[26]=z,o[27]=f.threadKey,o[28]=w):w=o[28];m=t==null?void 0:t.takedownState;var D;o[29]!==q||o[30]!==C||o[31]!==a||o[32]!==v||o[33]!==p||o[34]!==A||o[35]!==u||o[36]!==e||o[37]!==n||o[38]!==r||o[39]!==B||o[40]!==g||o[41]!==x||o[42]!==s||o[43]!==z||o[44]!==m||o[45]!==f.threadKey?(D=[q,f.threadKey,m,a,u,p,v,r,e,n,g,B,x,A,z,s,C],o[29]=q,o[30]=C,o[31]=a,o[32]=v,o[33]=p,o[34]=A,o[35]=u,o[36]=e,o[37]=n,o[38]=r,o[39]=B,o[40]=g,o[41]=x,o[42]=s,o[43]=z,o[44]=m,o[45]=f.threadKey,o[46]=D):D=o[46];return d("Int64Hooks").useCallbackInt64(w,D)}g.default=a}),226);
__d("usePreloadRoute",["JSScheduler","react","react-compiler-runtime","useCometRouterDispatcher","useMWNavigation"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=(h||d("react")).useEffect;function a(a,b){var e=d("react-compiler-runtime").c(6),f=c("useMWNavigation")(),g=c("useCometRouterDispatcher")(),h,k;e[0]!==g||e[1]!==f||e[2]!==a||e[3]!==b?(h=function(){(i||(i=d("JSScheduler"))).scheduleSpeculativeCallback(function(){g!=null&&g.prefetchRouteDefinition(f.getUrlFromThreadKey(a,b))})},k=[g,f,a,b],e[0]=g,e[1]=f,e[2]=a,e[3]=b,e[4]=h,e[5]=k):(h=e[4],k=e[5]);j(h,k)}g["default"]=a}),98);
__d("MWThreadListItem.react",["fbt","CometHeroHoldTrigger.react","CometPlaceholder.react","CometTextWithEntities.react","CurrentEnvironment","HeroInteractionIgnoreWithDiv.react","I64","Int64Hooks","LSIntEnum","LSMessagingThreadTypeUtil","LSRtcCallState","LSThreadRangeFilter","LSThreadTitle.react","MWCMJewelContext","MWCMThreadTypes.react","MWChatTextTransform","MWLogInboxFiltersInteraction","MWLogInteraction","MWPIsThreadUnread","MWThreadListConsts","MWThreadListFocusableTable.react","MWThreadListItemAddOnEnd.react","MWThreadListLastMessage.react","MWThreadPicture.react","MWThreadSnippetForDisplay.react","MWVerticalRhythm","MWXGlimmer.react","MWXListCellPressable.react","MWXSpinner.react","MWXText.react","MessageRequestsBulkActionsContext.react","MessageRequestsBulkActionsThreadListItem","MessagingCommunityChatsPauseStatus","MessengerMuteUtils","MessengerWebEntryPointsUtil","MessengerWebUXLogger","MetaConfig","ReQL","ReQLSuspense","deferredLoadComponent","emptyFunction","gkx","interaction-tracing-metrics","justknobx","mwCMIsAnyCMThread","mwCMIsThreadBumped","mwCMisStandAloneCommunity","mwIsThreadDisabled","react","react-compiler-runtime","react-strict-dom","requireDeferred","useCommunityFolder","useGroupsCometChatsEngagementImpressionLogger","useGroupsCometJoinChatDialog","useIsChatPreviewsEnabled","useMWNavigation","useMWPreloadThread","useMWThreadSnippetForDisplay","useMatchViewport","useMenuButtonVisibilityState","useMergeRefs","useOnPressMWThreadListItem","usePreloadRoute","useReStore","useSimpleImpression"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k,l,m=l||(l=d("react"));b=l;e=b.memo;b.useCallback;var n=b.useContext;b.useMemo;var o=b.useState,p=c("deferredLoadComponent")(c("requireDeferred")("MWThreadListItemMoreActions.react").__setRef("MWThreadListItem.react")),q={communityGlimmer:{borderStartStartRadius:"x1obq294",borderStartEndRadius:"x5a5i1n",borderEndEndRadius:"xde0f50",borderEndStartRadius:"x15x8krk",height:"x170jfvy",width:"x3hqpx7",$$css:!0},listItemContainer:{overflowX:"x6ikm8r",overflowY:"x10wlt62",paddingInlineStart:"xmzvs34",paddingInlineEnd:"xf159sx",paddingLeft:null,paddingRight:null,position:"x1n2onr6",$$css:!0},listItemContainerDisabled:{opacity:"xbyyjgo",$$css:!0},listItemContainerForMessengerDotCom:{paddingInlineStart:"x25sj25",paddingInlineEnd:"x1icxu4v",paddingLeft:null,paddingRight:null,$$css:!0},listItemContainerHiddenContent:{display:"x1lliihq",height:"xqtp20y",overflowX:"x6ikm8r",overflowY:"x10wlt62",width:"xnalus7",$$css:!0},threadBodyGlimmer:{display:"x78zum5",flexDirection:"xdt5ytf",flexGrow:"x1iyjqo2",justifyContent:"xl56j7k",$$css:!0},threadSnippetGlimmer:{borderStartStartRadius:"x1obq294",borderStartEndRadius:"x5a5i1n",borderEndEndRadius:"xde0f50",borderEndStartRadius:"x15x8krk",height:"xlup9mm",width:"xktia5q",$$css:!0},threadTitleGlimmer:{borderStartStartRadius:"x1obq294",borderStartEndRadius:"x5a5i1n",borderEndEndRadius:"xde0f50",borderEndStartRadius:"x15x8krk",height:"x1qx5ct2",marginBottom:"x1e56ztr",marginTop:"x1k70j0n",width:"x3hqpx7",$$css:!0}};function r(a){var b=d("react-compiler-runtime").c(12),e=a.isUnread,g=a.selected,h=a.showFollowUpReminder,j=a.threadKey,k=(i||(i=c("useReStore")))();b[0]!==k.tables.threads||b[1]!==j?(a=function(){return d("ReQL").fromTableAscending(k.tables.threads,["threadName","threadType","threadKey","takedownState","lastMessageCtaType","ongoingCallState","eventEndTimestampMs","eventStartTimestampMs","snippet","snippetText","threadStatus","lastActivityTimestampMs","hasPendingInvitation","disappearingSettingTtl","ongoingCallTimestampMs","nullstateDescriptionText1","lastReadWatermarkTimestampMs","snippetSenderContactId"]).getKeyRange(j)},b[0]=k.tables.threads,b[1]=j,b[2]=a):a=b[2];var l;b[3]!==k||b[4]!==j?(l=[k,j],b[3]=k,b[4]=j,b[5]=l):l=b[5];a=d("ReQLSuspense").useFirst(a,l,f.id+":156");if(a==null)return null;b[6]===Symbol["for"]("react.memo_cache_sentinel")?(l=m.jsx(d("react-strict-dom").html.div,{style:q.threadBodyGlimmer,children:m.jsx(c("MWXGlimmer.react"),{index:2,xstyle:q.threadSnippetGlimmer})}),b[6]=l):l=b[6];b[7]!==e||b[8]!==g||b[9]!==h||b[10]!==a?(l=m.jsx(c("CometPlaceholder.react"),{fallback:l,name:"MWThreadListItem.DefaultSubtitle",children:m.jsx(s,{isUnread:e,selected:g,showFollowUpReminder:h,thread:a})}),b[7]=e,b[8]=g,b[9]=h,b[10]=a,b[11]=l):l=b[11];return l}function s(a){var b,e=d("react-compiler-runtime").c(22),f=a.isUnread,g=a.selected,h=a.showFollowUpReminder;a=a.thread;g=c("useMWThreadSnippetForDisplay")(a,g);var i=g.isDraft,l=g.lastMessageCtaType,n=g.shouldHideTimestamp;g=g.snippet;var o;e[0]!==a.threadType?(o=d("MWCMThreadTypes.react").isUnjoinedCMThread(a.threadType),e[0]=a.threadType,e[1]=o):o=e[1];o=o;b=(b=c("gkx")("26362"))!=null?b:!1;var p;e[2]!==a.disappearingSettingTtl?(p=c("MetaConfig")._("112")&&a.disappearingSettingTtl!=null&&(j||(j=d("I64"))).gt(a.disappearingSettingTtl,(j||(j=d("I64"))).zero),e[2]=a.disappearingSettingTtl,e[3]=p):p=e[3];p=p;if(a.threadName==null&&c("mwCMIsAnyCMThread")(a.threadType)){var r;e[4]===Symbol["for"]("react.memo_cache_sentinel")?(r=m.jsxs(d("react-strict-dom").html.div,{style:q.threadBodyGlimmer,children:[m.jsx(c("MWXGlimmer.react"),{index:2,xstyle:q.threadSnippetGlimmer}),m.jsx(c("CometHeroHoldTrigger.react"),{description:"MWThreadListItem.DefaultSubtitleWithThread",hold:!0})]}),e[4]=r):r=e[4];return r}if(d("LSMessagingThreadTypeUtil").isDiscoverablePublicBroadcastChannel(a.threadType)&&g==null)return null;r=!(j||(j=d("I64"))).equal(a.ongoingCallState,(k||(k=d("LSIntEnum"))).ofNumber(c("LSRtcCallState").NO_ONGOING_CALL));var s;e[5]!==a.lastActivityTimestampMs?(s=(j||(j=d("I64"))).to_float(a.lastActivityTimestampMs),e[5]=a.lastActivityTimestampMs,e[6]=s):s=e[6];b=o&&(a==null?void 0:a.hasPendingInvitation)!==!0&&b;o=!o&&!n;e[7]!==i||e[8]!==g||e[9]!==a?(n=m.jsx(c("MWThreadSnippetForDisplay.react"),{isDraftMessage:i,snippetRaw:g,thread:a}),e[7]=i,e[8]=g,e[9]=a,e[10]=n):n=e[10];e[11]!==p||e[12]!==f||e[13]!==l||e[14]!==h||e[15]!==r||e[16]!==s||e[17]!==b||e[18]!==o||e[19]!==n||e[20]!==a?(i=m.jsx(c("MWThreadListLastMessage.react"),{hasOngoingCall:r,isUnread:f,lastMessageCtaType:l,lastMessageTimestamp:s,showDisappearingMessageVisualIndicator:p,showFollowUpReminder:h,showSnippetText:b,showTimestamp:o,snippet:n,thread:a}),e[11]=p,e[12]=f,e[13]=l,e[14]=h,e[15]=r,e[16]=s,e[17]=b,e[18]=o,e[19]=n,e[20]=a,e[21]=i):i=e[21];return i}function aa(a){var b=d("react-compiler-runtime").c(8),e=a.threadKey,g=(i||(i=c("useReStore")))();b[0]!==g.tables.threads||b[1]!==e?(a=function(){return d("ReQL").fromTableAscending(g.tables.threads,["threadName","threadType","threadKey"]).getKeyRange(e)},b[0]=g.tables.threads,b[1]=e,b[2]=a):a=b[2];var h;b[3]!==g||b[4]!==e?(h=[g,e],b[3]=g,b[4]=e,b[5]=h):h=b[5];a=d("ReQLSuspense").useFirst(a,h,f.id+":299");if(a==null)return null;b[6]!==a?(h=a.threadName==null&&c("mwCMIsAnyCMThread")(a.threadType)?m.jsxs(d("react-strict-dom").html.div,{style:q.threadBodyGlimmer,children:[m.jsx(c("MWXGlimmer.react"),{index:1,xstyle:q.threadTitleGlimmer}),m.jsx(c("CometHeroHoldTrigger.react"),{description:"MWThreadListItem.DefaultThreadTitle",hold:!0})]}):m.jsx(c("LSThreadTitle.react"),{thread:a}),b[6]=a,b[7]=h):h=b[7];return h}function a(a){var b=d("react-compiler-runtime").c(150),e=a.hideMoreActions,f=a.lsEntryPoint,g=a.lsSubEntryPoint,i=a.messagingEntrypoint,l=a.onClose,s=a.onPress,t=a.onPressOverride,u=a.onThreadJoined,v=a.onThreadSelected,w=a.parentSurface,x=a.renderAddOnEnd,y=a.renderThreadPhoto,z=a.renderThreadSubtitle,A=a.renderThreadTitle,B=a.responsive,C=a.selected,D=a.showFollowUpReminder,E=a.thread;a=e===void 0?!1:e;var F=l===void 0?c("emptyFunction"):l;e=u===void 0?c("emptyFunction"):u;var G=v===void 0?c("emptyFunction"):v,H=w===void 0?"channel_list":w,I=D===void 0?!1:D;l=n(c("MWCMJewelContext"));u=l.selectedFilterTab;b[0]!==E.threadType?(v={eventName:"threadlist_item_impression",threadType:E.threadType},b[0]=E.threadType,b[1]=v):v=b[1];w=c("MessengerWebUXLogger").useImpressionLoggerRef(v);bb0:{if(!c("mwCMIsThreadBumped")(E)){D=!1;break bb0}if(c("CurrentEnvironment").messengerdotcom){D=H==="channel_list";break bb0}if(f==="jewel"){b[2]!==u?(l=(j||(j=d("I64"))).equal(u,j.of_int32(c("LSThreadRangeFilter").NONE)),b[2]=u,b[3]=l):l=b[3];D=l;break bb0}D=f!=="inboxThreadList"}var J=D;b[4]!==J||b[5]!==y||b[6]!==E.threadKey?(v=function(){return y!=null?y:function(){return m.jsx(c("MWThreadPicture.react"),{badgeSize:c("gkx")("23219")?10:14,photoSize:c("gkx")("23219")?48:56,threadKey:E.threadKey,withAltText:!1,withCommunityPicture:J})}},u=[J,y,E.threadKey],b[4]=J,b[5]=y,b[6]=E.threadKey,b[7]=u,b[8]=v):(u=b[7],v=b[8]);var K=d("Int64Hooks").useMemoInt64(v,u);b[9]!==A||b[10]!==E.threadKey?(l=function(){return A!=null?A:function(){return m.jsx(aa,{threadKey:E.threadKey})}},D=[A,E.threadKey],b[9]=A,b[10]=E.threadKey,b[11]=l,b[12]=D):(l=b[11],D=b[12]);var L=d("Int64Hooks").useMemoInt64(l,D),M=c("useCommunityFolder")(E);v=M==null?void 0:M.takedownState;b[13]!==v||b[14]!==E.takedownState?(u=c("mwIsThreadDisabled")(E.takedownState,v),b[13]=v,b[14]=E.takedownState,b[15]=u):u=b[15];var N=u,O=d("MWPIsThreadUnread").useIsThreadUnread(E.threadKey)&&!N;b[16]!==O||b[17]!==z||b[18]!==C||b[19]!==I||b[20]!==E.threadKey?(l=function(){return z!=null?z:function(){return m.jsx(r,{isUnread:O,selected:C,showFollowUpReminder:I,threadKey:E.threadKey})}},D=[O,z,E.threadKey,C,I],b[16]=O,b[17]=z,b[18]=C,b[19]=I,b[20]=E.threadKey,b[21]=l,b[22]=D):(l=b[21],D=b[22]);var P=d("Int64Hooks").useMemoInt64(l,D);b[23]!==(M==null?void 0:M.name)||b[24]!==E.threadType?(v=function(){if(!c("mwCMIsAnyCMThread")(E.threadType)||c("CurrentEnvironment").messengerdotcom)return null;return(M==null?void 0:M.name)==null?m.jsxs(m.Fragment,{children:[m.jsx(c("MWXGlimmer.react"),{index:1,xstyle:q.communityGlimmer}),m.jsx(c("MWVerticalRhythm"),{height:8}),m.jsx(c("CometHeroHoldTrigger.react"),{description:"MWThreadListItem.Folder",hold:!0})]}):m.jsxs(m.Fragment,{children:[m.jsx(c("MWXText.react"),{align:"start",color:"secondary",numberOfLines:1,type:"meta3",children:M==null?void 0:M.name}),m.jsx(c("MWVerticalRhythm"),{height:8})]})},b[23]=M==null?void 0:M.name,b[24]=E.threadType,b[25]=v):v=b[25];u=M==null?void 0:M.name;b[26]!==u||b[27]!==E.threadType?(l=[u,E.threadType],b[26]=u,b[27]=E.threadType,b[28]=l):l=b[28];var Q=d("Int64Hooks").useCallbackInt64(v,l);b[29]!==E.threadType?(D=function(){var a=d("LSMessagingThreadTypeUtil").isArmadilloSecure(E.threadType),b=d("interaction-tracing-metrics").InteractionTracingMetricsCore.currentInteractionLogger(),c=Number(a);b.forEach(function(a){c=((a=a.annotations["int"])==null?void 0:a.hasSecureThread)||0||c});return b.addMetadata("hasSecureThread",c?1:0)},b[29]=E.threadType,b[30]=D):D=b[30];c("useSimpleImpression")(D);b[31]!==E.parentThreadKey?(u=(j||(j=d("I64"))).to_string(E.parentThreadKey),b[31]=E.parentThreadKey,b[32]=u):u=b[32];b[33]!==M?(v=M?(j||(j=d("I64"))).to_string(M.fbGroupId):void 0,b[33]=M,b[34]=v):v=b[34];l=f==="jewel"?"jewel_inbox":"chats_inbox";b[35]!==E.threadKey?(D=(j||(j=d("I64"))).to_string(E.threadKey),b[35]=E.threadKey,b[36]=D):D=b[36];var R;b[37]!==u||b[38]!==v||b[39]!==l||b[40]!==D?(R={community_id:u,event:"bumped_chat_rendered",group_id:v,parent_surface:l,source:"unknown",surface:"messenger_inbox",thread_id:D},b[37]=u,b[38]=v,b[39]=l,b[40]=D,b[41]=R):R=b[41];u=c("useGroupsCometChatsEngagementImpressionLogger")(R);b[42]!==E.threadType?(v=d("LSMessagingThreadTypeUtil").isArmadilloSecure(E.threadType),b[42]=E.threadType,b[43]=v):v=b[43];l=v;var ba=c("useMWNavigation")();D=c("gkx")("24056")?!1:B;var S=c("useMatchViewport")("min","width",d("MWThreadListConsts").minimumPixelsNeededForMaxDisplay)||!D;R=d("MWCMThreadTypes.react").isUnjoinedCMThread(E.threadType);b[44]!==(M==null?void 0:M.communityType)||b[45]!==E?(v=E.hasPendingInvitation===!0&&d("useIsChatPreviewsEnabled").isChatPreviewsEnabled(E,M==null?void 0:M.communityType),b[44]=M==null?void 0:M.communityType,b[45]=E,b[46]=v):v=b[46];var ca=v;b[47]!==E?(B=d("MessengerMuteUtils").calcMuteUntilMs(E),b[47]=E,b[48]=B):B=b[48];D=B;var da=D,T=c("useMenuButtonVisibilityState")(!0);v=T[1];var ea=v.setListItemFocused,U=v.setListItemHovered;B=c("mwCMIsAnyCMThread")(E.threadType);b[49]!==E.parentThreadKey?(D=(j||(j=d("I64"))).equal(E.parentThreadKey,(k||(k=d("LSIntEnum"))).ofNumber(0)),b[49]=E.parentThreadKey,b[50]=D):D=b[50];var V=D,W=N?!1:V?S:!(R||a);b[51]!==U?(v=function(){return U(!1)},b[51]=U,b[52]=v):v=b[52];D=v;b[53]!==U?(R=function(){return U(!0)},b[53]=U,b[54]=R):R=b[54];a=R;v=c("useMWPreloadThread")(E,l);var fa=v.onHoverInPreloader,ga=v.onHoverOutPreloader,ha=v.onPressInPreloader;if(M!=null&&B){b[55]!==M.enableState||b[56]!==M.fbGroupId||b[57]!==M.folderId?(R=[M.fbGroupId,M.folderId,M.enableState],b[55]=M.enableState,b[56]=M.fbGroupId,b[57]=M.folderId,b[58]=R):R=b[58];v=R}else{b[59]===Symbol["for"]("react.memo_cache_sentinel")?(B=[void 0,void 0,void 0],b[59]=B):B=b[59];v=B}R=v;var X=R[0],ia=R[1];B=R[2];v=n(c("MessageRequestsBulkActionsContext.react"));R=v.isBulkActionsEditMode;c("usePreloadRoute")(E.threadKey,E.threadType);b[60]!==M?(v=(M==null?void 0:M.pauseStatus)!=null&&(j||(j=d("I64"))).equal(M.pauseStatus,(k||(k=d("LSIntEnum"))).ofNumber(c("MessagingCommunityChatsPauseStatus").PAUSED_BY_SOFT_ACTION))&&c("gkx")("4215"),b[60]=M,b[61]=v):v=b[61];var ja=v;b[62]!==J||b[63]!==ja||b[64]!==N||b[65]!==f||b[66]!==E.threadType?(v=function(){return d("MessengerWebEntryPointsUtil").getEntryPointShouldOverrideThreadSnippetRemoval(f)?!1:ja||!N&&!J&&d("MWCMThreadTypes.react").isJoinedCMThread(E.threadType)},b[62]=J,b[63]=ja,b[64]=N,b[65]=f,b[66]=E.threadType,b[67]=v):v=b[67];var ka=v;v=o(!1);var Y=v[0];v=v[1];var Z=c("useOnPressMWThreadListItem")(B,f,E,v,S,g);B=M==null?void 0:M.communityType;b[68]!==B?(v=c("mwCMisStandAloneCommunity")(B),b[68]=B,b[69]=v):v=b[69];g=v;var $=c("useGroupsCometJoinChatDialog")(E,X,H,"messenger_inbox",e,g);b[70]!==ia||b[71]!==ca||b[72]!==X||b[73]!==S||b[74]!==N||b[75]!==i||b[76]!==da||b[77]!==F||b[78]!==Z||b[79]!==H||b[80]!==x||b[81]!==$||b[82]!==E.threadKey?(B=function(){return N||ca?void 0:m.jsx(c("MWThreadListItemAddOnEnd.react"),{communityId:ia,fbGroupId:X,isMaximized:S,messagingEntrypoint:i,mutedUntilMs:da,parentSurface:H,renderAddOnEnd:x,showGroupsJoinChatDialog:function(a){return Z(a,$,F)},threadKey:E.threadKey})},v=[ia,ca,X,S,N,i,da,F,Z,H,x,$,E.threadKey],b[70]=ia,b[71]=ca,b[72]=X,b[73]=S,b[74]=N,b[75]=i,b[76]=da,b[77]=F,b[78]=Z,b[79]=H,b[80]=x,b[81]=$,b[82]=E.threadKey,b[83]=B,b[84]=v):(B=b[83],v=b[84]);var la=d("Int64Hooks").useMemoInt64(B,v);b[85]!==la||b[86]!==V||b[87]!==Y||b[88]!==S||b[89]!==N||b[90]!==ka||b[91]!==O||b[92]!==ba||b[93]!==F||b[94]!==fa||b[95]!==ga||b[96]!==s||b[97]!==ha||b[98]!==Z||b[99]!==t||b[100]!==G||b[101]!==Q||b[102]!==K||b[103]!==P||b[104]!==L||b[105]!==C||b[106]!==ea||b[107]!==$||b[108]!==E?(e=function(){var a=E.additionalThreadContext!=null?m.jsxs(m.Fragment,{children:[m.jsx(c("MWXText.react"),{align:"start",color:"secondary",numberOfLines:1,type:"meta4",children:m.jsx(c("CometTextWithEntities.react"),{text:E.additionalThreadContext,transforms:d("MWChatTextTransform").textTransforms})}),m.jsx(c("MWVerticalRhythm"),{height:8})]}):null,b=h._(/*BTDS*/"\u0e01\u0e33\u0e25\u0e31\u0e07\u0e40\u0e02\u0e49\u0e32\u0e23\u0e48\u0e27\u0e21\u0e41\u0e0a\u0e17..."),e=m.jsxs(m.Fragment,{children:[m.jsx(c("MWXSpinner.react"),{color:"disabled_DEPRECATED",size:24}),m.jsx(c("CometHeroHoldTrigger.react"),{description:"MWThreadListItem.AddOnEndLoadingSpinner",hold:!0})]});return m.jsx(c("MWXListCellPressable.react"),{addOnEnd:Y?e:la,addOnStart:K(),"aria-current":C?"page":!1,content:m.jsxs(d("react-strict-dom").html.div,{style:S||!V?void 0:q.listItemContainerHiddenContent,children:[a,Q(),m.jsx(c("MWXText.react"),{align:"start",color:"primary",numberOfLines:1,type:O?"headlineEmphasized4":"headline4",children:L()}),ka()?null:m.jsxs(m.Fragment,{children:[m.jsx(c("MWVerticalRhythm"),{height:8}),Y?m.jsx(c("MWXText.react"),{type:"entityHeaderMeta3",children:b}):P()]})]}),disabled:Y,linkProps:N?void 0:{preventLocalNavigation:!0,url:ba.getUrlFromThreadKey(E.threadKey,E.threadType)},onFocusChange:ea,onHoverIn:fa,onHoverOut:ga,onPress:function(a){c("justknobx")._("4052")?(d("MWLogInteraction").logPopoverOpenComplete(),d("MWLogInboxFiltersInteraction").logInboxFiltersNavigationComplete()):(d("MWLogInteraction").logPopoverOpenCancel("thread_click"),d("MWLogInboxFiltersInteraction").logInboxFiltersNavigationCancel("thread_click")),t!=null?t==null||t(a):(s==null||s(a,E),Z(a,$,F)),G()},onPressIn:ha,selected:C,size:"large"})},g=[E,Y,la,K,C,S,V,Q,O,L,ka,P,N,ba,ea,fa,ga,ha,t,G,s,Z,$,F],b[85]=la,b[86]=V,b[87]=Y,b[88]=S,b[89]=N,b[90]=ka,b[91]=O,b[92]=ba,b[93]=F,b[94]=fa,b[95]=ga,b[96]=s,b[97]=ha,b[98]=Z,b[99]=t,b[100]=G,b[101]=Q,b[102]=K,b[103]=P,b[104]=L,b[105]=C,b[106]=ea,b[107]=$,b[108]=E,b[109]=e,b[110]=g):(e=b[109],g=b[110]);B=d("Int64Hooks").useMemoInt64(e,g);b[111]!==T||b[112]!==i||b[113]!==F||b[114]!==C||b[115]!==W||b[116]!==E.threadKey||b[117]!==E.threadName||b[118]!==E.threadType?(v=function(){return W?m.jsx(c("HeroInteractionIgnoreWithDiv.react"),{children:m.jsx(c("CometPlaceholder.react"),{fallback:null,name:"MWThreadListItem.MoreActions",children:m.jsx(p,{menuButtonVisibilityState:T,messagingEntrypoint:i,onClose:F,selected:C,thread:{threadKey:E.threadKey,threadName:E.threadName,threadType:E.threadType}})})}):null},b[111]=T,b[112]=i,b[113]=F,b[114]=C,b[115]=W,b[116]=E.threadKey,b[117]=E.threadName,b[118]=E.threadType,b[119]=v):v=b[119];b[120]!==X||b[121]!==T||b[122]!==i||b[123]!==F||b[124]!==C||b[125]!==W||b[126]!==E.threadKey||b[127]!==E.threadName||b[128]!==E.threadType?(e=[X,T,i,F,C,W,E.threadName,E.threadKey,E.threadType],b[120]=X,b[121]=T,b[122]=i,b[123]=F,b[124]=C,b[125]=W,b[126]=E.threadKey,b[127]=E.threadName,b[128]=E.threadType,b[129]=e):e=b[129];g=d("Int64Hooks").useMemoInt64(v,e);v=c("useMergeRefs")(w,J?u:null);e=l?"mwthreadlist-item-secure":"mwthreadlist-item-open";w=N?q.listItemContainerDisabled:!1;b[130]!==w?(u=[q.listItemContainer,w,c("gkx")("23219")?q.listItemContainerForMessengerDotCom:!1],b[130]=w,b[131]=u):u=b[131];b[132]!==R||b[133]!==E||b[134]!==B?(l=R?m.jsx(c("MessageRequestsBulkActionsThreadListItem"),{thread:E,threadListCell:B}):B,b[132]=R,b[133]=E,b[134]=B,b[135]=l):l=b[135];b[136]!==l?(w=m.jsx(d("MWThreadListFocusableTable.react").MWThreadListFocusableTableCell,{children:m.jsx(d("react-strict-dom").html.div,{role:"gridcell",children:l})}),b[136]=l,b[137]=w):w=b[137];b[138]!==g||b[139]!==w?(R=m.jsxs(d("MWThreadListFocusableTable.react").MWThreadListFocusableTableRow,{children:[w,g]}),b[138]=g,b[139]=w,b[140]=R):R=b[140];b[141]!==a||b[142]!==D||b[143]!==u||b[144]!==R?(B=m.jsx(d("react-strict-dom").html.div,{"data-testid":void 0,onMouseEnter:a,onMouseLeave:D,role:"row",style:u,children:R}),b[141]=a,b[142]=D,b[143]=u,b[144]=R,b[145]=B):B=b[145];b[146]!==v||b[147]!==e||b[148]!==B?(l=m.jsx(d("react-strict-dom").html.div,{"data-testid":void 0,ref:v,children:B}),b[146]=v,b[147]=e,b[148]=B,b[149]=l):l=b[149];return l}b=e(a);g["default"]=b}),226);
__d("MWThreadListFolderItem.react",["BaseView.react","CometTextWithEntities.react","I64","MAWVault","MWAddOnCircleContainer.react","MWCMThreadTypes.react","MWChatTextTransform","MWPIsThreadUnread","MWThreadListFocusableTable.react","MWThreadListLastMessage.react","MWXListCellPressable.react","MWXTextPairing.react","react","react-compiler-runtime","useMatchMedia"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=h||(h=d("react"));b=h;b.useCallback;b.useMemo;function a(a){var b=d("react-compiler-runtime").c(28),e=a.icon,f=a.onClick,g=a.responsive,h=a.selected,k=a.size,l=a.thread;a=a.threadName;g=c("useMatchMedia")("(min-width: 900px)")||!g;var m;b[0]!==l.snippet?(m=l.snippet!=null?d("MAWVault").unvault(l.snippet):null,b[0]=l.snippet,b[1]=m):m=b[1];m=m;m=m;var n;b[2]!==l.lastActivityTimestampMs?(n=(i||(i=d("I64"))).to_float(l.lastActivityTimestampMs),b[2]=l.lastActivityTimestampMs,b[3]=n):n=b[3];n=n;var o=d("MWPIsThreadUnread").useIsThreadUnread(l.threadKey),p;b[4]!==e||b[5]!==k?(p=j.jsx(c("MWAddOnCircleContainer.react"),{size:k,children:e}),b[4]=e,b[5]=k,b[6]=p):p=b[6];e=p;k=e;p=a!=null?a:l.threadName;e=p;b[7]!==f?(a=function(){return f()},b[7]=f,b[8]=a):a=b[8];p=a;b[9]===Symbol["for"]("react.memo_cache_sentinel")?(a={className:"xmzvs34 xf159sx"},b[9]=a):a=b[9];var q;b[10]!==g||b[11]!==o||b[12]!==n||b[13]!==m||b[14]!==l.threadType?(q=g?j.jsx(c("MWThreadListLastMessage.react"),{hasOngoingCall:!1,isUnread:o,lastMessageCtaType:null,lastMessageTimestamp:n,showTimestamp:!d("MWCMThreadTypes.react").isUnjoinedCMThread(l.threadType),snippet:m}):null,b[10]=g,b[11]=o,b[12]=n,b[13]=m,b[14]=l.threadType,b[15]=q):q=b[15];b[16]!==e||b[17]!==g?(n=g?j.jsx(c("CometTextWithEntities.react"),{text:e.toString(),transforms:d("MWChatTextTransform").textTransforms}):null,b[16]=e,b[17]=g,b[18]=n):n=b[18];m=!o;b[19]!==n||b[20]!==m||b[21]!==q?(l=j.jsx(c("MWXTextPairing.react"),{body:q,bodyLineLimit:1,headline:n,headlineLineLimit:1,level:4,reduceEmphasis:m}),b[19]=n,b[20]=m,b[21]=q,b[22]=l):l=b[22];b[23]!==k||b[24]!==p||b[25]!==h||b[26]!==l?(e=j.jsx(c("BaseView.react"),{testid:void 0,children:j.jsx(d("MWThreadListFocusableTable.react").MWThreadListFocusableTableRow,{children:j.jsx("div",{role:"row",children:j.jsx(d("MWThreadListFocusableTable.react").MWThreadListFocusableTableCell,{children:j.jsx("div",babelHelpers["extends"]({},a,{role:"gridcell",children:j.jsx(c("MWXListCellPressable.react"),{addOnStart:k,content:l,onPress:p,selected:h,size:"large"})}))})})})}),b[23]=k,b[24]=p,b[25]=h,b[26]=l,b[27]=e):e=b[27];return e}g["default"]=a}),98);
__d("MWThreadListJobsItem.react",["fbt","ix","LSIntEnum","MWThreadListFolderItem.react","MWXIcon_DEPRECATED.react","fbicon","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j,k,l=j||d("react");function a(a){var b=d("react-compiler-runtime").c(11),e=a.onClick,f=a.responsive,g=a.selected,j=a.size;a=a.thread;var m;b[0]!==e?(m=function(){return e((k||(k=d("LSIntEnum"))).ofNumber(-13))},b[0]=e,b[1]=m):m=b[1];m=m;var n;b[2]===Symbol["for"]("react.memo_cache_sentinel")?(n=l.jsx(c("MWXIcon_DEPRECATED.react"),{color:"primary",icon:d("fbicon")._(i("512668"),32),size:48}),b[2]=n):n=b[2];var o;b[3]===Symbol["for"]("react.memo_cache_sentinel")?(o=(k||(k=d("LSIntEnum"))).ofNumber(-13),b[3]=o):o=b[3];var p;b[4]===Symbol["for"]("react.memo_cache_sentinel")?(p=h._(/*BTDS*/"\u0e07\u0e32\u0e19").toString(),b[4]=p):p=b[4];b[5]!==m||b[6]!==f||b[7]!==g||b[8]!==j||b[9]!==a?(n=l.jsx(c("MWThreadListFolderItem.react"),{icon:n,onClick:m,responsive:f,selected:g,size:j,systemFolder:o,thread:a,threadName:p}),b[5]=m,b[6]=f,b[7]=g,b[8]=j,b[9]=a,b[10]=n):n=b[10];return n}g["default"]=a}),226);
__d("useVirtualizationContainerContext",["react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h;b=h||d("react");b.useCallback;b.useMemo;var i=b.useRef;function a(){var a=d("react-compiler-runtime").c(2),b=i(null),c;a[0]===Symbol["for"]("react.memo_cache_sentinel")?(c=function(a){b.current=a},a[0]=c):c=a[0];c=c;a[1]===Symbol["for"]("react.memo_cache_sentinel")?(c={rootElementRef:b,updateRootElementRef:c},a[1]=c):c=a[1];a=c;c=a;return c}g["default"]=a}),98);
__d("MWThreadList.react",["CometHeroHoldTrigger.react","CometHideableComponentExperiment.react","CometPageletWithDiv.react","CometRouterFocusRegion.react","CometTransientDialogProvider.react","CometVisualCompletion","CurrentEnvironment","FBLogger","FocusRegion.react","FocusRegionType","GroupsCometChatsEngagementLogger","I64","Int64Hooks","LSAuthorityLevel","LSIntEnum","LSThreadBitOffset","MWCMGetValidId","MWCreatorMessagingUtils","MWJewelPopoverThreadlistContext.react","MWLSJewelMessageRequestsThreadContainer.react","MWPBaseThreadList.react","MWPBumpEntityKey","MWPParentThreadKeyContext","MWPThreadIsPage.react","MWPThreadsForThreadList","MWResponsiveLayoutConstants","MWResponsiveLayoutContext.react","MWThreadKey.react","MWThreadListEmptyContainer.react","MWThreadListGlimmer.react","MWThreadListItem.react","MWThreadListJobsItem.react","MWThreadListSupportedThreadTypes","MWXacGating","MessagingFolderTag","MessengerWebUXLogger","Promise","QPLUserFlow","ReQL","ReQLSuspense","VirtualizationContainerContext","cr:12043","cr:21161","cr:21162","cr:2261","cr:6055","emptyFunction","focusScopeQueries","gkx","isMWXacGroupThread","mwCMIsThreadBumped","promiseDone","qpl","react","react-compiler-runtime","useCommunityFolder","useEmptyFunction","useGroupsCometIsInCCNegativeTest","useMWGetInboxFocusTargetFromRoute","useMWResponsiveLogExtraData","useReStore","useVirtualizationContainerContext"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m=l||(l=d("react")),n=l,o=n.useCallback,p=n.useContext,q=n.useId,r=n.useRef;function a(){var a=d("react-compiler-runtime").c(1),b;a[0]===Symbol["for"]("react.memo_cache_sentinel")?(b={computeInboxFollowUps:t,refresh:s,reminders:[]},a[0]=b):b=a[0];return b}function s(){return(i||(i=b("Promise"))).resolve()}function t(){}var u=(n=b("cr:12043"))!=null?n:{useInboxFollowUps:a},v=(a=(n=b("cr:21162"))==null?void 0:n.useFilterPinnedThreads)!=null?a:c("useEmptyFunction"),w=b("cr:6055")||c("useEmptyFunction");function x(a){return(j||(j=d("I64"))).equal(a.threadType,(k||(k=d("LSIntEnum"))).ofNumber(15))&&(j||(j=d("I64"))).equal(a.authorityLevel,(k||(k=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE))&&(j||(j=d("I64"))).equal(a.lastReadWatermarkTimestampMs,(j||(j=d("I64"))).of_int32(-1))&&(j||(j=d("I64"))).equal(a.lastActivityTimestampMs,(j||(j=d("I64"))).of_int32(-1))}var y=5;function e(a){var e=a.lsEntryPoint,f=a.lsSubEntryPoint,g=a.messagingEntrypoint,h=a.onClickNestedFolderThread,i=a.onClose,l=a.responsive,n=a.selected,o=a.showFollowUpReminder,q=a.thread,s=p(c("MWJewelPopoverThreadlistContext.react")),t=c("useCommunityFolder")({parentThreadKey:(j||(j=d("I64"))).equal(q.threadType,(k||(k=d("LSIntEnum"))).ofNumber(17))?q.threadKey:q.parentThreadKey});a=p(c("MWResponsiveLayoutContext.react"));var u=a.pushCard,v=q.threadKey;d("Int64Hooks").useEffectInt64(function(){if(b("cr:2261")==null)return;s==null||s.add(v);return function(){s==null||s["delete"](v)}},[s,v]);var w=r({loggingTimeout:null,threadKey:(j||(j=d("I64"))).of_int32(-1)}),y=r(j.of_int32(-1)),z=p(c("MWPParentThreadKeyContext"));d("Int64Hooks").useEffectInt64(function(){if(z!=null){var a=(j||(j=d("I64"))).to_string(q.parentThreadKey),b=j.to_string(z);!(j||(j=d("I64"))).equal(y.current,v)&&q.folderName!==c("MessagingFolderTag").COMMUNITY&&a!==b&&c("FBLogger")("messenger_threadlist_folder_inconsistency").mustfix("Render thread item expected folder %s but receive %s",b,a)}x(q)?(j||(j=d("I64"))).equal(w.current.threadKey,v)||(w.current.threadKey=v,w.current.loggingTimeout=window.setTimeout(function(){c("FBLogger")("messenger_web").mustfix("Thread ID %s showing up as ghost",(j||(j=d("I64"))).to_string(v)),w.current.loggingTimeout=null},5e3)):(j||(j=d("I64"))).equal(w.current.threadKey,v)&&w.current.loggingTimeout!=null&&window.clearTimeout(w.current.loggingTimeout)},[z,q,v]);a=d("Int64Hooks").useCallbackInt64(function(){d("MWCreatorMessagingUtils").isAPPlusMessageRequest(q)&&c("QPLUserFlow").start(c("qpl")._(421070823,"2981"),{annotations:{string:{entrypoint:d("MWCreatorMessagingUtils").fetchQPLEntrypoint(q)}},instanceKey:(j||(j=d("I64"))).to_int32(q.threadKey)}),c("mwCMIsThreadBumped")({secondaryParentThreadKey:q.secondaryParentThreadKey,threadType:q.threadType})&&d("GroupsCometChatsEngagementLogger").log({action:"tap",client_extras:{is_bumped:"true"},community_id:t?(j||(j=d("I64"))).to_string(t.folderId):(j||(j=d("I64"))).to_string(q.parentThreadKey),event:"thread_open",group_id:d("MWCMGetValidId").MWCMHasValidFbGroupId(t==null?void 0:t.fbGroupId)?(j||(j=d("I64"))).to_string(t.fbGroupId):null,source:"chat_row",surface:e==="jewel"?"jewel_tray":"messenger_inbox",thread_id:(j||(j=d("I64"))).to_string(v)}),c("gkx")("24056")&&n&&u(d("MWResponsiveLayoutConstants").MWLayoutPanel.MESSAGE_LIST_PANEL)},[q.secondaryParentThreadKey,q.threadType,q.parentThreadKey,t,e,v,n,u]);if((j||(j=d("I64"))).equal(q.threadType,(k||(k=d("LSIntEnum"))).ofNumber(6))){if((j||(j=d("I64"))).equal(v,(k||(k=d("LSIntEnum"))).ofNumber(-13)))return m.jsx(c("MWThreadListJobsItem.react"),{onClick:h,responsive:l,selected:n,size:56,thread:q});else if(b("cr:2261")!=null&&(j||(j=d("I64"))).equal(v,(k||(k=d("LSIntEnum"))).ofNumber(-12)))return m.jsx(b("cr:2261"),{onClick:h,responsive:l,selected:n,size:56,thread:q});return null}return m.jsx(d("CometPageletWithDiv.react").Placeholder,{fallback:m.jsx(c("MWThreadListGlimmer.react"),{parentComponentForDebug:"MWThreadListItem"}),name:"MWThreadListThreadListRow",children:m.jsx(d("MWPThreadIsPage.react").Provider,{threadKey:q.threadKey,children:m.jsx(d("MWThreadKey.react").MWThreadKeyProvider,{id:q.threadKey,children:m.jsx(c("CometTransientDialogProvider.react"),{children:m.jsx(c("MWThreadListItem.react"),{lsEntryPoint:e,lsSubEntryPoint:f,messagingEntrypoint:g,onClose:i,onThreadSelected:a,responsive:l,selected:n,showFollowUpReminder:o,size:56,thread:q})})})})})}e.displayName=e.name+" [from "+f.id+"]";var z=m.memo(e);function A(a){var e=a.gridLabel,g=a.filter,i=a.customThreadFilter,l=a.header,n=a.lsEntryPoint,p=a.onOpenMessageRequests,r=a.lsSubEntryPoint,s=a.parentThreadKey,t=a.responsive,x=a.selectedThreadKey,A=a.setHasScrolled,C=a.setIsEmptyInbox,D=a.threadListMessagingEntrypoint,E=a.onClose,F=E===void 0?c("emptyFunction"):E;E=a.onClickNestedFolderThread;var G=E===void 0?c("emptyFunction"):E;E=a.preamble;var H=(h||(h=c("useReStore")))(),I=d("ReQLSuspense").useFirst(function(){return d("ReQL").fromTableAscending(H.tables.threads_ranges_v2__generated).getKeyRange(s)},[H,s],f.id+":374"),J=d("ReQLSuspense").useArray(function(){return d("MWPThreadsForThreadList").createIterable(H,s,I,["lastActivityTimestampMs","threadType"].concat(d("LSThreadBitOffset").threadCapabilityFields)).filter(function(a){if(!c("MWThreadListSupportedThreadTypes").some(function(b){return(j||(j=d("I64"))).equal(a.threadType,b)}))return!1;return d("MWXacGating").isGroupsEnabled()?!0:!c("isMWXacGroupThread")(a)}).take(5)},[H,s,I],f.id+":386").pop();a=q();var K=d("ReQLSuspense").useFirst(function(){return x!=null?d("ReQL").fromTableAscending(H.tables.threads,["parentThreadKey"]).getKeyRange(x):d("ReQL").empty()},[H,x],f.id+":412");w(a);var L=d("useGroupsCometIsInCCNegativeTest").useShouldDisableBumpToInboxForNegativeTest(),M=u.useInboxFollowUps(),N=M.computeInboxFollowUps,O=M.refresh,P=M.reminders,Q=o(function(){c("promiseDone")(O()),F()},[O,F]);M=o(function(a){if(a==null)return m.jsx("div",{});if(d("CurrentEnvironment").facebookdotcom&&c("mwCMIsThreadBumped")({secondaryParentThreadKey:a.secondaryParentThreadKey,threadType:a.threadType})&&L)return m.jsx("div",{});var b;(j||(j=d("I64"))).equal(a.threadKey,(k||(k=d("LSIntEnum"))).ofNumber(-13))||(j||(j=d("I64"))).equal(a.threadKey,(k||(k=d("LSIntEnum"))).ofNumber(-12))?b=K!=null&&(j||(j=d("I64"))).equal(a.threadKey,K.parentThreadKey):b=x!=null&&(j||(j=d("I64"))).equal(x,a.threadKey);return a!=null?m.jsx(c("CometHideableComponentExperiment.react"),{callingSurface:"thread_list",disableHiding:!0,children:m.jsx(z,{lsEntryPoint:n==="inboxThreadList"?J!=null&&(j||(j=d("I64"))).le(a.lastActivityTimestampMs,J.lastActivityTimestampMs)?"inboxRecentThreads":"inboxRemainingThreads":n,lsSubEntryPoint:r,messagingEntrypoint:D!=null?D:"jewel",onClickNestedFolderThread:G,onClose:Q,responsive:t,selected:b,showFollowUpReminder:P.find(function(b){return(j||(j=d("I64"))).equal(b,a.threadKey)})!=null,thread:a})}):m.jsx("div",{})},[n,J,D,G,F,t,K,x,L,P]);var R=o(function(a){A&&A(function(b){return a.scrollTop>0})},[A]),S=c("useMWResponsiveLogExtraData")();S=c("MessengerWebUXLogger").useImpressionLoggerRef({eventName:"threadlist_impression",extraData:S});var T=c("useVirtualizationContainerContext")(),U=o(function(a){T.rootElementRef.current=a==null?void 0:a.getScrollAreaElement()},[T.rootElementRef]),V=v(),W=o(function(a){return(V!=null?V(a):!0)&&(i!=null?i(a):!0)},[V,i]),X=c("useMWGetInboxFocusTargetFromRoute")();X=X===1;p=m.jsx(d("CometPageletWithDiv.react").Placeholder,{className:"x78zum5 xmz0i5r x6ikm8r x10wlt62",fallback:null,name:"MWThreadList",children:m.jsx(c("MWPParentThreadKeyContext").Provider,{value:s,children:m.jsx(c("VirtualizationContainerContext").Provider,{value:T,children:m.jsx(c("MWPBaseThreadList.react"),{beforeContent:m.jsxs(m.Fragment,{children:[m.jsx(c("MWLSJewelMessageRequestsThreadContainer.react"),{onOpenMessageRequests:p}),E,b("cr:21161")&&m.jsx(d("CometPageletWithDiv.react").Placeholder,{fallback:null,name:"MWPinnedThreadsList",children:m.jsx(b("cr:21161"),{customThreadFilter:i,parentThreadKey:s,renderItem:M})})]}),customThreadFilter:W,emptyContent:m.jsx(c("MWThreadListEmptyContainer.react"),{filter:g,parentThreadKey:s}),filter:g,gridLabel:e,imperativeRef:U,onDataLoaded:N,onLoadMoreThreads:function(){d("MWPBumpEntityKey").bumpEntityKeyWithAppId("mw.threadlist","load_more_threads"),c("CometVisualCompletion").addFirstMarkerPoint("threadListLoadMoreThreads")},onScroll:R,pageSize:15,parentThreadKey:s,renderItem:M,renderLoadingAnimation:function(a,b){b=a==="onBottom"&&b>y;return m.jsxs("div",{children:[m.jsx(c("MWThreadListGlimmer.react"),{numberOfItems:2,parentComponentForDebug:"MWThreadListLoadingAnimation",vcIgnore:b}),m.jsx(c("CometHeroHoldTrigger.react"),{description:"ThreadListLoadingMoreItems."+a,hold:!b})]})},setIsEmptyInbox:C})})})});return m.jsxs("div",babelHelpers["extends"]({className:"x78zum5 xdt5ytf x1iyjqo2 x6ikm8r x10wlt62"},{id:a,ref:S,children:[l!=null?m.jsx(d("FocusRegion.react").FocusRegion,{children:l}):null,m.jsx(B,{autoFocusQuery:d("focusScopeQueries").tabbableScopeQuery,enabled:X,children:m.jsx(d("FocusRegion.react").FocusRegion,{autoFocusQuery:X?d("focusScopeQueries").tabbableScopeQuery:void 0,recoverFocusQuery:d("focusScopeQueries").tabbableScopeQuery,recoverFocusStrategy:d("FocusRegionType").RecoverFocusStrategy.Nearest,children:p})})]}))}A.displayName=A.name+" [from "+f.id+"]";function B(a){var b=d("react-compiler-runtime").c(3),e=a.autoFocusQuery,f=a.children;a=a.enabled;if(!a)return f;b[0]!==e||b[1]!==f?(a=m.jsx(c("CometRouterFocusRegion.react"),{autoFocusQuery:e,children:f}),b[0]=e,b[1]=f,b[2]=a):a=b[2];return a}g["default"]=A}),98);
__d("MWJewelNestedFolderThreadList.react",["CometScrollView.react","CometTopNavListDropdownCard.react","MWJewelNestedFolderThreadListHeader.react","MWThreadList.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){var b=d("react-compiler-runtime").c(13),e=a.folder,f=a.onClose,g=a.onReturn;a=a.title;var h;b[0]!==g||b[1]!==a?(h=i.jsx(c("MWJewelNestedFolderThreadListHeader.react"),{onReturn:g,title:a}),b[0]=g,b[1]=a,b[2]=h):h=b[2];b[3]!==a?(g=typeof a==="string"?a:a.toString(),b[3]=a,b[4]=g):g=b[4];b[5]!==e||b[6]!==f||b[7]!==g?(a=i.jsx(c("MWThreadList.react"),{gridLabel:g,lsEntryPoint:"jewelNestedFolder",onClose:f,parentThreadKey:e,responsive:!1}),b[5]=e,b[6]=f,b[7]=g,b[8]=a):a=b[8];b[9]===Symbol["for"]("react.memo_cache_sentinel")?(e=i.jsx("div",{className:"x1qx5ct2"}),b[9]=e):e=b[9];b[10]!==h||b[11]!==a?(f=i.jsx(c("CometTopNavListDropdownCard.react"),{useMaxHeight:!0,children:i.jsxs(c("CometScrollView.react"),{showsHorizontalScrollIndicator:!1,showsVerticalScrollIndicator:!0,children:[h,a,e]})}),b[10]=h,b[11]=a,b[12]=f):f=b[12];return f}g["default"]=a}),98);
__d("MWChatSearchFetchCCRecommendations",["fbt","I64","LSIntEnum","LSMessagingThreadTypeUtil","MNetContactItemType","MWChatTemporarySearchResult","ReQL"],(function(a,b,c,d,e,f,g,h){"use strict";var i=["communityId","contextLine","score","scoreType","secondaryThreadPictureUrl","secondaryThreadPictureUrlFallback","threadKey","threadName","threadPictureUrl","threadPictureUrlFallback","threadType"],j,k,l=3;async function a(a,b){return(j||(j=d("I64"))).equal(b,(k||(k=d("LSIntEnum"))).ofNumber(15))?[]:n(await m(a,l))}async function m(a,b){a=await d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.tables.cm_search_nullstate_metadata).filter(function(a){return(j||(j=d("I64"))).equal(a.threadType,(k||(k=d("LSIntEnum"))).ofNumber(18))}));return a.sort(function(a,b){a=a.score;b=b.score;return a===b?0:a>b?1:-1}).slice(0,b)}function n(a){return a.map(function(a,b){var e=a.communityId,f=a.contextLine,g=a.score,l=a.scoreType,m=a.secondaryThreadPictureUrl,n=a.secondaryThreadPictureUrlFallback,o=a.threadKey,p=a.threadName,q=a.threadPictureUrl;a.threadPictureUrlFallback;var r=a.threadType;babelHelpers.objectWithoutPropertiesLoose(a,i);a={contactId:o,contactType:(k||(k=d("LSIntEnum"))).ofNumber(c("MNetContactItemType").COMMUNITY_MESSAGING_THREAD_FOR_CC_SECTION),score:g,scoreIndex:(j||(j=d("I64"))).of_int32(b),scoreType:l};return{communityId:e!=null?(j||(j=d("I64"))).to_string(e):"",displayName:p,id:j.to_string(o),imageUrl:(g=q!=null?q:m)!=null?g:"",isAiBot:j.equal(r,k.ofNumber(201)),isContact:d("LSMessagingThreadTypeUtil").isOneToOne(r),isDisappearingModeSettingOn:!1,isE2EE:d("LSMessagingThreadTypeUtil").isArmadilloSecure(r),isEPD:!1,isInstagramAccount:!1,isInstamadilloCutover:!1,isTTLCClipEnabled:!1,isTTLCGenericXMAShareEnabled:!1,isTTLCMediaShareEnabled:!1,isTTLCStoryShareEnabled:!1,isVerified:!1,rankingScore:a,resultType:d("MWChatTemporarySearchResult").getResultType(k.ofNumber(13)),searchSource:"server",secondaryImageUrl:(b=m!=null?m:n)!=null?b:"",section:h._(/*BTDS*/"\u0e0a\u0e48\u0e2d\u0e07\u0e02\u0e2d\u0e07\u0e04\u0e38\u0e13").toString(),subtext:f!=null?f:"",threadKey:o,threadType:r}})}g.fetchCCs=a;g.mapToSearchResults=n}),226);
__d("MWChatSearchFetchGenAIBotRecommendations",["I64","LSContactViewerRelationship","LSIntEnum","LSMessagingThreadTypeUtil","MNetContactItemType","MNetRankType","MWChatSearchResultType","MWChatTemporarySearchResultUtils","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=3;async function a(a,b){return(h||(h=d("I64"))).equal(b,(i||(i=d("LSIntEnum"))).ofNumber(15))?[]:l(await k(a,j))}async function k(a,b){a=await d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.tables.ai_bot_search_metadata));return a.sort(function(a,b){a=a.score;b=b.score;return a===b?0:a>b?1:-1}).slice(0,b)}function l(a){return a.map(function(a,b){var e=a.botId,f=a.contactViewerRelationship,g=a.contextLine,j=a.displayName,k=a.displayPictureUrl;a=a.score;a={contactId:e,contactType:(i||(i=d("LSIntEnum"))).ofNumber(c("MNetContactItemType").BOT),score:a,scoreIndex:(h||(h=d("I64"))).of_int32(b),scoreType:i.ofNumber(c("MNetRankType").MESSENGER_USER_SEARCH_NULLSTATE)};return{displayName:j,id:h.to_string(e),imageUrl:k!=null?k:"",isAiBot:!0,isContact:!0,isDisappearingModeSettingOn:!1,isE2EE:d("LSMessagingThreadTypeUtil").isArmadilloSecure(e),isEPD:!1,isInstagramAccount:!1,isInstamadilloCutover:!1,isTTLCClipEnabled:!1,isTTLCGenericXMAShareEnabled:!1,isTTLCMediaShareEnabled:!1,isTTLCStoryShareEnabled:!1,isVerified:!1,isViewerUnconnected:h.equal(f,i.ofNumber(c("LSContactViewerRelationship").NOT_CONTACT)),rankingScore:a,resultType:c("MWChatSearchResultType").AI_BOT,searchSource:"server",secondaryImageUrl:"",section:d("MWChatTemporarySearchResultUtils").getSectionHeaderForAIBot(),subtext:g!=null?g:"",threadKey:e,threadType:h.of_int32(201)}})}g.fetchGenAIBots=a;g.mapToSearchResults=l}),98);
__d("MWChatSearchFetchRecommendations",["I64","LSInitSyncCompleteSubscription","LSIntEnum","MWChatSearchFetchCCRecommendations","MWChatSearchFetchContactRecommendations","MWChatSearchFetchGenAIBotRecommendations","MWChatSearchIssueLightspeedQuery","Promise","cr:23417","emptyFunction","gkx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(a,e,f,g,k){var m=e.includes((j||(j=d("LSIntEnum"))).ofNumber(13));e=e.includes(j.ofNumber(16));c("promiseDone")((h||(h=b("Promise"))).all([(i||(i=d("I64"))).equal(g,(j||(j=d("LSIntEnum"))).ofNumber(1))&&b("cr:23417")!=null?b("cr:23417").fetchNullStateRecentSearches(a):(h||(h=b("Promise"))).resolve([]),d("MWChatSearchFetchContactRecommendations").fetchContacts(a,f,g),m?d("MWChatSearchFetchCCRecommendations").fetchCCs(a,g):[],e?d("MWChatSearchFetchGenAIBotRecommendations").fetchGenAIBots(a,g):[]]).then(function(a){var b=a[0],c=a[1],d=a[2];a=a[3];b=l(b,c,d,a);return k(b)}))}function a(a,b,e,f,g,h){c("promiseDone")(d("MWChatSearchIssueLightspeedQuery").makeSearchQuery(b,f,g));c("gkx")("15587")?c("promiseDone")(d("LSInitSyncCompleteSubscription").maybeWaitForSyncGroup(a,(j||(j=d("LSIntEnum"))).ofNumber(7)),function(){k(a,b,e,f,h)}):k(a,b,e,f,h);return c("emptyFunction")}function l(a,b,c,d){return[].concat(a,d,c,b)}g.requestRecommendations=a;g.blendSearchResults=l}),98);
__d("LsUniversalSearchDataSource",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum")({LOCAL_BLENDED:0,SERVER_ENTITIES_NAMED_DSQ1:1,SERVER_ENTITIES_NAMED_DSQ2:2});c=a;f["default"]=c}),66);
__d("LsUniversalSearchThreadType",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum")({ARMADILLO:0,TINCAN:1,OPEN_THREAD:2});c=a;f["default"]=c}),66);
__d("SearchTransportType",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum")({ARMADILLO:1,TINCAN:2,OPEN_THREAD:3,IG_DJANGO:4,IG_ADVANCED_CRYPTO_TRANSPORT:5,IG_MESSENGER_INFRA:6});c=a;f["default"]=c}),66);
__d("UniversalSearchEndFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("844");b=d("FalcoLoggerInternal").create("universal_search_end",a);e=b;g["default"]=e}),98);
__d("UniversalSearchResultSelectedFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("846");b=d("FalcoLoggerInternal").create("universal_search_result_selected",a);e=b;g["default"]=e}),98);
__d("UniversalSearchUISectionType",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum")({NULL_STATE_RECENTS:1,NULL_STATE_RECENTS_SEE_ALL:2,NULL_STATE_SUGGESTED:3,NULL_STATE_XAC_FOLLOWING:4,QUERY_SUGGESTED:5,QUERY_NON_FOLLOWING:6,QUERY_XAC_FOLLOWING:7,QUERY_XAC_NON_FOLLOWING:8,QUERY_BUSINESSES:9,QUERY_MESSAGES:10,OTHER:11,QUERY_NON_BUSINESSES:12,COMMUNITY_CHATS:13,MORE_COMMUNITY_CHATS:14,RELEVANT_SHARES:15,LATEST_SHARES:16,RECOMMENDED_COMMUNITIES:17,COMMUNITIES_AND_MORE:18,CHANNELS:19,NULL_STATE_NON_FOLLOWING:20,JOINED_CM_AND_CHANNEL:21,JOINED_CM_AND_CHANNEL_SEE_MORE:22,RECOMMENDED_CM_AND_CHANNEL:23,RECOMMENDED_CM_AND_CHANNEL_SEE_MORE:24,AI:25,AI_SEE_MORE:26,CHANNELS_SEE_MORE:27,UNJOINED_COMMUNITY_CHATS:28,MORE_UNJOINED_COMMUNITY_CHATS:29,NS_SUGGESTED_CHANNELS:30,NS_SUGGESTED_CHANNELS_SEE_MORE:31,NULL_STATE_MESSAGES:32,NULL_STATE_SUGGESTED_PROMPT:33,NULL_STATE_PYMK:34,QUERY_SUGGESTED_PROMPT:35,INVITE_TO_INSTAGRAM:36,INVITE_TO_INSTAGRAM_SEE_MORE:37,NULL_STATE_GROUP_CHATS:38,NULL_STATE_GROUP_CHATS_SEE_MORE:39,QUERY_NON_FOLLOWING_SEE_MORE:40,META_AI_SNIPPET:41,QUERY_BUSINESSES_SEE_MORE:42,QUERY_MESSAGES_SEE_MORE:43,PHOTOS_AND_VIDEOS:44,PHOTOS_AND_VIDEOS_SEE_MORE:45,LINKS:46,LINKS_SEE_MORE:47,FILES:48,FILES_SEE_MORE:49,PHONE_CONTACTS:50,PHONE_CONTACTS_SEE_MORE:51,NOT_IN_PHONE_CONTACTS:52});c=a;f["default"]=c}),66);
__d("MWSearchLogging",["$InternalEnum","I64","LSMessagingThreadTypeUtil","MWChatSearchResultType","UniversalSearchEndFalcoEvent","UniversalSearchResultSelectedFalcoEvent","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h,i=b("$InternalEnum")({CM_THREADS:"cm_threads",UNJOINED_GROUPS:"unjoined_groups",NON_CONTACTS:"noncontacts",PAGES:"pages",CONTACTS_GROUPS:"contacts_groups",MESSAGE_SEARCH:"message_search"}),j=function(a){switch(a){case"server":return[1,2];case"offline":case"offline_nullstate":case"secure":return[0];default:return[]}};function k(a){return a===!0?1:3}function a(a){return a===!0?0:2}function l(a,b){var c=b.searchSource,d=b.section;b=b.sectionAnalyticsName;if(a==="")return c==="null_state_recent"?1:3;if(i.cast(b)===i.MESSAGE_SEARCH)return 10;if(c!=="server"||d==="")return 5;a=i.cast(b);if(a==null)return 11;switch(a){case i.CM_THREADS:return 13;case i.CONTACTS_GROUPS:return 5;case i.NON_CONTACTS:return 6;case i.PAGES:return 9;default:return 11}}function m(a){return(a!=null?a:-1).toString()}function e(a,b,e,f){var g=e.rawData,i=g.id,n=g.isE2EE,o=g.isEPD,p=g.renderIndex,q=g.searchResultType,r=g.searchSource,s=g.serverSearchResult,t=m(p),u=i,v=k(n);if(s!=null){u=(p=s.resultId)!=null?p:u;v=d("LSMessagingThreadTypeUtil").isArmadilloSecure(s==null?void 0:s.threadType)?1:3;t=(h||(h=d("I64"))).to_string(s.globalIndex)}c("UniversalSearchResultSelectedFalcoEvent").log(function(){return{data_sources:j(r),is_epd:c("gkx")("23390")||o,search_result:{query_string:b,result_fbid:u,result_index:t,result_type:q!=null?q:7},session_id:a,transport_type:v,ui_section:l(b,g)}});if(!f.current){var w=7;e.rawData.resultType===c("MWChatSearchResultType").MESSAGE&&(w=23);c("UniversalSearchEndFalcoEvent").log(function(){return{end_action:w,is_epd:c("gkx")("24110")||o,session_id:a,transport_type:v}});f.current=!0}}g.SectionAnalyticsNameType=i;g.getLoggingDataSources=j;g.getTransportType=k;g.getLsTransportType=a;g.mapSectionToSearchUISection=l;g.logResultSelected=e}),98);
__d("MWStaticSearchEntries",["fbt","MWChatSearchResultType","MWSearchLogging"],(function(a,b,c,d,e,f,g,h){"use strict";function a(a){var b=h._(/*BTDS*/"\u0e04\u0e49\u0e19\u0e2b\u0e32 \"{param}\" \u0e43\u0e19\u0e02\u0e49\u0e2d\u0e04\u0e27\u0e32\u0e21",[h._param("param",a)]).toString();return{key:a,label:b,rawData:{displayName:b,id:"0",imageUrl:"",isContact:!1,isDisappearingModeSettingOn:!1,isE2EE:!1,isEPD:!1,isInstamadilloCutover:!1,isTTLCClipEnabled:!1,isTTLCGenericXMAShareEnabled:!1,isTTLCMediaShareEnabled:!1,isTTLCStoryShareEnabled:!1,resultType:c("MWChatSearchResultType").MESSAGE,searchResultType:14,secondaryImageUrl:"",sectionAnalyticsName:d("MWSearchLogging").SectionAnalyticsNameType.MESSAGE_SEARCH,subtext:""},type:"entry"}}g.createMessageSearchHeaderEntry=a}),226);
__d("filterInstagramContactsMWChatSearchLocalEntries",["MWChatSearchSurfaces"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return b===c("MWChatSearchSurfaces").instagramAll?a:a.filter(function(a){return!a.isInstagramAccount})}g["default"]=a}),98);
__d("sortMWChatSearchLocalResults",["gkx"],(function(a,b,c,d,e,f,g){"use strict";var h={group:1,message:2,messages:3,page:4,user:0},i=c("gkx")("23913");function a(a,b){var c={};for(var d of a){var e;c[d.id]=(e=d.rankingScore)==null?void 0:e.score}e=a.sort(function(a,d){var e=h[a.resultType],f=h[d.resultType];if(e!==f)return e-f;if(i&&b.length>1){e=(f=(e=a.matchedTerms)==null?void 0:e.length)!=null?f:0;f=(f=(f=d.matchedTerms)==null?void 0:f.length)!=null?f:0;if(f!==e)return f-e}e=(f=c[a.id])!=null?f:0;f=(a=c[d.id])!=null?a:0;return f-e});return e}g["default"]=a}),98);
__d("MWChatSearchTypeaheadLightspeedSubscriptionDataSource",["FBLogger","I64","LSIntEnum","MNetRankType","MWChatSearchFetchRecommendations","MWChatSearchFilteringUtils","MWChatSearchIssueLightspeedQuery","MWChatSearchSurfaces","MWLSSearchIssueSearchQuerySupportedTypes","MWPSearchOfflineOpenConversationsUtils","MWPSearchSystem","MWStaticSearchEntries","cr:20302","cr:3752","createMWChatSearchTypeaheadDataEntry","filterInstagramContactsMWChatSearchLocalEntries","isArmadillo","isSearchQualityEnabled","justknobx","mwChatSearchPayloadDecoratorRemoveExcluded","mwChatSearchPayloadEnumerate","promiseDone","relay-runtime/network/RelayObservable","sortMWChatSearchLocalResults"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=10,k=10,l=c("isArmadillo")();a=function(){function a(a){var b=a.database,e=a.excludedIDs;e=e===void 0?[]:e;var f=a.lightspeedSupportedTypes;f=f===void 0?d("MWLSSearchIssueSearchQuerySupportedTypes").allSupportedTypes:f;var g=a.source;g=g===void 0?c("MWChatSearchSurfaces").universal:g;var i=a.includeRecommendations;i=i===void 0?!0:i;var j=a.includeGroupSearch;j=j===void 0?!1:j;var k=a.includeMessageSearchEntry;k=k===void 0?!0:k;var l=a.nullstateRankType;l=l===void 0?c("isSearchQualityEnabled")()?(h||(h=d("LSIntEnum"))).ofNumber(c("MNetRankType").MESSENGER_BLENDED_NULLSTATE):(h||(h=d("LSIntEnum"))).ofNumber(c("MNetRankType").MESSENGER_USER_SEARCH_NULLSTATE):l;a=a.includeAiBots;a=a===void 0?!0:a;this.$1=[];this.$5=function(){};this.$1=e;this.$2=g===c("MWChatSearchSurfaces").omnipickerArmadillo?d("MWLSSearchIssueSearchQuerySupportedTypes").armadilloSupportedTypes:f;this.$3=g;this.$4=b;this.$6=i;this.$7=j;this.$8=k;this.$9=l;this.$10=a;d("MWPSearchSystem").makeAll(b)}var e=a.prototype;e.resolveData=async function(a,b){b=b.map(c("createMWChatSearchTypeaheadDataEntry"));b=[].concat(this.$8&&a.query.length>1?[d("MWStaticSearchEntries").createMessageSearchHeaderEntry(a.query)]:[],b);b=d("MWChatSearchFilteringUtils").dedupeByThreadKey(b);b=await d("MWChatSearchFilteringUtils").filterSearchResults(b,this.$4,!1,l,!this.$10);var e=c("mwChatSearchPayloadDecoratorRemoveExcluded")(this.$1);return c("mwChatSearchPayloadEnumerate")(e({entries:b,params:a}))};e.fetchNetwork=function(a){var e=this;b("cr:20302")==null||b("cr:20302").qplAddAnnotations({annotations:{bool:{include_group_search:this.$7},int:{source:(i||(i=d("I64"))).to_int32(this.$3)}}});this.$5();return c("relay-runtime/network/RelayObservable").create(function(f){if(a.query.length===0){e.$5=e.fetchNullstateResults(a,f);return}var g=[],h=[],i=!1;b("cr:20302")==null||b("cr:20302").qplAddPoint({annotations:{int:{query_length:a.query.length}},point:"local_query_start"});var j=Promise.allSettled(e.issueLocalSearchQuery(a)).then(async function(d){var j=d[0];d=d[1];j=j.status==="fulfilled"?j.value:[];d=d.status==="fulfilled"?d.value:[];b("cr:20302")==null||b("cr:20302").qplAddPoint({annotations:{int:{offline_search_results_count:d.length,secure_search_results_count:j.length}},point:"local_query_end"});g=e.transformLocalSearchResults(j,d);g=c("sortMWChatSearchLocalResults")(g,a.query);b("cr:20302")==null||b("cr:20302").qplAddPoint({point:"resolve_data_start"});j=await e.resolveData(a,g.concat(h));b("cr:20302")==null||b("cr:20302").qplAddPoint({point:"resolve_data_end"});i||f.next(j)}).catch(function(a){c("FBLogger")("messenger_search").catching(a).mustfix("Error performing MWChatSearchIssueMAWFTSQuery.fetchResults")}),k=d("MWChatSearchIssueLightspeedQuery").requestResults_T200619723;c("justknobx")._("2003")&&(k=d("MWChatSearchIssueLightspeedQuery").requestResults);b("cr:20302")==null||b("cr:20302").qplAddPoint({point:"server_query_start"});var l=k(e.$4,e.$2,e.$3,e.$7,a,function(i){b("cr:20302")==null||b("cr:20302").qplAddPoint({annotations:{int:{server_search_results_count:i.length}},point:"server_query_end"});h=i;i=a.query.length>0&&d("MWPSearchSystem").isDone();var k=i?j:Promise.resolve();b("cr:20302")==null||b("cr:20302").qplAddPoint({annotations:{bool:{wait_for_local_search:i}},point:"wait_for_local_search_start"});c("promiseDone")(k.finally(async function(){b("cr:20302")==null||b("cr:20302").qplAddPoint({point:"wait_for_local_search_end"});b("cr:20302")==null||b("cr:20302").qplAddPoint({point:"resolve_data_start"});var c=await e.resolveData(a,g.concat(h));b("cr:20302")==null||b("cr:20302").qplAddPoint({annotations:{int:{total_results_count:c.entries.length}},point:"resolve_data_end"});f.next(c);b("cr:20302")==null||b("cr:20302").qplSuccess();f.complete()}))});e.$5=function(){l(),i=!0}})};e.issueLocalSearchQuery=function(a){return[b("cr:3752")!=null?b("cr:3752").fetchResults(this.$2,this.$3,this.$7,a):Promise.resolve([]),this.$3!==c("MWChatSearchSurfaces").broadcast?d("MWPSearchOfflineOpenConversationsUtils").search(a.query,this.$7):Promise.resolve([])]};e.transformLocalSearchResults=function(a,b){b=j<=0?b:b.slice(0,j);a=k<=0?a:a.slice(0,k);return b.concat(a)};e.fetchNullstateResults=function(a,e){var f=this;if(!this.$6){e.next({entries:[],params:a});e.complete();return function(){}}b("cr:20302")==null||b("cr:20302").qplAddPoint({annotations:{bool:{should_fetch_community_chats:this.$2.includes((h||(h=d("LSIntEnum"))).ofNumber(13)),should_fetch_genai_bots:this.$2.includes((h||(h=d("LSIntEnum"))).ofNumber(16))},int:{null_state_rank_type:(i||(i=d("I64"))).to_int32(this.$9)}},point:"null_state_query_start"});return d("MWChatSearchFetchRecommendations").requestRecommendations(this.$4,this.$2,this.$9,this.$3,a,async function(d){d=c("filterInstagramContactsMWChatSearchLocalEntries")(d,f.$3);b("cr:20302")==null||b("cr:20302").qplAddPoint({point:"null_state_query_end"});b("cr:20302")==null||b("cr:20302").qplAddPoint({point:"resolve_data_start"});d=await f.resolveData(a,d);b("cr:20302")==null||b("cr:20302").qplAddPoint({annotations:{int:{null_state_results_count:d.entries.length}},point:"resolve_data_end"});e.next(d);b("cr:20302")==null||b("cr:20302").qplSuccess();e.complete()})};e.setExcludedIds=function(a){this.$1=a};return a}();g.default=a}),98);
__d("MWSearchLoggingTypes",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({Jewel:"jewel",Inbox:"inbox"});f.SearchSurface=a}),66);
__d("UniversalSearchQueryChangedFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("843");b=d("FalcoLoggerInternal").create("universal_search_query_changed",a);e=b;g["default"]=e}),98);
__d("UniversalSearchStartFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("840");b=d("FalcoLoggerInternal").create("universal_search_start",a);e=b;g["default"]=e}),98);
__d("MWChatSearchTypeheadActionButtonViewItem.react",["CometTypeaheadViewItem.react","FDSSkittleIcon.react","MWXText.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){var b=d("react-compiler-runtime").c(11),e=a.entry,f=a.icon,g=a.onHighlightEntry,h=a.onPressEntry;a=a.title;var j;b[0]!==f?(j=i.jsx(c("FDSSkittleIcon.react"),{color:"gray",icon:f,size:36}),b[0]=f,b[1]=j):j=b[1];f=j;b[2]===Symbol["for"]("react.memo_cache_sentinel")?(j={className:"xe8uvvx xexx8yu x1icxu4v x18d9i69 x25sj25"},b[2]=j):j=b[2];var k;b[3]!==a?(k=i.jsx(c("MWXText.react"),{type:"body3",children:a}),b[3]=a,b[4]=k):k=b[4];b[5]!==e||b[6]!==f||b[7]!==g||b[8]!==h||b[9]!==k?(a=i.jsx("div",babelHelpers["extends"]({},j,{role:"listbox",children:i.jsx(c("CometTypeaheadViewItem.react"),{entry:e,isActive:!1,itemStartContent:f,onHighlightEntry:g,onPressEntry:h,role:"option",children:k})})),b[5]=e,b[6]=f,b[7]=g,b[8]=h,b[9]=k,b[10]=a):a=b[10];return a}g["default"]=a}),98);
__d("MWCreateBroadcastChannelDialogQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="10056616957724259"}),null);
__d("MWCreateBroadcastChannelDialogQuery$Parameters",["MWCreateBroadcastChannelDialogQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a={kind:"PreloadableConcreteRequest",params:{id:b("MWCreateBroadcastChannelDialogQuery_facebookRelayOperation"),metadata:{},name:"MWCreateBroadcastChannelDialogQuery",operationKind:"query",text:null}};e.exports=a}),null);
__d("MWQuickPromotionCreateBroadcastChannelNuxQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="23896442089962141"}),null);
__d("MWQuickPromotionCreateBroadcastChannelNuxQuery$Parameters",["MWQuickPromotionCreateBroadcastChannelNuxQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a={kind:"PreloadableConcreteRequest",params:{id:b("MWQuickPromotionCreateBroadcastChannelNuxQuery_facebookRelayOperation"),metadata:{},name:"MWQuickPromotionCreateBroadcastChannelNuxQuery",operationKind:"query",text:null}};e.exports=a}),null);
__d("MWQuickPromotionCreateBroadcastChannelNux.entrypoint",["JSResourceForInteraction","MWQuickPromotionCreateBroadcastChannelNuxQuery$Parameters"],(function(a,b,c,d,e,f,g){"use strict";a={getPreloadProps:function(){return{queries:{broadcastChannelQueryRef:{parameters:c("MWQuickPromotionCreateBroadcastChannelNuxQuery$Parameters"),variables:{}}}}},root:c("JSResourceForInteraction")("MWQuickPromotionCreateBroadcastChannelNux.react").__setRef("MWQuickPromotionCreateBroadcastChannelNux.entrypoint")};b=a;g["default"]=b}),98);
__d("MWCreateBroadcastChannelDialog.entrypoint",["JSResourceForInteraction","MWCreateBroadcastChannelDialogQuery$Parameters","MWQuickPromotionCreateBroadcastChannelNux.entrypoint","NestedRelayEntryPointBuilderUtils"],(function(a,b,c,d,e,f,g){"use strict";a={getPreloadProps:function(){return{entryPoints:{nuxEntryPoint:d("NestedRelayEntryPointBuilderUtils").NestedRelayEntryPoint({entryPoint:c("MWQuickPromotionCreateBroadcastChannelNux.entrypoint"),entryPointParams:{}})},queries:{queryReference:{parameters:c("MWCreateBroadcastChannelDialogQuery$Parameters"),variables:{}}}}},root:c("JSResourceForInteraction")("MWCreateBroadcastChannelDialog.react").__setRef("MWCreateBroadcastChannelDialog.entrypoint")};g["default"]=a}),98);
__d("MWChatSearchTypeaheadCreateBroadcastChannelActionButtonViewItem.react",["fbt","BroadcastChannelQPL","BroadcastChat.svg.react","MWChatSearchTypeheadActionButtonViewItem.react","MWCreateBroadcastChannelDialog.entrypoint","MWLogBroadcastChannelFalcoEvent","emptyFunction","react","react-compiler-runtime","useBroadcastChannelImpressionLogger","useMWXEntryPointDialog"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react");function a(){var a=d("react-compiler-runtime").c(9),b;a[0]===Symbol["for"]("react.memo_cache_sentinel")?(b=h._(/*BTDS*/"\u0e2a\u0e23\u0e49\u0e32\u0e07\u0e0a\u0e48\u0e2d\u0e07"),a[0]=b):b=a[0];b=b;var e;a[1]===Symbol["for"]("react.memo_cache_sentinel")?(e={},a[1]=e):e=a[1];e=c("useMWXEntryPointDialog")(c("MWCreateBroadcastChannelDialog.entrypoint"),e);var f=e[0];a[2]===Symbol["for"]("react.memo_cache_sentinel")?(e={clientExtras:{entry_point:"public_chats:omnipicker"},event:161,parentSurface:7,source:20,surface:4},a[2]=e):e=a[2];e=c("useBroadcastChannelImpressionLogger")(e);var g;a[3]===Symbol["for"]("react.memo_cache_sentinel")?(g={key:"newBroadcastChannel",label:"New Broadcast Channel",type:"entry"},a[3]=g):g=a[3];a[4]!==f?(g=j.jsx(c("MWChatSearchTypeheadActionButtonViewItem.react"),{entry:g,icon:c("BroadcastChat.svg.react"),onHighlightEntry:c("emptyFunction"),onPressEntry:function(){d("BroadcastChannelQPL").logCreateBroadcastChannelQPLStart("public_chats:omnipicker"),d("MWLogBroadcastChannelFalcoEvent").logBroadcastChannelFalcoEvent({clientExtras:{entry_point:"public_chats:omnipicker"},event:95,parentSurface:7,source:20,surface:4}),f({},k)},title:b}),a[4]=f,a[5]=g):g=a[5];a[6]!==e||a[7]!==g?(b=j.jsx("div",{ref:e,children:g}),a[6]=e,a[7]=g,a[8]=b):b=a[8];return b}function k(){}g["default"]=a}),226);
__d("GroupsCometGlobalChatCreationDialogQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="9578991145469240"}),null);
__d("GroupsCometGlobalChatCreationDialogQuery$Parameters",["GroupsCometGlobalChatCreationDialogQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a={kind:"PreloadableConcreteRequest",params:{id:b("GroupsCometGlobalChatCreationDialogQuery_facebookRelayOperation"),metadata:{},name:"GroupsCometGlobalChatCreationDialogQuery",operationKind:"query",text:null}};e.exports=a}),null);
__d("GroupsCometGlobalChatCreationDialog.entrypoint",["GroupsCometGlobalChatCreationDialogQuery$Parameters","JSResourceForInteraction","WebPixelRatio"],(function(a,b,c,d,e,f,g){"use strict";a={getPreloadProps:function(){return{queries:{queryReference:{parameters:c("GroupsCometGlobalChatCreationDialogQuery$Parameters"),variables:{scale:d("WebPixelRatio").get()}}}}},root:c("JSResourceForInteraction")("GroupsCometGlobalChatCreationDialog.react").__setRef("GroupsCometGlobalChatCreationDialog.entrypoint")};g["default"]=a}),98);
__d("MessengerGroup.svg.react",["react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){return i.jsxs("svg",babelHelpers["extends"]({viewBox:"0 0 26 19",fill:"currentColor",width:"1em",height:"1em"},a,{children:[a.title!=null&&i.jsx("title",{children:a.title}),a.children!=null&&i.jsx("defs",{children:a.children}),i.jsx("path",{d:"M13 10c-2.13 0-3.96-1.5-3.96-4.75C9.04 2.6 10.71.83 13 .83c2.3 0 3.96 1.77 3.96 4.42C16.96 8.51 15.13 10 13 10zm6.62 8.33c.57 0 .88-.5.88-1.1 0-3.08-3.47-5.56-7.5-5.56-4.03 0-7.5 2.48-7.5 5.55 0 .62.3 1.11.88 1.11h13.24zm2.55-7.5c-1.57 0-2.92-1.08-2.92-3.45 0-1.93 1.23-3.21 2.92-3.21s2.91 1.28 2.91 3.21c0 2.37-1.34 3.45-2.91 3.45zm.81 6.67a.83.83 0 0 1-.83-.72l-.01-.11a6.3 6.3 0 0 0-1.7-3.65c-.2-.22-.14-.57.14-.67a4.95 4.95 0 0 1 1.59-.27c1.66 0 3.33.84 3.33 2.5 0 2.92-2.08 2.92-2.08 2.92h-.44zM.92 7.38c0 2.37 1.34 3.45 2.91 3.45s2.92-1.08 2.92-3.45c0-1.93-1.23-3.21-2.92-3.21S.92 5.45.92 7.38zm2.1 10.12h-.44S.5 17.5.5 14.58c0-1.66 1.67-2.5 3.33-2.5.54 0 1.08.1 1.6.27.27.1.33.45.13.67a6.3 6.3 0 0 0-1.7 3.65l-.01.1a.83.83 0 0 1-.83.73z"})]}))}a.displayName=a.name+" [from "+f.id+"]";a._isSVG=!0;b=a;g["default"]=b}),98);
__d("useMWLoggerEntrypoint",["gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=c("gkx")("23433"),d=null;a!==void 0&&(a==="Inbox"?d=b?"messengerdotcom":"fb_groups:comet_www_inbox":a==="ChatTab"?d="fb_groups:comet_www_chat":a==="FullscreenChat"&&(d="fb_groups:comet_www_fullscreen_chat"));return d}g["default"]=a}),98);
__d("MWChatSearchTypeaheadCreateCommunityChatActionButtonViewItem.react",["fbt","$InternalEnum","GroupsCometChatsEngagementLogger","GroupsCometGlobalChatCreationDialog.entrypoint","LSThreadAttributionStore","MWChatSearchTypeheadActionButtonViewItem.react","MWLSThreadDisplayContext","MessengerGroup.svg.react","emptyFunction","react","react-compiler-runtime","useGroupsCometChatsEngagementImpressionLogger","useMWLoggerEntrypoint","useMWXEntryPointDialog"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react"),k=b("$InternalEnum")({CHAT_HEAD:"bottom_chat_create",JEWEL:"top_chat_create"});function a(){var a=d("react-compiler-runtime").c(14),b;a[0]===Symbol["for"]("react.memo_cache_sentinel")?(b={},a[0]=b):b=a[0];b=c("useMWXEntryPointDialog")(c("GroupsCometGlobalChatCreationDialog.entrypoint"),b);var e=b[0],f=d("MWLSThreadDisplayContext").useMWLSThreadDisplayContext(),g=c("useMWLoggerEntrypoint")(f);b=d("LSThreadAttributionStore").getSourceForNewThread();var i=b==="chatheadsNewMessage"?k.CHAT_HEAD:b==="jewelNewMessage"?k.JEWEL:null;b=g!=null?g:"";var m;a[1]!==b?(m={client_extras:{entry_point:b,origin:i!=null?i:""},event:"community_chat_button_impression",surface:"chat_creation_template_list"},a[1]=b,a[2]=m):m=a[2];b=c("useGroupsCometChatsEngagementImpressionLogger")(m);a[3]===Symbol["for"]("react.memo_cache_sentinel")?(m={key:"newCommunityChat",label:"New Community Chat",type:"entry"},a[3]=m):m=a[3];var n;a[4]!==f||a[5]!==g||a[6]!==e?(n=function(){e({entrypoint:g!=null?g:void 0,shouldCloseComposeTab:f==="ChatTab",shouldGoToMessenger:f==="Inbox"},l),d("GroupsCometChatsEngagementLogger").log({action:"tap",client_extras:{entry_point:g!=null?g:"",origin:i!=null?i:""},event:"create_cc_button_clicked",source:"create_cc_button",surface:"chat_creation_template_list"})},a[4]=f,a[5]=g,a[6]=e,a[7]=n):n=a[7];var o;a[8]===Symbol["for"]("react.memo_cache_sentinel")?(o=h._(/*BTDS*/"\u0e2a\u0e23\u0e49\u0e32\u0e07\u0e41\u0e0a\u0e17\u0e02\u0e2d\u0e07\u0e04\u0e2d\u0e21\u0e21\u0e39\u0e19\u0e34\u0e15\u0e35\u0e49"),a[8]=o):o=a[8];a[9]!==n?(m=j.jsx(c("MWChatSearchTypeheadActionButtonViewItem.react"),{entry:m,icon:c("MessengerGroup.svg.react"),onHighlightEntry:c("emptyFunction"),onPressEntry:n,title:o}),a[9]=n,a[10]=m):m=a[10];a[11]!==b||a[12]!==m?(o=j.jsx("div",{ref:b,children:m}),a[11]=b,a[12]=m,a[13]=o):o=a[13];return o}function l(){}g["default"]=a}),226);
__d("MWCMLightSpeedChatTabActionViewItems.react",["BaseDivider.react","CurrentEnvironment","MWChatSearchTypeaheadCreateBroadcastChannelActionButtonViewItem.react","MWChatSearchTypeaheadCreateCommunityChatActionButtonViewItem.react","MWPActor.react","gkx","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react"),j={divider:{marginTop:"x1xmf6yo",marginInlineEnd:"x1ys307a",marginBottom:"x1e56ztr",marginInlineStart:"xyqm7xq",$$css:!0}};function a(){var a=d("react-compiler-runtime").c(2),b=c("gkx")("24047")&&!c("CurrentEnvironment").messengerdotcom,e=c("gkx")("24048"),f;a[0]===Symbol["for"]("react.memo_cache_sentinel")?(f=d("MWPActor.react").isPromode(),a[0]=f):f=a[0];f=f;var g=e||f;g=b||g;f=f||e;a[1]===Symbol["for"]("react.memo_cache_sentinel")?(e=g?i.jsxs(i.Fragment,{children:[b&&i.jsx(c("MWChatSearchTypeaheadCreateCommunityChatActionButtonViewItem.react"),{}),f&&i.jsx(c("MWChatSearchTypeaheadCreateBroadcastChannelActionButtonViewItem.react"),{}),i.jsx(c("BaseDivider.react"),{xstyle:j.divider})]}):null,a[1]=e):e=a[1];return e}g["default"]=a}),98);
__d("mwGroupEntriesForDisplay",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b=new Map();for(a of a){var c,d;c=(c=a.rawData.section)!=null?c:"";d=(d=b.get(c))!=null?d:[];d.push(a);b.set(c,d)}return b}f.mwGroupEntriesForDisplay=a}),66);
__d("MWChatSearchLightspeedTypeaheadViewList.react",["MWCMLightSpeedChatTabActionViewItems.react","MWXText.react","getItemRoleFromCompositeRole","mwGroupEntriesForDisplay","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h=["showActionItems","ariaProps","children","entries","highlightedEntry"],i,j=i||(i=d("react")),k=i.useMemo;function l(a){var b=d("react-compiler-runtime").c(19),e=a.activeEntryKey,f=a.children,g=a.entries,h=a.itemRole;a=a.title;var i="chatSearchListHeading-"+a.toString().replace(/\s/g,"-");if(g!=null&&g.length>0){var k;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(k={className:"xexx8yu x1icxu4v x18d9i69 x25sj25"},b[0]=k):k=b[0];var l;b[1]!==a||b[2]!==i?(l=a?j.jsx("div",babelHelpers["extends"]({className:"x1y1aw1k xf159sx xwib8y2 xmzvs34"},{children:j.jsx(c("MWXText.react"),{id:i,isSemanticHeading:!0,type:"entityHeaderMeta1",children:a})})):null,b[1]=a,b[2]=i,b[3]=l):l=b[3];if(b[4]!==e||b[5]!==f||b[6]!==g||b[7]!==h){b[9]!==e||b[10]!==f||b[11]!==h?(a=function(a,b){var c=e===a.key;return f({entry:a,index:b,isActive:c,itemRole:h})},b[9]=e,b[10]=f,b[11]=h,b[12]=a):a=b[12];a=g.map(a);b[4]=e;b[5]=f;b[6]=g;b[7]=h;b[8]=a}else a=b[8];b[13]!==a||b[14]!==i?(g=j.jsx("ul",{"aria-labelledby":i,children:a}),b[13]=a,b[14]=i,b[15]=g):g=b[15];b[16]!==l||b[17]!==g?(a=j.jsxs("li",babelHelpers["extends"]({},k,{children:[l,g]})),b[16]=l,b[17]=g,b[18]=a):a=b[18];return a}return null}function a(a){var b=a.showActionItems,e=a.ariaProps,f=a.children,g=a.entries,i=a.highlightedEntry;a=babelHelpers.objectWithoutPropertiesLoose(a,h);var m=i!=null?i.key:null;a=k(function(){return d("mwGroupEntriesForDisplay").mwGroupEntriesForDisplay(g)},[g]);var n=c("getItemRoleFromCompositeRole")(e.role);return j.jsxs("ul",babelHelpers["extends"]({className:"x1yrsyyn xyri2b x10b6aqq x1c1uobl"},{"data-testid":void 0,role:"listbox",children:[b&&j.jsx(c("MWCMLightSpeedChatTabActionViewItems.react"),{}),Array.from(a.entries()).map(function(a){var b=a[0];a=a[1];return j.jsx(l,{activeEntryKey:m,children:f,entries:a,itemRole:n,title:b},b)})]}))}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWJewelLightspeedSearchTypeaheadViewList.react",["CometScrollView.react","MWChatSearchLightspeedTypeaheadViewList.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h=["xstyle"],i,j=i||d("react"),k={scroll:{maxHeight:"x1wxkln1",$$css:!0}};function a(a){var b=d("react-compiler-runtime").c(10),e,f;b[0]!==a?(f=a.xstyle,e=babelHelpers.objectWithoutPropertiesLoose(a,h),b[0]=a,b[1]=e,b[2]=f):(e=b[1],f=b[2]);b[3]!==f?(a=[k.scroll,f],b[3]=f,b[4]=a):a=b[4];b[5]!==e?(f=j.jsx(c("MWChatSearchLightspeedTypeaheadViewList.react"),babelHelpers["extends"]({showActionItems:!1},e)),b[5]=e,b[6]=f):f=b[6];b[7]!==a||b[8]!==f?(e=j.jsx(c("CometScrollView.react"),{showsHorizontalScrollIndicator:!1,xstyle:a,children:f}),b[7]=a,b[8]=f,b[9]=e):e=b[9];return e}g["default"]=a}),98);
__d("MWJewelSearchEmptyState.react",["fbt","MWXText.react","react","react-compiler-runtime","useCometTypeaheadEmptyState"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react");function a(a){var b=d("react-compiler-runtime").c(3);a=a.queryString;var e=c("useCometTypeaheadEmptyState")(),f;b[0]!==e||b[1]!==a?(f=e?j.jsxs("div",babelHelpers["extends"]({className:"xz9dl7a xpdmqnj xsag5q8 x1g0dm76"},{children:[j.jsx(c("MWXText.react"),{align:"center",type:"body2",children:h._(/*BTDS*/"\u0e44\u0e21\u0e48\u0e1e\u0e1a\u0e1c\u0e25\u0e25\u0e31\u0e1e\u0e18\u0e4c")}),j.jsx("br",{}),j.jsx(c("MWXText.react"),{align:"center",color:"tertiary",type:"body3",children:h._(/*BTDS*/"\u0e40\u0e23\u0e32\u0e44\u0e21\u0e48\u0e1e\u0e1a\u0e1c\u0e25\u0e25\u0e31\u0e1e\u0e18\u0e4c\u0e17\u0e35\u0e48\u0e15\u0e23\u0e07\u0e01\u0e31\u0e1a \"{query}\" \u0e42\u0e1b\u0e23\u0e14\u0e25\u0e2d\u0e07\u0e15\u0e23\u0e27\u0e08\u0e2a\u0e2d\u0e1a\u0e15\u0e31\u0e27\u0e2a\u0e30\u0e01\u0e14\u0e2b\u0e23\u0e37\u0e2d\u0e43\u0e0a\u0e49\u0e04\u0e33\u0e40\u0e15\u0e47\u0e21",[h._param("query",a)])})]})):null,b[0]=e,b[1]=a,b[2]=f):f=b[2];return f}g["default"]=a}),226);
__d("MWJewelSearchTypeaheadViewItemStartContent.react",["I64","LSMessagingThreadTypeUtil","MWChatFacepile.react","MWChatProfile.react","MWChatSearchResultType","MWFacepile.react","MWLSThread","MWXIconMagnifyingGlass","MWXIconStrict.react","getLSMediaThreadPictureUrl","isStringNullOrEmpty","qex","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=h||d("react");function a(a){var b=d("react-compiler-runtime").c(18);a=a.entry;var e=a.rawData,f=e.imageUrl,g=e.resultType,h=e.searchSource;e=e.secondaryImageUrl;var l;b[0]!==a.key?(l=(i||(i=d("I64"))).of_string_opt(a.key),b[0]=a.key,b[1]=l):l=b[1];a=l;l=d("MWLSThread").useThread(a!=null?a:null,k);var m;b[2]!==l?(m=l!=null?l:{},b[2]=l,b[3]=m):m=b[3];m=m;m=m.threadType;var n;b[4]!==l?(n=l!=null?c("getLSMediaThreadPictureUrl")(l):null,b[4]=l,b[5]=n):n=b[5];l=n;if(g===c("MWChatSearchResultType").MESSAGE){b[6]===Symbol["for"]("react.memo_cache_sentinel")?(n=j.jsx("div",babelHelpers["extends"]({className:"x1qhmfi1 x1c9tyrk xeusxvb x1pahc9y x1ertn4p x1y1aw1k xf159sx xwib8y2 xmzvs34"},{children:j.jsx(c("MWXIconStrict.react"),{color:"primary",icon:c("MWXIconMagnifyingGlass"),isDecorative:!0,size:20})})),b[6]=n):n=b[6];return n}if(h==="null_state_recent"&&((g=c("qex")._("4966"))!=null?g:!1)&&m!=null&&d("LSMessagingThreadTypeUtil").isGroup(m)&&a!=null){b[7]!==a||b[8]!==l||b[9]!==m?(n=l!=null?j.jsx(c("MWChatProfile.react"),{size:36,src:l}):j.jsx(c("MWFacepile.react"),{actualBadge:null,onlyAuthoratitiveContacts:!0,photoSize:36,threadKey:a,threadType:m}),b[7]=a,b[8]=l,b[9]=m,b[10]=n):n=b[10];return n}h=!(m!=null?d("LSMessagingThreadTypeUtil").isOneToOne(m):!1);if(c("isStringNullOrEmpty")(e)){b[11]!==f?(g=j.jsx(c("MWChatProfile.react"),{size:36,src:f}),b[11]=f,b[12]=g):g=b[12];return g}if(h){b[13]!==f||b[14]!==e?(a=j.jsx(c("MWChatFacepile.react"),{firstParticipantURI:f,secondParticipantURI:e,size:36}),b[13]=f,b[14]=e,b[15]=a):a=b[15];return a}b[16]!==e?(l=j.jsx(c("MWChatProfile.react"),{size:36,src:e}),b[16]=e,b[17]=l):l=b[17];return l}function k(a){var b=a.threadPictureUrl,c=a.threadPictureUrlExpirationTimestampMs,d=a.threadPictureUrlFallback;a=a.threadType;return{threadPictureUrl:b,threadPictureUrlExpirationTimestampMs:c,threadPictureUrlFallback:d,threadType:a}}g["default"]=a}),98);
__d("MWJewelSearchTypeaheadViewItemUtils",["fbt","ConstUriUtils","CurrentEnvironment","I64","LSMessagingThreadTypeUtil","MWChatSearchResultType","MWSearchLogging","QPLUserFlow","UniversalSearchResultSelectedFalcoEvent","XCometMessengerControllerRouteBuilder","XMessengerDotComCometMainControllerRouteBuilder","gkx","isTlcSearchEnabled","justknobx","qpl"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=function(a){if(a==null)return null;a=a.loggingSessionId;return a};function k(a){a=a!=null?a:{};var b=a.threadType;a=a.type_;if(b==null||a==null)return!1;if(!d("LSMessagingThreadTypeUtil").isSocialChannelUnjoined(b))return!1;if((i||(i=d("I64"))).to_int32(a)!==14)return!1;return!c("gkx")("24052")?!1:!0}function a(a){if(c("CurrentEnvironment").messengerdotcom===!0)return!1;if(c("justknobx")._("1406"))return!1;a=a===c("MWChatSearchResultType").USER||a===c("MWChatSearchResultType").GROUP;return c("isTlcSearchEnabled")()===!0&&a}function b(a){var b=a!=null?a:{},c=b.threadJoinLinkHash;b=b.threadType;if(b==null||c==null)return void 0;a=k(a)||d("LSMessagingThreadTypeUtil").isUnjoinedDiscoverablePublicBroadcastChannel(b);a=a?(b=d("ConstUriUtils").getUri(c))==null?void 0:b.getPath().split("/").reverse()[1]:void 0;return a}function e(a){return a==null?!1:d("LSMessagingThreadTypeUtil").isUnjoinedDiscoverablePublicBroadcastChannel(a)}function f(a){return a==null?!1:d("LSMessagingThreadTypeUtil").isDiscoverablePublicBroadcastChannel(a)}function l(){return h._(/*BTDS*/"\u0e01\u0e32\u0e23\u0e2a\u0e19\u0e17\u0e19\u0e32\u0e25\u0e31\u0e1a")}function m(a,b){c("CurrentEnvironment").facebookdotcom?c("XCometMessengerControllerRouteBuilder").buildURL({link_hash:a,thread_key:b}):c("XMessengerDotComCometMainControllerRouteBuilder").buildURL({link_hash:a,thread_key:b})}function n(a,b,e){if(a==null)return;var f=e.rawData,g=f.id,h=f.isE2EE,i=f.isEPD,j=f.renderIndex,k=f.searchResultType,l=f.searchSource;c("UniversalSearchResultSelectedFalcoEvent").log(function(){return{data_sources:d("MWSearchLogging").getLoggingDataSources(l),is_epd:c("gkx")("23390")||i,search_result:{query_string:b,result_fbid:g,result_index:(j!=null?j:-1).toString(),result_type:k!=null?k:7},session_id:a,transport_type:d("MWSearchLogging").getTransportType(h),ui_section:d("MWSearchLogging").mapSectionToSearchUISection(b,f)}})}function o(a,b,d,e){a===!0?c("QPLUserFlow").endSuccess(c("qpl")._(25312244,"1683")):c("QPLUserFlow").endCancel(c("qpl")._(25312244,"1683")),n(b,d,e)}g.getSessionId=j;g.isUnjoinedPublicChat=k;g.shouldUpdateThreadKey=a;g.genLinkHash=b;g.isUnjoinedBroadcastChannel=e;g.isBroadcastChannel=f;g.gete2eeAttributionSubtext=l;g.getChatNavigationUrl=m;g.logSearchResultClickHepler=n;g.logSearchResultClick=o}),226);
__d("UniversalSearchImpressionFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("845");b=d("FalcoLoggerInternal").create("universal_search_impression",a);e=b;g["default"]=e}),98);
__d("useUniversalSearchImpressionFalcoEvent",["MWSearchLogging","UniversalSearchImpressionFalcoEvent","cr:20302","react","react-compiler-runtime","usePartialViewImpression"],(function(a,b,c,d,e,f,g){"use strict";var h;(h||d("react")).useCallback;function a(a){var e=d("react-compiler-runtime").c(17),f=a.cmGroupId,g=a.entry,h=a.instanceId,i=a.queryString,j=g.rawData;a=j.id;var k=j.isE2EE,l=j.isEPD,m=j.renderIndex,n=j.searchResultType,o=j.searchSource;a=a;var p=a;a=m!=null?m:-1;var q;e[0]!==a?(q=a.toString(),e[0]=a,e[1]=q):q=e[1];var r=q;if(e[2]!==f||e[3]!==((a=g.rawData)==null?void 0:a.query)||e[4]!==h||e[5]!==k||e[6]!==l||e[7]!==i||e[8]!==j||e[9]!==m||e[10]!==p||e[11]!==r||e[12]!==n||e[13]!==o){q=function(){var a;if(h==null)return;c("UniversalSearchImpressionFalcoEvent").log(function(){return{cm_group_id:f,data_sources:d("MWSearchLogging").getLoggingDataSources(o),impression_selected:!1,is_epd:l,search_result:{query_string:i,result_fbid:p,result_index:r,result_type:n!=null?n:7},session_id:h,transport_type:d("MWSearchLogging").getTransportType(k),ui_section:d("MWSearchLogging").mapSectionToSearchUISection(i,j)}});b("cr:20302")==null||b("cr:20302").renderSearchResult({queryString:(a=g.rawData)==null?void 0:a.query,renderIndex:m!=null?m:-1,sessionInstanceId:h,source:o})};e[2]=f;e[3]=(a=g.rawData)==null?void 0:a.query;e[4]=h;e[5]=k;e[6]=l;e[7]=i;e[8]=j;e[9]=m;e[10]=p;e[11]=r;e[12]=n;e[13]=o;e[14]=q}else q=e[14];a=q;e[15]!==a?(q={onImpressionStart:a},e[15]=a,e[16]=q):q=e[16];return c("usePartialViewImpression")(q)}g["default"]=a}),98);
__d("MWJewelSearchTypeaheadViewItem.react",["BaseMiddot.react","CometTypeaheadViewItem.react","FBLogger","I64","LSIntEnum","LSThreadAttributionStore","MAWThreadCutover","MWJewelSearchTypeaheadViewItemStartContent.react","MWJewelSearchTypeaheadViewItemUtils","MWLSThreadDisplayContext","MWXPageVerificationIcon.react","MWXText.react","MWXTextPairing.react","cr:23418","cr:23436","cr:23437","cr:393","cr:4538","cr:4539","deferredLoadComponent","isStringNullOrEmpty","mwCMIsAnyCMThread","react","requireDeferred","useMWNavigation","useMergeRefs","useUniversalSearchImpressionFalcoEvent"],(function(a,b,c,d,e,f,g){"use strict";var h=["entry","extraViewItemProps","onPressEntry","queryString"],i,j,k,l=i||(i=d("react"));e=i;var m=e.useEffect,n=e.useRef,o=e.useState,p=c("deferredLoadComponent")(c("requireDeferred")("MAWChatVerifyCutover.react").__setRef("MWJewelSearchTypeaheadViewItem.react")),q={contentRoot:{borderStartStartRadius:"x1obq294",borderStartEndRadius:"x5a5i1n",borderEndEndRadius:"xde0f50",borderEndStartRadius:"x15x8krk",marginTop:"xdj266r",marginBottom:"xat24cr",paddingTop:"x1y1aw1k",paddingInlineEnd:"xf159sx",paddingBottom:"xwib8y2",paddingInlineStart:"xmzvs34",":hover_backgroundColor":"x8du52y",$$css:!0}};function a(a){var e=a.entry,f=a.extraViewItemProps,g=a.onPressEntry,i=a.queryString,r=babelHelpers.objectWithoutPropertiesLoose(a,h);a=e.rawData;var s=a.id,t=a.isE2EE,u=a.isInstagramAccount,v=a.isInteropEligible,w=a.otherUserId,x=a.resultType,y=a.searchSource,z=a.section,A=a.serverSearchResult,B=a.subtext,C=a.subtextAdditional,D=a.threadType,E=a.verificationStatus,F=b("cr:4538")==null?void 0:b("cr:4538")(),G=b("cr:4539")==null?void 0:b("cr:4539")({onSuccess:function(a){return F==null?void 0:F(a)}}),H=d("MAWThreadCutover").useShouldHideE2eeAttribution((j||(j=d("I64"))).of_string_opt(s),D),I=c("useMWNavigation")(),J=D!=null&&c("mwCMIsAnyCMThread")(D),K=d("MWLSThreadDisplayContext").useMWLSThreadDisplayContext(),L=d("MWJewelSearchTypeaheadViewItemUtils").getSessionId(f);f=c("useUniversalSearchImpressionFalcoEvent")({entry:e,instanceId:L,isCommunityChat:J,queryString:i});var M=n(null);f=c("useMergeRefs")(M,f);var N=b("cr:23418")(),O=o(),P=O[0];O=O[1];w=w;t=t&&!H?d("MWJewelSearchTypeaheadViewItemUtils").gete2eeAttributionSubtext():B;m(function(){if(r.isActive){var a;(a=M.current)==null||a.scrollIntoView({block:"nearest"})}},[r.isActive]);var Q=P!=null?P:s,R=d("MWJewelSearchTypeaheadViewItemUtils").genLinkHash(A);H=babelHelpers["extends"]({},e,{key:Q,rawData:babelHelpers["extends"]({},a,{id:Q},w==null&&s!==Q?{otherUserId:s}:{})});B=E==="BLUE_VERIFIED"||E==="GRAY_VERIFIED";if(c("isStringNullOrEmpty")(e.label)&&b("cr:23436")!=null&&y!=="null_state_recent"){c("FBLogger")("search").warn("aibolk Empty search result label for entry: %s",e.rawData.id);return null}return l.jsx("div",{ref:f,children:l.jsxs(c("CometTypeaheadViewItem.react"),babelHelpers["extends"]({},r,{entry:H,isDisabled:u===!0&&v===!1,itemEndContent:y==="null_state_recent"&&b("cr:23437")!=null?l.jsx(b("cr:23437"),{entry:e}):null,itemStartContent:l.jsx(c("MWJewelSearchTypeaheadViewItemStartContent.react"),{entry:e}),linkProps:{preventLocalNavigation:!0,url:d("MWJewelSearchTypeaheadViewItemUtils").getChatNavigationUrl(R,Q)},onPressEntry:function(a,b){var c=d("LSThreadAttributionStore").getSourceForNewThread();c==="jewel"||c==="unknown"&&K==null?c="jewelSearch":c==="unknown"&&K==="ChatTab"?c="chatheadsNewMessage":c==="unknown"&&K==="Inbox"&&(c="messengerUniversalSearch");c!=="unknown"&&d("LSThreadAttributionStore").setSource(Q,c);if(d("MWJewelSearchTypeaheadViewItemUtils").isUnjoinedPublicChat(A)){c=A!=null?A:{};c=c.threadJoinLinkHash;c!=null&&(G==null||G(c))}else d("MWJewelSearchTypeaheadViewItemUtils").isUnjoinedBroadcastChannel(D)?(N==null||N(e),I.openInbox({threadKey:(j||(j=d("I64"))).of_string(Q),threadLinkHash:R,threadType:(k||(k=d("LSIntEnum"))).ofNumber(153)},"jewelSearch")):(g(a,b),d("MWJewelSearchTypeaheadViewItemUtils").logSearchResultClick(J,L,i,e))},testid:void 0,xstyle:q.contentRoot,children:[d("MWJewelSearchTypeaheadViewItemUtils").shouldUpdateThreadKey(x)?l.jsx(p,{id:s.toString(),updateThreadKey:O}):null,l.jsx(c("MWXTextPairing.react"),{body:l.jsxs(c("MWXText.react"),{numberOfLines:1,type:"body3",children:[y==="null_state_recent"&&b("cr:23436")!=null?l.jsx(b("cr:23436"),{entry:e}):e.label,E!=null&&B&&!d("MWJewelSearchTypeaheadViewItemUtils").isBroadcastChannel(D)?l.jsx("span",babelHelpers["extends"]({className:"xmzvs34"},{children:l.jsx(c("MWXPageVerificationIcon.react"),{size:"small",verificationBadge:E})})):null]}),level:3,meta:t&&t!==""?l.jsxs(c("MWXText.react"),{numberOfLines:1,type:"meta4",children:[t,d("MWJewelSearchTypeaheadViewItemUtils").isBroadcastChannel(D)&&Boolean(C)&&l.jsxs(l.Fragment,{children:[E!=null&&B&&l.jsx("span",babelHelpers["extends"]({className:"x135b78x xxymvpz"},{children:l.jsx(c("MWXPageVerificationIcon.react"),{size:"small",verificationBadge:E})})),l.jsx(c("BaseMiddot.react"),{}),C]}),(z==null||z==="")&&Boolean(e.rawData.isInstagramAccount)?l.jsxs(l.Fragment,{children:[l.jsx(c("BaseMiddot.react"),{}),"Instagram"]}):null]}):null}),b("cr:393")!=null&&l.jsx(b("cr:393"),{rawData:H.rawData})]}))})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("createMWJewelSearchTypeaheadViewStrategy.react",["CometTypeaheadProgressGlimmer.react","MWJewelLightspeedSearchTypeaheadViewList.react","MWJewelSearchEmptyState.react","MWJewelSearchTypeaheadViewItem.react","gkx","react"],(function(a,b,c,d,e,f,g){"use strict";var h=["ariaProps","entries","extraViewProps","highlightedEntry","isLoading","onAbandonTypeahead_DO_NOT_USE"],i,j=i||d("react");function a(a,b){return function(d){var e=d.ariaProps,f=d.entries;d.extraViewProps;var g=d.highlightedEntry,i=d.isLoading;d.onAbandonTypeahead_DO_NOT_USE;var k=babelHelpers.objectWithoutPropertiesLoose(d,h);d=f.length===0&&k.queryString.length>0;var l=f.length>0&&i;i=f.length===0&&i&&k.queryString.length===0&&c("gkx")("15587");return i?j.jsx(c("CometTypeaheadProgressGlimmer.react"),{}):d?j.jsx(c("MWJewelSearchEmptyState.react"),{queryString:k.queryString}):j.jsxs(j.Fragment,{children:[j.jsx(c("MWJewelLightspeedSearchTypeaheadViewList.react"),{ariaProps:e,entries:f,highlightedEntry:g,xstyle:a,children:function(a){var d=a.entry,e=a.isActive;a=a.itemRole;return j.createElement(c("MWJewelSearchTypeaheadViewItem.react"),babelHelpers["extends"]({},k,{entry:d,extraViewItemProps:{loggingSessionId:b},isActive:e,key:d.key,role:a}))}}),l&&j.jsx(c("CometTypeaheadProgressGlimmer.react"),{})]})}}g["default"]=a}),98);
__d("MWJewelSearchSubscriptionTypeahead.react",["fbt","BaseSubscriptionTypeahead.react","CometTypeaheadBackButton.react","CometTypeaheadInputRoundedStrategy.react","CometTypeaheadLayoutContextualStrategy.react","MWChatSearchResultType","MWChatSearchSurfaces","MWChatSearchTypeaheadLightspeedSubscriptionDataSource","MWFacebookUserWithoutMessengerAccess","MWInboxRouteBuilder","MWLSSearchIssueSearchQuerySupportedTypes","MWLSThreadDisplayContext","MWPConversationSearchLogger","MWPSearchSystem","MWSearchLogging","MWSearchLoggingTypes","UniversalSearchEndFalcoEvent","UniversalSearchQueryChangedFalcoEvent","UniversalSearchStartFalcoEvent","cr:2012305","cr:20302","cr:23418","createMWJewelSearchTypeaheadViewStrategy.react","gkx","isArmadillo","promiseDone","react","useCometRouterDispatcher","useReStore","uuidv4","xplatToDOMRef"],(function(a,b,c,d,e,f,g,h){"use strict";var i=["onChange","onFocus","onPressEntry","onSelectFreeformQuery"],j,k,l=k||(k=d("react"));e=k;var m=e.useCallback,n=e.useEffect,o=e.useMemo,p=e.useRef,q=e.useState,r={searchInput:{marginTop:"x1xmf6yo",marginInlineEnd:"x14z9mp",marginBottom:"x1e56ztr",marginInlineStart:"x1lziwak",paddingTop:"xexx8yu",paddingInlineEnd:"xv54qhq",paddingBottom:"x18d9i69",paddingInlineStart:"xf7dkkf",$$css:!0},searchView:{borderStartStartRadius:"x1obq294",borderStartEndRadius:"x5a5i1n",borderEndEndRadius:"xde0f50",borderEndStartRadius:"x15x8krk",boxShadow:"x1gnnqk1",display:"x78zum5",minHeight:"xphu8jj",$$css:!0}},s=function(a){return c("createMWJewelSearchTypeaheadViewStrategy.react")(null,a)},t=c("gkx")("24086"),u=c("gkx")("23390");function a(a){var e=a.onChange,f=a.onFocus,g=a.onPressEntry,k=a.onSelectFreeformQuery,v=babelHelpers.objectWithoutPropertiesLoose(a,i);a=q(null);var w=a[0],x=a[1],y=p(null),z=(j||(j=c("useReStore")))(),A=p(!1),B=b("cr:23418")();n(function(){var a=y.current;b("cr:2012305")!==null&&a!=null&&b("cr:2012305").trackTypingPerf(a,"MWJewelSearchTypeahead");return function(){b("cr:2012305")!==null&&a!=null&&b("cr:2012305").unregisterTypingPerf(a)}},[y]);var C=d("MWLSThreadDisplayContext").useMWLSThreadDisplayContext();a=o(function(){return new(c("MWChatSearchTypeaheadLightspeedSubscriptionDataSource"))({database:z,excludedIDs:[],includeGroupSearch:C!=="ChatTab",includeMessageSearchEntry:c("gkx")("5801"),includeRecommendations:!0,lightspeedSupportedTypes:d("MWLSSearchIssueSearchQuerySupportedTypes").allSupportedTypes,source:c("MWChatSearchSurfaces").universal})},[z,C]);var D=m(function(){x(null),w!=null&&(A.current||(c("UniversalSearchEndFalcoEvent").log(function(){return{end_action:8,is_epd:u,session_id:w,transport_type:null}}),A.current=!0)),b("cr:20302")==null||b("cr:20302").qplCancel("abandon"),e("")},[e,w]),E=c("useCometRouterDispatcher")(),F=m(function(a){var b=a.rawData.resultType;if(b===c("MWChatSearchResultType").MESSAGE&&a.rawData.query!=null&&c("gkx")("5801")){b=d("MWInboxRouteBuilder").buildMultiThreadMesageSearchURL({search:a.rawData.query});E!=null&&b!=null&&(c("MWPConversationSearchLogger").logUniversalMessageSearch(),E.go(b,{}))}else B==null||B(a);b=function(){g!=null&&g(a)};if(w==null){b();return}d("MWSearchLogging").logResultSelected(w,v.queryString,a,A);b()},[g,w,v.queryString,E,B]);n(function(){return function(){b("cr:20302")==null||b("cr:20302").qplCancel("abandon")}},[]);var G=m(function(){t&&c("promiseDone")(d("MWPSearchSystem").clearAll(z));var a=c("uuidv4")();x(a);b("cr:20302")==null||b("cr:20302").qplStart({queryString:"",sessionInstanceId:a,surface:d("MWSearchLoggingTypes").SearchSurface.Jewel});A.current=!1;c("UniversalSearchStartFalcoEvent").log(function(){return{is_epd:u,search_surface:0,session_id:a}});c("UniversalSearchQueryChangedFalcoEvent").log(function(){return{query_length:"0",query_string:null,session_id:a}})},[z]),H=m(function(a){w!=null&&(c("UniversalSearchQueryChangedFalcoEvent").log(function(){return{query_length:a.length.toString(),query_string:a,session_id:w}}),b("cr:20302")==null||b("cr:20302").qplStart({queryString:a,sessionInstanceId:w,surface:d("MWSearchLoggingTypes").SearchSurface.Jewel})),e(a)},[e,w]),I=function(){f()},J=d("MWFacebookUserWithoutMessengerAccess").useIsFacebookUserWithoutMessengerAccess(),K=h._(/*BTDS*/"\u0e04\u0e49\u0e19\u0e2b\u0e32 Messenger"),L=h._(/*BTDS*/"\u0e04\u0e49\u0e19\u0e2b\u0e32\u0e02\u0e49\u0e2d\u0e04\u0e27\u0e32\u0e21");J=J?L:K;return l.jsx(c("BaseSubscriptionTypeahead.react"),{dataSource:a,dataSourceFetchConfigParams:c("isArmadillo")()?{requestFlow:"network-upon-approve"}:void 0,inputExtraProps:{hideIconAnimation:!0,hideIconOnFocus:!0},inputRef:d("xplatToDOMRef").xplatToInputRef(y),inputStartContent:w!=null?l.jsx(c("CometTypeaheadBackButton.react"),{testid:void 0}):null,inputStrategyRenderer:c("CometTypeaheadInputRoundedStrategy.react"),layoutStrategyRenderer:c("CometTypeaheadLayoutContextualStrategy.react"),loggingContext:"messenger_jewel",onChange:H,onClose:D,onFocus:I,onOpen:G,onPressEntry:F,onSelectFreeformQuery:k,placeholder:J,queryString:v.queryString,shouldCloseOnEnter:!1,shouldHandleCloseAfterHandlePressEntry:!0,shouldQueryStringUpdateFromSelectedEntryOnClick:!1,viewStrategyRenderer:s(w),xstyles:{inputXStyle:r.searchInput,viewXStyle_DO_NOT_USE:r.searchView}})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("MWJewelThreadListSearchTypeahead.react",["CometRelay","FBLogger","I64","MWChatSearchFilteringUtils","MWChatSearchResultType","MWJewelSearchSubscriptionTypeahead.react","MWLogInboxFiltersInteraction","MWLogInteraction","MWPSearchSystem","MWThreadCreationUtil","QPLUserFlow","emptyFunction","qpl","react","react-compiler-runtime","setTimeoutCometSpeculative","useCometPreloader","useMWChatOpenTabForGroup","useMWChatOpenTabForPage","useMWChatOpenTabForUser","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=j||(j=d("react"));b=j;b.useCallback;var l=b.useEffect,m=b.useState;function a(a){var b=d("react-compiler-runtime").c(25),e=a.onClose;a=m("");var f=a[0];a=a[1];var g=c("useMWChatOpenTabForGroup")("jewelSearch"),j=g[0],o=c("useMWChatOpenTabForPage")("jewelSearch");g=c("useMWChatOpenTabForUser")("jewelSearch");var p=g.openTabByThreadKey,q=g.openTabForUserWithoutPreloadedNavigationData,r=(h||(h=c("useReStore")))(),s=d("CometRelay").useRelayEnvironment();b[0]!==r?(g=function(){return d("MWPSearchSystem").makeAll(r)},b[0]=r,b[1]=g):g=b[1];var t=g;b[2]!==t?(g=function(){c("setTimeoutCometSpeculative")(t,1e4)},b[2]=t,b[3]=g):g=b[3];l(g,void 0);b[4]!==r||b[5]!==s||b[6]!==p||b[7]!==q?(g=function(a,b){var c=d("MWChatSearchFilteringUtils").getIsE2ee(b.rawData);if(c)return p(a,!0);d("MWThreadCreationUtil").getIsSecureBasedOnContactCapabilitiesForOneToOneThreadV2(b,s,r).then(async function(c){var e=c.isSecureThread;c=c.reason;if(c==="default_e2ee")q({unpreloadedReason:"jewelsearch_not_support_gql",userId:a});else{var f=await r.tables.threads.get((i||(i=d("I64"))).of_string(a));q({isSecureThread:e,reason:"MWJewelThreadListSearchTypeahead, FBID: "+a+", reason: "+(c!=null?c:"")+", searchSource: "+((e=b.rawData.searchSource)!=null?e:"")+", otherUserId: "+((c=b.rawData.otherUserId)!=null?c:"")+", hasCutoverThread: "+((c=(e=b.rawData.hasCutoverThread)==null?void 0:e.toString())!=null?c:"false")+", threadAuthorityLevel: "+(f!=null?(i||(i=d("I64"))).to_string(f.authorityLevel):"null"),unpreloadedReason:"jewelsearch_not_support_gql",userId:a})}}).catch(n)},b[4]=r,b[5]=s,b[6]=p,b[7]=q,b[8]=g):g=b[8];var u=g;b[9]!==e||b[10]!==j||b[11]!==o||b[12]!==u?(g=function(a){var b=a.rawData,d=b.id;b=b.resultType;bb41:switch(b){case c("MWChatSearchResultType").MESSAGE:break bb41;case c("MWChatSearchResultType").GROUP:j(d);break bb41;case c("MWChatSearchResultType").USER:case c("MWChatSearchResultType").AI_BOT:u(d,a);break bb41;case c("MWChatSearchResultType").PAGE:o(d)}e()},b[9]=e,b[10]=j,b[11]=o,b[12]=u,b[13]=g):g=b[13];g=g;var v=c("useCometPreloader")("button_aggressive",c("emptyFunction"),t),w=v.onHoverInPreloader,x=v.onHoverMovePreloader;v=v.onHoverOutPreloader;var y;b[14]!==t?(y=function(){d("MWLogInteraction").logPopoverOpenCancel("initiate_search"),d("MWLogInboxFiltersInteraction").logInboxFiltersNavigationCancel("initiate_search"),t(),c("QPLUserFlow").start(c("qpl")._(25312244,"1683"))},b[14]=t,b[15]=y):y=b[15];b[16]!==g||b[17]!==f||b[18]!==y?(a=k.jsx(c("MWJewelSearchSubscriptionTypeahead.react"),{onChange:a,onFocus:y,onPressEntry:g,queryString:f}),b[16]=g,b[17]=f,b[18]=y,b[19]=a):a=b[19];b[20]!==w||b[21]!==x||b[22]!==v||b[23]!==a?(g=k.jsx("div",{onMouseEnter:w,onMouseLeave:v,onMouseMove:x,children:a}),b[20]=w,b[21]=x,b[22]=v,b[23]=a,b[24]=g):g=b[24];return g}function n(a){c("FBLogger")("messenger_search").mustfix("Error fetching contact capabilities: %s",a)}e=k.memo(a);g.default=e}),98);
__d("CometMessagingJewelDropdownContent.react",["fbt","CometErrorBoundary.react","CometHeroInteractionWithDiv.react","CometMessagingJewelDropdownContentGlimmer.react","CometMessagingJewelDropdownEBUpsellContainer.react","CometMessagingJewelDropdownScrollableAreaForSmallScreens.react","CometPageletWithDiv.react","CometPlaceholder.react","CometRelay","CometTopNavListDropdownCard.react","FBLogger","I64","InteractionTracing","JSResourceForInteraction","LSContactBitOffset","LSIntEnum","LSPlatformErrorsCatcher.react","LSThreadRangeFilter","MAWUnrecoverableErrorBoundary.react","MWCMJewelContext","MWInboxContextSwitcherDeferred.react","MWInboxContextSwitcherGlimmer.react","MWInboxContextSwitcherUtils","MWInboxTrayContainer.react","MWInboxTrayGating","MWJewelDropdownHeader.react","MWJewelNestedFolderThreadList.react","MWJewelPopoverDialogContext.react","MWJewelThreadListSearchTypeahead.react","MWResponsiveLayoutContext.react","MWThreadList.react","ODS","ReQL","ReQLSuspense","WebUXLoggingEntryPointContextProvider","XCometMessengerControllerRouteBuilder","cr:23174","cr:3721","cr:7643","gkx","lazyLoadComponent","qpl","react","react-compiler-runtime","recoverableViolation","useCometInteractionTracing","useMWChatSearchClearSearchResults","useReStore"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k,l,m,n=m||(m=d("react"));e=m;var o=e.memo;e.useCallback;var p=e.useContext,q=e.useEffect,r=e.useState;e=(e=(e=b("cr:23174"))!=null?e:b("cr:3721"))!=null?e:{MWInboxQPContextProvider:n.Fragment};var s=e.MWInboxQPContextProvider,t=c("lazyLoadComponent")(c("JSResourceForInteraction")("MAWJewelMessageRequestsAndSpamDropdownWithTab.react").__setRef("CometMessagingJewelDropdownContent.react")),u=c("lazyLoadComponent")(c("JSResourceForInteraction")("MWRestrictedAccountsList.react").__setRef("CometMessagingJewelDropdownContent.react")),v=c("lazyLoadComponent")(c("JSResourceForInteraction")("MWJewelArchivedChatsDropdown.react").__setRef("CometMessagingJewelDropdownContent.react")),w=c("lazyLoadComponent")(c("JSResourceForInteraction")("CometMessagingJewelDropdownErrorState.react").__setRef("CometMessagingJewelDropdownContent.react")),x=h._(/*BTDS*/"\u0e41\u0e0a\u0e17");function y(a){c("recoverableViolation")("CometMessagingJewelDropdownQPBannerContainer failed to render","messenger_web_entrypoints",{error:a})}var z=c("gkx")("22839")===!0;function A(a){var e=d("react-compiler-runtime").c(99),g=a.ebSoftblockUpsell,m=a.ebUpsellContainerQueryRef,o=a.mwInboxTrayContainerQuery,w=a.onClose,A=a.pushPage;a=p(c("MWResponsiveLayoutContext.react"));a=a.isDenseMode;var C=p(c("MWJewelPopoverDialogContext.react")),D=C.setIsOpenForDialog,E=c("useMWChatSearchClearSearchResults")();e[0]!==E||e[1]!==w?(C=function(){E(),w()},e[0]=E,e[1]=w,e[2]=C):C=e[2];var F=C,G;e[3]!==E?(C=function(){return E},G=[E],e[3]=E,e[4]=C,e[5]=G):(C=e[4],G=e[5]);q(C,G);e[6]===Symbol["for"]("react.memo_cache_sentinel")?(C=c("XCometMessengerControllerRouteBuilder").buildURL({}),e[6]=C):C=e[6];G=C;C=p(c("MWCMJewelContext"));var H=C.MWCMBlendedThreadListEntrypointRef,I=C.selectedFilterTab,J=C.setSelectedFilterTab;C=r();var K=C[0],L=C[1];e[7]===Symbol["for"]("react.memo_cache_sentinel")?(C=c("qpl")._(30610001,"3003"),e[7]=C):C=e[7];var M=c("useCometInteractionTracing")(C,"fast","INTERACTION"),N=(i||(i=c("useReStore")))();e[8]!==N.tables._user_info?(C=function(){return d("ReQL").fromTableAscending(N.tables._user_info).map(B)},e[8]=N.tables._user_info,e[9]=C):C=e[9];var O;e[10]!==N?(O=[N],e[10]=N,e[11]=O):O=e[11];var P=d("ReQLSuspense").useFirst(C,O,f.id+":164");e[12]!==N.tables.contacts||e[13]!==P?(C=function(){return P!=null?d("ReQL").fromTableAscending(N.tables.contacts,["capabilities","capabilities2"]).getKeyRange(P):d("ReQL").empty()},e[12]=N.tables.contacts,e[13]=P,e[14]=C):C=e[14];e[15]!==N||e[16]!==P?(O=[N,P],e[15]=N,e[16]=P,e[17]=O):O=e[17];var Q=d("ReQLSuspense").useFirst(C,O,f.id+":168");e[18]!==F||e[19]!==A?(C=function(){var a=c("InteractionTracing").startInteraction({interactionClass:"fast",qplEvent:c("qpl")._(30607516,"756"),tracePolicy:"comet.jewel.message_requests",traceType:"INTERACTION"});A(function(b){b=b.onReturn;return n.jsx(d("CometPageletWithDiv.react").Placeholder,{fallback:n.jsx(c("CometMessagingJewelDropdownContentGlimmer.react"),{isFullHeight:!1,title:x,withBackButton:!0}),name:"MAWJewelMessageRequestsAndSpamDropdownWithTab",children:n.jsx(t,{interactionID:a,onClose:F,onReturn:b})})})},e[18]=F,e[19]=A,e[20]=C):C=e[20];O=C;e[21]!==O||e[22]!==I?(C=d("MWInboxContextSwitcherUtils").shouldShowMessageRequestsFromFilter(I)?O:void 0,e[21]=O,e[22]=I,e[23]=C):C=e[23];C=C;var R;e[24]!==F||e[25]!==A?(R=function(){A(function(a){a=a.onReturn;return n.jsx(u,{hidePage:a,onClose:F})})},e[24]=F,e[25]=A,e[26]=R):R=e[26];R=R;var S;e[27]!==F||e[28]!==A?(S=function(){(j||(j=d("ODS"))).bumpEntityKey(3185,"mw_jewel","archived_chats"),A(function(a){a=a.onReturn;return n.jsx(v,{onClose:F,onReturn:a})})},e[27]=F,e[28]=A,e[29]=S):S=e[29];S=S;var T;e[30]!==F||e[31]!==A||e[32]!==Q?(T=function(a){A(function(b){b=b.onReturn;switch((k||(k=d("I64"))).to_int32(a)){case-13:return n.jsx(c("MWJewelNestedFolderThreadList.react"),{folder:a,onClose:F,onReturn:b,title:h._(/*BTDS*/"\u0e07\u0e32\u0e19")});case-12:var e=Q!=null&&d("LSContactBitOffset").has(86,Q),f=h._(/*BTDS*/"Marketplace");e&&(f=h._(/*BTDS*/"_j[\"\\u0e01\\u0e25\\u0e38\\u0e48\\u0e21\\u0e0b\\u0e37\\u0e49\\u0e2d\\u0e02\\u0e32\\u0e22\\u0e2a\\u0e34\\u0e19\\u0e04\\u0e49\\u0e32\",\"6a9a0529abd169ff91b49b4022dbf5a5\",1]"));return n.jsx(c("MWJewelNestedFolderThreadList.react"),{folder:a,onClose:F,onReturn:b,title:f});default:c("FBLogger")("messenger_web_entrypoints").mustfix("Attempted to show an unimplemented nested system folder");return null}})},e[30]=F,e[31]=A,e[32]=Q,e[33]=T):T=e[33];T=T;var U;e[34]!==g||e[35]!==a||e[36]!==o||e[37]!==F?(U=!a&&g==null?n.jsx(c("MWInboxTrayContainer.react"),{mwInboxTrayContainerQuery:o,onClose:F}):null,e[34]=g,e[35]=a,e[36]=o,e[37]=F,e[38]=U):U=e[38];a=U;e[39]!==g||e[40]!==m||e[41]!==I?(o=n.jsx(c("CometMessagingJewelDropdownEBUpsellContainer.react"),{ebSoftblockUpsell:g,ebUpsellContainerQueryRef:m,selectedFilterTab:I}),e[39]=g,e[40]=m,e[41]=I,e[42]=o):o=e[42];U=o;m=d("MWInboxTrayGating").isInboxTrayEnabled();e[43]!==I?(o=d("MWInboxContextSwitcherUtils").getCustomThreadFilter(I),e[43]=I,e[44]=o):o=e[44];o=o;var V;e[45]!==I?(V=d("MWInboxContextSwitcherUtils").getParentThreadKeyFromFilter(I),e[45]=I,e[46]=V):V=e[46];V=V;var W;e[47]!==F||e[48]!==S||e[49]!==O||e[50]!==R?(W=n.jsx(d("CometPageletWithDiv.react").Placeholder,{fallback:null,name:"MWJewelDropdownHeader",children:n.jsx(c("MWJewelDropdownHeader.react"),{inboxUrl:G,onClose:F,onOpenArchivedChats:S,onOpenMessageRequests:O,onOpenRestrictedAccountsList:R,title:x})}),e[47]=F,e[48]=S,e[49]=O,e[50]=R,e[51]=W):W=e[51];e[52]===Symbol["for"]("react.memo_cache_sentinel")?(S={className:"x1c4vz4f"},e[52]=S):S=e[52];e[53]!==F||e[54]!==A?(O=n.jsx(d("CometPageletWithDiv.react").Placeholder,{fallback:null,name:"MWJewelThreadListSearchTypeahead",children:n.jsx(c("MWJewelThreadListSearchTypeahead.react"),{onClose:F,pushPage:A})}),e[53]=F,e[54]=A,e[55]=O):O=e[55];R=m?U:null;var X;e[56]===Symbol["for"]("react.memo_cache_sentinel")?(X=n.jsx(c("MWInboxContextSwitcherGlimmer.react"),{}),e[56]=X):X=e[56];var Y;e[57]!==M||e[58]!==D||e[59]!==J?(Y=function(a){M(function(a){L(a.getTraceId())},void 0,void 0,"comet.jewel.messenger."+d("MWInboxContextSwitcherUtils").getTracePolicyFromFilter(a)),D(!1),J==null||J(a)},e[57]=M,e[58]=D,e[59]=J,e[60]=Y):Y=e[60];e[61]!==V||e[62]!==I||e[63]!==Y?(X=n.jsx(d("CometPageletWithDiv.react").Placeholder,{fallback:X,name:"MWInboxContextSwitcher",children:n.jsx(c("MWInboxContextSwitcherDeferred.react"),{entryPoint:"jewel",onTabChange:Y,parentThreadKey:V,selectedFilterTab:I})}),e[61]=V,e[62]=I,e[63]=Y,e[64]=X):X=e[64];e[65]!==a||e[66]!==O||e[67]!==R||e[68]!==X?(Y=n.jsxs("div",babelHelpers["extends"]({},S,{children:[O,R,a,X]})),e[65]=a,e[66]=O,e[67]=R,e[68]=X,e[69]=Y):Y=e[69];S=m?null:U;e[70]!==W||e[71]!==Y||e[72]!==S?(a=n.jsxs(n.Fragment,{children:[W,Y,S]}),e[70]=W,e[71]=Y,e[72]=S,e[73]=a):a=e[73];O=a;e[74]!==I?(R=d("MWInboxContextSwitcherUtils").getJewelEntryPointFromFilter(I),e[74]=I,e[75]=R):R=e[75];X=R;e[76]!==I?(m=d("MWInboxContextSwitcherUtils").getJewelLsSubEntryPointFromFilter(I),e[76]=I,e[77]=m):m=e[77];U=m;e[78]!==H||e[79]!==o||e[80]!==g||e[81]!==U||e[82]!==T||e[83]!==F||e[84]!==C||e[85]!==V||e[86]!==I?(W=g!=null&&d("MWInboxContextSwitcherUtils").shouldShowEBUpsellFromFilter(I)?n.jsx(n.Fragment,{children:g}):n.jsxs(n.Fragment,{children:[z&&(k||(k=d("I64"))).equal(I,(l||(l=d("LSIntEnum"))).ofNumber(c("LSThreadRangeFilter").COMMUNITIES))?n.jsx(c("CometPlaceholder.react"),{fallback:n.jsx(c("CometMessagingJewelDropdownContentGlimmer.react"),{isFullHeight:!0}),name:"CometMessagingJewelDropdownContent.MWCMBlendedThreadList",children:H!=null?n.jsx(d("CometRelay").EntryPointContainer,{entryPointReference:H,props:{filter:I,gridLabel:x.toString(),header:null,lsEntryPoint:"jewel",lsSubEntryPoint:U,onDropdownClose:F,onError:y,parentThreadKey:V}}):null}):n.jsx(c("MWThreadList.react"),{customThreadFilter:o,filter:I,gridLabel:x.toString(),lsEntryPoint:"jewel",lsSubEntryPoint:U,onClickNestedFolderThread:T,onClose:F,onOpenMessageRequests:C,parentThreadKey:V,responsive:!1},(k||(k=d("I64"))).to_string(I)),b("cr:7643")&&n.jsx(b("cr:7643"),{onClick:F,url:G})]}),e[78]=H,e[79]=o,e[80]=g,e[81]=U,e[82]=T,e[83]=F,e[84]=C,e[85]=V,e[86]=I,e[87]=W):W=e[87];e[88]!==O||e[89]!==W?(Y=n.jsx(s,{children:n.jsx(c("CometTopNavListDropdownCard.react"),{testid:void 0,useFullHeight:!0,useMaxHeight:!0,children:n.jsxs(c("CometMessagingJewelDropdownScrollableAreaForSmallScreens.react"),{children:[O,W]})})}),e[88]=O,e[89]=W,e[90]=Y):Y=e[90];S=Y;e[91]===Symbol["for"]("react.memo_cache_sentinel")?(a=n.jsx(c("CometMessagingJewelDropdownContentGlimmer.react"),{isFullHeight:!0,title:x}),e[91]=a):a=e[91];e[92]!==K||e[93]!==I||e[94]!==S?(R=K!=null?n.jsx(c("CometHeroInteractionWithDiv.react"),{interactionDesc:"JewelThreadList."+d("MWInboxContextSwitcherUtils").getInteractionDescFromFilter(I),interactionUUID:K,children:S}):S,e[92]=K,e[93]=I,e[94]=S,e[95]=R):R=e[95];e[96]!==R||e[97]!==X?(m=n.jsx(d("CometPageletWithDiv.react").Placeholder,{fallback:a,name:"MWJewelDropdownContent",children:n.jsx(d("WebUXLoggingEntryPointContextProvider").WebUXLoggingEntryPointContextProvider,{value:X,children:R})}),e[96]=R,e[97]=X,e[98]=m):m=e[98];return m}function B(a){return a.facebookUserId}function a(a){var b=d("react-compiler-runtime").c(2),e=C;b[0]!==a?(e=n.jsx(c("MAWUnrecoverableErrorBoundary.react"),{fallback:e,children:n.jsx(c("CometErrorBoundary.react"),{fallback:e,children:n.jsx(c("LSPlatformErrorsCatcher.react"),{fallback:e,children:n.jsx(A,babelHelpers["extends"]({},a))})})}),b[0]=a,b[1]=e):e=b[1];return e}function C(a){return n.jsx(w,{error:a})}C.displayName=C.name+" [from "+f.id+"]";e=o(a);g["default"]=e}),226);
__d("CometMessagingJewelDropdown.react",["fbt","BaseMultiStepContainer.react","BasePopoverReflowSheetContext","CometMessagingJewelDropdownContent.react","CometTopNavListDropdown.react","MWLogInboxFiltersInteraction","MWLogInteraction","cr:6188","justknobx","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react"));e=i;e.useCallback;var k=e.useContext;function a(a){var e=d("react-compiler-runtime").c(12),f=a.props;a=a.queries;var g=f.onClose,i=a.ebUpsellContainerQueryRef,m=a.mwInboxTrayContainerQuery;f=d("MWLogInteraction").getPopoverTrace();f==null||f.addAnnotation("PopoverEntrypoint","CometMessagingJewelDropdown");a=k(c("BasePopoverReflowSheetContext"));f=a.isReflowSheet;a=l;var n;e[0]===Symbol["for"]("react.memo_cache_sentinel")?(n=h._(/*BTDS*/"Messenger"),e[0]=n):n=e[0];var o;e[1]!==f?(o={0:{className:"x1cvmir6"},1:{className:"x14atkfc"}}[!!f<<0],e[1]=f,e[2]=o):o=e[2];e[3]!==i||e[4]!==m||e[5]!==g?(f=j.jsx(c("BaseMultiStepContainer.react"),{fitContentWidth:!0,onPageChange:a,children:function(a){return j.jsx(c("CometMessagingJewelDropdownContent.react"),{ebUpsellContainerQueryRef:i,mwInboxTrayContainerQuery:m,onClose:g,pushPage:a})}}),e[3]=i,e[4]=m,e[5]=g,e[6]=f):f=e[6];e[7]!==o||e[8]!==f?(a=j.jsx(c("CometTopNavListDropdown.react"),{label:n,name:"MWJewelDropdown",children:j.jsx("div",babelHelpers["extends"]({},o,{children:f}))}),e[7]=o,e[8]=f,e[9]=a):a=e[9];n=a;e[10]!==n?(o=b("cr:6188")!=null?j.jsx(b("cr:6188"),{children:n}):n,e[10]=n,e[11]=o):o=e[11];return o}function l(a){a>0&&c("justknobx")._("3802")&&(d("MWLogInteraction").logPopoverOpenCancel("popover_page_change"),d("MWLogInboxFiltersInteraction").logInboxFiltersNavigationCancel("popover_page_change"))}g["default"]=a}),226);
__d("FBIconCheckmarkFilled12.svg.react",["XPlatReactSVG","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){return i.jsxs(d("XPlatReactSVG").Svg,babelHelpers["extends"]({viewBox:"0 0 12 13",width:"1em",height:"1em",fill:"currentColor",title:a.title},a,{children:[a.children!=null&&i.jsx(d("XPlatReactSVG").Defs,{children:a.children}),i.jsx(d("XPlatReactSVG").G,{fillRule:"evenodd",transform:"translate(-450 -1073)",children:i.jsx(d("XPlatReactSVG").Path,{fillRule:"nonzero",d:"M451.78 1079.098a.75.75 0 0 0-1.06 1.06l3.08 3.082a.75.75 0 0 0 1.061 0l6.42-6.42a.75.75 0 0 0-1.061-1.06l-5.889 5.889-2.55-2.55z"})})]}))}a.displayName=a.name+" [from "+f.id+"]";a._isSVG=!0;b=a;g["default"]=b}),98);
__d("FBIconPauseCircleFilled12.svg.react",["XPlatReactSVG","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){return i.jsxs(d("XPlatReactSVG").Svg,babelHelpers["extends"]({viewBox:"0 0 12 13",width:"1em",height:"1em",fill:"currentColor",title:a.title},a,{children:[a.children!=null&&i.jsx(d("XPlatReactSVG").Defs,{children:a.children}),i.jsx(d("XPlatReactSVG").G,{fillRule:"evenodd",transform:"translate(-450 -1073)",children:i.jsx(d("XPlatReactSVG").Path,{d:"M459 1081.875c0 .344-.28.625-.625.625h-.75a.626.626 0 0 1-.625-.625v-4.75c0-.344.28-.625.625-.625h.75c.344 0 .625.28.625.625v4.75zm-4 0c0 .344-.28.625-.625.625h-.75a.626.626 0 0 1-.625-.625v-4.75c0-.344.28-.625.625-.625h.75c.344 0 .625.28.625.625v4.75zm1-8.375c-3.308 0-6 2.691-6 6s2.692 6 6 6 6-2.691 6-6-2.692-6-6-6z"})})]}))}a.displayName=a.name+" [from "+f.id+"]";a._isSVG=!0;b=a;g["default"]=b}),98);
__d("useHasOTCEligibleDevices",["MAWOneTimeCodeGating","ReQL","ReQLSuspense","react-compiler-runtime","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){var a=d("react-compiler-runtime").c(4),b=(h||(h=c("useReStore")))(),e;a[0]!==b.tables.encrypted_backups?(e=function(){return d("ReQL").fromTableAscending(b.tables.encrypted_backups)},a[0]=b.tables.encrypted_backups,a[1]=e):e=a[1];var g;a[2]!==b?(g=[b],a[2]=b,a[3]=g):g=a[3];a=d("ReQLSuspense").useFirst(e,g,f.id+":19");return a==null||!d("MAWOneTimeCodeGating").isOneTimeCodeEnabled()?!1:a.hasOtcEligibleDevices}g["default"]=a}),98);
__d("MWEBVirtualDevicesContextProvider.react",["MAWOneTimeCodeGating","MWEBVirtualDevicesContext.react","gkx","react","react-compiler-runtime","useHasOTCEligibleDevices","useMWEncryptedBackupsListenForChangesToVirtualDevicesV2"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react"));h.useMemo;var j=(b=c("gkx")("24064"))!=null?b:!1;function a(a){var b=d("react-compiler-runtime").c(14),e=a.children,f=a.hasOtcEligibleDevicesInitialValue,g=a.offlineDevicesCountInitialValue;a=a.vestaClientIDInitialValue;g=g===void 0?-1:g;a=a!=null?a:void 0;var h;b[0]!==g||b[1]!==a?(h={offlineDevicesCountInitialValue:g,vestaClientIDInitialValue:a},b[0]=g,b[1]=a,b[2]=h):h=b[2];g=c("useMWEncryptedBackupsListenForChangesToVirtualDevicesV2")(h);a=g.offlineDevicesCount;h=g.vestaClientID;g=c("useHasOTCEligibleDevices")();var k;b[3]!==g||b[4]!==f?(k=d("MAWOneTimeCodeGating").isOneTimeCodeEnabled()&&(j===!0||f===!0||g),b[3]=g,b[4]=f,b[5]=k):k=b[5];g=k;f=h!=null;b[6]!==g||b[7]!==a||b[8]!==f||b[9]!==h?(k={virtualDeviceInfo:{doesUserHaveOtcEligibleDevices:g,isPINCodeRegistered:f,offlineDevicesCount:a,vestaClientID:h}},b[6]=g,b[7]=a,b[8]=f,b[9]=h,b[10]=k):k=b[10];g=k;a=g;b[11]!==e||b[12]!==a?(f=i.jsx(d("MWEBVirtualDevicesContext.react").MWEBVirtualDevicesContext.Provider,{value:a,children:e}),b[11]=e,b[12]=a,b[13]=f):f=b[13];return f}g["default"]=a}),98);
__d("MWFDSCheckmark.svg.react",["cr:21598"],(function(a,b,c,d,e,f,g){"use strict";g["default"]=b("cr:21598")}),98);
__d("MWFDSPauseChat.svg.react",["cr:21726"],(function(a,b,c,d,e,f,g){"use strict";g["default"]=b("cr:21726")}),98);
__d("useMWEncryptedBackupsGetVirtualDevicesPreloaded_xfbEncryptedBackup.graphql",[],(function(a,b,c,d,e,f){"use strict";a={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"useMWEncryptedBackupsGetVirtualDevicesPreloaded_xfbEncryptedBackup",selections:[{alias:null,args:null,concreteType:"XFBEBVirtualDevice",kind:"LinkedField",name:"virtual_devices",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"client_generated_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_type",storageKey:null}],storageKey:null}],type:"XFBEncryptedBackup",abstractKey:null};e.exports=a}),null);
__d("useMWEncryptedBackupsGetVirtualDevicesPreloaded",["CometRelay","react","react-compiler-runtime","useMWEncryptedBackupsGetVirtualDevicesPreloaded_xfbEncryptedBackup.graphql"],(function(a,b,c,d,e,f,g){"use strict";var h,i;(i||d("react")).useCallback;function a(a){var c=d("react-compiler-runtime").c(4);a=a.encryptedBackup;var e=d("CometRelay").useFragment(h!==void 0?h:h=b("useMWEncryptedBackupsGetVirtualDevicesPreloaded_xfbEncryptedBackup.graphql"),a);c[0]!==(e==null?void 0:e.virtual_devices)?(a=function(){var a=0,b=null;e==null||e.virtual_devices.forEach(function(c){bb13:switch(c.device_type){case"HSM":b=c.client_generated_id;break bb13;case"OFFLINE":a=a+1;a;break bb13;default:}});return{offlineDevicesCount:a,vestaClientID:b}},c[0]=e==null?void 0:e.virtual_devices,c[1]=a):a=c[1];e==null||e.virtual_devices;a=a;var f;c[2]!==a?(f={getVirtualDevices:a},c[2]=a,c[3]=f):f=c[3];return f}g["default"]=a}),98);